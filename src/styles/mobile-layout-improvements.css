/* ============================================
   MOBILE LAYOUT IMPROVEMENTS 2026
   Fixes for common mobile layout issues
   ============================================ */

/* ======================
   CRITICAL MOBILE FIXES
   ====================== */

/* Prevent horizontal scroll on mobile */
@media screen and (max-width: 768px) {
  /* GLOBAL: Prevent any horizontal overflow */
  * {
    box-sizing: border-box;
  }
  
  html,
  body,
  #root,
  .App,
  .pro-layout,
  .pro-main {
    width: 100% !important;
    max-width: 100vw !important;
    overflow-x: hidden !important;
    position: relative !important;
    box-sizing: border-box !important;
  }
  
  html,
  body {
    height: 100vh !important;
    height: 100dvh !important;
    max-height: 100vh !important;
    max-height: 100dvh !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
    width: 100% !important;
    position: relative !important;
  }
  
  /* Fix for dynamic background that might cause overflow */
  .dynamic-background,
  .gradient-orb,
  .floating-particles {
    max-width: 100vw !important;
    overflow: hidden !important;
  }
  
  /* Pro Layout - Ensure proper mobile structure */
  .pro-layout {
    display: flex !important;
    flex-direction: column !important;
    height: 100vh !important;
    height: 100dvh !important;
    max-height: 100vh !important;
    max-height: 100dvh !important;
    grid-template-columns: unset !important;
    grid-template-areas: unset !important;
    overflow: hidden !important;
  }
  
  /* Ensure main content area fills available space */
  .pro-layout .pro-main,
  .pro-layout .pro-content {
    flex: 1 1 auto !important;
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
    min-height: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
  }
  
  /* HEADER - Fixed at top, proper z-index */
  /* DISABLED - Controlled by mobile-final-override.css */
  /* .pro-header,
  .enhanced-chat-header {
    position: sticky !important;
    top: env(safe-area-inset-top, 0px) !important;
    left: 0 !important;
    right: 0 !important;
    width: 100% !important;
    min-height: 54px !important;
    max-height: 80px !important;
    padding: 8px 12px !important;
    background: var(--pro-surface, #ffffff) !important;
    border-bottom: 1px solid var(--pro-border, rgba(0, 0, 0, 0.1)) !important;
    border-radius: 0 0 20px 20px !important;
    z-index: 100 !important;
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    flex-shrink: 0 !important;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
  } */
  
  /* Simplify conversation info on mobile */
  .participant-count {
    display: none !important;
  }
  
  .conversation-info {
    flex: 1 !important;
    min-width: 0 !important;
  }
  
  .conversation-title {
    font-size: 15px !important;
    margin: 0 !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }
  
  /* Hide less critical header actions */
  .header-actions .notification-btn,
  .header-actions .invite-user-btn,
  .header-actions .file-share-btn,
  .header-actions .donation-btn {
    display: none !important;
  }
  
  /* Header left section */
  .pro-header .header-left,
  .enhanced-chat-header .header-left {
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
    flex: 1 !important;
    min-width: 0 !important;
    overflow: visible !important;
  }

  /* Conversation info takes available space but truncates text */
  .pro-header .conversation-info,
  .enhanced-chat-header .conversation-info {
    flex: 1 !important;
    min-width: 0 !important;
    overflow: hidden !important;
  }

  /* Header actions (buttons) never shrink so â‹® stays visible */
  .pro-header .header-actions,
  .enhanced-chat-header .header-actions {
    flex-shrink: 0 !important;
    overflow: visible !important;
  }
  
  /* Mobile menu button */
  .mobile-menu-btn {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 36px !important;
    height: 36px !important;
    padding: 0 !important;
    margin-right: 4px !important;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    border: 2px solid white !important;
    border-radius: 10px !important;
    color: white !important;
    font-size: 18px !important;
    flex-shrink: 0 !important;
    cursor: pointer !important;
    z-index: 101 !important;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3) !important;
  }
  
  /* MAIN CONTENT AREA - Scrollable middle */
  .pro-main {
    flex: 1 !important;
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
    position: relative !important;
    min-height: 0 !important;
  }
  
  /* Pro-content wrapper - Flex column layout */
  .pro-content {
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important;
    width: 100% !important;
    overflow: hidden !important;
    position: relative !important;
  }
  
  /* Message list - Scrollable area above input */
  /* DISABLED - Controlled by mobile-final-override.css */
  /* .pro-message-list,
  .pro-message-area,
  .pro-content > .pro-message-list {
    flex: 1 1 auto !important;
    order: 1 !important;
    width: 100% !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    padding: 8px 12px 100px 12px !important;
    -webkit-overflow-scrolling: touch !important;
    min-height: 0 !important;
  } */
  
  /* Ensure messages don't overlap with input */
  .pro-message-list:after,
  .pro-message-area:after {
    content: '' !important;
    display: block !important;
    height: 8px !important;
    width: 100% !important;
    flex-shrink: 0 !important;
  }
  
  /* INPUT CONTAINER - Fixed at bottom */
  .pro-content > .pro-chat-input-container,
  .pro-chat-input-container,
  .message-input-container {
    flex: 0 0 auto !important;
    order: 2 !important;
    position: sticky !important;
    bottom: 0 relative !important;
    width: 100% !important;
    max-width: 100%px !important;
    padding-bottom: max(10px, env(safe-area-inset-bottom, 0px)) !important;
    background: var(--pro-surface, #ffffff) !important;
    border-top: 1px solid var(--pro-border, rgba(0, 0, 0, 0.1)) !important;
    box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05) !important;
    z-index: 90 !important;
  }
  
  /* Message input wrapper */
  .message-input-wrapper {
    display: flex !important;
    align-items: flex-end !important;
    gap: 6px !important;
    width: 100% !important;
    max-width: 100% !important;
  }
  
  /* Message input field */
  .pro-input,
  .message-input,
  .pro-message-input {
    flex: 1 !important;
    min-width: 0 !important;
    max-width: 100% !important;
    min-height: 40px !important;
    max-height: 120px !important;
    padding: 10px 14px !important;
    font-size: 15px !important;
    border-radius: 20px !important;
    border: 1px solid var(--pro-border, rgba(0, 0, 0, 0.1)) !important;
    background: var(--pro-bg, #f8fafc) !important;
    resize: none !important;
    outline: none !important;
  }
  
  /* Input action buttons */
  .input-actions,
  .message-actions {
    display: flex !important;
    gap: 4px !important;
    flex-shrink: 0 !important;
  }
  
  .input-action-btn,
  .message-action-btn {
    width: 40px !important;
    height: 40px !important;
    min-width: 40px !important;
    padding: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    border-radius: 50% !important;
  }
  
  .send-btn,
  .pro-send-btn {
    width: 40px !important;
    height: 40px !important;
    min-width: 40px !important;
    padding: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    border-radius: 50% !important;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    color: white !important;
    border: none !important;
    flex-shrink: 0 !important;
  }
  
  /* SIDEBAR - Overlay style */
  .pro-sidebar,
  .enhanced-sidebar {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    bottom: 0 !important;
    width: 280px !important;
    max-width: 85vw !important;
    background: var(--pro-surface, #ffffff) !important;
    box-shadow: 2px 0 12px rgba(0, 0, 0, 0.15) !important;
    z-index: 999 !important;
    transform: translateX(-100%) !important;
    transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1) !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
  }
  
  /* Show sidebar when active */
  .pro-sidebar:not(.collapsed),
  .enhanced-sidebar:not(.collapsed),
  .pro-sidebar.active,
  .enhanced-sidebar.active {
    transform: translateX(0) !important;
  }
  
  /* Hide sidebar when collapsed */
  .pro-sidebar.collapsed,
  .enhanced-sidebar.collapsed {
    transform: translateX(-100%) !important;
  }
  
  /* Sidebar overlay backdrop */
  .pro-sidebar-overlay,
  .sidebar-overlay {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    background: rgba(0, 0, 0, 0.5) !important;
    backdrop-filter: blur(2px) !important;
    z-index: 998 !important;
    display: block !important;
  }
  
  /* Hide overlay when sidebar is collapsed */
  .pro-sidebar.collapsed ~ .pro-sidebar-overlay,
  .enhanced-sidebar.collapsed ~ .sidebar-overlay {
    display: none !important;
  }
  
  /* Message bubbles */
  .pro-message,
  .message-bubble,
  .pro-message-blurb {
    max-width: 85% !important;
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
  }
  
  /* Images and media */
  .message-image,
  .pro-message-image,
  img {
    max-width: 100% !important;
    height: auto !important;
  }
  
  /* Video and audio */
  video,
  audio {
    max-width: 100% !important;
  }
  
  /* Modals and overlays */
  .modal,
  .pro-modal {
    max-width: 95vw !important;
    max-height: 90vh !important;
  }
  
  /* Safe area insets for notched devices */
  @supports (padding: max(0px)) {
    .pro-header,
    .enhanced-chat-header {
      padding-top: max(10px, env(safe-area-inset-top)) !important;
      padding-left: max(12px, env(safe-area-inset-left)) !important;
      padding-right: max(12px, env(safe-area-inset-right)) !important;
    }
    
    .pro-chat-input-container,
    .message-input-container {
      padding-bottom: max(10px, env(safe-area-inset-bottom)) !important;
      padding-left: max(12px, env(safe-area-inset-left)) !important;
      padding-right: max(12px, env(safe-area-inset-right)) !important;
    }
    
    .pro-sidebar,
    .enhanced-sidebar {
      padding-top: max(0px, env(safe-area-inset-top)) !important;
      padding-bottom: max(0px, env(safe-area-inset-bottom)) !important;
    }
  }
}

/* Extra small phones (< 380px) */
@media screen and (max-width: 380px) {
  .pro-header,
  .enhanced-chat-header {
    min-height: 52px !important;
    padding: 8px 10px !important;
  }
  
  .mobile-menu-btn {
    width: 40px !important;
    height: 40px !important;
    font-size: 20px !important;
  }
  
  .conversation-title {
    font-size: 14px !important;
  }
  
  .conversation-status {
    font-size: 11px !important;
  }
  
  .pro-chat-input-container,
  .message-input-container {
    padding: 8px 10px !important;
  }
  
  .pro-input,
  .message-input {
    font-size: 14px !important;
    padding: 8px 12px !important;
  }
  
  .send-btn,
  .pro-send-btn {
    width: 36px !important;
    height: 36px !important;
    min-width: 36px !important;
  }
}

/* Landscape mode on mobile */
@media screen and (max-width: 768px) and (orientation: landscape) {
  .pro-header,
  .enhanced-chat-header {
    min-height: 48px !important;
    padding: 6px 12px !important;
  }
  
  .mobile-menu-btn {
    width: 40px !important;
    height: 40px !important;
  }
  
  /* Message list needs proper padding, not pro-content */
  .pro-message-list,
  .pro-message-area {
    padding-bottom: 16px !important;
  }
}

/* ======================
   TOUCH IMPROVEMENTS
   ====================== */

@media screen and (max-width: 768px) {
  /* Improve tap targets */
  button,
  a,
  .clickable {
    min-width: 44px !important;
    min-height: 44px !important;
  }
  
  /* Remove tap highlight color that interferes with custom styling */
  a,
  button,
  input,
  textarea {
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
  }
  
  /* Improve scrolling on touch devices */
  .scrollable,
  .pro-message-list,
  .pro-message-area,
  .pro-content,
  .pro-sidebar,
  .enhanced-sidebar {
    -webkit-overflow-scrolling: touch !important;
    scroll-behavior: smooth;
  }
}

/* ======================
   PREVENT ZOOM ON INPUT
   ====================== */

@media screen and (max-width: 768px) {
  /* Prevent zoom on input focus (iOS) */
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="search"],
  input[type="tel"],
  input[type="url"],
  textarea {
    font-size: 16px !important; /* iOS won't zoom if font-size >= 16px */
  }
}

/* ======================
   FIX COMMON ISSUES
   ====================== */

@media screen and (max-width: 768px) {
  /* Fix for elements breaking out of container */
  .pro-layout * {
    max-width: 100% !important;
  }
  
  /* Ensure no element causes horizontal scroll */
  .pro-layout > * {
    box-sizing: border-box !important;
  }
  
  /* Fix for long words/URLs breaking layout */
  .message-text,
  .pro-message-text,
  .message-content {
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    hyphens: auto !important;
  }
  
  /* Fix for pre/code blocks */
  pre,
  code {
    max-width: 100% !important;
    overflow-x: auto !important;
    white-space: pre-wrap !important;
    word-wrap: break-word !important;
  }
  
  /* Fix for tables */
  table {
    max-width: 100% !important;
    overflow-x: auto !important;
    display: block !important;
  }
}

/* ======================
   INPUT WRAPPER & ACTIONS
   ====================== */

@media screen and (max-width: 768px) {
  /* Input wrapper should flex row */
  .pro-chat-input-container .input-wrapper,
  .input-wrapper {
    display: flex !important;
    flex-direction: column !important;
    gap: 8px !important;
    width: 100% !important;
  }
  
  /* Action buttons row above input */
  .input-actions-row,
  .input-actions {
    display: flex !important;
    flex-direction: row !important;
    gap: 6px !important;
    justify-content: flex-start !important;
    align-items: center !important;
    flex-wrap: nowrap !important;
    width: 100% !important;
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
    scrollbar-width: none !important;
  }
  
  .input-actions-row::-webkit-scrollbar,
  .input-actions::-webkit-scrollbar {
    display: none !important;
  }
  
  /* Message input row */
  .message-input-row {
    display: flex !important;
    flex-direction: row !important;
    gap: 8px !important;
    align-items: flex-end !important;
    width: 100% !important;
  }
  
  /* Input buttons size */
  .input-btn,
  .input-action-btn {
    width: 36px !important;
    height: 36px !important;
    min-width: 36px !important;
    min-height: 36px !important;
    padding: 6px !important;
    flex-shrink: 0 !important;
  }
}

/* ==================== END OF MOBILE IMPROVEMENTS ==================== */
