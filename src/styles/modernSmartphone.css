/**
 * Modern Smartphone CSS
 * Enhanced styles for latest devices with cutting-edge features
 * Supports: iPhone 15 Pro, Samsung Galaxy S24, foldable devices, 120Hz displays
 */

/* Modern CSS Custom Properties */
:root {
  /* Modern viewport units with fallbacks */
  --modern-vh: 100vh;
  --modern-svh: 100vh;
  --modern-lvh: 100vh;
  --modern-dvh: 100vh;
  --modern-vw: 100vw;
  --modern-svw: 100vw;
  --modern-lvw: 100vw;
  --modern-dvw: 100vw;
  
  /* Safe viewport dimensions */
  --safe-height: calc(100vh - var(--safe-area-top, 0px) - var(--safe-area-bottom, 0px));
  --safe-width: calc(100vw - var(--safe-area-left, 0px) - var(--safe-area-right, 0px));
  
  /* Dynamic island support */
  --dynamic-island-height: 37px;
  --dynamic-island-width: 126px;
  
  /* High refresh rate optimizations */
  --animation-duration-multiplier: 1;
  --scroll-snap-smoothing: 0.3s;
  
  /* Container query breakpoints */
  --mobile-container: 320px;
  --tablet-container: 768px;
  --desktop-container: 1024px;
  
  /* Touch target sizes */
  --touch-target-min: 44px;
  --touch-target-comfortable: 48px;
  
  /* Modern color spaces */
  --primary-p3: color(display-p3 0.2 0.4 0.9);
  --primary-fallback: #4a90e2;
}

/* Use new viewport units where supported */
@supports (height: 100dvh) {
  :root {
    --modern-dvh: 100dvh;
    --modern-svh: 100svh;
    --modern-lvh: 100lvh;
  }
}

@supports (width: 100dvw) {
  :root {
    --modern-dvw: 100dvw;
    --modern-svw: 100svw;
    --modern-lvw: 100lvw;
  }
}

/* Dynamic viewport units for main containers */
.login-container,
.main-container,
.chat-container {
  min-height: var(--modern-dvh);
  height: var(--modern-dvh);
}

@supports (height: 100dvh) {
  .login-container,
  .main-container,
  .chat-container {
    min-height: 100dvh;
    height: 100dvh;
  }
}

/* Safe area optimization for all containers */
.safe-area-container {
  padding-top: var(--safe-area-top, 0px);
  padding-right: var(--safe-area-right, 0px);
  padding-bottom: var(--safe-area-bottom, 0px);
  padding-left: var(--safe-area-left, 0px);
}

/* High refresh rate display optimizations */
.high-refresh-display {
  --scroll-behavior: smooth;
}

.high-refresh-display * {
  /* Optimize animations for 120Hz */
  transition-duration: calc(var(--transition-duration, 0.3s) * var(--animation-duration-multiplier, 0.83));
  animation-duration: calc(var(--animation-duration, 1s) * var(--animation-duration-multiplier, 0.83));
}

.high-refresh-display .smooth-scroll {
  scroll-behavior: smooth;
  scroll-snap-type: y mandatory;
  scroll-padding-top: var(--safe-area-top, 20px);
}

/* iPhone 15 Pro specific optimizations */
@media only screen 
  and (device-width: 393px) 
  and (device-height: 852px) 
  and (-webkit-device-pixel-ratio: 3) {
  
  .has-dynamic-island .header-safe-area {
    padding-top: calc(var(--dynamic-island-height) + 12px);
  }
  
  .has-dynamic-island .auth-form {
    margin-top: calc(var(--dynamic-island-height) + 20px);
  }
  
  /* ProMotion display optimizations */
  .smooth-animations {
    will-change: transform, opacity;
    transform: translateZ(0); /* Force hardware acceleration */
  }
}

/* Samsung Galaxy S24 optimizations */
@media only screen 
  and (min-device-width: 360px) 
  and (max-device-width: 412px) 
  and (min-device-height: 800px) 
  and (max-device-height: 950px) 
  and (-webkit-device-pixel-ratio: 3) {
  
  .has-edge-display .content-area {
    margin-left: 8px;
    margin-right: 8px;
    border-radius: 16px;
  }
  
  /* Edge-to-edge optimization */
  .edge-optimized {
    padding-left: max(12px, var(--safe-area-left, 0px));
    padding-right: max(12px, var(--safe-area-right, 0px));
  }
}

/* Foldable device support */
.foldable-device {
  /* Base foldable styles */
  --fold-transition: 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

@media (orientation: fold) {
  .foldable-device .main-content {
    transform: scale(0.95);
    transition: transform var(--fold-transition);
  }
}

/* Dual screen support */
.dual-screen .split-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--screen-gap, 20px);
}

@media (spanning: single-fold-vertical) {
  .dual-screen .split-layout {
    grid-template-columns: 1fr;
    grid-template-rows: 1fr 1fr;
  }
}

/* Container queries for responsive components */
@supports (container-type: inline-size) {
  .responsive-container {
    container-type: inline-size;
  }
  
  @container (min-width: 320px) {
    .auth-form {
      padding: 24px;
    }
  }
  
  @container (min-width: 480px) {
    .auth-form {
      padding: 32px;
      max-width: 400px;
    }
  }
}

/* Advanced color support */
@supports (color: color(display-p3 1 0 0)) {
  .modern-colors {
    background: var(--primary-p3);
  }
}

/* Fallback for older browsers */
@supports not (color: color(display-p3 1 0 0)) {
  .modern-colors {
    background: var(--primary-fallback);
  }
}

/* Enhanced touch targets */
.touch-optimized {
  min-height: var(--touch-target-comfortable);
  min-width: var(--touch-target-comfortable);
  
  /* Improve touch response */
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* Large touch targets for accessibility */
@media (pointer: coarse) {
  .touch-target {
    min-height: var(--touch-target-min);
    min-width: var(--touch-target-min);
    padding: 8px 12px;
  }
}

/* Modern scrolling optimizations */
.smooth-scroll-container {
  scroll-behavior: smooth;
  scroll-snap-type: y proximity;
  overscroll-behavior: contain;
  
  /* iOS momentum scrolling */
  -webkit-overflow-scrolling: touch;
  
  /* Hide scrollbars on mobile */
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.smooth-scroll-container::-webkit-scrollbar {
  display: none;
}

/* Enhanced animations for high refresh rate displays */
@keyframes modernFadeIn {
  from {
    opacity: 0;
    transform: translateY(10px) scale(0.98);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes modernSlideIn {
  from {
    transform: translateX(-100%) scale(0.95);
    opacity: 0;
  }
  to {
    transform: translateX(0) scale(1);
    opacity: 1;
  }
}

.modern-fade-in {
  animation: modernFadeIn calc(0.4s * var(--animation-duration-multiplier)) cubic-bezier(0.16, 1, 0.3, 1);
}

.modern-slide-in {
  animation: modernSlideIn calc(0.5s * var(--animation-duration-multiplier)) cubic-bezier(0.16, 1, 0.3, 1);
}

/* Interactive feedback for high refresh rate displays */
.high-refresh-display .interactive-element {
  transition: all calc(0.1s * var(--animation-duration-multiplier)) ease-out;
}

.high-refresh-display .interactive-element:active {
  transform: scale(0.96);
  transition-duration: calc(0.05s * var(--animation-duration-multiplier));
}

/* GPU acceleration for smooth animations */
.gpu-accelerated {
  will-change: transform, opacity;
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

/* Modern layout with CSS Grid and Flexbox */
.modern-layout {
  display: grid;
  grid-template-rows: auto 1fr auto;
  min-height: var(--modern-dvh);
  gap: 0;
}

.modern-flex-container {
  display: flex;
  flex-direction: column;
  min-height: var(--modern-dvh);
  gap: 0;
}

/* Enhanced focus indicators for keyboard navigation */
.modern-focus:focus-visible {
  outline: 2px solid var(--primary-p3, var(--primary-fallback));
  outline-offset: 2px;
  border-radius: 4px;
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* High contrast support */
@media (prefers-contrast: high) {
  .modern-colors {
    background: #000;
    color: #fff;
    border: 2px solid #fff;
  }
}

/* Dark mode optimizations */
@media (prefers-color-scheme: dark) {
  :root {
    --primary-p3: color(display-p3 0.4 0.6 1);
    --primary-fallback: #6fa8f5;
  }
}

/* Modern shadows with better performance */
.modern-shadow {
  box-shadow: 
    0 2px 8px -2px rgba(0, 0, 0, 0.1),
    0 6px 20px -6px rgba(0, 0, 0, 0.12);
  
  /* Optimize shadow rendering */
  isolation: isolate;
}

/* Enhanced mobile header with dynamic island support */
.modern-mobile-header {
  position: sticky;
  top: var(--safe-area-top, 0px);
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  z-index: 1000;
  
  /* Account for dynamic island */
  margin-top: var(--dynamic-island-height, 0px);
}

.has-dynamic-island .modern-mobile-header {
  border-radius: 0 0 16px 16px;
  margin-left: 8px;
  margin-right: 8px;
  margin-top: calc(var(--dynamic-island-height) + 8px);
}

/* Modern modal with enhanced backdrop */
.modern-modal {
  backdrop-filter: blur(20px) saturate(150%);
  -webkit-backdrop-filter: blur(20px) saturate(150%);
  background: rgba(0, 0, 0, 0.4);
}

.modern-modal-content {
  border-radius: 16px;
  background: rgba(255, 255, 255, 0.95);
  box-shadow: 
    0 10px 40px -10px rgba(0, 0, 0, 0.2),
    0 0 0 1px rgba(255, 255, 255, 0.1);
}

/* Enhanced form styling for modern devices */
.modern-form {
  --form-border-radius: 12px;
  --form-spacing: 16px;
}

.modern-form input {
  border-radius: var(--form-border-radius);
  padding: 16px;
  font-size: 16px; /* Prevent zoom on iOS */
  border: 1px solid rgba(0, 0, 0, 0.1);
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(10px);
  transition: all calc(0.2s * var(--animation-duration-multiplier)) ease;
}

.modern-form input:focus {
  border-color: var(--primary-p3, var(--primary-fallback));
  box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
  transform: translateY(-1px);
}

/* Ultra-wide display support */
@media (min-aspect-ratio: 21/9) {
  .ultra-wide-layout {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 40px;
  }
}

/* Print optimizations */
@media print {
  .modern-layout {
    display: block;
  }
  
  .modern-shadow,
  .modern-modal {
    box-shadow: none;
    backdrop-filter: none;
  }
}