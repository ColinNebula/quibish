<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social Profile Test - Quibish</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 48px;
      margin-bottom: 10px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .header p {
      font-size: 18px;
      opacity: 0.9;
    }

    .test-controls {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      margin-bottom: 30px;
    }

    .test-controls h2 {
      margin-bottom: 20px;
      color: #333;
    }

    .user-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .user-btn {
      padding: 15px 25px;
      border: 2px solid #667eea;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .user-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
    }

    .api-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .api-section h3 {
      margin-bottom: 15px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .endpoint {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid #667eea;
    }

    .endpoint-method {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-weight: 700;
      font-size: 12px;
      margin-right: 10px;
    }

    .get { background: #28a745; color: white; }
    .post { background: #007bff; color: white; }
    .put { background: #ffc107; color: #333; }
    .delete { background: #dc3545; color: white; }

    .endpoint-url {
      font-family: 'Courier New', monospace;
      font-size: 14px;
      color: #666;
    }

    .endpoint-desc {
      margin-top: 8px;
      font-size: 13px;
      color: #777;
    }

    .test-btn {
      padding: 8px 16px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      margin-top: 10px;
      transition: all 0.2s;
    }

    .test-btn:hover {
      background: #764ba2;
      transform: translateY(-2px);
    }

    .response-box {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 6px;
      margin-top: 10px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      display: none;
    }

    .response-box.show {
      display: block;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .feature-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .feature-card h4 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .feature-card ul {
      list-style: none;
      padding: 0;
    }

    .feature-card li {
      padding: 5px 0;
      font-size: 14px;
      color: #666;
    }

    .feature-card li:before {
      content: "‚úì ";
      color: #28a745;
      font-weight: bold;
    }

    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-online { background: #28a745; }
    .status-offline { background: #dc3545; }

    .server-status {
      background: white;
      padding: 15px 20px;
      border-radius: 10px;
      display: inline-flex;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .pulse {
      animation: pulse 2s infinite;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üé≠ Social Profile Test</h1>
      <p>Enhanced User Profiles - Priority 1 Complete ‚úÖ</p>
    </div>

    <div class="server-status">
      <span class="status-indicator status-online pulse"></span>
      <strong>Backend Server:</strong>&nbsp;
      <span id="serverStatus">Checking...</span>
    </div>

    <div class="test-controls">
      <h2>üë• Test User Profiles</h2>
      <p style="margin-bottom: 20px; color: #666;">Click a button to test the profile API for each user:</p>
      
      <div class="user-buttons">
        <button class="user-btn" onclick="loadProfile('demo')">
          üë§ Demo User
        </button>
        <button class="user-btn" onclick="loadProfile('john')">
          üíª John Doe (Engineer)
        </button>
        <button class="user-btn" onclick="loadProfile('jane')">
          üé® Jane Smith (Designer)
        </button>
        <button class="user-btn" onclick="loadProfile('admin')">
          ‚≠ê Admin (Verified)
        </button>
      </div>

      <div id="profileDisplay" style="display: none;">
        <div class="api-section">
          <h3>üìä Profile Data</h3>
          <div id="profileContent"></div>
        </div>
      </div>
    </div>

    <div class="test-controls">
      <h2>üîå API Endpoints</h2>
      
      <div class="api-section">
        <h3>üìñ Profile Endpoints</h3>
        
        <div class="endpoint">
          <div>
            <span class="endpoint-method get">GET</span>
            <span class="endpoint-url">/api/social-profiles/:userId</span>
          </div>
          <div class="endpoint-desc">Fetch complete user profile with statistics and friendship status</div>
          <button class="test-btn" onclick="testEndpoint('GET', '/api/social-profiles/demo', null, 'resp1')">Test</button>
          <pre class="response-box" id="resp1"></pre>
        </div>

        <div class="endpoint">
          <div>
            <span class="endpoint-method get">GET</span>
            <span class="endpoint-url">/api/social-profiles/:userId/stats</span>
          </div>
          <div class="endpoint-desc">Get user statistics (friends, posts, followers, following)</div>
          <button class="test-btn" onclick="testEndpoint('GET', '/api/social-profiles/demo/stats', null, 'resp2')">Test</button>
          <pre class="response-box" id="resp2"></pre>
        </div>

        <div class="endpoint">
          <div>
            <span class="endpoint-method put">PUT</span>
            <span class="endpoint-url">/api/social-profiles/update</span>
          </div>
          <div class="endpoint-desc">Update profile (bio, headline, location, etc.) - Requires authentication</div>
          <button class="test-btn" onclick="alert('This endpoint requires authentication. Login first to test.')">Test (Auth Required)</button>
        </div>

        <div class="endpoint">
          <div>
            <span class="endpoint-method post">POST</span>
            <span class="endpoint-url">/api/social-profiles/cover-photo</span>
          </div>
          <div class="endpoint-desc">Upload cover photo - Requires authentication</div>
          <button class="test-btn" onclick="alert('This endpoint requires authentication. Login first to test.')">Test (Auth Required)</button>
        </div>

        <div class="endpoint">
          <div>
            <span class="endpoint-method delete">DELETE</span>
            <span class="endpoint-url">/api/social-profiles/cover-photo</span>
          </div>
          <div class="endpoint-desc">Remove cover photo - Requires authentication</div>
          <button class="test-btn" onclick="alert('This endpoint requires authentication. Login first to test.')">Test (Auth Required)</button>
        </div>
      </div>
    </div>

    <div class="test-controls">
      <h2>‚ú® Implemented Features</h2>
      <div class="features-grid">
        <div class="feature-card">
          <h4>üì± Frontend Component</h4>
          <ul>
            <li>Cover photo display</li>
            <li>Large avatar with overlay</li>
            <li>Verification badge</li>
            <li>Profile statistics</li>
            <li>Edit mode for own profile</li>
            <li>Responsive design</li>
            <li>Dark mode support</li>
          </ul>
        </div>

        <div class="feature-card">
          <h4>üîß Backend API</h4>
          <ul>
            <li>Get profile endpoint</li>
            <li>Update profile endpoint</li>
            <li>Upload cover photo</li>
            <li>Get statistics</li>
            <li>Dual storage support</li>
            <li>Authentication middleware</li>
          </ul>
        </div>

        <div class="feature-card">
          <h4>üíæ Database Schema</h4>
          <ul>
            <li>Bio & headline fields</li>
            <li>Cover photo URL</li>
            <li>Location & website</li>
            <li>Company & job title</li>
            <li>Interests (JSON)</li>
            <li>Statistics counters</li>
            <li>Verification & badges</li>
          </ul>
        </div>

        <div class="feature-card">
          <h4>üé® User Experience</h4>
          <ul>
            <li>Loading states</li>
            <li>Error handling</li>
            <li>Form validation</li>
            <li>File upload UI</li>
            <li>Interest tags</li>
            <li>Tab navigation</li>
            <li>Mobile optimized</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="test-controls">
      <h2>üìù Next Steps</h2>
      <div class="api-section">
        <h3>üöÄ Priority 2: Posts & News Feed</h3>
        <p style="margin: 10px 0; color: #666;">
          Create posts with text, images, and videos. Build a dynamic news feed with likes, comments, and shares.
        </p>
      </div>
      <div class="api-section">
        <h3>ü§ù Priority 3: Friend Connections</h3>
        <p style="margin: 10px 0; color: #666;">
          Send and accept friend requests. Display friends list on profile pages. Show mutual friends.
        </p>
      </div>
      <div class="api-section">
        <h3>üîî Priority 4: Notifications System</h3>
        <p style="margin: 10px 0; color: #666;">
          Real-time notifications for profile views, friend requests, post interactions, and mentions.
        </p>
      </div>
    </div>
  </div>

  <script>
    // Check server status
    async function checkServer() {
      try {
        const response = await fetch('/api/health');
        const data = await response.json();
        document.getElementById('serverStatus').innerHTML = 
          `<span style="color: #28a745;">‚úì Online</span> (${data.uptime || 'running'})`;
      } catch (error) {
        document.getElementById('serverStatus').innerHTML = 
          '<span style="color: #dc3545;">‚úó Offline</span>';
      }
    }

    // Load user profile
    async function loadProfile(userId) {
      const displayDiv = document.getElementById('profileDisplay');
      const contentDiv = document.getElementById('profileContent');
      
      displayDiv.style.display = 'block';
      contentDiv.innerHTML = '<p style="color: #999;">Loading...</p>';

      try {
        const response = await fetch(`/api/social-profiles/${userId}`);
        const data = await response.json();

        if (data.success) {
          const profile = data.profile;
          contentDiv.innerHTML = `
            <div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #667eea;">
              <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                <img src="${profile.avatar || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(profile.name)}" 
                     alt="${profile.name}"
                     style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid #667eea;">
                <div>
                  <h3 style="margin: 0; font-size: 24px; color: #333;">
                    ${profile.displayName || profile.name}
                    ${profile.is_verified ? ' <span style="color: #667eea;">‚úì</span>' : ''}
                  </h3>
                  <p style="margin: 5px 0; color: #666;">@${profile.username}</p>
                  ${profile.headline ? `<p style="margin: 5px 0; color: #667eea; font-weight: 600;">${profile.headline}</p>` : ''}
                </div>
              </div>

              ${profile.bio ? `
                <div style="margin-bottom: 15px;">
                  <strong style="color: #333;">Bio:</strong>
                  <p style="margin: 5px 0; color: #666;">${profile.bio}</p>
                </div>
              ` : ''}

              <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px;">
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                  <strong style="display: block; font-size: 24px; color: #667eea;">${profile.friends_count || 0}</strong>
                  <span style="font-size: 12px; color: #666; text-transform: uppercase;">Friends</span>
                </div>
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                  <strong style="display: block; font-size: 24px; color: #667eea;">${profile.posts_count || 0}</strong>
                  <span style="font-size: 12px; color: #666; text-transform: uppercase;">Posts</span>
                </div>
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                  <strong style="display: block; font-size: 24px; color: #667eea;">${profile.followers_count || 0}</strong>
                  <span style="font-size: 12px; color: #666; text-transform: uppercase;">Followers</span>
                </div>
                <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                  <strong style="display: block; font-size: 24px; color: #667eea;">${profile.following_count || 0}</strong>
                  <span style="font-size: 12px; color: #666; text-transform: uppercase;">Following</span>
                </div>
              </div>

              ${profile.interests && profile.interests.length > 0 ? `
                <div style="margin-top: 20px;">
                  <strong style="color: #333;">Interests:</strong>
                  <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                    ${profile.interests.map(interest => `
                      <span style="padding: 6px 14px; background: #667eea15; color: #667eea; border-radius: 20px; border: 2px solid #667eea; font-size: 13px; font-weight: 500;">
                        ${interest}
                      </span>
                    `).join('')}
                  </div>
                </div>
              ` : ''}

              <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e1e4e8;">
                ${profile.location ? `<p style="margin: 5px 0; color: #666;">üìç ${profile.location}</p>` : ''}
                ${profile.website ? `<p style="margin: 5px 0;"><a href="${profile.website}" target="_blank" style="color: #667eea;">üîó ${profile.website}</a></p>` : ''}
                ${profile.company ? `<p style="margin: 5px 0; color: #666;">üè¢ ${profile.company}${profile.jobTitle ? ' ‚Ä¢ ' + profile.jobTitle : ''}</p>` : ''}
              </div>
            </div>
          `;
        } else {
          contentDiv.innerHTML = `<p style="color: #dc3545;">Error: ${data.error}</p>`;
        }
      } catch (error) {
        contentDiv.innerHTML = `<p style="color: #dc3545;">Failed to load profile: ${error.message}</p>`;
      }
    }

    // Test API endpoint
    async function testEndpoint(method, url, body, responseId) {
      const responseBox = document.getElementById(responseId);
      responseBox.textContent = 'Loading...';
      responseBox.classList.add('show');

      try {
        const options = {
          method: method,
          headers: {
            'Content-Type': 'application/json'
          }
        };

        if (body) {
          options.body = JSON.stringify(body);
        }

        const response = await fetch(url, options);
        const data = await response.json();
        responseBox.textContent = JSON.stringify(data, null, 2);
      } catch (error) {
        responseBox.textContent = `Error: ${error.message}`;
      }
    }

    // Check server on load
    checkServer();
    setInterval(checkServer, 10000); // Check every 10 seconds
  </script>
</body>
</html>
