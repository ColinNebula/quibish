/*! For license information please see main.c5dbd3a7.js.LICENSE.txt */
(()=>{"use strict";var e={85:(e,t,n)=>{var a=n(340),s=n(950),i=n(119);function r(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function l(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function c(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function d(e){if(l(e)!==e)throw Error(r(188))}function u(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=u(e)))return t;e=e.sibling}return null}var h=Object.assign,m=Symbol.for("react.element"),p=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),x=Symbol.for("react.consumer"),w=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),j=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),C=Symbol.for("react.lazy");Symbol.for("react.scope");var E=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var T=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var I=Symbol.iterator;function P(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=I&&e[I]||e["@@iterator"])?e:null}var D=Symbol.for("react.client.reference");function A(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===D?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case f:return"Fragment";case y:return"Profiler";case v:return"StrictMode";case k:return"Suspense";case j:return"SuspenseList";case E:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case g:return"Portal";case w:return(e.displayName||"Context")+".Provider";case x:return(e._context.displayName||"Context")+".Consumer";case S:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case N:return null!==(t=e.displayName||null)?t:A(e.type)||"Memo";case C:t=e._payload,e=e._init;try{return A(e(t))}catch(n){}}return null}var M=Array.isArray,R=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,L={pending:!1,data:null,method:null,action:null},z=[],O=-1;function _(e){return{current:e}}function U(e){0>O||(e.current=z[O],z[O]=null,O--)}function q(e,t){O++,z[O]=e.current,e.current=t}var B=_(null),H=_(null),W=_(null),V=_(null);function K(e,t){switch(q(W,t),q(H,e),q(B,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?su(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=iu(t=su(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}U(B),q(B,e)}function G(){U(B),U(H),U(W)}function J(e){null!==e.memoizedState&&q(V,e);var t=B.current,n=iu(t,e.type);t!==n&&(q(H,e),q(B,n))}function Y(e){H.current===e&&(U(B),U(H)),V.current===e&&(U(V),Ju._currentValue=L)}var Q=Object.prototype.hasOwnProperty,$=a.unstable_scheduleCallback,X=a.unstable_cancelCallback,Z=a.unstable_shouldYield,ee=a.unstable_requestPaint,te=a.unstable_now,ne=a.unstable_getCurrentPriorityLevel,ae=a.unstable_ImmediatePriority,se=a.unstable_UserBlockingPriority,ie=a.unstable_NormalPriority,re=a.unstable_LowPriority,oe=a.unstable_IdlePriority,le=a.log,ce=a.unstable_setDisableYieldValue,de=null,ue=null;function he(e){if("function"===typeof le&&ce(e),ue&&"function"===typeof ue.setStrictMode)try{ue.setStrictMode(de,e)}catch(t){}}var me=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(pe(e)/ge|0)|0},pe=Math.log,ge=Math.LN2;var fe=256,ve=4194304;function ye(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194048&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function be(e,t,n){var a=e.pendingLanes;if(0===a)return 0;var s=0,i=e.suspendedLanes,r=e.pingedLanes;e=e.warmLanes;var o=134217727&a;return 0!==o?0!==(a=o&~i)?s=ye(a):0!==(r&=o)?s=ye(r):n||0!==(n=o&~e)&&(s=ye(n)):0!==(o=a&~i)?s=ye(o):0!==r?s=ye(r):n||0!==(n=a&~e)&&(s=ye(n)),0===s?0:0!==t&&t!==s&&0===(t&i)&&((i=s&-s)>=(n=t&-t)||32===i&&0!==(4194048&n))?t:s}function xe(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function we(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Se(){var e=fe;return 0===(4194048&(fe<<=1))&&(fe=256),e}function ke(){var e=ve;return 0===(62914560&(ve<<=1))&&(ve=4194304),e}function je(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ne(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ce(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var a=31-me(t);e.entangledLanes|=t,e.entanglements[a]=1073741824|e.entanglements[a]|4194090&n}function Ee(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var a=31-me(n),s=1<<a;s&t|e[a]&t&&(e[a]|=t),n&=~s}}function Te(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Ie(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Pe(){var e=F.p;return 0!==e?e:void 0===(e=window.event)?32:ch(e.type)}var De=Math.random().toString(36).slice(2),Ae="__reactFiber$"+De,Me="__reactProps$"+De,Re="__reactContainer$"+De,Fe="__reactEvents$"+De,Le="__reactListeners$"+De,ze="__reactHandles$"+De,Oe="__reactResources$"+De,_e="__reactMarker$"+De;function Ue(e){delete e[Ae],delete e[Me],delete e[Fe],delete e[Le],delete e[ze]}function qe(e){var t=e[Ae];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Re]||n[Ae]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=bu(e);null!==e;){if(n=e[Ae])return n;e=bu(e)}return t}n=(e=n).parentNode}return null}function Be(e){if(e=e[Ae]||e[Re]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function He(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(r(33))}function We(e){var t=e[Oe];return t||(t=e[Oe]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Ve(e){e[_e]=!0}var Ke=new Set,Ge={};function Je(e,t){Ye(e,t),Ye(e+"Capture",t)}function Ye(e,t){for(Ge[e]=t,e=0;e<t.length;e++)Ke.add(t[e])}var Qe,$e,Xe=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ze={},et={};function tt(e,t,n){if(s=t,Q.call(et,s)||!Q.call(Ze,s)&&(Xe.test(s)?et[s]=!0:(Ze[s]=!0,0)))if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var a=t.toLowerCase().slice(0,5);if("data-"!==a&&"aria-"!==a)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var s}function nt(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function at(e,t,n,a){if(null===a)e.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+a)}}function st(e){if(void 0===Qe)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Qe=t&&t[1]||"",$e=-1<n.stack.indexOf("\n    at")?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+Qe+e+$e}var it=!1;function rt(e,t){if(!e||it)return"";it=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var a={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(s){var a=s}Reflect.construct(e,[],n)}else{try{n.call()}catch(i){a=i}e.call(n.prototype)}}else{try{throw Error()}catch(r){a=r}(n=e())&&"function"===typeof n.catch&&n.catch(function(){})}}catch(o){if(o&&a&&"string"===typeof o.stack)return[o.stack,a.stack]}return[null,null]}};a.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var s=Object.getOwnPropertyDescriptor(a.DetermineComponentFrameRoot,"name");s&&s.configurable&&Object.defineProperty(a.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var i=a.DetermineComponentFrameRoot(),r=i[0],o=i[1];if(r&&o){var l=r.split("\n"),c=o.split("\n");for(s=a=0;a<l.length&&!l[a].includes("DetermineComponentFrameRoot");)a++;for(;s<c.length&&!c[s].includes("DetermineComponentFrameRoot");)s++;if(a===l.length||s===c.length)for(a=l.length-1,s=c.length-1;1<=a&&0<=s&&l[a]!==c[s];)s--;for(;1<=a&&0<=s;a--,s--)if(l[a]!==c[s]){if(1!==a||1!==s)do{if(a--,0>--s||l[a]!==c[s]){var d="\n"+l[a].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}}while(1<=a&&0<=s);break}}}finally{it=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?st(n):""}function ot(e){switch(e.tag){case 26:case 27:case 5:return st(e.type);case 16:return st("Lazy");case 13:return st("Suspense");case 19:return st("SuspenseList");case 0:case 15:return rt(e.type,!1);case 11:return rt(e.type.render,!1);case 1:return rt(e.type,!0);case 31:return st("Activity");default:return""}}function lt(e){try{var t="";do{t+=ot(e),e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}function ct(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function dt(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function ut(e){e._valueTracker||(e._valueTracker=function(e){var t=dt(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),a=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var s=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){a=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return a},setValue:function(e){a=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function ht(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),a="";return e&&(a=dt(e)?e.checked?"true":"false":e.value),(e=a)!==n&&(t.setValue(e),!0)}function mt(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var pt=/[\n"\\]/g;function gt(e){return e.replace(pt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function ft(e,t,n,a,s,i,r,o){e.name="",null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&"boolean"!==typeof r?e.type=r:e.removeAttribute("type"),null!=t?"number"===r?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ct(t)):e.value!==""+ct(t)&&(e.value=""+ct(t)):"submit"!==r&&"reset"!==r||e.removeAttribute("value"),null!=t?yt(e,r,ct(t)):null!=n?yt(e,r,ct(n)):null!=a&&e.removeAttribute("value"),null==s&&null!=i&&(e.defaultChecked=!!i),null!=s&&(e.checked=s&&"function"!==typeof s&&"symbol"!==typeof s),null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o?e.name=""+ct(o):e.removeAttribute("name")}function vt(e,t,n,a,s,i,r,o){if(null!=i&&"function"!==typeof i&&"symbol"!==typeof i&&"boolean"!==typeof i&&(e.type=i),null!=t||null!=n){if(!("submit"!==i&&"reset"!==i||void 0!==t&&null!==t))return;n=null!=n?""+ct(n):"",t=null!=t?""+ct(t):n,o||t===e.value||(e.value=t),e.defaultValue=t}a="function"!==typeof(a=null!=a?a:s)&&"symbol"!==typeof a&&!!a,e.checked=o?e.checked:!!a,e.defaultChecked=!!a,null!=r&&"function"!==typeof r&&"symbol"!==typeof r&&"boolean"!==typeof r&&(e.name=r)}function yt(e,t,n){"number"===t&&mt(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function bt(e,t,n,a){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&a&&(e[n].defaultSelected=!0)}else{for(n=""+ct(n),t=null,s=0;s<e.length;s++){if(e[s].value===n)return e[s].selected=!0,void(a&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function xt(e,t,n){null==t||((t=""+ct(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ct(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function wt(e,t,n,a){if(null==t){if(null!=a){if(null!=n)throw Error(r(92));if(M(a)){if(1<a.length)throw Error(r(93));a=a[0]}n=a}null==n&&(n=""),t=n}n=ct(t),e.defaultValue=n,(a=e.textContent)===n&&""!==a&&null!==a&&(e.value=a)}function St(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var kt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function jt(e,t,n){var a=0===t.indexOf("--");null==n||"boolean"===typeof n||""===n?a?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":a?e.setProperty(t,n):"number"!==typeof n||0===n||kt.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function Nt(e,t,n){if(null!=t&&"object"!==typeof t)throw Error(r(62));if(e=e.style,null!=n){for(var a in n)!n.hasOwnProperty(a)||null!=t&&t.hasOwnProperty(a)||(0===a.indexOf("--")?e.setProperty(a,""):"float"===a?e.cssFloat="":e[a]="");for(var s in t)a=t[s],t.hasOwnProperty(s)&&n[s]!==a&&jt(e,s,a)}else for(var i in t)t.hasOwnProperty(i)&&jt(e,i,t[i])}function Ct(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Et=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Tt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function It(e){return Tt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var Pt=null;function Dt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var At=null,Mt=null;function Rt(e){var t=Be(e);if(t&&(e=t.stateNode)){var n=e[Me]||null;e:switch(e=t.stateNode,t.type){case"input":if(ft(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+gt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var a=n[t];if(a!==e&&a.form===e.form){var s=a[Me]||null;if(!s)throw Error(r(90));ft(a,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name)}}for(t=0;t<n.length;t++)(a=n[t]).form===e.form&&ht(a)}break e;case"textarea":xt(e,n.value,n.defaultValue);break e;case"select":null!=(t=n.value)&&bt(e,!!n.multiple,t,!1)}}}var Ft=!1;function Lt(e,t,n){if(Ft)return e(t,n);Ft=!0;try{return e(t)}finally{if(Ft=!1,(null!==At||null!==Mt)&&(qc(),At&&(t=At,e=Mt,Mt=At=null,Rt(t),e)))for(t=0;t<e.length;t++)Rt(e[t])}}function zt(e,t){var n=e.stateNode;if(null===n)return null;var a=n[Me]||null;if(null===a)return null;n=a[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(a=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!a;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(r(231,t,typeof n));return n}var Ot=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),_t=!1;if(Ot)try{var Ut={};Object.defineProperty(Ut,"passive",{get:function(){_t=!0}}),window.addEventListener("test",Ut,Ut),window.removeEventListener("test",Ut,Ut)}catch(Mh){_t=!1}var qt=null,Bt=null,Ht=null;function Wt(){if(Ht)return Ht;var e,t,n=Bt,a=n.length,s="value"in qt?qt.value:qt.textContent,i=s.length;for(e=0;e<a&&n[e]===s[e];e++);var r=a-e;for(t=1;t<=r&&n[a-t]===s[i-t];t++);return Ht=s.slice(e,1<t?1-t:void 0)}function Vt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Kt(){return!0}function Gt(){return!1}function Jt(e){function t(t,n,a,s,i){for(var r in this._reactName=t,this._targetInst=a,this.type=n,this.nativeEvent=s,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(r)&&(t=e[r],this[r]=t?t(s):s[r]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?Kt:Gt,this.isPropagationStopped=Gt,this}return h(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Kt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Kt)},persist:function(){},isPersistent:Kt}),t}var Yt,Qt,$t,Xt={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zt=Jt(Xt),en=h({},Xt,{view:0,detail:0}),tn=Jt(en),nn=h({},en,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==$t&&($t&&"mousemove"===e.type?(Yt=e.screenX-$t.screenX,Qt=e.screenY-$t.screenY):Qt=Yt=0,$t=e),Yt)},movementY:function(e){return"movementY"in e?e.movementY:Qt}}),an=Jt(nn),sn=Jt(h({},nn,{dataTransfer:0})),rn=Jt(h({},en,{relatedTarget:0})),on=Jt(h({},Xt,{animationName:0,elapsedTime:0,pseudoElement:0})),ln=Jt(h({},Xt,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),cn=Jt(h({},Xt,{data:0})),dn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},un={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=hn[e])&&!!t[e]}function pn(){return mn}var gn=Jt(h({},en,{key:function(e){if(e.key){var t=dn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Vt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?un[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pn,charCode:function(e){return"keypress"===e.type?Vt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Vt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),fn=Jt(h({},nn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),vn=Jt(h({},en,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pn})),yn=Jt(h({},Xt,{propertyName:0,elapsedTime:0,pseudoElement:0})),bn=Jt(h({},nn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),xn=Jt(h({},Xt,{newState:0,oldState:0})),wn=[9,13,27,32],Sn=Ot&&"CompositionEvent"in window,kn=null;Ot&&"documentMode"in document&&(kn=document.documentMode);var jn=Ot&&"TextEvent"in window&&!kn,Nn=Ot&&(!Sn||kn&&8<kn&&11>=kn),Cn=String.fromCharCode(32),En=!1;function Tn(e,t){switch(e){case"keyup":return-1!==wn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function In(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Pn=!1;var Dn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function An(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Dn[e.type]:"textarea"===t}function Mn(e,t,n,a){At?Mt?Mt.push(a):Mt=[a]:At=a,0<(t=Wd(t,"onChange")).length&&(n=new Zt("onChange","change",null,n,a),e.push({event:n,listeners:t}))}var Rn=null,Fn=null;function Ln(e){Ld(e,0)}function zn(e){if(ht(He(e)))return e}function On(e,t){if("change"===e)return t}var _n=!1;if(Ot){var Un;if(Ot){var qn="oninput"in document;if(!qn){var Bn=document.createElement("div");Bn.setAttribute("oninput","return;"),qn="function"===typeof Bn.oninput}Un=qn}else Un=!1;_n=Un&&(!document.documentMode||9<document.documentMode)}function Hn(){Rn&&(Rn.detachEvent("onpropertychange",Wn),Fn=Rn=null)}function Wn(e){if("value"===e.propertyName&&zn(Fn)){var t=[];Mn(t,Fn,e,Dt(e)),Lt(Ln,t)}}function Vn(e,t,n){"focusin"===e?(Hn(),Fn=n,(Rn=t).attachEvent("onpropertychange",Wn)):"focusout"===e&&Hn()}function Kn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return zn(Fn)}function Gn(e,t){if("click"===e)return zn(t)}function Jn(e,t){if("input"===e||"change"===e)return zn(t)}var Yn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Qn(e,t){if(Yn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(a=0;a<n.length;a++){var s=n[a];if(!Q.call(t,s)||!Yn(e[s],t[s]))return!1}return!0}function $n(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Xn(e,t){var n,a=$n(e);for(e=0;a;){if(3===a.nodeType){if(n=e+a.textContent.length,e<=t&&n>=t)return{node:a,offset:t-e};e=n}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=$n(a)}}function Zn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Zn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ea(e){for(var t=mt((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(a){n=!1}if(!n)break;t=mt((e=t.contentWindow).document)}return t}function ta(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var na=Ot&&"documentMode"in document&&11>=document.documentMode,aa=null,sa=null,ia=null,ra=!1;function oa(e,t,n){var a=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ra||null==aa||aa!==mt(a)||("selectionStart"in(a=aa)&&ta(a)?a={start:a.selectionStart,end:a.selectionEnd}:a={anchorNode:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset},ia&&Qn(ia,a)||(ia=a,0<(a=Wd(sa,"onSelect")).length&&(t=new Zt("onSelect","select",null,t,n),e.push({event:t,listeners:a}),t.target=aa)))}function la(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ca={animationend:la("Animation","AnimationEnd"),animationiteration:la("Animation","AnimationIteration"),animationstart:la("Animation","AnimationStart"),transitionrun:la("Transition","TransitionRun"),transitionstart:la("Transition","TransitionStart"),transitioncancel:la("Transition","TransitionCancel"),transitionend:la("Transition","TransitionEnd")},da={},ua={};function ha(e){if(da[e])return da[e];if(!ca[e])return e;var t,n=ca[e];for(t in n)if(n.hasOwnProperty(t)&&t in ua)return da[e]=n[t];return e}Ot&&(ua=document.createElement("div").style,"AnimationEvent"in window||(delete ca.animationend.animation,delete ca.animationiteration.animation,delete ca.animationstart.animation),"TransitionEvent"in window||delete ca.transitionend.transition);var ma=ha("animationend"),pa=ha("animationiteration"),ga=ha("animationstart"),fa=ha("transitionrun"),va=ha("transitionstart"),ya=ha("transitioncancel"),ba=ha("transitionend"),xa=new Map,wa="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Sa(e,t){xa.set(e,t),Je(t,[e])}wa.push("scrollEnd");var ka=new WeakMap;function ja(e,t){if("object"===typeof e&&null!==e){var n=ka.get(e);return void 0!==n?n:(t={value:e,source:t,stack:lt(t)},ka.set(e,t),t)}return{value:e,source:t,stack:lt(t)}}var Na=[],Ca=0,Ea=0;function Ta(){for(var e=Ca,t=Ea=Ca=0;t<e;){var n=Na[t];Na[t++]=null;var a=Na[t];Na[t++]=null;var s=Na[t];Na[t++]=null;var i=Na[t];if(Na[t++]=null,null!==a&&null!==s){var r=a.pending;null===r?s.next=s:(s.next=r.next,r.next=s),a.pending=s}0!==i&&Aa(n,s,i)}}function Ia(e,t,n,a){Na[Ca++]=e,Na[Ca++]=t,Na[Ca++]=n,Na[Ca++]=a,Ea|=a,e.lanes|=a,null!==(e=e.alternate)&&(e.lanes|=a)}function Pa(e,t,n,a){return Ia(e,t,n,a),Ma(e)}function Da(e,t){return Ia(e,null,null,t),Ma(e)}function Aa(e,t,n){e.lanes|=n;var a=e.alternate;null!==a&&(a.lanes|=n);for(var s=!1,i=e.return;null!==i;)i.childLanes|=n,null!==(a=i.alternate)&&(a.childLanes|=n),22===i.tag&&(null===(e=i.stateNode)||1&e._visibility||(s=!0)),e=i,i=i.return;return 3===e.tag?(i=e.stateNode,s&&null!==t&&(s=31-me(n),null===(a=(e=i.hiddenUpdates)[s])?e[s]=[t]:a.push(t),t.lane=536870912|n),i):null}function Ma(e){if(50<Ac)throw Ac=0,Mc=null,Error(r(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Ra={};function Fa(e,t,n,a){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function La(e,t,n,a){return new Fa(e,t,n,a)}function za(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Oa(e,t){var n=e.alternate;return null===n?((n=La(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function _a(e,t){e.flags&=65011714;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Ua(e,t,n,a,s,i){var o=0;if(a=e,"function"===typeof e)za(e)&&(o=1);else if("string"===typeof e)o=function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,n,B.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case E:return(e=La(31,n,t,s)).elementType=E,e.lanes=i,e;case f:return qa(n.children,s,i,t);case v:o=8,s|=24;break;case y:return(e=La(12,n,t,2|s)).elementType=y,e.lanes=i,e;case k:return(e=La(13,n,t,s)).elementType=k,e.lanes=i,e;case j:return(e=La(19,n,t,s)).elementType=j,e.lanes=i,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case b:case w:o=10;break e;case x:o=9;break e;case S:o=11;break e;case N:o=14;break e;case C:o=16,a=null;break e}o=29,n=Error(r(130,null===e?"null":typeof e,"")),a=null}return(t=La(o,n,t,s)).elementType=e,t.type=a,t.lanes=i,t}function qa(e,t,n,a){return(e=La(7,e,a,t)).lanes=n,e}function Ba(e,t,n){return(e=La(6,e,null,t)).lanes=n,e}function Ha(e,t,n){return(t=La(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Wa=[],Va=0,Ka=null,Ga=0,Ja=[],Ya=0,Qa=null,$a=1,Xa="";function Za(e,t){Wa[Va++]=Ga,Wa[Va++]=Ka,Ka=e,Ga=t}function es(e,t,n){Ja[Ya++]=$a,Ja[Ya++]=Xa,Ja[Ya++]=Qa,Qa=e;var a=$a;e=Xa;var s=32-me(a)-1;a&=~(1<<s),n+=1;var i=32-me(t)+s;if(30<i){var r=s-s%5;i=(a&(1<<r)-1).toString(32),a>>=r,s-=r,$a=1<<32-me(t)+s|n<<s|a,Xa=i+e}else $a=1<<i|n<<s|a,Xa=e}function ts(e){null!==e.return&&(Za(e,1),es(e,1,0))}function ns(e){for(;e===Ka;)Ka=Wa[--Va],Wa[Va]=null,Ga=Wa[--Va],Wa[Va]=null;for(;e===Qa;)Qa=Ja[--Ya],Ja[Ya]=null,Xa=Ja[--Ya],Ja[Ya]=null,$a=Ja[--Ya],Ja[Ya]=null}var as=null,ss=null,is=!1,rs=null,os=!1,ls=Error(r(519));function cs(e){throw gs(ja(Error(r(418,"")),e)),ls}function ds(e){var t=e.stateNode,n=e.type,a=e.memoizedProps;switch(t[Ae]=e,t[Me]=a,n){case"dialog":zd("cancel",t),zd("close",t);break;case"iframe":case"object":case"embed":zd("load",t);break;case"video":case"audio":for(n=0;n<Rd.length;n++)zd(Rd[n],t);break;case"source":zd("error",t);break;case"img":case"image":case"link":zd("error",t),zd("load",t);break;case"details":zd("toggle",t);break;case"input":zd("invalid",t),vt(t,a.value,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name,!0),ut(t);break;case"select":zd("invalid",t);break;case"textarea":zd("invalid",t),wt(t,a.value,a.defaultValue,a.children),ut(t)}"string"!==typeof(n=a.children)&&"number"!==typeof n&&"bigint"!==typeof n||t.textContent===""+n||!0===a.suppressHydrationWarning||Qd(t.textContent,n)?(null!=a.popover&&(zd("beforetoggle",t),zd("toggle",t)),null!=a.onScroll&&zd("scroll",t),null!=a.onScrollEnd&&zd("scrollend",t),null!=a.onClick&&(t.onclick=$d),t=!0):t=!1,t||cs(e)}function us(e){for(as=e.return;as;)switch(as.tag){case 5:case 13:return void(os=!1);case 27:case 3:return void(os=!0);default:as=as.return}}function hs(e){if(e!==as)return!1;if(!is)return us(e),is=!0,!1;var t,n=e.tag;if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||ru(e.type,e.memoizedProps)),t=!t),t&&ss&&cs(e),us(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,n=0;e;){if(8===e.nodeType)if("/$"===(t=e.data)){if(0===n){ss=vu(e.nextSibling);break e}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++;e=e.nextSibling}ss=null}}else 27===n?(n=ss,mu(e.type)?(e=yu,yu=null,ss=e):ss=n):ss=as?vu(e.stateNode.nextSibling):null;return!0}function ms(){ss=as=null,is=!1}function ps(){var e=rs;return null!==e&&(null===bc?bc=e:bc.push.apply(bc,e),rs=null),e}function gs(e){null===rs?rs=[e]:rs.push(e)}var fs=_(null),vs=null,ys=null;function bs(e,t,n){q(fs,t._currentValue),t._currentValue=n}function xs(e){e._currentValue=fs.current,U(fs)}function ws(e,t,n){for(;null!==e;){var a=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==a&&(a.childLanes|=t)):null!==a&&(a.childLanes&t)!==t&&(a.childLanes|=t),e===n)break;e=e.return}}function Ss(e,t,n,a){var s=e.child;for(null!==s&&(s.return=e);null!==s;){var i=s.dependencies;if(null!==i){var o=s.child;i=i.firstContext;e:for(;null!==i;){var l=i;i=s;for(var c=0;c<t.length;c++)if(l.context===t[c]){i.lanes|=n,null!==(l=i.alternate)&&(l.lanes|=n),ws(i.return,n,e),a||(o=null);break e}i=l.next}}else if(18===s.tag){if(null===(o=s.return))throw Error(r(341));o.lanes|=n,null!==(i=o.alternate)&&(i.lanes|=n),ws(o,n,e),o=null}else o=s.child;if(null!==o)o.return=s;else for(o=s;null!==o;){if(o===e){o=null;break}if(null!==(s=o.sibling)){s.return=o.return,o=s;break}o=o.return}s=o}}function ks(e,t,n,a){e=null;for(var s=t,i=!1;null!==s;){if(!i)if(0!==(524288&s.flags))i=!0;else if(0!==(262144&s.flags))break;if(10===s.tag){var o=s.alternate;if(null===o)throw Error(r(387));if(null!==(o=o.memoizedProps)){var l=s.type;Yn(s.pendingProps.value,o.value)||(null!==e?e.push(l):e=[l])}}else if(s===V.current){if(null===(o=s.alternate))throw Error(r(387));o.memoizedState.memoizedState!==s.memoizedState.memoizedState&&(null!==e?e.push(Ju):e=[Ju])}s=s.return}null!==e&&Ss(t,e,n,a),t.flags|=262144}function js(e){for(e=e.firstContext;null!==e;){if(!Yn(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ns(e){vs=e,ys=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Cs(e){return Ts(vs,e)}function Es(e,t){return null===vs&&Ns(e),Ts(e,t)}function Ts(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===ys){if(null===e)throw Error(r(308));ys=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else ys=ys.next=t;return n}var Is="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Ps=a.unstable_scheduleCallback,Ds=a.unstable_NormalPriority,As={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ms(){return{controller:new Is,data:new Map,refCount:0}}function Rs(e){e.refCount--,0===e.refCount&&Ps(Ds,function(){e.controller.abort()})}var Fs=null,Ls=0,zs=0,Os=null;function _s(){if(0===--Ls&&null!==Fs){null!==Os&&(Os.status="fulfilled");var e=Fs;Fs=null,zs=0,Os=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Us=R.S;R.S=function(e,t){"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Fs){var n=Fs=[];Ls=0,zs=Id(),Os={status:"pending",value:void 0,then:function(e){n.push(e)}}}Ls++,t.then(_s,_s)}(0,t),null!==Us&&Us(e,t)};var qs=_(null);function Bs(){var e=qs.current;return null!==e?e:ac.pooledCache}function Hs(e,t){q(qs,null===t?qs.current:t.pool)}function Ws(){var e=Bs();return null===e?null:{parent:As._currentValue,pool:e}}var Vs=Error(r(460)),Ks=Error(r(474)),Gs=Error(r(542)),Js={then:function(){}};function Ys(e){return"fulfilled"===(e=e.status)||"rejected"===e}function Qs(){}function $s(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(Qs,Qs),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw ei(e=t.reason),e;default:if("string"===typeof t.status)t.then(Qs,Qs);else{if(null!==(e=ac)&&100<e.shellSuspendCounter)throw Error(r(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw ei(e=t.reason),e}throw Xs=t,Vs}}var Xs=null;function Zs(){if(null===Xs)throw Error(r(459));var e=Xs;return Xs=null,e}function ei(e){if(e===Vs||e===Gs)throw Error(r(483))}var ti=!1;function ni(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ai(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function si(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function ii(e,t,n){var a=e.updateQueue;if(null===a)return null;if(a=a.shared,0!==(2&nc)){var s=a.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),a.pending=t,t=Ma(e),Aa(e,null,n),t}return Ia(e,a,t,n),Ma(e)}function ri(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&n))){var a=t.lanes;n|=a&=e.pendingLanes,t.lanes=n,Ee(e,n)}}function oi(e,t){var n=e.updateQueue,a=e.alternate;if(null!==a&&n===(a=a.updateQueue)){var s=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var r={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===i?s=i=r:i=i.next=r,n=n.next}while(null!==n);null===i?s=i=t:i=i.next=t}else s=i=t;return n={baseState:a.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:a.shared,callbacks:a.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var li=!1;function ci(){if(li){if(null!==Os)throw Os}}function di(e,t,n,a){li=!1;var s=e.updateQueue;ti=!1;var i=s.firstBaseUpdate,r=s.lastBaseUpdate,o=s.shared.pending;if(null!==o){s.shared.pending=null;var l=o,c=l.next;l.next=null,null===r?i=c:r.next=c,r=l;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==r&&(null===o?d.firstBaseUpdate=c:o.next=c,d.lastBaseUpdate=l))}if(null!==i){var u=s.baseState;for(r=0,d=c=l=null,o=i;;){var m=-536870913&o.lane,p=m!==o.lane;if(p?(ic&m)===m:(a&m)===m){0!==m&&m===zs&&(li=!0),null!==d&&(d=d.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var g=e,f=o;m=t;var v=n;switch(f.tag){case 1:if("function"===typeof(g=f.payload)){u=g.call(v,u,m);break e}u=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null===(m="function"===typeof(g=f.payload)?g.call(v,u,m):g)||void 0===m)break e;u=h({},u,m);break e;case 2:ti=!0}}null!==(m=o.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=s.callbacks)?s.callbacks=[m]:p.push(m))}else p={lane:m,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(c=d=p,l=u):d=d.next=p,r|=m;if(null===(o=o.next)){if(null===(o=s.shared.pending))break;o=(p=o).next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}null===d&&(l=u),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=d,null===i&&(s.shared.lanes=0),mc|=r,e.lanes=r,e.memoizedState=u}}function ui(e,t){if("function"!==typeof e)throw Error(r(191,e));e.call(t)}function hi(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)ui(n[e],t)}var mi=_(null),pi=_(0);function gi(e,t){q(pi,e=uc),q(mi,t),uc=e|t.baseLanes}function fi(){q(pi,uc),q(mi,mi.current)}function vi(){uc=pi.current,U(mi),U(pi)}var yi=0,bi=null,xi=null,wi=null,Si=!1,ki=!1,ji=!1,Ni=0,Ci=0,Ei=null,Ti=0;function Ii(){throw Error(r(321))}function Pi(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Yn(e[n],t[n]))return!1;return!0}function Di(e,t,n,a,s,i){return yi=i,bi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,R.H=null===e||null===e.memoizedState?Vr:Kr,ji=!1,i=n(a,s),ji=!1,ki&&(i=Mi(t,n,a,s)),Ai(e),i}function Ai(e){R.H=Wr;var t=null!==xi&&null!==xi.next;if(yi=0,wi=xi=bi=null,Si=!1,Ci=0,Ei=null,t)throw Error(r(300));null===e||Eo||null!==(e=e.dependencies)&&js(e)&&(Eo=!0)}function Mi(e,t,n,a){bi=e;var s=0;do{if(ki&&(Ei=null),Ci=0,ki=!1,25<=s)throw Error(r(301));if(s+=1,wi=xi=null,null!=e.updateQueue){var i=e.updateQueue;i.lastEffect=null,i.events=null,i.stores=null,null!=i.memoCache&&(i.memoCache.index=0)}R.H=Gr,i=t(n,a)}while(ki);return i}function Ri(){var e=R.H,t=e.useState()[0];return t="function"===typeof t.then?Ui(t):t,e=e.useState()[0],(null!==xi?xi.memoizedState:null)!==e&&(bi.flags|=1024),t}function Fi(){var e=0!==Ni;return Ni=0,e}function Li(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function zi(e){if(Si){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Si=!1}yi=0,wi=xi=bi=null,ki=!1,Ci=Ni=0,Ei=null}function Oi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===wi?bi.memoizedState=wi=e:wi=wi.next=e,wi}function _i(){if(null===xi){var e=bi.alternate;e=null!==e?e.memoizedState:null}else e=xi.next;var t=null===wi?bi.memoizedState:wi.next;if(null!==t)wi=t,xi=e;else{if(null===e){if(null===bi.alternate)throw Error(r(467));throw Error(r(310))}e={memoizedState:(xi=e).memoizedState,baseState:xi.baseState,baseQueue:xi.baseQueue,queue:xi.queue,next:null},null===wi?bi.memoizedState=wi=e:wi=wi.next=e}return wi}function Ui(e){var t=Ci;return Ci+=1,null===Ei&&(Ei=[]),e=$s(Ei,e,t),t=bi,null===(null===wi?t.memoizedState:wi.next)&&(t=t.alternate,R.H=null===t||null===t.memoizedState?Vr:Kr),e}function qi(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return Ui(e);if(e.$$typeof===w)return Cs(e)}throw Error(r(438,String(e)))}function Bi(e){var t=null,n=bi.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var a=bi.alternate;null!==a&&(null!==(a=a.updateQueue)&&(null!=(a=a.memoCache)&&(t={data:a.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},bi.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),a=0;a<e;a++)n[a]=T;return t.index++,n}function Hi(e,t){return"function"===typeof t?t(e):t}function Wi(e){return Vi(_i(),xi,e)}function Vi(e,t,n){var a=e.queue;if(null===a)throw Error(r(311));a.lastRenderedReducer=n;var s=e.baseQueue,i=a.pending;if(null!==i){if(null!==s){var o=s.next;s.next=i.next,i.next=o}t.baseQueue=s=i,a.pending=null}if(i=e.baseState,null===s)e.memoizedState=i;else{var l=o=null,c=null,d=t=s.next,u=!1;do{var h=-536870913&d.lane;if(h!==d.lane?(ic&h)===h:(yi&h)===h){var m=d.revertLane;if(0===m)null!==c&&(c=c.next={lane:0,revertLane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),h===zs&&(u=!0);else{if((yi&m)===m){d=d.next,m===zs&&(u=!0);continue}h={lane:0,revertLane:d.revertLane,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===c?(l=c=h,o=i):c=c.next=h,bi.lanes|=m,mc|=m}h=d.action,ji&&n(i,h),i=d.hasEagerState?d.eagerState:n(i,h)}else m={lane:h,revertLane:d.revertLane,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===c?(l=c=m,o=i):c=c.next=m,bi.lanes|=h,mc|=h;d=d.next}while(null!==d&&d!==t);if(null===c?o=i:c.next=l,!Yn(i,e.memoizedState)&&(Eo=!0,u&&null!==(n=Os)))throw n;e.memoizedState=i,e.baseState=o,e.baseQueue=c,a.lastRenderedState=i}return null===s&&(a.lanes=0),[e.memoizedState,a.dispatch]}function Ki(e){var t=_i(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var a=n.dispatch,s=n.pending,i=t.memoizedState;if(null!==s){n.pending=null;var o=s=s.next;do{i=e(i,o.action),o=o.next}while(o!==s);Yn(i,t.memoizedState)||(Eo=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,a]}function Gi(e,t,n){var a=bi,s=_i(),i=is;if(i){if(void 0===n)throw Error(r(407));n=n()}else n=t();var o=!Yn((xi||s).memoizedState,n);if(o&&(s.memoizedState=n,Eo=!0),s=s.queue,fr(2048,8,Qi.bind(null,a,s,e),[e]),s.getSnapshot!==t||o||null!==wi&&1&wi.memoizedState.tag){if(a.flags|=2048,mr(9,{destroy:void 0,resource:void 0},Yi.bind(null,a,s,n,t),null),null===ac)throw Error(r(349));i||0!==(124&yi)||Ji(a,t,n)}return n}function Ji(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=bi.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},bi.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Yi(e,t,n,a){t.value=n,t.getSnapshot=a,$i(t)&&Xi(e)}function Qi(e,t,n){return n(function(){$i(t)&&Xi(e)})}function $i(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Yn(e,n)}catch(a){return!0}}function Xi(e){var t=Da(e,2);null!==t&&Lc(t,e,2)}function Zi(e){var t=Oi();if("function"===typeof e){var n=e;if(e=n(),ji){he(!0);try{n()}finally{he(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hi,lastRenderedState:e},t}function er(e,t,n,a){return e.baseState=n,Vi(e,xi,"function"===typeof a?a:Hi)}function tr(e,t,n,a,s){if(qr(e))throw Error(r(485));if(null!==(e=t.action)){var i={payload:s,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){i.listeners.push(e)}};null!==R.T?n(!0):i.isTransition=!1,a(i),null===(n=t.pending)?(i.next=t.pending=i,nr(t,i)):(i.next=n.next,t.pending=n.next=i)}}function nr(e,t){var n=t.action,a=t.payload,s=e.state;if(t.isTransition){var i=R.T,r={};R.T=r;try{var o=n(s,a),l=R.S;null!==l&&l(r,o),ar(e,t,o)}catch(c){ir(e,t,c)}finally{R.T=i}}else try{ar(e,t,i=n(s,a))}catch(d){ir(e,t,d)}}function ar(e,t,n){null!==n&&"object"===typeof n&&"function"===typeof n.then?n.then(function(n){sr(e,t,n)},function(n){return ir(e,t,n)}):sr(e,t,n)}function sr(e,t,n){t.status="fulfilled",t.value=n,rr(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,nr(e,n)))}function ir(e,t,n){var a=e.pending;if(e.pending=null,null!==a){a=a.next;do{t.status="rejected",t.reason=n,rr(t),t=t.next}while(t!==a)}e.action=null}function rr(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function or(e,t){return t}function lr(e,t){if(is){var n=ac.formState;if(null!==n){e:{var a=bi;if(is){if(ss){t:{for(var s=ss,i=os;8!==s.nodeType;){if(!i){s=null;break t}if(null===(s=vu(s.nextSibling))){s=null;break t}}s="F!"===(i=s.data)||"F"===i?s:null}if(s){ss=vu(s.nextSibling),a="F!"===s.data;break e}}cs(a)}a=!1}a&&(t=n[0])}}return(n=Oi()).memoizedState=n.baseState=t,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:or,lastRenderedState:t},n.queue=a,n=Or.bind(null,bi,a),a.dispatch=n,a=Zi(!1),i=Ur.bind(null,bi,!1,a.queue),s={state:t,dispatch:null,action:e,pending:null},(a=Oi()).queue=s,n=tr.bind(null,bi,s,i,n),s.dispatch=n,a.memoizedState=e,[t,n,!1]}function cr(e){return dr(_i(),xi,e)}function dr(e,t,n){if(t=Vi(e,t,or)[0],e=Wi(Hi)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var a=Ui(t)}catch(r){if(r===Vs)throw Gs;throw r}else a=t;var s=(t=_i()).queue,i=s.dispatch;return n!==t.memoizedState&&(bi.flags|=2048,mr(9,{destroy:void 0,resource:void 0},ur.bind(null,s,n),null)),[a,i,e]}function ur(e,t){e.action=t}function hr(e){var t=_i(),n=xi;if(null!==n)return dr(t,n,e);_i(),t=t.memoizedState;var a=(n=_i()).queue.dispatch;return n.memoizedState=e,[t,a,!1]}function mr(e,t,n,a){return e={tag:e,create:n,deps:a,inst:t,next:null},null===(t=bi.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},bi.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(a=n.next,n.next=e,e.next=a,t.lastEffect=e),e}function pr(){return _i().memoizedState}function gr(e,t,n,a){var s=Oi();a=void 0===a?null:a,bi.flags|=e,s.memoizedState=mr(1|t,{destroy:void 0,resource:void 0},n,a)}function fr(e,t,n,a){var s=_i();a=void 0===a?null:a;var i=s.memoizedState.inst;null!==xi&&null!==a&&Pi(a,xi.memoizedState.deps)?s.memoizedState=mr(t,i,n,a):(bi.flags|=e,s.memoizedState=mr(1|t,i,n,a))}function vr(e,t){gr(8390656,8,e,t)}function yr(e,t){fr(2048,8,e,t)}function br(e,t){return fr(4,2,e,t)}function xr(e,t){return fr(4,4,e,t)}function wr(e,t){if("function"===typeof t){e=e();var n=t(e);return function(){"function"===typeof n?n():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Sr(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,fr(4,4,wr.bind(null,t,e),n)}function kr(){}function jr(e,t){var n=_i();t=void 0===t?null:t;var a=n.memoizedState;return null!==t&&Pi(t,a[1])?a[0]:(n.memoizedState=[e,t],e)}function Nr(e,t){var n=_i();t=void 0===t?null:t;var a=n.memoizedState;if(null!==t&&Pi(t,a[1]))return a[0];if(a=e(),ji){he(!0);try{e()}finally{he(!1)}}return n.memoizedState=[a,t],a}function Cr(e,t,n){return void 0===n||0!==(1073741824&yi)?e.memoizedState=t:(e.memoizedState=n,e=Fc(),bi.lanes|=e,mc|=e,n)}function Er(e,t,n,a){return Yn(n,t)?n:null!==mi.current?(e=Cr(e,n,a),Yn(e,t)||(Eo=!0),e):0===(42&yi)?(Eo=!0,e.memoizedState=n):(e=Fc(),bi.lanes|=e,mc|=e,t)}function Tr(e,t,n,a,s){var i=F.p;F.p=0!==i&&8>i?i:8;var r=R.T,o={};R.T=o,Ur(e,!1,t,n);try{var l=s(),c=R.S;if(null!==c&&c(o,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)_r(e,t,function(e,t){var n=[],a={status:"pending",value:null,reason:null,then:function(e){n.push(e)}};return e.then(function(){a.status="fulfilled",a.value=t;for(var e=0;e<n.length;e++)(0,n[e])(t)},function(e){for(a.status="rejected",a.reason=e,e=0;e<n.length;e++)(0,n[e])(void 0)}),a}(l,a),Rc());else _r(e,t,a,Rc())}catch(d){_r(e,t,{then:function(){},status:"rejected",reason:d},Rc())}finally{F.p=i,R.T=r}}function Ir(){}function Pr(e,t,n,a){if(5!==e.tag)throw Error(r(476));var s=Dr(e).queue;Tr(e,s,t,L,null===n?Ir:function(){return Ar(e),n(a)})}function Dr(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:L,baseState:L,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hi,lastRenderedState:L},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hi,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function Ar(e){_r(e,Dr(e).next.queue,{},Rc())}function Mr(){return Cs(Ju)}function Rr(){return _i().memoizedState}function Fr(){return _i().memoizedState}function Lr(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=Rc(),a=ii(t,e=si(n),n);return null!==a&&(Lc(a,t,n),ri(a,t,n)),t={cache:Ms()},void(e.payload=t)}t=t.return}}function zr(e,t,n){var a=Rc();n={lane:a,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},qr(e)?Br(t,n):null!==(n=Pa(e,t,n,a))&&(Lc(n,e,a),Hr(n,t,a))}function Or(e,t,n){_r(e,t,n,Rc())}function _r(e,t,n,a){var s={lane:a,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(qr(e))Br(t,s);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var r=t.lastRenderedState,o=i(r,n);if(s.hasEagerState=!0,s.eagerState=o,Yn(o,r))return Ia(e,t,s,0),null===ac&&Ta(),!1}catch(l){}if(null!==(n=Pa(e,t,s,a)))return Lc(n,e,a),Hr(n,t,a),!0}return!1}function Ur(e,t,n,a){if(a={lane:2,revertLane:Id(),action:a,hasEagerState:!1,eagerState:null,next:null},qr(e)){if(t)throw Error(r(479))}else null!==(t=Pa(e,n,a,2))&&Lc(t,e,2)}function qr(e){var t=e.alternate;return e===bi||null!==t&&t===bi}function Br(e,t){ki=Si=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Hr(e,t,n){if(0!==(4194048&n)){var a=t.lanes;n|=a&=e.pendingLanes,t.lanes=n,Ee(e,n)}}var Wr={readContext:Cs,use:qi,useCallback:Ii,useContext:Ii,useEffect:Ii,useImperativeHandle:Ii,useLayoutEffect:Ii,useInsertionEffect:Ii,useMemo:Ii,useReducer:Ii,useRef:Ii,useState:Ii,useDebugValue:Ii,useDeferredValue:Ii,useTransition:Ii,useSyncExternalStore:Ii,useId:Ii,useHostTransitionStatus:Ii,useFormState:Ii,useActionState:Ii,useOptimistic:Ii,useMemoCache:Ii,useCacheRefresh:Ii},Vr={readContext:Cs,use:qi,useCallback:function(e,t){return Oi().memoizedState=[e,void 0===t?null:t],e},useContext:Cs,useEffect:vr,useImperativeHandle:function(e,t,n){n=null!==n&&void 0!==n?n.concat([e]):null,gr(4194308,4,wr.bind(null,t,e),n)},useLayoutEffect:function(e,t){return gr(4194308,4,e,t)},useInsertionEffect:function(e,t){gr(4,2,e,t)},useMemo:function(e,t){var n=Oi();t=void 0===t?null:t;var a=e();if(ji){he(!0);try{e()}finally{he(!1)}}return n.memoizedState=[a,t],a},useReducer:function(e,t,n){var a=Oi();if(void 0!==n){var s=n(t);if(ji){he(!0);try{n(t)}finally{he(!1)}}}else s=t;return a.memoizedState=a.baseState=s,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:s},a.queue=e,e=e.dispatch=zr.bind(null,bi,e),[a.memoizedState,e]},useRef:function(e){return e={current:e},Oi().memoizedState=e},useState:function(e){var t=(e=Zi(e)).queue,n=Or.bind(null,bi,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:kr,useDeferredValue:function(e,t){return Cr(Oi(),e,t)},useTransition:function(){var e=Zi(!1);return e=Tr.bind(null,bi,e.queue,!0,!1),Oi().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var a=bi,s=Oi();if(is){if(void 0===n)throw Error(r(407));n=n()}else{if(n=t(),null===ac)throw Error(r(349));0!==(124&ic)||Ji(a,t,n)}s.memoizedState=n;var i={value:n,getSnapshot:t};return s.queue=i,vr(Qi.bind(null,a,i,e),[e]),a.flags|=2048,mr(9,{destroy:void 0,resource:void 0},Yi.bind(null,a,i,n,t),null),n},useId:function(){var e=Oi(),t=ac.identifierPrefix;if(is){var n=Xa;t="\xab"+t+"R"+(n=($a&~(1<<32-me($a)-1)).toString(32)+n),0<(n=Ni++)&&(t+="H"+n.toString(32)),t+="\xbb"}else t="\xab"+t+"r"+(n=Ti++).toString(32)+"\xbb";return e.memoizedState=t},useHostTransitionStatus:Mr,useFormState:lr,useActionState:lr,useOptimistic:function(e){var t=Oi();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=Ur.bind(null,bi,!0,n),n.dispatch=t,[e,t]},useMemoCache:Bi,useCacheRefresh:function(){return Oi().memoizedState=Lr.bind(null,bi)}},Kr={readContext:Cs,use:qi,useCallback:jr,useContext:Cs,useEffect:yr,useImperativeHandle:Sr,useInsertionEffect:br,useLayoutEffect:xr,useMemo:Nr,useReducer:Wi,useRef:pr,useState:function(){return Wi(Hi)},useDebugValue:kr,useDeferredValue:function(e,t){return Er(_i(),xi.memoizedState,e,t)},useTransition:function(){var e=Wi(Hi)[0],t=_i().memoizedState;return["boolean"===typeof e?e:Ui(e),t]},useSyncExternalStore:Gi,useId:Rr,useHostTransitionStatus:Mr,useFormState:cr,useActionState:cr,useOptimistic:function(e,t){return er(_i(),0,e,t)},useMemoCache:Bi,useCacheRefresh:Fr},Gr={readContext:Cs,use:qi,useCallback:jr,useContext:Cs,useEffect:yr,useImperativeHandle:Sr,useInsertionEffect:br,useLayoutEffect:xr,useMemo:Nr,useReducer:Ki,useRef:pr,useState:function(){return Ki(Hi)},useDebugValue:kr,useDeferredValue:function(e,t){var n=_i();return null===xi?Cr(n,e,t):Er(n,xi.memoizedState,e,t)},useTransition:function(){var e=Ki(Hi)[0],t=_i().memoizedState;return["boolean"===typeof e?e:Ui(e),t]},useSyncExternalStore:Gi,useId:Rr,useHostTransitionStatus:Mr,useFormState:hr,useActionState:hr,useOptimistic:function(e,t){var n=_i();return null!==xi?er(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:Bi,useCacheRefresh:Fr},Jr=null,Yr=0;function Qr(e){var t=Yr;return Yr+=1,null===Jr&&(Jr=[]),$s(Jr,e,t)}function $r(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function Xr(e,t){if(t.$$typeof===m)throw Error(r(525));throw e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Zr(e){return(0,e._init)(e._payload)}function eo(e){function t(t,n){if(e){var a=t.deletions;null===a?(t.deletions=[n],t.flags|=16):a.push(n)}}function n(n,a){if(!e)return null;for(;null!==a;)t(n,a),a=a.sibling;return null}function a(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function s(e,t){return(e=Oa(e,t)).index=0,e.sibling=null,e}function i(t,n,a){return t.index=a,e?null!==(a=t.alternate)?(a=a.index)<n?(t.flags|=67108866,n):a:(t.flags|=67108866,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,a){return null===t||6!==t.tag?((t=Ba(n,e.mode,a)).return=e,t):((t=s(t,n)).return=e,t)}function c(e,t,n,a){var i=n.type;return i===f?u(e,t,n.props.children,a,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===C&&Zr(i)===t.type)?($r(t=s(t,n.props),n),t.return=e,t):($r(t=Ua(n.type,n.key,n.props,null,e.mode,a),n),t.return=e,t)}function d(e,t,n,a){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Ha(n,e.mode,a)).return=e,t):((t=s(t,n.children||[])).return=e,t)}function u(e,t,n,a,i){return null===t||7!==t.tag?((t=qa(n,e.mode,a,i)).return=e,t):((t=s(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Ba(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case p:return $r(n=Ua(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case g:return(t=Ha(t,e.mode,n)).return=e,t;case C:return h(e,t=(0,t._init)(t._payload),n)}if(M(t)||P(t))return(t=qa(t,e.mode,n,null)).return=e,t;if("function"===typeof t.then)return h(e,Qr(t),n);if(t.$$typeof===w)return h(e,Es(e,t),n);Xr(e,t)}return null}function m(e,t,n,a){var s=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return null!==s?null:l(e,t,""+n,a);if("object"===typeof n&&null!==n){switch(n.$$typeof){case p:return n.key===s?c(e,t,n,a):null;case g:return n.key===s?d(e,t,n,a):null;case C:return m(e,t,n=(s=n._init)(n._payload),a)}if(M(n)||P(n))return null!==s?null:u(e,t,n,a,null);if("function"===typeof n.then)return m(e,t,Qr(n),a);if(n.$$typeof===w)return m(e,t,Es(e,n),a);Xr(e,n)}return null}function v(e,t,n,a,s){if("string"===typeof a&&""!==a||"number"===typeof a||"bigint"===typeof a)return l(t,e=e.get(n)||null,""+a,s);if("object"===typeof a&&null!==a){switch(a.$$typeof){case p:return c(t,e=e.get(null===a.key?n:a.key)||null,a,s);case g:return d(t,e=e.get(null===a.key?n:a.key)||null,a,s);case C:return v(e,t,n,a=(0,a._init)(a._payload),s)}if(M(a)||P(a))return u(t,e=e.get(n)||null,a,s,null);if("function"===typeof a.then)return v(e,t,n,Qr(a),s);if(a.$$typeof===w)return v(e,t,n,Es(t,a),s);Xr(t,a)}return null}function y(l,c,d,u){if("object"===typeof d&&null!==d&&d.type===f&&null===d.key&&(d=d.props.children),"object"===typeof d&&null!==d){switch(d.$$typeof){case p:e:{for(var b=d.key;null!==c;){if(c.key===b){if((b=d.type)===f){if(7===c.tag){n(l,c.sibling),(u=s(c,d.props.children)).return=l,l=u;break e}}else if(c.elementType===b||"object"===typeof b&&null!==b&&b.$$typeof===C&&Zr(b)===c.type){n(l,c.sibling),$r(u=s(c,d.props),d),u.return=l,l=u;break e}n(l,c);break}t(l,c),c=c.sibling}d.type===f?((u=qa(d.props.children,l.mode,u,d.key)).return=l,l=u):($r(u=Ua(d.type,d.key,d.props,null,l.mode,u),d),u.return=l,l=u)}return o(l);case g:e:{for(b=d.key;null!==c;){if(c.key===b){if(4===c.tag&&c.stateNode.containerInfo===d.containerInfo&&c.stateNode.implementation===d.implementation){n(l,c.sibling),(u=s(c,d.children||[])).return=l,l=u;break e}n(l,c);break}t(l,c),c=c.sibling}(u=Ha(d,l.mode,u)).return=l,l=u}return o(l);case C:return y(l,c,d=(b=d._init)(d._payload),u)}if(M(d))return function(s,r,o,l){for(var c=null,d=null,u=r,p=r=0,g=null;null!==u&&p<o.length;p++){u.index>p?(g=u,u=null):g=u.sibling;var f=m(s,u,o[p],l);if(null===f){null===u&&(u=g);break}e&&u&&null===f.alternate&&t(s,u),r=i(f,r,p),null===d?c=f:d.sibling=f,d=f,u=g}if(p===o.length)return n(s,u),is&&Za(s,p),c;if(null===u){for(;p<o.length;p++)null!==(u=h(s,o[p],l))&&(r=i(u,r,p),null===d?c=u:d.sibling=u,d=u);return is&&Za(s,p),c}for(u=a(u);p<o.length;p++)null!==(g=v(u,s,p,o[p],l))&&(e&&null!==g.alternate&&u.delete(null===g.key?p:g.key),r=i(g,r,p),null===d?c=g:d.sibling=g,d=g);return e&&u.forEach(function(e){return t(s,e)}),is&&Za(s,p),c}(l,c,d,u);if(P(d)){if("function"!==typeof(b=P(d)))throw Error(r(150));return function(s,o,l,c){if(null==l)throw Error(r(151));for(var d=null,u=null,p=o,g=o=0,f=null,y=l.next();null!==p&&!y.done;g++,y=l.next()){p.index>g?(f=p,p=null):f=p.sibling;var b=m(s,p,y.value,c);if(null===b){null===p&&(p=f);break}e&&p&&null===b.alternate&&t(s,p),o=i(b,o,g),null===u?d=b:u.sibling=b,u=b,p=f}if(y.done)return n(s,p),is&&Za(s,g),d;if(null===p){for(;!y.done;g++,y=l.next())null!==(y=h(s,y.value,c))&&(o=i(y,o,g),null===u?d=y:u.sibling=y,u=y);return is&&Za(s,g),d}for(p=a(p);!y.done;g++,y=l.next())null!==(y=v(p,s,g,y.value,c))&&(e&&null!==y.alternate&&p.delete(null===y.key?g:y.key),o=i(y,o,g),null===u?d=y:u.sibling=y,u=y);return e&&p.forEach(function(e){return t(s,e)}),is&&Za(s,g),d}(l,c,d=b.call(d),u)}if("function"===typeof d.then)return y(l,c,Qr(d),u);if(d.$$typeof===w)return y(l,c,Es(l,d),u);Xr(l,d)}return"string"===typeof d&&""!==d||"number"===typeof d||"bigint"===typeof d?(d=""+d,null!==c&&6===c.tag?(n(l,c.sibling),(u=s(c,d)).return=l,l=u):(n(l,c),(u=Ba(d,l.mode,u)).return=l,l=u),o(l)):n(l,c)}return function(e,t,n,a){try{Yr=0;var s=y(e,t,n,a);return Jr=null,s}catch(r){if(r===Vs||r===Gs)throw r;var i=La(29,r,null,e.mode);return i.lanes=a,i.return=e,i}}}var to=eo(!0),no=eo(!1),ao=_(null),so=null;function io(e){var t=e.alternate;q(co,1&co.current),q(ao,e),null===so&&(null===t||null!==mi.current||null!==t.memoizedState)&&(so=e)}function ro(e){if(22===e.tag){if(q(co,co.current),q(ao,e),null===so){var t=e.alternate;null!==t&&null!==t.memoizedState&&(so=e)}}else oo()}function oo(){q(co,co.current),q(ao,ao.current)}function lo(e){U(ao),so===e&&(so=null),U(co)}var co=_(0);function uo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||fu(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function ho(e,t,n,a){n=null===(n=n(a,t=e.memoizedState))||void 0===n?t:h({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var mo={enqueueSetState:function(e,t,n){e=e._reactInternals;var a=Rc(),s=si(a);s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=ii(e,s,a))&&(Lc(t,e,a),ri(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var a=Rc(),s=si(a);s.tag=1,s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=ii(e,s,a))&&(Lc(t,e,a),ri(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Rc(),a=si(n);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=ii(e,a,n))&&(Lc(t,e,n),ri(t,e,n))}};function po(e,t,n,a,s,i,r){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(a,i,r):!t.prototype||!t.prototype.isPureReactComponent||(!Qn(n,a)||!Qn(s,i))}function go(e,t,n,a){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,a),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,a),t.state!==e&&mo.enqueueReplaceState(t,t.state,null)}function fo(e,t){var n=t;if("ref"in t)for(var a in n={},t)"ref"!==a&&(n[a]=t[a]);if(e=e.defaultProps)for(var s in n===t&&(n=h({},n)),e)void 0===n[s]&&(n[s]=e[s]);return n}var vo="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function yo(e){vo(e)}function bo(e){console.error(e)}function xo(e){vo(e)}function wo(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function So(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(a){setTimeout(function(){throw a})}}function ko(e,t,n){return(n=si(n)).tag=3,n.payload={element:null},n.callback=function(){wo(e,t)},n}function jo(e){return(e=si(e)).tag=3,e}function No(e,t,n,a){var s=n.type.getDerivedStateFromError;if("function"===typeof s){var i=a.value;e.payload=function(){return s(i)},e.callback=function(){So(t,n,a)}}var r=n.stateNode;null!==r&&"function"===typeof r.componentDidCatch&&(e.callback=function(){So(t,n,a),"function"!==typeof s&&(null===jc?jc=new Set([this]):jc.add(this));var e=a.stack;this.componentDidCatch(a.value,{componentStack:null!==e?e:""})})}var Co=Error(r(461)),Eo=!1;function To(e,t,n,a){t.child=null===e?no(t,null,n,a):to(t,e.child,n,a)}function Io(e,t,n,a,s){n=n.render;var i=t.ref;if("ref"in a){var r={};for(var o in a)"ref"!==o&&(r[o]=a[o])}else r=a;return Ns(t),a=Di(e,t,n,r,i,s),o=Fi(),null===e||Eo?(is&&o&&ts(t),t.flags|=1,To(e,t,a,s),t.child):(Li(e,t,s),Yo(e,t,s))}function Po(e,t,n,a,s){if(null===e){var i=n.type;return"function"!==typeof i||za(i)||void 0!==i.defaultProps||null!==n.compare?((e=Ua(n.type,null,a,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Do(e,t,i,a,s))}if(i=e.child,!Qo(e,s)){var r=i.memoizedProps;if((n=null!==(n=n.compare)?n:Qn)(r,a)&&e.ref===t.ref)return Yo(e,t,s)}return t.flags|=1,(e=Oa(i,a)).ref=t.ref,e.return=t,t.child=e}function Do(e,t,n,a,s){if(null!==e){var i=e.memoizedProps;if(Qn(i,a)&&e.ref===t.ref){if(Eo=!1,t.pendingProps=a=i,!Qo(e,s))return t.lanes=e.lanes,Yo(e,t,s);0!==(131072&e.flags)&&(Eo=!0)}}return Fo(e,t,n,a,s)}function Ao(e,t,n){var a=t.pendingProps,s=a.children,i=null!==e?e.memoizedState:null;if("hidden"===a.mode){if(0!==(128&t.flags)){if(a=null!==i?i.baseLanes|n:n,null!==e){for(s=t.child=e.child,i=0;null!==s;)i=i|s.lanes|s.childLanes,s=s.sibling;t.childLanes=i&~a}else t.childLanes=0,t.child=null;return Mo(e,t,a,n)}if(0===(536870912&n))return t.lanes=t.childLanes=536870912,Mo(e,t,null!==i?i.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Hs(0,null!==i?i.cachePool:null),null!==i?gi(t,i):fi(),ro(t)}else null!==i?(Hs(0,i.cachePool),gi(t,i),oo(),t.memoizedState=null):(null!==e&&Hs(0,null),fi(),oo());return To(e,t,s,n),t.child}function Mo(e,t,n,a){var s=Bs();return s=null===s?null:{parent:As._currentValue,pool:s},t.memoizedState={baseLanes:n,cachePool:s},null!==e&&Hs(0,null),fi(),ro(t),null!==e&&ks(e,t,a,!0),null}function Ro(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof n&&"object"!==typeof n)throw Error(r(284));null!==e&&e.ref===n||(t.flags|=4194816)}}function Fo(e,t,n,a,s){return Ns(t),n=Di(e,t,n,a,void 0,s),a=Fi(),null===e||Eo?(is&&a&&ts(t),t.flags|=1,To(e,t,n,s),t.child):(Li(e,t,s),Yo(e,t,s))}function Lo(e,t,n,a,s,i){return Ns(t),t.updateQueue=null,n=Mi(t,a,n,s),Ai(e),a=Fi(),null===e||Eo?(is&&a&&ts(t),t.flags|=1,To(e,t,n,i),t.child):(Li(e,t,i),Yo(e,t,i))}function zo(e,t,n,a,s){if(Ns(t),null===t.stateNode){var i=Ra,r=n.contextType;"object"===typeof r&&null!==r&&(i=Cs(r)),i=new n(a,i),t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,i.updater=mo,t.stateNode=i,i._reactInternals=t,(i=t.stateNode).props=a,i.state=t.memoizedState,i.refs={},ni(t),r=n.contextType,i.context="object"===typeof r&&null!==r?Cs(r):Ra,i.state=t.memoizedState,"function"===typeof(r=n.getDerivedStateFromProps)&&(ho(t,n,r,a),i.state=t.memoizedState),"function"===typeof n.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(r=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),r!==i.state&&mo.enqueueReplaceState(i,i.state,null),di(t,a,i,s),ci(),i.state=t.memoizedState),"function"===typeof i.componentDidMount&&(t.flags|=4194308),a=!0}else if(null===e){i=t.stateNode;var o=t.memoizedProps,l=fo(n,o);i.props=l;var c=i.context,d=n.contextType;r=Ra,"object"===typeof d&&null!==d&&(r=Cs(d));var u=n.getDerivedStateFromProps;d="function"===typeof u||"function"===typeof i.getSnapshotBeforeUpdate,o=t.pendingProps!==o,d||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(o||c!==r)&&go(t,i,a,r),ti=!1;var h=t.memoizedState;i.state=h,di(t,a,i,s),ci(),c=t.memoizedState,o||h!==c||ti?("function"===typeof u&&(ho(t,n,u,a),c=t.memoizedState),(l=ti||po(t,n,l,a,h,c,r))?(d||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||("function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"===typeof i.componentDidMount&&(t.flags|=4194308)):("function"===typeof i.componentDidMount&&(t.flags|=4194308),t.memoizedProps=a,t.memoizedState=c),i.props=a,i.state=c,i.context=r,a=l):("function"===typeof i.componentDidMount&&(t.flags|=4194308),a=!1)}else{i=t.stateNode,ai(e,t),d=fo(n,r=t.memoizedProps),i.props=d,u=t.pendingProps,h=i.context,c=n.contextType,l=Ra,"object"===typeof c&&null!==c&&(l=Cs(c)),(c="function"===typeof(o=n.getDerivedStateFromProps)||"function"===typeof i.getSnapshotBeforeUpdate)||"function"!==typeof i.UNSAFE_componentWillReceiveProps&&"function"!==typeof i.componentWillReceiveProps||(r!==u||h!==l)&&go(t,i,a,l),ti=!1,h=t.memoizedState,i.state=h,di(t,a,i,s),ci();var m=t.memoizedState;r!==u||h!==m||ti||null!==e&&null!==e.dependencies&&js(e.dependencies)?("function"===typeof o&&(ho(t,n,o,a),m=t.memoizedState),(d=ti||po(t,n,d,a,h,m,l)||null!==e&&null!==e.dependencies&&js(e.dependencies))?(c||"function"!==typeof i.UNSAFE_componentWillUpdate&&"function"!==typeof i.componentWillUpdate||("function"===typeof i.componentWillUpdate&&i.componentWillUpdate(a,m,l),"function"===typeof i.UNSAFE_componentWillUpdate&&i.UNSAFE_componentWillUpdate(a,m,l)),"function"===typeof i.componentDidUpdate&&(t.flags|=4),"function"===typeof i.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof i.componentDidUpdate||r===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||r===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=a,t.memoizedState=m),i.props=a,i.state=m,i.context=l,a=d):("function"!==typeof i.componentDidUpdate||r===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof i.getSnapshotBeforeUpdate||r===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),a=!1)}return i=a,Ro(e,t),a=0!==(128&t.flags),i||a?(i=t.stateNode,n=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render(),t.flags|=1,null!==e&&a?(t.child=to(t,e.child,null,s),t.child=to(t,null,n,s)):To(e,t,n,s),t.memoizedState=i.state,e=t.child):e=Yo(e,t,s),e}function Oo(e,t,n,a){return ms(),t.flags|=256,To(e,t,n,a),t.child}var _o={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Uo(e){return{baseLanes:e,cachePool:Ws()}}function qo(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=fc),e}function Bo(e,t,n){var a,s=t.pendingProps,i=!1,o=0!==(128&t.flags);if((a=o)||(a=(null===e||null!==e.memoizedState)&&0!==(2&co.current)),a&&(i=!0,t.flags&=-129),a=0!==(32&t.flags),t.flags&=-33,null===e){if(is){if(i?io(t):oo(),is){var l,c=ss;if(l=c){e:{for(l=c,c=os;8!==l.nodeType;){if(!c){c=null;break e}if(null===(l=vu(l.nextSibling))){c=null;break e}}c=l}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==Qa?{id:$a,overflow:Xa}:null,retryLane:536870912,hydrationErrors:null},(l=La(18,null,null,0)).stateNode=c,l.return=t,t.child=l,as=t,ss=null,l=!0):l=!1}l||cs(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return fu(c)?t.lanes=32:t.lanes=536870912,null;lo(t)}return c=s.children,s=s.fallback,i?(oo(),c=Wo({mode:"hidden",children:c},i=t.mode),s=qa(s,i,n,null),c.return=t,s.return=t,c.sibling=s,t.child=c,(i=t.child).memoizedState=Uo(n),i.childLanes=qo(e,a,n),t.memoizedState=_o,s):(io(t),Ho(t,c))}if(null!==(l=e.memoizedState)&&null!==(c=l.dehydrated)){if(o)256&t.flags?(io(t),t.flags&=-257,t=Vo(e,t,n)):null!==t.memoizedState?(oo(),t.child=e.child,t.flags|=128,t=null):(oo(),i=s.fallback,c=t.mode,s=Wo({mode:"visible",children:s.children},c),(i=qa(i,c,n,null)).flags|=2,s.return=t,i.return=t,s.sibling=i,t.child=s,to(t,e.child,null,n),(s=t.child).memoizedState=Uo(n),s.childLanes=qo(e,a,n),t.memoizedState=_o,t=i);else if(io(t),fu(c)){if(a=c.nextSibling&&c.nextSibling.dataset)var d=a.dgst;a=d,(s=Error(r(419))).stack="",s.digest=a,gs({value:s,source:null,stack:null}),t=Vo(e,t,n)}else if(Eo||ks(e,t,n,!1),a=0!==(n&e.childLanes),Eo||a){if(null!==(a=ac)&&(0!==(s=0!==((s=0!==(42&(s=n&-n))?1:Te(s))&(a.suspendedLanes|n))?0:s)&&s!==l.retryLane))throw l.retryLane=s,Da(e,s),Lc(a,e,s),Co;"$?"===c.data||Gc(),t=Vo(e,t,n)}else"$?"===c.data?(t.flags|=192,t.child=e.child,t=null):(e=l.treeContext,ss=vu(c.nextSibling),as=t,is=!0,rs=null,os=!1,null!==e&&(Ja[Ya++]=$a,Ja[Ya++]=Xa,Ja[Ya++]=Qa,$a=e.id,Xa=e.overflow,Qa=t),(t=Ho(t,s.children)).flags|=4096);return t}return i?(oo(),i=s.fallback,c=t.mode,d=(l=e.child).sibling,(s=Oa(l,{mode:"hidden",children:s.children})).subtreeFlags=65011712&l.subtreeFlags,null!==d?i=Oa(d,i):(i=qa(i,c,n,null)).flags|=2,i.return=t,s.return=t,s.sibling=i,t.child=s,s=i,i=t.child,null===(c=e.child.memoizedState)?c=Uo(n):(null!==(l=c.cachePool)?(d=As._currentValue,l=l.parent!==d?{parent:d,pool:d}:l):l=Ws(),c={baseLanes:c.baseLanes|n,cachePool:l}),i.memoizedState=c,i.childLanes=qo(e,a,n),t.memoizedState=_o,s):(io(t),e=(n=e.child).sibling,(n=Oa(n,{mode:"visible",children:s.children})).return=t,n.sibling=null,null!==e&&(null===(a=t.deletions)?(t.deletions=[e],t.flags|=16):a.push(e)),t.child=n,t.memoizedState=null,n)}function Ho(e,t){return(t=Wo({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Wo(e,t){return(e=La(22,e,null,t)).lanes=0,e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},e}function Vo(e,t,n){return to(t,e.child,null,n),(e=Ho(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Ko(e,t,n){e.lanes|=t;var a=e.alternate;null!==a&&(a.lanes|=t),ws(e.return,t,n)}function Go(e,t,n,a,s){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:a,tail:n,tailMode:s}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=a,i.tail=n,i.tailMode=s)}function Jo(e,t,n){var a=t.pendingProps,s=a.revealOrder,i=a.tail;if(To(e,t,a.children,n),0!==(2&(a=co.current)))a=1&a|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ko(e,n,t);else if(19===e.tag)Ko(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}switch(q(co,a),s){case"forwards":for(n=t.child,s=null;null!==n;)null!==(e=n.alternate)&&null===uo(e)&&(s=n),n=n.sibling;null===(n=s)?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),Go(t,!1,s,n,i);break;case"backwards":for(n=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===uo(e)){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}Go(t,!0,n,null,i);break;case"together":Go(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Yo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),mc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null;if(ks(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(n=Oa(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Oa(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Qo(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!js(e))}function $o(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Eo=!0;else{if(!Qo(e,n)&&0===(128&t.flags))return Eo=!1,function(e,t,n){switch(t.tag){case 3:K(t,t.stateNode.containerInfo),bs(0,As,e.memoizedState.cache),ms();break;case 27:case 5:J(t);break;case 4:K(t,t.stateNode.containerInfo);break;case 10:bs(0,t.type,t.memoizedProps.value);break;case 13:var a=t.memoizedState;if(null!==a)return null!==a.dehydrated?(io(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Bo(e,t,n):(io(t),null!==(e=Yo(e,t,n))?e.sibling:null);io(t);break;case 19:var s=0!==(128&e.flags);if((a=0!==(n&t.childLanes))||(ks(e,t,n,!1),a=0!==(n&t.childLanes)),s){if(a)return Jo(e,t,n);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),q(co,co.current),a)break;return null;case 22:case 23:return t.lanes=0,Ao(e,t,n);case 24:bs(0,As,e.memoizedState.cache)}return Yo(e,t,n)}(e,t,n);Eo=0!==(131072&e.flags)}else Eo=!1,is&&0!==(1048576&t.flags)&&es(t,Ga,t.index);switch(t.lanes=0,t.tag){case 16:e:{e=t.pendingProps;var a=t.elementType,s=a._init;if(a=s(a._payload),t.type=a,"function"!==typeof a){if(void 0!==a&&null!==a){if((s=a.$$typeof)===S){t.tag=11,t=Io(null,t,a,e,n);break e}if(s===N){t.tag=14,t=Po(null,t,a,e,n);break e}}throw t=A(a)||a,Error(r(306,t,""))}za(a)?(e=fo(a,e),t.tag=1,t=zo(null,t,a,e,n)):(t.tag=0,t=Fo(null,t,a,e,n))}return t;case 0:return Fo(e,t,t.type,t.pendingProps,n);case 1:return zo(e,t,a=t.type,s=fo(a,t.pendingProps),n);case 3:e:{if(K(t,t.stateNode.containerInfo),null===e)throw Error(r(387));a=t.pendingProps;var i=t.memoizedState;s=i.element,ai(e,t),di(t,a,null,n);var o=t.memoizedState;if(a=o.cache,bs(0,As,a),a!==i.cache&&Ss(t,[As],n,!0),ci(),a=o.element,i.isDehydrated){if(i={element:a,isDehydrated:!1,cache:o.cache},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Oo(e,t,a,n);break e}if(a!==s){gs(s=ja(Error(r(424)),t)),t=Oo(e,t,a,n);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(ss=vu(e.firstChild),as=t,is=!0,rs=null,os=!0,n=no(t,null,a,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ms(),a===s){t=Yo(e,t,n);break e}To(e,t,a,n)}t=t.child}return t;case 26:return Ro(e,t),null===e?(n=Tu(t.type,null,t.pendingProps,null))?t.memoizedState=n:is||(n=t.type,e=t.pendingProps,(a=au(W.current).createElement(n))[Ae]=t,a[Me]=e,eu(a,n,e),Ve(a),t.stateNode=a):t.memoizedState=Tu(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return J(t),null===e&&is&&(a=t.stateNode=xu(t.type,t.pendingProps,W.current),as=t,os=!0,s=ss,mu(t.type)?(yu=s,ss=vu(a.firstChild)):ss=s),To(e,t,t.pendingProps.children,n),Ro(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&is&&((s=a=ss)&&(null!==(a=function(e,t,n,a){for(;1===e.nodeType;){var s=n;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!a&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(a){if(!e[_e])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(i=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(i!==s.rel||e.getAttribute("href")!==(null==s.href||""===s.href?null:s.href)||e.getAttribute("crossorigin")!==(null==s.crossOrigin?null:s.crossOrigin)||e.getAttribute("title")!==(null==s.title?null:s.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((i=e.getAttribute("src"))!==(null==s.src?null:s.src)||e.getAttribute("type")!==(null==s.type?null:s.type)||e.getAttribute("crossorigin")!==(null==s.crossOrigin?null:s.crossOrigin))&&i&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var i=null==s.name?null:""+s.name;if("hidden"===s.type&&e.getAttribute("name")===i)return e}if(null===(e=vu(e.nextSibling)))break}return null}(a,t.type,t.pendingProps,os))?(t.stateNode=a,as=t,ss=vu(a.firstChild),os=!1,s=!0):s=!1),s||cs(t)),J(t),s=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,a=i.children,ru(s,i)?a=null:null!==o&&ru(s,o)&&(t.flags|=32),null!==t.memoizedState&&(s=Di(e,t,Ri,null,null,n),Ju._currentValue=s),Ro(e,t),To(e,t,a,n),t.child;case 6:return null===e&&is&&((e=n=ss)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null;if(null===(e=vu(e.nextSibling)))return null}return e}(n,t.pendingProps,os))?(t.stateNode=n,as=t,ss=null,e=!0):e=!1),e||cs(t)),null;case 13:return Bo(e,t,n);case 4:return K(t,t.stateNode.containerInfo),a=t.pendingProps,null===e?t.child=to(t,null,a,n):To(e,t,a,n),t.child;case 11:return Io(e,t,t.type,t.pendingProps,n);case 7:return To(e,t,t.pendingProps,n),t.child;case 8:case 12:return To(e,t,t.pendingProps.children,n),t.child;case 10:return a=t.pendingProps,bs(0,t.type,a.value),To(e,t,a.children,n),t.child;case 9:return s=t.type._context,a=t.pendingProps.children,Ns(t),a=a(s=Cs(s)),t.flags|=1,To(e,t,a,n),t.child;case 14:return Po(e,t,t.type,t.pendingProps,n);case 15:return Do(e,t,t.type,t.pendingProps,n);case 19:return Jo(e,t,n);case 31:return a=t.pendingProps,n=t.mode,a={mode:a.mode,children:a.children},null===e?((n=Wo(a,n)).ref=t.ref,t.child=n,n.return=t,t=n):((n=Oa(e.child,a)).ref=t.ref,t.child=n,n.return=t,t=n),t;case 22:return Ao(e,t,n);case 24:return Ns(t),a=Cs(As),null===e?(null===(s=Bs())&&(s=ac,i=Ms(),s.pooledCache=i,i.refCount++,null!==i&&(s.pooledCacheLanes|=n),s=i),t.memoizedState={parent:a,cache:s},ni(t),bs(0,As,s)):(0!==(e.lanes&n)&&(ai(e,t),di(t,null,null,n),ci()),s=e.memoizedState,i=t.memoizedState,s.parent!==a?(s={parent:a,cache:a},t.memoizedState=s,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=s),bs(0,As,a)):(a=i.cache,bs(0,As,a),a!==s.cache&&Ss(t,[As],n,!0))),To(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(r(156,t.tag))}function Xo(e){e.flags|=4}function Zo(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!qu(t)){if(null!==(t=ao.current)&&((4194048&ic)===ic?null!==so:(62914560&ic)!==ic&&0===(536870912&ic)||t!==so))throw Xs=Js,Ks;e.flags|=8192}}function el(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?ke():536870912,e.lanes|=t,vc|=t)}function tl(e,t){if(!is)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var a=null;null!==n;)null!==n.alternate&&(a=n),n=n.sibling;null===a?t||null===e.tail?e.tail=null:e.tail.sibling=null:a.sibling=null}}function nl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,a=0;if(t)for(var s=e.child;null!==s;)n|=s.lanes|s.childLanes,a|=65011712&s.subtreeFlags,a|=65011712&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)n|=s.lanes|s.childLanes,a|=s.subtreeFlags,a|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=a,e.childLanes=n,t}function al(e,t,n){var a=t.pendingProps;switch(ns(t),t.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return nl(t),null;case 3:return n=t.stateNode,a=null,null!==e&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),xs(As),G(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(hs(t)?Xo(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,ps())),nl(t),null;case 26:return n=t.memoizedState,null===e?(Xo(t),null!==n?(nl(t),Zo(t,n)):(nl(t),t.flags&=-16777217)):n?n!==e.memoizedState?(Xo(t),nl(t),Zo(t,n)):(nl(t),t.flags&=-16777217):(e.memoizedProps!==a&&Xo(t),nl(t),t.flags&=-16777217),null;case 27:Y(t),n=W.current;var s=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==a&&Xo(t);else{if(!a){if(null===t.stateNode)throw Error(r(166));return nl(t),null}e=B.current,hs(t)?ds(t):(e=xu(s,a,n),t.stateNode=e,Xo(t))}return nl(t),null;case 5:if(Y(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==a&&Xo(t);else{if(!a){if(null===t.stateNode)throw Error(r(166));return nl(t),null}if(e=B.current,hs(t))ds(t);else{switch(s=au(W.current),e){case 1:e=s.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=s.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=s.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=s.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=s.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"===typeof a.is?s.createElement("select",{is:a.is}):s.createElement("select"),a.multiple?e.multiple=!0:a.size&&(e.size=a.size);break;default:e="string"===typeof a.is?s.createElement(n,{is:a.is}):s.createElement(n)}}e[Ae]=t,e[Me]=a;e:for(s=t.child;null!==s;){if(5===s.tag||6===s.tag)e.appendChild(s.stateNode);else if(4!==s.tag&&27!==s.tag&&null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break e;for(;null===s.sibling;){if(null===s.return||s.return===t)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}t.stateNode=e;e:switch(eu(e,n,a),n){case"button":case"input":case"select":case"textarea":e=!!a.autoFocus;break e;case"img":e=!0;break e;default:e=!1}e&&Xo(t)}}return nl(t),t.flags&=-16777217,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==a&&Xo(t);else{if("string"!==typeof a&&null===t.stateNode)throw Error(r(166));if(e=W.current,hs(t)){if(e=t.stateNode,n=t.memoizedProps,a=null,null!==(s=as))switch(s.tag){case 27:case 5:a=s.memoizedProps}e[Ae]=t,(e=!!(e.nodeValue===n||null!==a&&!0===a.suppressHydrationWarning||Qd(e.nodeValue,n)))||cs(t)}else(e=au(e).createTextNode(a))[Ae]=t,t.stateNode=e}return nl(t),null;case 13:if(a=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(s=hs(t),null!==a&&null!==a.dehydrated){if(null===e){if(!s)throw Error(r(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(r(317));s[Ae]=t}else ms(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;nl(t),s=!1}else s=ps(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=s),s=!0;if(!s)return 256&t.flags?(lo(t),t):(lo(t),null)}if(lo(t),0!==(128&t.flags))return t.lanes=n,t;if(n=null!==a,e=null!==e&&null!==e.memoizedState,n){s=null,null!==(a=t.child).alternate&&null!==a.alternate.memoizedState&&null!==a.alternate.memoizedState.cachePool&&(s=a.alternate.memoizedState.cachePool.pool);var i=null;null!==a.memoizedState&&null!==a.memoizedState.cachePool&&(i=a.memoizedState.cachePool.pool),i!==s&&(a.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),el(t,t.updateQueue),nl(t),null;case 4:return G(),null===e&&Ud(t.stateNode.containerInfo),nl(t),null;case 10:return xs(t.type),nl(t),null;case 19:if(U(co),null===(s=t.memoizedState))return nl(t),null;if(a=0!==(128&t.flags),null===(i=s.rendering))if(a)tl(s,!1);else{if(0!==hc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(i=uo(e))){for(t.flags|=128,tl(s,!1),e=i.updateQueue,t.updateQueue=e,el(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)_a(n,e),n=n.sibling;return q(co,1&co.current|2),t.child}e=e.sibling}null!==s.tail&&te()>Sc&&(t.flags|=128,a=!0,tl(s,!1),t.lanes=4194304)}else{if(!a)if(null!==(e=uo(i))){if(t.flags|=128,a=!0,e=e.updateQueue,t.updateQueue=e,el(t,e),tl(s,!0),null===s.tail&&"hidden"===s.tailMode&&!i.alternate&&!is)return nl(t),null}else 2*te()-s.renderingStartTime>Sc&&536870912!==n&&(t.flags|=128,a=!0,tl(s,!1),t.lanes=4194304);s.isBackwards?(i.sibling=t.child,t.child=i):(null!==(e=s.last)?e.sibling=i:t.child=i,s.last=i)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=te(),t.sibling=null,e=co.current,q(co,a?1&e|2:1&e),t):(nl(t),null);case 22:case 23:return lo(t),vi(),a=null!==t.memoizedState,null!==e?null!==e.memoizedState!==a&&(t.flags|=8192):a&&(t.flags|=8192),a?0!==(536870912&n)&&0===(128&t.flags)&&(nl(t),6&t.subtreeFlags&&(t.flags|=8192)):nl(t),null!==(n=t.updateQueue)&&el(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),a=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(a=t.memoizedState.cachePool.pool),a!==n&&(t.flags|=2048),null!==e&&U(qs),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),xs(As),nl(t),null;case 25:case 30:return null}throw Error(r(156,t.tag))}function sl(e,t){switch(ns(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return xs(As),G(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return Y(t),null;case 13:if(lo(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));ms()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return U(co),null;case 4:return G(),null;case 10:return xs(t.type),null;case 22:case 23:return lo(t),vi(),null!==e&&U(qs),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return xs(As),null;default:return null}}function il(e,t){switch(ns(t),t.tag){case 3:xs(As),G();break;case 26:case 27:case 5:Y(t);break;case 4:G();break;case 13:lo(t);break;case 19:U(co);break;case 10:xs(t.type);break;case 22:case 23:lo(t),vi(),null!==e&&U(qs);break;case 24:xs(As)}}function rl(e,t){try{var n=t.updateQueue,a=null!==n?n.lastEffect:null;if(null!==a){var s=a.next;n=s;do{if((n.tag&e)===e){a=void 0;var i=n.create,r=n.inst;a=i(),r.destroy=a}n=n.next}while(n!==s)}}catch(o){dd(t,t.return,o)}}function ol(e,t,n){try{var a=t.updateQueue,s=null!==a?a.lastEffect:null;if(null!==s){var i=s.next;a=i;do{if((a.tag&e)===e){var r=a.inst,o=r.destroy;if(void 0!==o){r.destroy=void 0,s=t;var l=n,c=o;try{c()}catch(d){dd(s,l,d)}}}a=a.next}while(a!==i)}}catch(d){dd(t,t.return,d)}}function ll(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{hi(t,n)}catch(a){dd(e,e.return,a)}}}function cl(e,t,n){n.props=fo(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(a){dd(e,t,a)}}function dl(e,t){try{var n=e.ref;if(null!==n){switch(e.tag){case 26:case 27:case 5:var a=e.stateNode;break;default:a=e.stateNode}"function"===typeof n?e.refCleanup=n(a):n.current=a}}catch(s){dd(e,t,s)}}function ul(e,t){var n=e.ref,a=e.refCleanup;if(null!==n)if("function"===typeof a)try{a()}catch(s){dd(e,t,s)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof n)try{n(null)}catch(i){dd(e,t,i)}else n.current=null}function hl(e){var t=e.type,n=e.memoizedProps,a=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&a.focus();break e;case"img":n.src?a.src=n.src:n.srcSet&&(a.srcset=n.srcSet)}}catch(s){dd(e,e.return,s)}}function ml(e,t,n){try{var a=e.stateNode;!function(e,t,n,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var s=null,i=null,o=null,l=null,c=null,d=null,u=null;for(p in n){var h=n[p];if(n.hasOwnProperty(p)&&null!=h)switch(p){case"checked":case"value":break;case"defaultValue":c=h;default:a.hasOwnProperty(p)||Xd(e,t,p,null,a,h)}}for(var m in a){var p=a[m];if(h=n[m],a.hasOwnProperty(m)&&(null!=p||null!=h))switch(m){case"type":i=p;break;case"name":s=p;break;case"checked":d=p;break;case"defaultChecked":u=p;break;case"value":o=p;break;case"defaultValue":l=p;break;case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(r(137,t));break;default:p!==h&&Xd(e,t,m,p,a,h)}}return void ft(e,o,l,c,d,u,i,s);case"select":for(i in p=o=l=m=null,n)if(c=n[i],n.hasOwnProperty(i)&&null!=c)switch(i){case"value":break;case"multiple":p=c;default:a.hasOwnProperty(i)||Xd(e,t,i,null,a,c)}for(s in a)if(i=a[s],c=n[s],a.hasOwnProperty(s)&&(null!=i||null!=c))switch(s){case"value":m=i;break;case"defaultValue":l=i;break;case"multiple":o=i;default:i!==c&&Xd(e,t,s,i,a,c)}return t=l,n=o,a=p,void(null!=m?bt(e,!!n,m,!1):!!a!==!!n&&(null!=t?bt(e,!!n,t,!0):bt(e,!!n,n?[]:"",!1)));case"textarea":for(l in p=m=null,n)if(s=n[l],n.hasOwnProperty(l)&&null!=s&&!a.hasOwnProperty(l))switch(l){case"value":case"children":break;default:Xd(e,t,l,null,a,s)}for(o in a)if(s=a[o],i=n[o],a.hasOwnProperty(o)&&(null!=s||null!=i))switch(o){case"value":m=s;break;case"defaultValue":p=s;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=s)throw Error(r(91));break;default:s!==i&&Xd(e,t,o,s,a,i)}return void xt(e,m,p);case"option":for(var g in n)if(m=n[g],n.hasOwnProperty(g)&&null!=m&&!a.hasOwnProperty(g))if("selected"===g)e.selected=!1;else Xd(e,t,g,null,a,m);for(c in a)if(m=a[c],p=n[c],a.hasOwnProperty(c)&&m!==p&&(null!=m||null!=p))if("selected"===c)e.selected=m&&"function"!==typeof m&&"symbol"!==typeof m;else Xd(e,t,c,m,a,p);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var f in n)m=n[f],n.hasOwnProperty(f)&&null!=m&&!a.hasOwnProperty(f)&&Xd(e,t,f,null,a,m);for(d in a)if(m=a[d],p=n[d],a.hasOwnProperty(d)&&m!==p&&(null!=m||null!=p))switch(d){case"children":case"dangerouslySetInnerHTML":if(null!=m)throw Error(r(137,t));break;default:Xd(e,t,d,m,a,p)}return;default:if(Ct(t)){for(var v in n)m=n[v],n.hasOwnProperty(v)&&void 0!==m&&!a.hasOwnProperty(v)&&Zd(e,t,v,void 0,a,m);for(u in a)m=a[u],p=n[u],!a.hasOwnProperty(u)||m===p||void 0===m&&void 0===p||Zd(e,t,u,m,a,p);return}}for(var y in n)m=n[y],n.hasOwnProperty(y)&&null!=m&&!a.hasOwnProperty(y)&&Xd(e,t,y,null,a,m);for(h in a)m=a[h],p=n[h],!a.hasOwnProperty(h)||m===p||null==m&&null==p||Xd(e,t,h,m,a,p)}(a,e.type,n,t),a[Me]=t}catch(s){dd(e,e.return,s)}}function pl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&mu(e.type)||4===e.tag}function gl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||pl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&mu(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function fl(e,t,n){var a=e.tag;if(5===a||6===a)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$d));else if(4!==a&&(27===a&&mu(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(fl(e,t,n),e=e.sibling;null!==e;)fl(e,t,n),e=e.sibling}function vl(e,t,n){var a=e.tag;if(5===a||6===a)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==a&&(27===a&&mu(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(vl(e,t,n),e=e.sibling;null!==e;)vl(e,t,n),e=e.sibling}function yl(e){var t=e.stateNode,n=e.memoizedProps;try{for(var a=e.type,s=t.attributes;s.length;)t.removeAttributeNode(s[0]);eu(t,a,n),t[Ae]=e,t[Me]=n}catch(i){dd(e,e.return,i)}}var bl=!1,xl=!1,wl=!1,Sl="function"===typeof WeakSet?WeakSet:Set,kl=null;function jl(e,t,n){var a=n.flags;switch(n.tag){case 0:case 11:case 15:zl(e,n),4&a&&rl(5,n);break;case 1:if(zl(e,n),4&a)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(r){dd(n,n.return,r)}else{var s=fo(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(s,t,e.__reactInternalSnapshotBeforeUpdate)}catch(o){dd(n,n.return,o)}}64&a&&ll(n),512&a&&dl(n,n.return);break;case 3:if(zl(e,n),64&a&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{hi(e,t)}catch(r){dd(n,n.return,r)}}break;case 27:null===t&&4&a&&yl(n);case 26:case 5:zl(e,n),null===t&&4&a&&hl(n),512&a&&dl(n,n.return);break;case 12:zl(e,n);break;case 13:zl(e,n),4&a&&Pl(e,n),64&a&&(null!==(e=n.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var a=function(){t(),n.removeEventListener("DOMContentLoaded",a)};n.addEventListener("DOMContentLoaded",a),e._reactRetry=a}}(e,n=pd.bind(null,n))));break;case 22:if(!(a=null!==n.memoizedState||bl)){t=null!==t&&null!==t.memoizedState||xl,s=bl;var i=xl;bl=a,(xl=t)&&!i?_l(e,n,0!==(8772&n.subtreeFlags)):zl(e,n),bl=s,xl=i}break;case 30:break;default:zl(e,n)}}function Nl(e){var t=e.alternate;null!==t&&(e.alternate=null,Nl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Ue(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Cl=null,El=!1;function Tl(e,t,n){for(n=n.child;null!==n;)Il(e,t,n),n=n.sibling}function Il(e,t,n){if(ue&&"function"===typeof ue.onCommitFiberUnmount)try{ue.onCommitFiberUnmount(de,n)}catch(i){}switch(n.tag){case 26:xl||ul(n,t),Tl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:xl||ul(n,t);var a=Cl,s=El;mu(n.type)&&(Cl=n.stateNode,El=!1),Tl(e,t,n),wu(n.stateNode),Cl=a,El=s;break;case 5:xl||ul(n,t);case 6:if(a=Cl,s=El,Cl=null,Tl(e,t,n),El=s,null!==(Cl=a))if(El)try{(9===Cl.nodeType?Cl.body:"HTML"===Cl.nodeName?Cl.ownerDocument.body:Cl).removeChild(n.stateNode)}catch(r){dd(n,t,r)}else try{Cl.removeChild(n.stateNode)}catch(r){dd(n,t,r)}break;case 18:null!==Cl&&(El?(pu(9===(e=Cl).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Eh(e)):pu(Cl,n.stateNode));break;case 4:a=Cl,s=El,Cl=n.stateNode.containerInfo,El=!0,Tl(e,t,n),Cl=a,El=s;break;case 0:case 11:case 14:case 15:xl||ol(2,n,t),xl||ol(4,n,t),Tl(e,t,n);break;case 1:xl||(ul(n,t),"function"===typeof(a=n.stateNode).componentWillUnmount&&cl(n,t,a)),Tl(e,t,n);break;case 21:Tl(e,t,n);break;case 22:xl=(a=xl)||null!==n.memoizedState,Tl(e,t,n),xl=a;break;default:Tl(e,t,n)}}function Pl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Eh(e)}catch(n){dd(t,t.return,n)}}function Dl(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Sl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Sl),t;default:throw Error(r(435,e.tag))}}(e);t.forEach(function(t){var a=gd.bind(null,e,t);n.has(t)||(n.add(t),t.then(a,a))})}function Al(e,t){var n=t.deletions;if(null!==n)for(var a=0;a<n.length;a++){var s=n[a],i=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 27:if(mu(l.type)){Cl=l.stateNode,El=!1;break e}break;case 5:Cl=l.stateNode,El=!1;break e;case 3:case 4:Cl=l.stateNode.containerInfo,El=!0;break e}l=l.return}if(null===Cl)throw Error(r(160));Il(i,o,s),Cl=null,El=!1,null!==(i=s.alternate)&&(i.return=null),s.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)Rl(t,e),t=t.sibling}var Ml=null;function Rl(e,t){var n=e.alternate,a=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Al(t,e),Fl(e),4&a&&(ol(3,e,e.return),rl(3,e),ol(5,e,e.return));break;case 1:Al(t,e),Fl(e),512&a&&(xl||null===n||ul(n,n.return)),64&a&&bl&&(null!==(e=e.updateQueue)&&(null!==(a=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?a:n.concat(a))));break;case 26:var s=Ml;if(Al(t,e),Fl(e),512&a&&(xl||null===n||ul(n,n.return)),4&a){var i=null!==n?n.memoizedState:null;if(a=e.memoizedState,null===n)if(null===a)if(null===e.stateNode){e:{a=e.type,n=e.memoizedProps,s=s.ownerDocument||s;t:switch(a){case"title":(!(i=s.getElementsByTagName("title")[0])||i[_e]||i[Ae]||"http://www.w3.org/2000/svg"===i.namespaceURI||i.hasAttribute("itemprop"))&&(i=s.createElement(a),s.head.insertBefore(i,s.querySelector("head > title"))),eu(i,a,n),i[Ae]=e,Ve(i),a=i;break e;case"link":var o=_u("link","href",s).get(a+(n.href||""));if(o)for(var l=0;l<o.length;l++)if((i=o[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&i.getAttribute("rel")===(null==n.rel?null:n.rel)&&i.getAttribute("title")===(null==n.title?null:n.title)&&i.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){o.splice(l,1);break t}eu(i=s.createElement(a),a,n),s.head.appendChild(i);break;case"meta":if(o=_u("meta","content",s).get(a+(n.content||"")))for(l=0;l<o.length;l++)if((i=o[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&i.getAttribute("name")===(null==n.name?null:n.name)&&i.getAttribute("property")===(null==n.property?null:n.property)&&i.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&i.getAttribute("charset")===(null==n.charSet?null:n.charSet)){o.splice(l,1);break t}eu(i=s.createElement(a),a,n),s.head.appendChild(i);break;default:throw Error(r(468,a))}i[Ae]=e,Ve(i),a=i}e.stateNode=a}else Uu(s,e.type,e.stateNode);else e.stateNode=Ru(s,a,e.memoizedProps);else i!==a?(null===i?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):i.count--,null===a?Uu(s,e.type,e.stateNode):Ru(s,a,e.memoizedProps)):null===a&&null!==e.stateNode&&ml(e,e.memoizedProps,n.memoizedProps)}break;case 27:Al(t,e),Fl(e),512&a&&(xl||null===n||ul(n,n.return)),null!==n&&4&a&&ml(e,e.memoizedProps,n.memoizedProps);break;case 5:if(Al(t,e),Fl(e),512&a&&(xl||null===n||ul(n,n.return)),32&e.flags){s=e.stateNode;try{St(s,"")}catch(p){dd(e,e.return,p)}}4&a&&null!=e.stateNode&&ml(e,s=e.memoizedProps,null!==n?n.memoizedProps:s),1024&a&&(wl=!0);break;case 6:if(Al(t,e),Fl(e),4&a){if(null===e.stateNode)throw Error(r(162));a=e.memoizedProps,n=e.stateNode;try{n.nodeValue=a}catch(p){dd(e,e.return,p)}}break;case 3:if(Ou=null,s=Ml,Ml=ju(t.containerInfo),Al(t,e),Ml=s,Fl(e),4&a&&null!==n&&n.memoizedState.isDehydrated)try{Eh(t.containerInfo)}catch(p){dd(e,e.return,p)}wl&&(wl=!1,Ll(e));break;case 4:a=Ml,Ml=ju(e.stateNode.containerInfo),Al(t,e),Fl(e),Ml=a;break;case 12:default:Al(t,e),Fl(e);break;case 13:Al(t,e),Fl(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==n&&null!==n.memoizedState)&&(wc=te()),4&a&&(null!==(a=e.updateQueue)&&(e.updateQueue=null,Dl(e,a)));break;case 22:s=null!==e.memoizedState;var c=null!==n&&null!==n.memoizedState,d=bl,u=xl;if(bl=d||s,xl=u||c,Al(t,e),xl=u,bl=d,Fl(e),8192&a)e:for(t=e.stateNode,t._visibility=s?-2&t._visibility:1|t._visibility,s&&(null===n||c||bl||xl||Ol(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t;try{if(i=c.stateNode,s)"function"===typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none";else{l=c.stateNode;var h=c.memoizedProps.style,m=void 0!==h&&null!==h&&h.hasOwnProperty("display")?h.display:null;l.style.display=null==m||"boolean"===typeof m?"":(""+m).trim()}}catch(p){dd(c,c.return,p)}}}else if(6===t.tag){if(null===n){c=t;try{c.stateNode.nodeValue=s?"":c.memoizedProps}catch(p){dd(c,c.return,p)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&a&&(null!==(a=e.updateQueue)&&(null!==(n=a.retryQueue)&&(a.retryQueue=null,Dl(e,n))));break;case 19:Al(t,e),Fl(e),4&a&&(null!==(a=e.updateQueue)&&(e.updateQueue=null,Dl(e,a)));case 30:case 21:}}function Fl(e){var t=e.flags;if(2&t){try{for(var n,a=e.return;null!==a;){if(pl(a)){n=a;break}a=a.return}if(null==n)throw Error(r(160));switch(n.tag){case 27:var s=n.stateNode;vl(e,gl(e),s);break;case 5:var i=n.stateNode;32&n.flags&&(St(i,""),n.flags&=-33),vl(e,gl(e),i);break;case 3:case 4:var o=n.stateNode.containerInfo;fl(e,gl(e),o);break;default:throw Error(r(161))}}catch(l){dd(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Ll(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Ll(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function zl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)jl(e,t.alternate,t),t=t.sibling}function Ol(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:ol(4,t,t.return),Ol(t);break;case 1:ul(t,t.return);var n=t.stateNode;"function"===typeof n.componentWillUnmount&&cl(t,t.return,n),Ol(t);break;case 27:wu(t.stateNode);case 26:case 5:ul(t,t.return),Ol(t);break;case 22:null===t.memoizedState&&Ol(t);break;default:Ol(t)}e=e.sibling}}function _l(e,t,n){for(n=n&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var a=t.alternate,s=e,i=t,r=i.flags;switch(i.tag){case 0:case 11:case 15:_l(s,i,n),rl(4,i);break;case 1:if(_l(s,i,n),"function"===typeof(s=(a=i).stateNode).componentDidMount)try{s.componentDidMount()}catch(c){dd(a,a.return,c)}if(null!==(s=(a=i).updateQueue)){var o=a.stateNode;try{var l=s.shared.hiddenCallbacks;if(null!==l)for(s.shared.hiddenCallbacks=null,s=0;s<l.length;s++)ui(l[s],o)}catch(c){dd(a,a.return,c)}}n&&64&r&&ll(i),dl(i,i.return);break;case 27:yl(i);case 26:case 5:_l(s,i,n),n&&null===a&&4&r&&hl(i),dl(i,i.return);break;case 12:_l(s,i,n);break;case 13:_l(s,i,n),n&&4&r&&Pl(s,i);break;case 22:null===i.memoizedState&&_l(s,i,n),dl(i,i.return);break;case 30:break;default:_l(s,i,n)}t=t.sibling}}function Ul(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&Rs(n))}function ql(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Rs(e))}function Bl(e,t,n,a){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Hl(e,t,n,a),t=t.sibling}function Hl(e,t,n,a){var s=t.flags;switch(t.tag){case 0:case 11:case 15:Bl(e,t,n,a),2048&s&&rl(9,t);break;case 1:case 13:default:Bl(e,t,n,a);break;case 3:Bl(e,t,n,a),2048&s&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Rs(e)));break;case 12:if(2048&s){Bl(e,t,n,a),e=t.stateNode;try{var i=t.memoizedProps,r=i.id,o=i.onPostCommit;"function"===typeof o&&o(r,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){dd(t,t.return,l)}}else Bl(e,t,n,a);break;case 23:break;case 22:i=t.stateNode,r=t.alternate,null!==t.memoizedState?2&i._visibility?Bl(e,t,n,a):Vl(e,t):2&i._visibility?Bl(e,t,n,a):(i._visibility|=2,Wl(e,t,n,a,0!==(10256&t.subtreeFlags))),2048&s&&Ul(r,t);break;case 24:Bl(e,t,n,a),2048&s&&ql(t.alternate,t)}}function Wl(e,t,n,a,s){for(s=s&&0!==(10256&t.subtreeFlags),t=t.child;null!==t;){var i=e,r=t,o=n,l=a,c=r.flags;switch(r.tag){case 0:case 11:case 15:Wl(i,r,o,l,s),rl(8,r);break;case 23:break;case 22:var d=r.stateNode;null!==r.memoizedState?2&d._visibility?Wl(i,r,o,l,s):Vl(i,r):(d._visibility|=2,Wl(i,r,o,l,s)),s&&2048&c&&Ul(r.alternate,r);break;case 24:Wl(i,r,o,l,s),s&&2048&c&&ql(r.alternate,r);break;default:Wl(i,r,o,l,s)}t=t.sibling}}function Vl(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,a=t,s=a.flags;switch(a.tag){case 22:Vl(n,a),2048&s&&Ul(a.alternate,a);break;case 24:Vl(n,a),2048&s&&ql(a.alternate,a);break;default:Vl(n,a)}t=t.sibling}}var Kl=8192;function Gl(e){if(e.subtreeFlags&Kl)for(e=e.child;null!==e;)Jl(e),e=e.sibling}function Jl(e){switch(e.tag){case 26:Gl(e),e.flags&Kl&&null!==e.memoizedState&&function(e,t,n){if(null===Bu)throw Error(r(475));var a=Bu;if("stylesheet"===t.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&t.state.loading)){if(null===t.instance){var s=Iu(n.href),i=e.querySelector(Pu(s));if(i)return null!==(e=i._p)&&"object"===typeof e&&"function"===typeof e.then&&(a.count++,a=Wu.bind(a),e.then(a,a)),t.state.loading|=4,t.instance=i,void Ve(i);i=e.ownerDocument||e,n=Du(n),(s=Su.get(s))&&Lu(n,s),Ve(i=i.createElement("link"));var o=i;o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),eu(i,"link",n),t.instance=i}null===a.stylesheets&&(a.stylesheets=new Map),a.stylesheets.set(t,e),(e=t.state.preload)&&0===(3&t.state.loading)&&(a.count++,t=Wu.bind(a),e.addEventListener("load",t),e.addEventListener("error",t))}}(Ml,e.memoizedState,e.memoizedProps);break;case 5:default:Gl(e);break;case 3:case 4:var t=Ml;Ml=ju(e.stateNode.containerInfo),Gl(e),Ml=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=Kl,Kl=16777216,Gl(e),Kl=t):Gl(e))}}function Yl(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function Ql(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var a=t[n];kl=a,Zl(a,e)}Yl(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)$l(e),e=e.sibling}function $l(e){switch(e.tag){case 0:case 11:case 15:Ql(e),2048&e.flags&&ol(9,e,e.return);break;case 3:case 12:default:Ql(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,Xl(e)):Ql(e)}}function Xl(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var a=t[n];kl=a,Zl(a,e)}Yl(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:ol(8,t,t.return),Xl(t);break;case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,Xl(t));break;default:Xl(t)}e=e.sibling}}function Zl(e,t){for(;null!==kl;){var n=kl;switch(n.tag){case 0:case 11:case 15:ol(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var a=n.memoizedState.cachePool.pool;null!=a&&a.refCount++}break;case 24:Rs(n.memoizedState.cache)}if(null!==(a=n.child))a.return=n,kl=a;else e:for(n=e;null!==kl;){var s=(a=kl).sibling,i=a.return;if(Nl(a),a===n){kl=null;break e}if(null!==s){s.return=i,kl=s;break e}kl=i}}}var ec={getCacheForType:function(e){var t=Cs(As),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},tc="function"===typeof WeakMap?WeakMap:Map,nc=0,ac=null,sc=null,ic=0,rc=0,oc=null,lc=!1,cc=!1,dc=!1,uc=0,hc=0,mc=0,pc=0,gc=0,fc=0,vc=0,yc=null,bc=null,xc=!1,wc=0,Sc=1/0,kc=null,jc=null,Nc=0,Cc=null,Ec=null,Tc=0,Ic=0,Pc=null,Dc=null,Ac=0,Mc=null;function Rc(){if(0!==(2&nc)&&0!==ic)return ic&-ic;if(null!==R.T){return 0!==zs?zs:Id()}return Pe()}function Fc(){0===fc&&(fc=0===(536870912&ic)||is?Se():536870912);var e=ao.current;return null!==e&&(e.flags|=32),fc}function Lc(e,t,n){(e!==ac||2!==rc&&9!==rc)&&null===e.cancelPendingCommit||(Hc(e,0),Uc(e,ic,fc,!1)),Ne(e,n),0!==(2&nc)&&e===ac||(e===ac&&(0===(2&nc)&&(pc|=n),4===hc&&Uc(e,ic,fc,!1)),Sd(e))}function zc(e,t,n){if(0!==(6&nc))throw Error(r(327));for(var a=!n&&0===(124&t)&&0===(t&e.expiredLanes)||xe(e,t),s=a?function(e,t){var n=nc;nc|=2;var a=Vc(),s=Kc();ac!==e||ic!==t?(kc=null,Sc=te()+500,Hc(e,t)):cc=xe(e,t);e:for(;;)try{if(0!==rc&&null!==sc){t=sc;var i=oc;t:switch(rc){case 1:rc=0,oc=null,Zc(e,t,i,1);break;case 2:case 9:if(Ys(i)){rc=0,oc=null,Xc(t);break}t=function(){2!==rc&&9!==rc||ac!==e||(rc=7),Sd(e)},i.then(t,t);break e;case 3:rc=7;break e;case 4:rc=5;break e;case 7:Ys(i)?(rc=0,oc=null,Xc(t)):(rc=0,oc=null,Zc(e,t,i,7));break;case 5:var o=null;switch(sc.tag){case 26:o=sc.memoizedState;case 5:case 27:var l=sc;if(!o||qu(o)){rc=0,oc=null;var c=l.sibling;if(null!==c)sc=c;else{var d=l.return;null!==d?(sc=d,ed(d)):sc=null}break t}}rc=0,oc=null,Zc(e,t,i,5);break;case 6:rc=0,oc=null,Zc(e,t,i,6);break;case 8:Bc(),hc=6;break e;default:throw Error(r(462))}}Qc();break}catch(u){Wc(e,u)}return ys=vs=null,R.H=a,R.A=s,nc=n,null!==sc?0:(ac=null,ic=0,Ta(),hc)}(e,t):Jc(e,t,!0),i=a;;){if(0===s){cc&&!a&&Uc(e,t,0,!1);break}if(n=e.current.alternate,!i||_c(n)){if(2===s){if(i=t,e.errorRecoveryDisabledLanes&i)var o=0;else o=0!==(o=-536870913&e.pendingLanes)?o:536870912&o?536870912:0;if(0!==o){t=o;e:{var l=e;s=yc;var c=l.current.memoizedState.isDehydrated;if(c&&(Hc(l,o).flags|=256),2!==(o=Jc(l,o,!1))){if(dc&&!c){l.errorRecoveryDisabledLanes|=i,pc|=i,s=4;break e}i=bc,bc=s,null!==i&&(null===bc?bc=i:bc.push.apply(bc,i))}s=o}if(i=!1,2!==s)continue}}if(1===s){Hc(e,0),Uc(e,t,0,!0);break}e:{switch(a=e,i=s){case 0:case 1:throw Error(r(345));case 4:if((4194048&t)!==t)break;case 6:Uc(a,t,fc,!lc);break e;case 2:bc=null;break;case 3:case 5:break;default:throw Error(r(329))}if((62914560&t)===t&&10<(s=wc+300-te())){if(Uc(a,t,fc,!lc),0!==be(a,0,!0))break e;a.timeoutHandle=lu(Oc.bind(null,a,n,bc,kc,xc,t,fc,pc,vc,lc,i,2,-0,0),s)}else Oc(a,n,bc,kc,xc,t,fc,pc,vc,lc,i,0,-0,0)}break}s=Jc(e,t,!1),i=!1}Sd(e)}function Oc(e,t,n,a,s,i,o,l,c,d,u,h,m,p){if(e.timeoutHandle=-1,(8192&(h=t.subtreeFlags)||16785408===(16785408&h))&&(Bu={stylesheets:null,count:0,unsuspend:Hu},Jl(t),null!==(h=function(){if(null===Bu)throw Error(r(475));var e=Bu;return e.stylesheets&&0===e.count&&Ku(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&Ku(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}())))return e.cancelPendingCommit=h(nd.bind(null,e,t,i,n,a,s,o,l,c,u,1,m,p)),void Uc(e,i,o,!d);nd(e,t,i,n,a,s,o,l,c)}function _c(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&(null!==(n=t.updateQueue)&&null!==(n=n.stores)))for(var a=0;a<n.length;a++){var s=n[a],i=s.getSnapshot;s=s.value;try{if(!Yn(i(),s))return!1}catch(r){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Uc(e,t,n,a){t&=~gc,t&=~pc,e.suspendedLanes|=t,e.pingedLanes&=~t,a&&(e.warmLanes|=t),a=e.expirationTimes;for(var s=t;0<s;){var i=31-me(s),r=1<<i;a[i]=-1,s&=~r}0!==n&&Ce(e,n,t)}function qc(){return 0!==(6&nc)||(kd(0,!1),!1)}function Bc(){if(null!==sc){if(0===rc)var e=sc.return;else ys=vs=null,zi(e=sc),Jr=null,Yr=0,e=sc;for(;null!==e;)il(e.alternate,e),e=e.return;sc=null}}function Hc(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,cu(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),Bc(),ac=e,sc=n=Oa(e.current,null),ic=t,rc=0,oc=null,lc=!1,cc=xe(e,t),dc=!1,vc=fc=gc=pc=mc=hc=0,bc=yc=null,xc=!1,0!==(8&t)&&(t|=32&t);var a=e.entangledLanes;if(0!==a)for(e=e.entanglements,a&=t;0<a;){var s=31-me(a),i=1<<s;t|=e[s],a&=~i}return uc=t,Ta(),n}function Wc(e,t){bi=null,R.H=Wr,t===Vs||t===Gs?(t=Zs(),rc=3):t===Ks?(t=Zs(),rc=4):rc=t===Co?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,oc=t,null===sc&&(hc=1,wo(e,ja(t,e.current)))}function Vc(){var e=R.H;return R.H=Wr,null===e?Wr:e}function Kc(){var e=R.A;return R.A=ec,e}function Gc(){hc=4,lc||(4194048&ic)!==ic&&null!==ao.current||(cc=!0),0===(134217727&mc)&&0===(134217727&pc)||null===ac||Uc(ac,ic,fc,!1)}function Jc(e,t,n){var a=nc;nc|=2;var s=Vc(),i=Kc();ac===e&&ic===t||(kc=null,Hc(e,t)),t=!1;var r=hc;e:for(;;)try{if(0!==rc&&null!==sc){var o=sc,l=oc;switch(rc){case 8:Bc(),r=6;break e;case 3:case 2:case 9:case 6:null===ao.current&&(t=!0);var c=rc;if(rc=0,oc=null,Zc(e,o,l,c),n&&cc){r=0;break e}break;default:c=rc,rc=0,oc=null,Zc(e,o,l,c)}}Yc(),r=hc;break}catch(d){Wc(e,d)}return t&&e.shellSuspendCounter++,ys=vs=null,nc=a,R.H=s,R.A=i,null===sc&&(ac=null,ic=0,Ta()),r}function Yc(){for(;null!==sc;)$c(sc)}function Qc(){for(;null!==sc&&!Z();)$c(sc)}function $c(e){var t=$o(e.alternate,e,uc);e.memoizedProps=e.pendingProps,null===t?ed(e):sc=t}function Xc(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=Lo(n,t,t.pendingProps,t.type,void 0,ic);break;case 11:t=Lo(n,t,t.pendingProps,t.type.render,t.ref,ic);break;case 5:zi(t);default:il(n,t),t=$o(n,t=sc=_a(t,uc),uc)}e.memoizedProps=e.pendingProps,null===t?ed(e):sc=t}function Zc(e,t,n,a){ys=vs=null,zi(t),Jr=null,Yr=0;var s=t.return;try{if(function(e,t,n,a,s){if(n.flags|=32768,null!==a&&"object"===typeof a&&"function"===typeof a.then){if(null!==(t=n.alternate)&&ks(t,n,s,!0),null!==(n=ao.current)){switch(n.tag){case 13:return null===so?Gc():null===n.alternate&&0===hc&&(hc=3),n.flags&=-257,n.flags|=65536,n.lanes=s,a===Js?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([a]):t.add(a),ud(e,a,s)),!1;case 22:return n.flags|=65536,a===Js?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([a])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([a]):n.add(a),ud(e,a,s)),!1}throw Error(r(435,n.tag))}return ud(e,a,s),Gc(),!1}if(is)return null!==(t=ao.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=s,a!==ls&&gs(ja(e=Error(r(422),{cause:a}),n))):(a!==ls&&gs(ja(t=Error(r(423),{cause:a}),n)),(e=e.current.alternate).flags|=65536,s&=-s,e.lanes|=s,a=ja(a,n),oi(e,s=ko(e.stateNode,a,s)),4!==hc&&(hc=2)),!1;var i=Error(r(520),{cause:a});if(i=ja(i,n),null===yc?yc=[i]:yc.push(i),4!==hc&&(hc=2),null===t)return!0;a=ja(a,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=s&-s,n.lanes|=e,oi(n,e=ko(n.stateNode,a,e)),!1;case 1:if(t=n.type,i=n.stateNode,0===(128&n.flags)&&("function"===typeof t.getDerivedStateFromError||null!==i&&"function"===typeof i.componentDidCatch&&(null===jc||!jc.has(i))))return n.flags|=65536,s&=-s,n.lanes|=s,No(s=jo(s),e,n,a),oi(n,s),!1}n=n.return}while(null!==n);return!1}(e,s,t,n,ic))return hc=1,wo(e,ja(n,e.current)),void(sc=null)}catch(i){if(null!==s)throw sc=s,i;return hc=1,wo(e,ja(n,e.current)),void(sc=null)}32768&t.flags?(is||1===a?e=!0:cc||0!==(536870912&ic)?e=!1:(lc=e=!0,(2===a||9===a||3===a||6===a)&&(null!==(a=ao.current)&&13===a.tag&&(a.flags|=16384))),td(t,e)):ed(t)}function ed(e){var t=e;do{if(0!==(32768&t.flags))return void td(t,lc);e=t.return;var n=al(t.alternate,t,uc);if(null!==n)return void(sc=n);if(null!==(t=t.sibling))return void(sc=t);sc=t=e}while(null!==t);0===hc&&(hc=5)}function td(e,t){do{var n=sl(e.alternate,e);if(null!==n)return n.flags&=32767,void(sc=n);if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(sc=e);sc=e=n}while(null!==e);hc=6,sc=null}function nd(e,t,n,a,s,i,o,l,c){e.cancelPendingCommit=null;do{od()}while(0!==Nc);if(0!==(6&nc))throw Error(r(327));if(null!==t){if(t===e.current)throw Error(r(177));if(i=t.lanes|t.childLanes,function(e,t,n,a,s,i){var r=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var o=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=r&~n;0<n;){var d=31-me(n),u=1<<d;o[d]=0,l[d]=-1;var h=c[d];if(null!==h)for(c[d]=null,d=0;d<h.length;d++){var m=h[d];null!==m&&(m.lane&=-536870913)}n&=~u}0!==a&&Ce(e,a,0),0!==i&&0===s&&0!==e.tag&&(e.suspendedLanes|=i&~(r&~t))}(e,n,i|=Ea,o,l,c),e===ac&&(sc=ac=null,ic=0),Ec=t,Cc=e,Tc=n,Ic=i,Pc=s,Dc=a,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,$(ie,function(){return ld(),null})):(e.callbackNode=null,e.callbackPriority=0),a=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||a){a=R.T,R.T=null,s=F.p,F.p=2,o=nc,nc|=4;try{!function(e,t){if(e=e.containerInfo,tu=nh,ta(e=ea(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var a=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(a&&0!==a.rangeCount){n=a.anchorNode;var s=a.anchorOffset,i=a.focusNode;a=a.focusOffset;try{n.nodeType,i.nodeType}catch(f){n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=e,m=null;t:for(;;){for(var p;h!==n||0!==s&&3!==h.nodeType||(l=o+s),h!==i||0!==a&&3!==h.nodeType||(c=o+a),3===h.nodeType&&(o+=h.nodeValue.length),null!==(p=h.firstChild);)m=h,h=p;for(;;){if(h===e)break t;if(m===n&&++d===s&&(l=o),m===i&&++u===a&&(c=o),null!==(p=h.nextSibling))break;m=(h=m).parentNode}h=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(nu={focusedElem:e,selectionRange:n},nh=!1,kl=t;null!==kl;)if(e=(t=kl).child,0!==(1024&t.subtreeFlags)&&null!==e)e.return=t,kl=e;else for(;null!==kl;){switch(i=(t=kl).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==i){e=void 0,n=t,s=i.memoizedProps,i=i.memoizedState,a=n.stateNode;try{var g=fo(n.type,s,(n.elementType,n.type));e=a.getSnapshotBeforeUpdate(g,i),a.__reactInternalSnapshotBeforeUpdate=e}catch(v){dd(n,n.return,v)}}break;case 3:if(0!==(1024&e))if(9===(n=(e=t.stateNode.containerInfo).nodeType))gu(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":gu(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(r(163))}if(null!==(e=t.sibling)){e.return=t.return,kl=e;break}kl=t.return}}(e,t)}finally{nc=o,F.p=s,R.T=a}}Nc=1,ad(),sd(),id()}}function ad(){if(1===Nc){Nc=0;var e=Cc,t=Ec,n=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||n){n=R.T,R.T=null;var a=F.p;F.p=2;var s=nc;nc|=4;try{Rl(t,e);var i=nu,r=ea(e.containerInfo),o=i.focusedElem,l=i.selectionRange;if(r!==o&&o&&o.ownerDocument&&Zn(o.ownerDocument.documentElement,o)){if(null!==l&&ta(o)){var c=l.start,d=l.end;if(void 0===d&&(d=c),"selectionStart"in o)o.selectionStart=c,o.selectionEnd=Math.min(d,o.value.length);else{var u=o.ownerDocument||document,h=u&&u.defaultView||window;if(h.getSelection){var m=h.getSelection(),p=o.textContent.length,g=Math.min(l.start,p),f=void 0===l.end?g:Math.min(l.end,p);!m.extend&&g>f&&(r=f,f=g,g=r);var v=Xn(o,g),y=Xn(o,f);if(v&&y&&(1!==m.rangeCount||m.anchorNode!==v.node||m.anchorOffset!==v.offset||m.focusNode!==y.node||m.focusOffset!==y.offset)){var b=u.createRange();b.setStart(v.node,v.offset),m.removeAllRanges(),g>f?(m.addRange(b),m.extend(y.node,y.offset)):(b.setEnd(y.node,y.offset),m.addRange(b))}}}}for(u=[],m=o;m=m.parentNode;)1===m.nodeType&&u.push({element:m,left:m.scrollLeft,top:m.scrollTop});for("function"===typeof o.focus&&o.focus(),o=0;o<u.length;o++){var x=u[o];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}nh=!!tu,nu=tu=null}finally{nc=s,F.p=a,R.T=n}}e.current=t,Nc=2}}function sd(){if(2===Nc){Nc=0;var e=Cc,t=Ec,n=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||n){n=R.T,R.T=null;var a=F.p;F.p=2;var s=nc;nc|=4;try{jl(e,t.alternate,t)}finally{nc=s,F.p=a,R.T=n}}Nc=3}}function id(){if(4===Nc||3===Nc){Nc=0,ee();var e=Cc,t=Ec,n=Tc,a=Dc;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?Nc=5:(Nc=0,Ec=Cc=null,rd(e,e.pendingLanes));var s=e.pendingLanes;if(0===s&&(jc=null),Ie(n),t=t.stateNode,ue&&"function"===typeof ue.onCommitFiberRoot)try{ue.onCommitFiberRoot(de,t,void 0,128===(128&t.current.flags))}catch(l){}if(null!==a){t=R.T,s=F.p,F.p=2,R.T=null;try{for(var i=e.onRecoverableError,r=0;r<a.length;r++){var o=a[r];i(o.value,{componentStack:o.stack})}}finally{R.T=t,F.p=s}}0!==(3&Tc)&&od(),Sd(e),s=e.pendingLanes,0!==(4194090&n)&&0!==(42&s)?e===Mc?Ac++:(Ac=0,Mc=e):Ac=0,kd(0,!1)}}function rd(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Rs(t)))}function od(e){return ad(),sd(),id(),ld()}function ld(){if(5!==Nc)return!1;var e=Cc,t=Ic;Ic=0;var n=Ie(Tc),a=R.T,s=F.p;try{F.p=32>n?32:n,R.T=null,n=Pc,Pc=null;var i=Cc,o=Tc;if(Nc=0,Ec=Cc=null,Tc=0,0!==(6&nc))throw Error(r(331));var l=nc;if(nc|=4,$l(i.current),Hl(i,i.current,o,n),nc=l,kd(0,!1),ue&&"function"===typeof ue.onPostCommitFiberRoot)try{ue.onPostCommitFiberRoot(de,i)}catch(c){}return!0}finally{F.p=s,R.T=a,rd(e,t)}}function cd(e,t,n){t=ja(n,t),null!==(e=ii(e,t=ko(e.stateNode,t,2),2))&&(Ne(e,2),Sd(e))}function dd(e,t,n){if(3===e.tag)cd(e,e,n);else for(;null!==t;){if(3===t.tag){cd(t,e,n);break}if(1===t.tag){var a=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof a.componentDidCatch&&(null===jc||!jc.has(a))){e=ja(n,e),null!==(a=ii(t,n=jo(2),2))&&(No(n,a,t,e),Ne(a,2),Sd(a));break}}t=t.return}}function ud(e,t,n){var a=e.pingCache;if(null===a){a=e.pingCache=new tc;var s=new Set;a.set(t,s)}else void 0===(s=a.get(t))&&(s=new Set,a.set(t,s));s.has(n)||(dc=!0,s.add(n),e=hd.bind(null,e,t,n),t.then(e,e))}function hd(e,t,n){var a=e.pingCache;null!==a&&a.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,ac===e&&(ic&n)===n&&(4===hc||3===hc&&(62914560&ic)===ic&&300>te()-wc?0===(2&nc)&&Hc(e,0):gc|=n,vc===ic&&(vc=0)),Sd(e)}function md(e,t){0===t&&(t=ke()),null!==(e=Da(e,t))&&(Ne(e,t),Sd(e))}function pd(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),md(e,n)}function gd(e,t){var n=0;switch(e.tag){case 13:var a=e.stateNode,s=e.memoizedState;null!==s&&(n=s.retryLane);break;case 19:a=e.stateNode;break;case 22:a=e.stateNode._retryCache;break;default:throw Error(r(314))}null!==a&&a.delete(t),md(e,n)}var fd=null,vd=null,yd=!1,bd=!1,xd=!1,wd=0;function Sd(e){e!==vd&&null===e.next&&(null===vd?fd=vd=e:vd=vd.next=e),bd=!0,yd||(yd=!0,uu(function(){0!==(6&nc)?$(ae,jd):Nd()}))}function kd(e,t){if(!xd&&bd){xd=!0;do{for(var n=!1,a=fd;null!==a;){if(!t)if(0!==e){var s=a.pendingLanes;if(0===s)var i=0;else{var r=a.suspendedLanes,o=a.pingedLanes;i=(1<<31-me(42|e)+1)-1,i=201326741&(i&=s&~(r&~o))?201326741&i|1:i?2|i:0}0!==i&&(n=!0,Td(a,i))}else i=ic,0===(3&(i=be(a,a===ac?i:0,null!==a.cancelPendingCommit||-1!==a.timeoutHandle)))||xe(a,i)||(n=!0,Td(a,i));a=a.next}}while(n);xd=!1}}function jd(){Nd()}function Nd(){bd=yd=!1;var e=0;0!==wd&&(function(){var e=window.event;if(e&&"popstate"===e.type)return e!==ou&&(ou=e,!0);return ou=null,!1}()&&(e=wd),wd=0);for(var t=te(),n=null,a=fd;null!==a;){var s=a.next,i=Cd(a,t);0===i?(a.next=null,null===n?fd=s:n.next=s,null===s&&(vd=n)):(n=a,(0!==e||0!==(3&i))&&(bd=!0)),a=s}kd(e,!1)}function Cd(e,t){for(var n=e.suspendedLanes,a=e.pingedLanes,s=e.expirationTimes,i=-62914561&e.pendingLanes;0<i;){var r=31-me(i),o=1<<r,l=s[r];-1===l?0!==(o&n)&&0===(o&a)||(s[r]=we(o,t)):l<=t&&(e.expiredLanes|=o),i&=~o}if(n=ic,n=be(e,e===(t=ac)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),a=e.callbackNode,0===n||e===t&&(2===rc||9===rc)||null!==e.cancelPendingCommit)return null!==a&&null!==a&&X(a),e.callbackNode=null,e.callbackPriority=0;if(0===(3&n)||xe(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==a&&X(a),Ie(n)){case 2:case 8:n=se;break;case 32:default:n=ie;break;case 268435456:n=oe}return a=Ed.bind(null,e),n=$(n,a),e.callbackPriority=t,e.callbackNode=n,t}return null!==a&&null!==a&&X(a),e.callbackPriority=2,e.callbackNode=null,2}function Ed(e,t){if(0!==Nc&&5!==Nc)return e.callbackNode=null,e.callbackPriority=0,null;var n=e.callbackNode;if(od()&&e.callbackNode!==n)return null;var a=ic;return 0===(a=be(e,e===ac?a:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(zc(e,a,t),Cd(e,te()),null!=e.callbackNode&&e.callbackNode===n?Ed.bind(null,e):null)}function Td(e,t){if(od())return null;zc(e,t,!0)}function Id(){return 0===wd&&(wd=Se()),wd}function Pd(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:It(""+e)}function Dd(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Ad=0;Ad<wa.length;Ad++){var Md=wa[Ad];Sa(Md.toLowerCase(),"on"+(Md[0].toUpperCase()+Md.slice(1)))}Sa(ma,"onAnimationEnd"),Sa(pa,"onAnimationIteration"),Sa(ga,"onAnimationStart"),Sa("dblclick","onDoubleClick"),Sa("focusin","onFocus"),Sa("focusout","onBlur"),Sa(fa,"onTransitionRun"),Sa(va,"onTransitionStart"),Sa(ya,"onTransitionCancel"),Sa(ba,"onTransitionEnd"),Ye("onMouseEnter",["mouseout","mouseover"]),Ye("onMouseLeave",["mouseout","mouseover"]),Ye("onPointerEnter",["pointerout","pointerover"]),Ye("onPointerLeave",["pointerout","pointerover"]),Je("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Je("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Je("onBeforeInput",["compositionend","keypress","textInput","paste"]),Je("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Je("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Je("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fd=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Rd));function Ld(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var a=e[n],s=a.event;a=a.listeners;e:{var i=void 0;if(t)for(var r=a.length-1;0<=r;r--){var o=a[r],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==i&&s.isPropagationStopped())break e;i=o,s.currentTarget=c;try{i(s)}catch(d){vo(d)}s.currentTarget=null,i=l}else for(r=0;r<a.length;r++){if(l=(o=a[r]).instance,c=o.currentTarget,o=o.listener,l!==i&&s.isPropagationStopped())break e;i=o,s.currentTarget=c;try{i(s)}catch(d){vo(d)}s.currentTarget=null,i=l}}}}function zd(e,t){var n=t[Fe];void 0===n&&(n=t[Fe]=new Set);var a=e+"__bubble";n.has(a)||(qd(t,e,2,!1),n.add(a))}function Od(e,t,n){var a=0;t&&(a|=4),qd(n,e,a,t)}var _d="_reactListening"+Math.random().toString(36).slice(2);function Ud(e){if(!e[_d]){e[_d]=!0,Ke.forEach(function(t){"selectionchange"!==t&&(Fd.has(t)||Od(t,!1,e),Od(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[_d]||(t[_d]=!0,Od("selectionchange",!1,t))}}function qd(e,t,n,a){switch(ch(t)){case 2:var s=ah;break;case 8:s=sh;break;default:s=ih}n=s.bind(null,t,n,e),s=void 0,!_t||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),a?void 0!==s?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):void 0!==s?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function Bd(e,t,n,a,s){var i=a;if(0===(1&t)&&0===(2&t)&&null!==a)e:for(;;){if(null===a)return;var r=a.tag;if(3===r||4===r){var o=a.stateNode.containerInfo;if(o===s)break;if(4===r)for(r=a.return;null!==r;){var c=r.tag;if((3===c||4===c)&&r.stateNode.containerInfo===s)return;r=r.return}for(;null!==o;){if(null===(r=qe(o)))return;if(5===(c=r.tag)||6===c||26===c||27===c){a=i=r;continue e}o=o.parentNode}}a=a.return}Lt(function(){var a=i,s=Dt(n),r=[];e:{var o=xa.get(e);if(void 0!==o){var c=Zt,d=e;switch(e){case"keypress":if(0===Vt(n))break e;case"keydown":case"keyup":c=gn;break;case"focusin":d="focus",c=rn;break;case"focusout":d="blur",c=rn;break;case"beforeblur":case"afterblur":c=rn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=an;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=sn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=vn;break;case ma:case pa:case ga:c=on;break;case ba:c=yn;break;case"scroll":case"scrollend":c=tn;break;case"wheel":c=bn;break;case"copy":case"cut":case"paste":c=ln;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=fn;break;case"toggle":case"beforetoggle":c=xn}var u=0!==(4&t),h=!u&&("scroll"===e||"scrollend"===e),m=u?null!==o?o+"Capture":null:o;u=[];for(var p,g=a;null!==g;){var f=g;if(p=f.stateNode,5!==(f=f.tag)&&26!==f&&27!==f||null===p||null===m||null!=(f=zt(g,m))&&u.push(Hd(g,f,p)),h)break;g=g.return}0<u.length&&(o=new c(o,d,null,n,s),r.push({event:o,listeners:u}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===Pt||!(d=n.relatedTarget||n.fromElement)||!qe(d)&&!d[Re])&&(c||o)&&(o=s.window===s?s:(o=s.ownerDocument)?o.defaultView||o.parentWindow:window,c?(c=a,null!==(d=(d=n.relatedTarget||n.toElement)?qe(d):null)&&(h=l(d),u=d.tag,d!==h||5!==u&&27!==u&&6!==u)&&(d=null)):(c=null,d=a),c!==d)){if(u=an,f="onMouseLeave",m="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(u=fn,f="onPointerLeave",m="onPointerEnter",g="pointer"),h=null==c?o:He(c),p=null==d?o:He(d),(o=new u(f,g+"leave",c,n,s)).target=h,o.relatedTarget=p,f=null,qe(s)===a&&((u=new u(m,g+"enter",d,n,s)).target=p,u.relatedTarget=h,f=u),h=f,c&&d)e:{for(m=d,g=0,p=u=c;p;p=Vd(p))g++;for(p=0,f=m;f;f=Vd(f))p++;for(;0<g-p;)u=Vd(u),g--;for(;0<p-g;)m=Vd(m),p--;for(;g--;){if(u===m||null!==m&&u===m.alternate)break e;u=Vd(u),m=Vd(m)}u=null}else u=null;null!==c&&Kd(r,o,c,u,!1),null!==d&&null!==h&&Kd(r,h,d,u,!0)}if("select"===(c=(o=a?He(a):window).nodeName&&o.nodeName.toLowerCase())||"input"===c&&"file"===o.type)var v=On;else if(An(o))if(_n)v=Jn;else{v=Kn;var y=Vn}else!(c=o.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==o.type&&"radio"!==o.type?a&&Ct(a.elementType)&&(v=On):v=Gn;switch(v&&(v=v(e,a))?Mn(r,v,n,s):(y&&y(e,o,a),"focusout"===e&&a&&"number"===o.type&&null!=a.memoizedProps.value&&yt(o,"number",o.value)),y=a?He(a):window,e){case"focusin":(An(y)||"true"===y.contentEditable)&&(aa=y,sa=a,ia=null);break;case"focusout":ia=sa=aa=null;break;case"mousedown":ra=!0;break;case"contextmenu":case"mouseup":case"dragend":ra=!1,oa(r,n,s);break;case"selectionchange":if(na)break;case"keydown":case"keyup":oa(r,n,s)}var b;if(Sn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Pn?Tn(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(Nn&&"ko"!==n.locale&&(Pn||"onCompositionStart"!==x?"onCompositionEnd"===x&&Pn&&(b=Wt()):(Bt="value"in(qt=s)?qt.value:qt.textContent,Pn=!0)),0<(y=Wd(a,x)).length&&(x=new cn(x,e,null,n,s),r.push({event:x,listeners:y}),b?x.data=b:null!==(b=In(n))&&(x.data=b))),(b=jn?function(e,t){switch(e){case"compositionend":return In(t);case"keypress":return 32!==t.which?null:(En=!0,Cn);case"textInput":return(e=t.data)===Cn&&En?null:e;default:return null}}(e,n):function(e,t){if(Pn)return"compositionend"===e||!Sn&&Tn(e,t)?(e=Wt(),Ht=Bt=qt=null,Pn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Nn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(x=Wd(a,"onBeforeInput")).length&&(y=new cn("onBeforeInput","beforeinput",null,n,s),r.push({event:y,listeners:x}),y.data=b)),function(e,t,n,a,s){if("submit"===t&&n&&n.stateNode===s){var i=Pd((s[Me]||null).action),r=a.submitter;r&&null!==(t=(t=r[Me]||null)?Pd(t.formAction):r.getAttribute("formAction"))&&(i=t,r=null);var o=new Zt("action","action",null,a,s);e.push({event:o,listeners:[{instance:null,listener:function(){if(a.defaultPrevented){if(0!==wd){var e=r?Dd(s,r):new FormData(s);Pr(n,{pending:!0,data:e,method:s.method,action:i},null,e)}}else"function"===typeof i&&(o.preventDefault(),e=r?Dd(s,r):new FormData(s),Pr(n,{pending:!0,data:e,method:s.method,action:i},i,e))},currentTarget:s}]})}}(r,e,a,n,s)}Ld(r,t)})}function Hd(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wd(e,t){for(var n=t+"Capture",a=[];null!==e;){var s=e,i=s.stateNode;if(5!==(s=s.tag)&&26!==s&&27!==s||null===i||(null!=(s=zt(e,n))&&a.unshift(Hd(e,s,i)),null!=(s=zt(e,t))&&a.push(Hd(e,s,i))),3===e.tag)return a;e=e.return}return[]}function Vd(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function Kd(e,t,n,a,s){for(var i=t._reactName,r=[];null!==n&&n!==a;){var o=n,l=o.alternate,c=o.stateNode;if(o=o.tag,null!==l&&l===a)break;5!==o&&26!==o&&27!==o||null===c||(l=c,s?null!=(c=zt(n,i))&&r.unshift(Hd(n,c,l)):s||null!=(c=zt(n,i))&&r.push(Hd(n,c,l))),n=n.return}0!==r.length&&e.push({event:t,listeners:r})}var Gd=/\r\n?/g,Jd=/\u0000|\uFFFD/g;function Yd(e){return("string"===typeof e?e:""+e).replace(Gd,"\n").replace(Jd,"")}function Qd(e,t){return t=Yd(t),Yd(e)===t}function $d(){}function Xd(e,t,n,a,s,i){switch(n){case"children":"string"===typeof a?"body"===t||"textarea"===t&&""===a||St(e,a):("number"===typeof a||"bigint"===typeof a)&&"body"!==t&&St(e,""+a);break;case"className":nt(e,"class",a);break;case"tabIndex":nt(e,"tabindex",a);break;case"dir":case"role":case"viewBox":case"width":case"height":nt(e,n,a);break;case"style":Nt(e,a,i);break;case"data":if("object"!==t){nt(e,"data",a);break}case"src":case"href":if(""===a&&("a"!==t||"href"!==n)){e.removeAttribute(n);break}if(null==a||"function"===typeof a||"symbol"===typeof a||"boolean"===typeof a){e.removeAttribute(n);break}a=It(""+a),e.setAttribute(n,a);break;case"action":case"formAction":if("function"===typeof a){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof i&&("formAction"===n?("input"!==t&&Xd(e,t,"name",s.name,s,null),Xd(e,t,"formEncType",s.formEncType,s,null),Xd(e,t,"formMethod",s.formMethod,s,null),Xd(e,t,"formTarget",s.formTarget,s,null)):(Xd(e,t,"encType",s.encType,s,null),Xd(e,t,"method",s.method,s,null),Xd(e,t,"target",s.target,s,null))),null==a||"symbol"===typeof a||"boolean"===typeof a){e.removeAttribute(n);break}a=It(""+a),e.setAttribute(n,a);break;case"onClick":null!=a&&(e.onclick=$d);break;case"onScroll":null!=a&&zd("scroll",e);break;case"onScrollEnd":null!=a&&zd("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=a){if("object"!==typeof a||!("__html"in a))throw Error(r(61));if(null!=(n=a.__html)){if(null!=s.children)throw Error(r(60));e.innerHTML=n}}break;case"multiple":e.multiple=a&&"function"!==typeof a&&"symbol"!==typeof a;break;case"muted":e.muted=a&&"function"!==typeof a&&"symbol"!==typeof a;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==a||"function"===typeof a||"boolean"===typeof a||"symbol"===typeof a){e.removeAttribute("xlink:href");break}n=It(""+a),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=a&&"function"!==typeof a&&"symbol"!==typeof a?e.setAttribute(n,""+a):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":a&&"function"!==typeof a&&"symbol"!==typeof a?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===a?e.setAttribute(n,""):!1!==a&&null!=a&&"function"!==typeof a&&"symbol"!==typeof a?e.setAttribute(n,a):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&!isNaN(a)&&1<=a?e.setAttribute(n,a):e.removeAttribute(n);break;case"rowSpan":case"start":null==a||"function"===typeof a||"symbol"===typeof a||isNaN(a)?e.removeAttribute(n):e.setAttribute(n,a);break;case"popover":zd("beforetoggle",e),zd("toggle",e),tt(e,"popover",a);break;case"xlinkActuate":at(e,"http://www.w3.org/1999/xlink","xlink:actuate",a);break;case"xlinkArcrole":at(e,"http://www.w3.org/1999/xlink","xlink:arcrole",a);break;case"xlinkRole":at(e,"http://www.w3.org/1999/xlink","xlink:role",a);break;case"xlinkShow":at(e,"http://www.w3.org/1999/xlink","xlink:show",a);break;case"xlinkTitle":at(e,"http://www.w3.org/1999/xlink","xlink:title",a);break;case"xlinkType":at(e,"http://www.w3.org/1999/xlink","xlink:type",a);break;case"xmlBase":at(e,"http://www.w3.org/XML/1998/namespace","xml:base",a);break;case"xmlLang":at(e,"http://www.w3.org/XML/1998/namespace","xml:lang",a);break;case"xmlSpace":at(e,"http://www.w3.org/XML/1998/namespace","xml:space",a);break;case"is":tt(e,"is",a);break;case"innerText":case"textContent":break;default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&tt(e,n=Et.get(n)||n,a)}}function Zd(e,t,n,a,s,i){switch(n){case"style":Nt(e,a,i);break;case"dangerouslySetInnerHTML":if(null!=a){if("object"!==typeof a||!("__html"in a))throw Error(r(61));if(null!=(n=a.__html)){if(null!=s.children)throw Error(r(60));e.innerHTML=n}}break;case"children":"string"===typeof a?St(e,a):("number"===typeof a||"bigint"===typeof a)&&St(e,""+a);break;case"onScroll":null!=a&&zd("scroll",e);break;case"onScrollEnd":null!=a&&zd("scrollend",e);break;case"onClick":null!=a&&(e.onclick=$d);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:Ge.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(s=n.endsWith("Capture"),t=n.slice(2,s?n.length-7:void 0),"function"===typeof(i=null!=(i=e[Me]||null)?i[n]:null)&&e.removeEventListener(t,i,s),"function"!==typeof a)?n in e?e[n]=a:!0===a?e.setAttribute(n,""):tt(e,n,a):("function"!==typeof i&&null!==i&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,a,s)))}}function eu(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":zd("error",e),zd("load",e);var a,s=!1,i=!1;for(a in n)if(n.hasOwnProperty(a)){var o=n[a];if(null!=o)switch(a){case"src":s=!0;break;case"srcSet":i=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:Xd(e,t,a,o,n,null)}}return i&&Xd(e,t,"srcSet",n.srcSet,n,null),void(s&&Xd(e,t,"src",n.src,n,null));case"input":zd("invalid",e);var l=a=o=i=null,c=null,d=null;for(s in n)if(n.hasOwnProperty(s)){var u=n[s];if(null!=u)switch(s){case"name":i=u;break;case"type":o=u;break;case"checked":c=u;break;case"defaultChecked":d=u;break;case"value":a=u;break;case"defaultValue":l=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(r(137,t));break;default:Xd(e,t,s,u,n,null)}}return vt(e,a,l,c,d,o,i,!1),void ut(e);case"select":for(i in zd("invalid",e),s=o=a=null,n)if(n.hasOwnProperty(i)&&null!=(l=n[i]))switch(i){case"value":a=l;break;case"defaultValue":o=l;break;case"multiple":s=l;default:Xd(e,t,i,l,n,null)}return t=a,n=o,e.multiple=!!s,void(null!=t?bt(e,!!s,t,!1):null!=n&&bt(e,!!s,n,!0));case"textarea":for(o in zd("invalid",e),a=i=s=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":s=l;break;case"defaultValue":i=l;break;case"children":a=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(r(91));break;default:Xd(e,t,o,l,n,null)}return wt(e,s,i,a),void ut(e);case"option":for(c in n)if(n.hasOwnProperty(c)&&null!=(s=n[c]))if("selected"===c)e.selected=s&&"function"!==typeof s&&"symbol"!==typeof s;else Xd(e,t,c,s,n,null);return;case"dialog":zd("beforetoggle",e),zd("toggle",e),zd("cancel",e),zd("close",e);break;case"iframe":case"object":zd("load",e);break;case"video":case"audio":for(s=0;s<Rd.length;s++)zd(Rd[s],e);break;case"image":zd("error",e),zd("load",e);break;case"details":zd("toggle",e);break;case"embed":case"source":case"link":zd("error",e),zd("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(d in n)if(n.hasOwnProperty(d)&&null!=(s=n[d]))switch(d){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,t));default:Xd(e,t,d,s,n,null)}return;default:if(Ct(t)){for(u in n)n.hasOwnProperty(u)&&(void 0!==(s=n[u])&&Zd(e,t,u,s,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(null!=(s=n[l])&&Xd(e,t,l,s,n,null))}var tu=null,nu=null;function au(e){return 9===e.nodeType?e:e.ownerDocument}function su(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function iu(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function ru(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ou=null;var lu="function"===typeof setTimeout?setTimeout:void 0,cu="function"===typeof clearTimeout?clearTimeout:void 0,du="function"===typeof Promise?Promise:void 0,uu="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof du?function(e){return du.resolve(null).then(e).catch(hu)}:lu;function hu(e){setTimeout(function(){throw e})}function mu(e){return"head"===e}function pu(e,t){var n=t,a=0,s=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0<a&&8>a){n=a;var r=e.ownerDocument;if(1&n&&wu(r.documentElement),2&n&&wu(r.body),4&n)for(wu(n=r.head),r=n.firstChild;r;){var o=r.nextSibling,l=r.nodeName;r[_e]||"SCRIPT"===l||"STYLE"===l||"LINK"===l&&"stylesheet"===r.rel.toLowerCase()||n.removeChild(r),r=o}}if(0===s)return e.removeChild(i),void Eh(t);s--}else"$"===n||"$?"===n||"$!"===n?s++:a=n.charCodeAt(0)-48;else a=0;n=i}while(n);Eh(t)}function gu(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":gu(n),Ue(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function fu(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function vu(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}var yu=null;function bu(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function xu(e,t,n){switch(t=au(n),e){case"html":if(!(e=t.documentElement))throw Error(r(452));return e;case"head":if(!(e=t.head))throw Error(r(453));return e;case"body":if(!(e=t.body))throw Error(r(454));return e;default:throw Error(r(451))}}function wu(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Ue(e)}var Su=new Map,ku=new Set;function ju(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Nu=F.d;F.d={f:function(){var e=Nu.f(),t=qc();return e||t},r:function(e){var t=Be(e);null!==t&&5===t.tag&&"form"===t.type?Ar(t):Nu.r(e)},D:function(e){Nu.D(e),Eu("dns-prefetch",e,null)},C:function(e,t){Nu.C(e,t),Eu("preconnect",e,t)},L:function(e,t,n){Nu.L(e,t,n);var a=Cu;if(a&&e&&t){var s='link[rel="preload"][as="'+gt(t)+'"]';"image"===t&&n&&n.imageSrcSet?(s+='[imagesrcset="'+gt(n.imageSrcSet)+'"]',"string"===typeof n.imageSizes&&(s+='[imagesizes="'+gt(n.imageSizes)+'"]')):s+='[href="'+gt(e)+'"]';var i=s;switch(t){case"style":i=Iu(e);break;case"script":i=Au(e)}Su.has(i)||(e=h({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),Su.set(i,e),null!==a.querySelector(s)||"style"===t&&a.querySelector(Pu(i))||"script"===t&&a.querySelector(Mu(i))||(eu(t=a.createElement("link"),"link",e),Ve(t),a.head.appendChild(t)))}},m:function(e,t){Nu.m(e,t);var n=Cu;if(n&&e){var a=t&&"string"===typeof t.as?t.as:"script",s='link[rel="modulepreload"][as="'+gt(a)+'"][href="'+gt(e)+'"]',i=s;switch(a){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":i=Au(e)}if(!Su.has(i)&&(e=h({rel:"modulepreload",href:e},t),Su.set(i,e),null===n.querySelector(s))){switch(a){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Mu(i)))return}eu(a=n.createElement("link"),"link",e),Ve(a),n.head.appendChild(a)}}},X:function(e,t){Nu.X(e,t);var n=Cu;if(n&&e){var a=We(n).hoistableScripts,s=Au(e),i=a.get(s);i||((i=n.querySelector(Mu(s)))||(e=h({src:e,async:!0},t),(t=Su.get(s))&&zu(e,t),Ve(i=n.createElement("script")),eu(i,"link",e),n.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},a.set(s,i))}},S:function(e,t,n){Nu.S(e,t,n);var a=Cu;if(a&&e){var s=We(a).hoistableStyles,i=Iu(e);t=t||"default";var r=s.get(i);if(!r){var o={loading:0,preload:null};if(r=a.querySelector(Pu(i)))o.loading=5;else{e=h({rel:"stylesheet",href:e,"data-precedence":t},n),(n=Su.get(i))&&Lu(e,n);var l=r=a.createElement("link");Ve(l),eu(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){o.loading|=1}),l.addEventListener("error",function(){o.loading|=2}),o.loading|=4,Fu(r,t,a)}r={type:"stylesheet",instance:r,count:1,state:o},s.set(i,r)}}},M:function(e,t){Nu.M(e,t);var n=Cu;if(n&&e){var a=We(n).hoistableScripts,s=Au(e),i=a.get(s);i||((i=n.querySelector(Mu(s)))||(e=h({src:e,async:!0,type:"module"},t),(t=Su.get(s))&&zu(e,t),Ve(i=n.createElement("script")),eu(i,"link",e),n.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},a.set(s,i))}}};var Cu="undefined"===typeof document?null:document;function Eu(e,t,n){var a=Cu;if(a&&"string"===typeof t&&t){var s=gt(t);s='link[rel="'+e+'"][href="'+s+'"]',"string"===typeof n&&(s+='[crossorigin="'+n+'"]'),ku.has(s)||(ku.add(s),e={rel:e,crossOrigin:n,href:t},null===a.querySelector(s)&&(eu(t=a.createElement("link"),"link",e),Ve(t),a.head.appendChild(t)))}}function Tu(e,t,n,a){var s,i,o,l,c=(c=W.current)?ju(c):null;if(!c)throw Error(r(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof n.precedence&&"string"===typeof n.href?(t=Iu(n.href),(a=(n=We(c).hoistableStyles).get(t))||(a={type:"style",instance:null,count:0,state:null},n.set(t,a)),a):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"===typeof n.href&&"string"===typeof n.precedence){e=Iu(n.href);var d=We(c).hoistableStyles,u=d.get(e);if(u||(c=c.ownerDocument||c,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,u),(d=c.querySelector(Pu(e)))&&!d._p&&(u.instance=d,u.state.loading=5),Su.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Su.set(e,n),d||(s=c,i=e,o=n,l=u.state,s.querySelector('link[rel="preload"][as="style"]['+i+"]")?l.loading=1:(i=s.createElement("link"),l.preload=i,i.addEventListener("load",function(){return l.loading|=1}),i.addEventListener("error",function(){return l.loading|=2}),eu(i,"link",o),Ve(i),s.head.appendChild(i))))),t&&null===a)throw Error(r(528,""));return u}if(t&&null!==a)throw Error(r(529,""));return null;case"script":return t=n.async,"string"===typeof(n=n.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Au(n),(a=(n=We(c).hoistableScripts).get(t))||(a={type:"script",instance:null,count:0,state:null},n.set(t,a)),a):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,e))}}function Iu(e){return'href="'+gt(e)+'"'}function Pu(e){return'link[rel="stylesheet"]['+e+"]"}function Du(e){return h({},e,{"data-precedence":e.precedence,precedence:null})}function Au(e){return'[src="'+gt(e)+'"]'}function Mu(e){return"script[async]"+e}function Ru(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var a=e.querySelector('style[data-href~="'+gt(n.href)+'"]');if(a)return t.instance=a,Ve(a),a;var s=h({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return Ve(a=(e.ownerDocument||e).createElement("style")),eu(a,"style",s),Fu(a,n.precedence,e),t.instance=a;case"stylesheet":s=Iu(n.href);var i=e.querySelector(Pu(s));if(i)return t.state.loading|=4,t.instance=i,Ve(i),i;a=Du(n),(s=Su.get(s))&&Lu(a,s),Ve(i=(e.ownerDocument||e).createElement("link"));var o=i;return o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),eu(i,"link",a),t.state.loading|=4,Fu(i,n.precedence,e),t.instance=i;case"script":return i=Au(n.src),(s=e.querySelector(Mu(i)))?(t.instance=s,Ve(s),s):(a=n,(s=Su.get(i))&&zu(a=h({},n),s),Ve(s=(e=e.ownerDocument||e).createElement("script")),eu(s,"link",a),e.head.appendChild(s),t.instance=s);case"void":return null;default:throw Error(r(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(a=t.instance,t.state.loading|=4,Fu(a,n.precedence,e));return t.instance}function Fu(e,t,n){for(var a=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),s=a.length?a[a.length-1]:null,i=s,r=0;r<a.length;r++){var o=a[r];if(o.dataset.precedence===t)i=o;else if(i!==s)break}i?i.parentNode.insertBefore(e,i.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Lu(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function zu(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var Ou=null;function _u(e,t,n){if(null===Ou){var a=new Map,s=Ou=new Map;s.set(n,a)}else(a=(s=Ou).get(n))||(a=new Map,s.set(n,a));if(a.has(e))return a;for(a.set(e,null),n=n.getElementsByTagName(e),s=0;s<n.length;s++){var i=n[s];if(!(i[_e]||i[Ae]||"link"===e&&"stylesheet"===i.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==i.namespaceURI){var r=i.getAttribute(t)||"";r=e+r;var o=a.get(r);o?o.push(i):a.set(r,[i])}}return a}function Uu(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function qu(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var Bu=null;function Hu(){}function Wu(){if(this.count--,0===this.count)if(this.stylesheets)Ku(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var Vu=null;function Ku(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,Vu=new Map,t.forEach(Gu,e),Vu=null,Wu.call(e))}function Gu(e,t){if(!(4&t.state.loading)){var n=Vu.get(e);if(n)var a=n.get(null);else{n=new Map,Vu.set(e,n);for(var s=e.querySelectorAll("link[data-precedence],style[data-precedence]"),i=0;i<s.length;i++){var r=s[i];"LINK"!==r.nodeName&&"not all"===r.getAttribute("media")||(n.set(r.dataset.precedence,r),a=r)}a&&n.set(null,a)}r=(s=t.instance).getAttribute("data-precedence"),(i=n.get(r)||a)===a&&n.set(null,s),n.set(r,s),this.count++,a=Wu.bind(this),s.addEventListener("load",a),s.addEventListener("error",a),i?i.parentNode.insertBefore(s,i.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(s,e.firstChild),t.state.loading|=4}}var Ju={$$typeof:w,Provider:null,Consumer:null,_currentValue:L,_currentValue2:L,_threadCount:0};function Yu(e,t,n,a,s,i,r,o){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=je(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=je(0),this.hiddenUpdates=je(null),this.identifierPrefix=a,this.onUncaughtError=s,this.onCaughtError=i,this.onRecoverableError=r,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function Qu(e,t,n,a,s,i,r,o,l,c,d,u){return e=new Yu(e,t,n,r,o,l,c,u),t=1,!0===i&&(t|=24),i=La(3,null,null,t),e.current=i,i.stateNode=e,(t=Ms()).refCount++,e.pooledCache=t,t.refCount++,i.memoizedState={element:a,isDehydrated:n,cache:t},ni(i),e}function $u(e){return e?e=Ra:Ra}function Xu(e,t,n,a,s,i){s=$u(s),null===a.context?a.context=s:a.pendingContext=s,(a=si(t)).payload={element:n},null!==(i=void 0===i?null:i)&&(a.callback=i),null!==(n=ii(e,a,t))&&(Lc(n,0,t),ri(n,e,t))}function Zu(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function eh(e,t){Zu(e,t),(e=e.alternate)&&Zu(e,t)}function th(e){if(13===e.tag){var t=Da(e,67108864);null!==t&&Lc(t,0,67108864),eh(e,67108864)}}var nh=!0;function ah(e,t,n,a){var s=R.T;R.T=null;var i=F.p;try{F.p=2,ih(e,t,n,a)}finally{F.p=i,R.T=s}}function sh(e,t,n,a){var s=R.T;R.T=null;var i=F.p;try{F.p=8,ih(e,t,n,a)}finally{F.p=i,R.T=s}}function ih(e,t,n,a){if(nh){var s=rh(a);if(null===s)Bd(e,t,a,oh,n),yh(e,a);else if(function(e,t,n,a,s){switch(t){case"focusin":return uh=bh(uh,e,t,n,a,s),!0;case"dragenter":return hh=bh(hh,e,t,n,a,s),!0;case"mouseover":return mh=bh(mh,e,t,n,a,s),!0;case"pointerover":var i=s.pointerId;return ph.set(i,bh(ph.get(i)||null,e,t,n,a,s)),!0;case"gotpointercapture":return i=s.pointerId,gh.set(i,bh(gh.get(i)||null,e,t,n,a,s)),!0}return!1}(s,e,t,n,a))a.stopPropagation();else if(yh(e,a),4&t&&-1<vh.indexOf(e)){for(;null!==s;){var i=Be(s);if(null!==i)switch(i.tag){case 3:if((i=i.stateNode).current.memoizedState.isDehydrated){var r=ye(i.pendingLanes);if(0!==r){var o=i;for(o.pendingLanes|=2,o.entangledLanes|=2;r;){var l=1<<31-me(r);o.entanglements[1]|=l,r&=~l}Sd(i),0===(6&nc)&&(Sc=te()+500,kd(0,!1))}}break;case 13:null!==(o=Da(i,2))&&Lc(o,0,2),qc(),eh(i,2)}if(null===(i=rh(a))&&Bd(e,t,a,oh,n),i===s)break;s=i}null!==s&&a.stopPropagation()}else Bd(e,t,a,null,n)}}function rh(e){return lh(e=Dt(e))}var oh=null;function lh(e){if(oh=null,null!==(e=qe(e))){var t=l(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=c(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return oh=e,null}function ch(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ne()){case ae:return 2;case se:return 8;case ie:case re:return 32;case oe:return 268435456;default:return 32}default:return 32}}var dh=!1,uh=null,hh=null,mh=null,ph=new Map,gh=new Map,fh=[],vh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yh(e,t){switch(e){case"focusin":case"focusout":uh=null;break;case"dragenter":case"dragleave":hh=null;break;case"mouseover":case"mouseout":mh=null;break;case"pointerover":case"pointerout":ph.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":gh.delete(t.pointerId)}}function bh(e,t,n,a,s,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:a,nativeEvent:i,targetContainers:[s]},null!==t&&(null!==(t=Be(t))&&th(t)),e):(e.eventSystemFlags|=a,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function xh(e){var t=qe(e.target);if(null!==t){var n=l(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=c(n)))return e.blockedOn=t,void function(e,t){var n=F.p;try{return F.p=e,t()}finally{F.p=n}}(e.priority,function(){if(13===n.tag){var e=Rc();e=Te(e);var t=Da(n,e);null!==t&&Lc(t,0,e),eh(n,e)}})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function wh(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=rh(e.nativeEvent);if(null!==n)return null!==(t=Be(n))&&th(t),e.blockedOn=n,!1;var a=new(n=e.nativeEvent).constructor(n.type,n);Pt=a,n.target.dispatchEvent(a),Pt=null,t.shift()}return!0}function Sh(e,t,n){wh(e)&&n.delete(t)}function kh(){dh=!1,null!==uh&&wh(uh)&&(uh=null),null!==hh&&wh(hh)&&(hh=null),null!==mh&&wh(mh)&&(mh=null),ph.forEach(Sh),gh.forEach(Sh)}function jh(e,t){e.blockedOn===t&&(e.blockedOn=null,dh||(dh=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,kh)))}var Nh=null;function Ch(e){Nh!==e&&(Nh=e,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){Nh===e&&(Nh=null);for(var t=0;t<e.length;t+=3){var n=e[t],a=e[t+1],s=e[t+2];if("function"!==typeof a){if(null===lh(a||n))continue;break}var i=Be(n);null!==i&&(e.splice(t,3),t-=3,Pr(i,{pending:!0,data:s,method:n.method,action:a},a,s))}}))}function Eh(e){function t(t){return jh(t,e)}null!==uh&&jh(uh,e),null!==hh&&jh(hh,e),null!==mh&&jh(mh,e),ph.forEach(t),gh.forEach(t);for(var n=0;n<fh.length;n++){var a=fh[n];a.blockedOn===e&&(a.blockedOn=null)}for(;0<fh.length&&null===(n=fh[0]).blockedOn;)xh(n),null===n.blockedOn&&fh.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(a=0;a<n.length;a+=3){var s=n[a],i=n[a+1],r=s[Me]||null;if("function"===typeof i)r||Ch(n);else if(r){var o=null;if(i&&i.hasAttribute("formAction")){if(s=i,r=i[Me]||null)o=r.formAction;else if(null!==lh(s))continue}else o=r.action;"function"===typeof o?n[a+1]=o:(n.splice(a,3),a-=3),Ch(n)}}}function Th(e){this._internalRoot=e}function Ih(e){this._internalRoot=e}Ih.prototype.render=Th.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(r(409));Xu(t.current,Rc(),e,t,null,null)},Ih.prototype.unmount=Th.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Xu(e.current,2,null,e,null,null),qc(),t[Re]=null}},Ih.prototype.unstable_scheduleHydration=function(e){if(e){var t=Pe();e={blockedOn:null,target:e,priority:t};for(var n=0;n<fh.length&&0!==t&&t<fh[n].priority;n++);fh.splice(n,0,e),0===n&&xh(e)}};var Ph=s.version;if("19.1.1"!==Ph)throw Error(r(527,Ph,"19.1.1"));F.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=l(e)))throw Error(r(188));return t!==e?null:e}for(var n=e,a=t;;){var s=n.return;if(null===s)break;var i=s.alternate;if(null===i){if(null!==(a=s.return)){n=a;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return d(s),e;if(i===a)return d(s),t;i=i.sibling}throw Error(r(188))}if(n.return!==a.return)n=s,a=i;else{for(var o=!1,c=s.child;c;){if(c===n){o=!0,n=s,a=i;break}if(c===a){o=!0,a=s,n=i;break}c=c.sibling}if(!o){for(c=i.child;c;){if(c===n){o=!0,n=i,a=s;break}if(c===a){o=!0,a=i,n=s;break}c=c.sibling}if(!o)throw Error(r(189))}}if(n.alternate!==a)throw Error(r(190))}if(3!==n.tag)throw Error(r(188));return n.stateNode.current===n?e:t}(t),e=null===(e=null!==e?u(e):null)?null:e.stateNode};var Dh={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:R,reconcilerVersion:"19.1.1"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Ah=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ah.isDisabled&&Ah.supportsFiber)try{de=Ah.inject(Dh),ue=Ah}catch(Rh){}}t.createRoot=function(e,t){if(!o(e))throw Error(r(299));var n=!1,a="",s=yo,i=bo,l=xo;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(a=t.identifierPrefix),void 0!==t.onUncaughtError&&(s=t.onUncaughtError),void 0!==t.onCaughtError&&(i=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),t=Qu(e,1,!1,null,0,n,a,s,i,l,0,null),e[Re]=t.current,Ud(e),new Th(t)},t.hydrateRoot=function(e,t,n){if(!o(e))throw Error(r(299));var a=!1,s="",i=yo,l=bo,c=xo,d=null;return null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onUncaughtError&&(i=n.onUncaughtError),void 0!==n.onCaughtError&&(l=n.onCaughtError),void 0!==n.onRecoverableError&&(c=n.onRecoverableError),void 0!==n.unstable_transitionCallbacks&&n.unstable_transitionCallbacks,void 0!==n.formState&&(d=n.formState)),(t=Qu(e,1,!0,t,0,a,s,i,l,c,0,d)).context=$u(null),n=t.current,(s=si(a=Te(a=Rc()))).callback=null,ii(n,s,a),n=a,t.current.lanes=n,Ne(t,n),Sd(t),e[Re]=t.current,Ud(e),new Ih(t)},t.version="19.1.1"},119:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(863)},308:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});const a=new class{constructor(){this.module=null,this.isReady=!1,this.initPromise=null}async initialize(){if(!this.isReady)return this.initPromise||(this.initPromise=(async()=>{try{console.warn("\u26a0\ufe0f WebAssembly Image Processor not available, using fallback"),this.isReady=!1}catch(e){console.error("\u274c Failed to load Image Processor:",e)}})()),this.initPromise}async ensureReady(){this.isReady||await this.initialize()}async processImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await this.ensureReady();const{maxWidth:n=1920,maxHeight:a=1920,quality:s=85,format:i="image/jpeg",cropToSquare:r=!1,filters:o={}}=t;try{const t=await this.loadImageFromFile(e),{data:l,width:c,height:d}=t,u=new this.module.ImageProcessor,h=new Uint8Array(l.buffer);let m;u.loadImage(h,c,d),o.grayscale&&u.applyGrayscale(),void 0!==o.brightness&&u.adjustBrightness(o.brightness),void 0!==o.contrast&&u.adjustContrast(o.contrast);let p=c,g=d;if(r){m=u.cropToSquare();p=g=Math.min(c,d)}const f=this.module.calculateOptimalSize(p,g,Math.max(n,a));f.width!==p||f.height!==g?(m=u.resize(f.width,f.height),p=f.width,g=f.height):m||(m=u.getImageData()),s<100&&(m=u.compress(s));const v=document.createElement("canvas");v.width=p,v.height=g;const y=v.getContext("2d"),b=new ImageData(new Uint8ClampedArray(m),p,g);return y.putImageData(b,0,0),new Promise(e=>{v.toBlob(e,i,s/100)})}catch(l){throw console.error("Image processing error:",l),l}}async optimizeAvatar(e){return this.processImage(e,{maxWidth:512,maxHeight:512,quality:90,cropToSquare:!0,format:"image/jpeg"})}async optimizeChatImage(e){return this.processImage(e,{maxWidth:1920,maxHeight:1920,quality:85,format:"image/jpeg"})}async createThumbnail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return this.processImage(e,{maxWidth:t,maxHeight:t,quality:75,cropToSquare:!0,format:"image/jpeg"})}loadImageFromFile(e){return new Promise((t,n)=>{const a=new Image,s=URL.createObjectURL(e);a.onload=()=>{const e=document.createElement("canvas");e.width=a.width,e.height=a.height;const n=e.getContext("2d");n.drawImage(a,0,0);const i=n.getImageData(0,0,a.width,a.height);URL.revokeObjectURL(s),t({data:i.data,width:a.width,height:a.height})},a.onerror=()=>{URL.revokeObjectURL(s),n(new Error("Failed to load image"))},a.src=s})}estimateSizeReduction(e,t){return this.module.estimateCompressionSize(e,t)}}},340:(e,t,n)=>{e.exports=n(487)},352:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(85)},414:(e,t,n)=>{e.exports=n(916)},487:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var a=n-1>>>1,s=e[a];if(!(0<i(s,t)))break e;e[a]=t,e[n]=s,n=a}}function a(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var a=0,s=e.length,r=s>>>1;a<r;){var o=2*(a+1)-1,l=e[o],c=o+1,d=e[c];if(0>i(l,n))c<s&&0>i(d,l)?(e[a]=d,e[c]=n,a=c):(e[a]=l,e[o]=n,a=o);else{if(!(c<s&&0>i(d,n)))break e;e[a]=d,e[c]=n,a=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var r=performance;t.unstable_now=function(){return r.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,m=3,p=!1,g=!1,f=!1,v=!1,y="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=a(d);null!==t;){if(null===t.callback)s(d);else{if(!(t.startTime<=e))break;s(d),t.sortIndex=t.expirationTime,n(c,t)}t=a(d)}}function S(e){if(f=!1,w(e),!g)if(null!==a(c))g=!0,j||(j=!0,k());else{var t=a(d);null!==t&&A(S,t.startTime-e)}}var k,j=!1,N=-1,C=5,E=-1;function T(){return!!v||!(t.unstable_now()-E<C)}function I(){if(v=!1,j){var e=t.unstable_now();E=e;var n=!0;try{e:{g=!1,f&&(f=!1,b(N),N=-1),p=!0;var i=m;try{t:{for(w(e),h=a(c);null!==h&&!(h.expirationTime>e&&T());){var r=h.callback;if("function"===typeof r){h.callback=null,m=h.priorityLevel;var o=r(h.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof o){h.callback=o,w(e),n=!0;break t}h===a(c)&&s(c),w(e)}else s(c);h=a(c)}if(null!==h)n=!0;else{var l=a(d);null!==l&&A(S,l.startTime-e),n=!1}}break e}finally{h=null,m=i,p=!1}n=void 0}}finally{n?k():j=!1}}}if("function"===typeof x)k=function(){x(I)};else if("undefined"!==typeof MessageChannel){var P=new MessageChannel,D=P.port2;P.port1.onmessage=I,k=function(){D.postMessage(null)}}else k=function(){y(I,0)};function A(e,n){N=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_next=function(e){switch(m){case 1:case 2:case 3:var t=3;break;default:t=m}var n=m;m=t;try{return e()}finally{m=n}},t.unstable_requestPaint=function(){v=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=m;m=e;try{return t()}finally{m=n}},t.unstable_scheduleCallback=function(e,s,i){var r=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?r+i:r:i=r,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:s,priorityLevel:e,startTime:i,expirationTime:o=i+o,sortIndex:-1},i>r?(e.sortIndex=i,n(d,e),null===a(c)&&e===a(d)&&(f?(b(N),N=-1):f=!0,A(S,i-r))):(e.sortIndex=o,n(c,e),g||p||(g=!0,j||(j=!0,k()))),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=m;return function(){var n=m;m=t;try{return e.apply(this,arguments)}finally{m=n}}}},863:(e,t,n)=>{var a=n(950);function s(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var r={d:{f:i,r:function(){throw Error(s(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},o=Symbol.for("react.portal");var l=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(s(299));return function(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:o,key:null==a?null:""+a,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=r.p;try{if(l.T=null,r.p=2,e)return e()}finally{l.T=t,r.p=n,r.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,r.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&r.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var n=t.as,a=c(n,t.crossOrigin),s="string"===typeof t.integrity?t.integrity:void 0,i="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?r.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:a,integrity:s,fetchPriority:i}):"script"===n&&r.d.X(e,{crossOrigin:a,integrity:s,fetchPriority:i,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);r.d.M(e,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&r.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var n=t.as,a=c(n,t.crossOrigin);r.d.L(e,n,{crossOrigin:a,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var n=c(t.as,t.crossOrigin);r.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else r.d.m(e)},t.requestFormReset=function(e){r.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.1.1"},916:(e,t)=>{var n=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function s(e,t,a){var s=null;if(void 0!==a&&(s=""+a),void 0!==t.key&&(s=""+t.key),"key"in t)for(var i in a={},t)"key"!==i&&(a[i]=t[i]);else a=t;return t=a.ref,{$$typeof:n,type:e,key:s,ref:void 0!==t?t:null,props:a}}t.Fragment=a,t.jsx=s,t.jsxs=s},950:(e,t,n)=>{e.exports=n(983)},983:(e,t)=>{var n=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,f={};function v(e,t,n){this.props=e,this.context=t,this.refs=f,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=f,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var x=b.prototype=new y;x.constructor=b,g(x,v.prototype),x.isPureReactComponent=!0;var w=Array.isArray,S={H:null,A:null,T:null,S:null,V:null},k=Object.prototype.hasOwnProperty;function j(e,t,a,s,i,r){return a=r.ref,{$$typeof:n,type:e,key:t,ref:void 0!==a?a:null,props:r}}function N(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function T(){}function I(e,t,s,i,r){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l,c,d=!1;if(null===e)d=!0;else switch(o){case"bigint":case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case n:case a:d=!0;break;case h:return I((d=e._init)(e._payload),t,s,i,r)}}if(d)return r=r(e),d=""===i?"."+E(e,0):i,w(r)?(s="",null!=d&&(s=d.replace(C,"$&/")+"/"),I(r,t,s,"",function(e){return e})):null!=r&&(N(r)&&(l=r,c=s+(null==r.key||e&&e.key===r.key?"":(""+r.key).replace(C,"$&/")+"/")+d,r=j(l.type,c,void 0,0,0,l.props)),t.push(r)),1;d=0;var u,p=""===i?".":i+":";if(w(e))for(var g=0;g<e.length;g++)d+=I(i=e[g],t,s,o=p+E(i,g),r);else if("function"===typeof(g=null===(u=e)||"object"!==typeof u?null:"function"===typeof(u=m&&u[m]||u["@@iterator"])?u:null))for(e=g.call(e),g=0;!(i=e.next()).done;)d+=I(i=i.value,t,s,o=p+E(i,g++),r);else if("object"===o){if("function"===typeof e.then)return I(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(T,T):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,s,i,r);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return d}function P(e,t,n){if(null==e)return e;var a=[],s=0;return I(e,a,"","",function(e){return t.call(n,e,s++)}),a}function D(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var A="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)};function M(){}t.Children={map:P,forEach:function(e,t,n){P(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return P(e,function(){t++}),t},toArray:function(e){return P(e,function(e){return e})||[]},only:function(e){if(!N(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=s,t.Profiler=r,t.PureComponent=b,t.StrictMode=i,t.Suspense=d,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return S.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var a=g({},e.props),s=e.key;if(null!=t)for(i in void 0!==t.ref&&void 0,void 0!==t.key&&(s=""+t.key),t)!k.call(t,i)||"key"===i||"__self"===i||"__source"===i||"ref"===i&&void 0===t.ref||(a[i]=t[i]);var i=arguments.length-2;if(1===i)a.children=n;else if(1<i){for(var r=Array(i),o=0;o<i;o++)r[o]=arguments[o+2];a.children=r}return j(e.type,s,void 0,0,0,a)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:o,_context:e},e},t.createElement=function(e,t,n){var a,s={},i=null;if(null!=t)for(a in void 0!==t.key&&(i=""+t.key),t)k.call(t,a)&&"key"!==a&&"__self"!==a&&"__source"!==a&&(s[a]=t[a]);var r=arguments.length-2;if(1===r)s.children=n;else if(1<r){for(var o=Array(r),l=0;l<r;l++)o[l]=arguments[l+2];s.children=o}if(e&&e.defaultProps)for(a in r=e.defaultProps)void 0===s[a]&&(s[a]=r[a]);return j(e,i,void 0,0,0,s)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=N,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=S.T,n={};S.T=n;try{var a=e(),s=S.S;null!==s&&s(n,a),"object"===typeof a&&null!==a&&"function"===typeof a.then&&a.then(M,A)}catch(i){A(i)}finally{S.T=t}},t.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},t.use=function(e){return S.H.use(e)},t.useActionState=function(e,t,n){return S.H.useActionState(e,t,n)},t.useCallback=function(e,t){return S.H.useCallback(e,t)},t.useContext=function(e){return S.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return S.H.useDeferredValue(e,t)},t.useEffect=function(e,t,n){var a=S.H;if("function"===typeof n)throw Error("useEffect CRUD overload is not enabled in this build of React.");return a.useEffect(e,t)},t.useId=function(){return S.H.useId()},t.useImperativeHandle=function(e,t,n){return S.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return S.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return S.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return S.H.useMemo(e,t)},t.useOptimistic=function(e,t){return S.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return S.H.useReducer(e,t,n)},t.useRef=function(e){return S.H.useRef(e)},t.useState=function(e){return S.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return S.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return S.H.useTransition()},t.version="19.1.1"}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}n.m=e,n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce((t,a)=>(n.f[a](e,t),t),[])),n.u=e=>"static/js/"+e+".e7c141c4.chunk.js",n.miniCssF=e=>{},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="quibish:";n.l=(a,s,i,r)=>{if(e[a])e[a].push(s);else{var o,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==a||u.getAttribute("data-webpack")==t+i){o=u;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",t+i),o.src=a),e[a]=[s];var h=(t,n)=>{o.onerror=o.onload=null,clearTimeout(m);var s=e[a];if(delete e[a],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach(e=>e(n)),t)return t(n)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=h.bind(null,o.onerror),o.onload=h.bind(null,o.onload),l&&document.head.appendChild(o)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/quibish/",(()=>{var e={792:0};n.f.j=(t,a)=>{var s=n.o(e,t)?e[t]:void 0;if(0!==s)if(s)a.push(s[2]);else{var i=new Promise((n,a)=>s=e[t]=[n,a]);a.push(s[2]=i);var r=n.p+n.u(t),o=new Error;n.l(r,a=>{if(n.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var i=a&&("load"===a.type?"missing":a.type),r=a&&a.target&&a.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",o.name="ChunkLoadError",o.type=i,o.request=r,s[1](o)}},"chunk-"+t,t)}};var t=(t,a)=>{var s,i,r=a[0],o=a[1],l=a[2],c=0;if(r.some(t=>0!==e[t])){for(s in o)n.o(o,s)&&(n.m[s]=o[s]);if(l)l(n)}for(t&&t(a);c<r.length;c++)i=r[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0},a=self.webpackChunkquibish=self.webpackChunkquibish||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var a=n(950),s=n(352);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function r(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=i(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function o(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var d=n(119);const u=new class{constructor(){this.tokenKey="auth_token",this.refreshKey="refresh_token",this.encryptionKey=null,this.initializeEncryption()}initializeEncryption(){if(!sessionStorage.getItem("session_enc_key")){const e=this.generateSecureKey();sessionStorage.setItem("session_enc_key",e)}this.encryptionKey=sessionStorage.getItem("session_enc_key")}generateSecureKey(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}async encryptData(e){try{const t=(new TextEncoder).encode(e),n=crypto.getRandomValues(new Uint8Array(12)),a=await crypto.subtle.importKey("raw",new Uint8Array(this.encryptionKey.match(/.{2}/g).map(e=>parseInt(e,16))),{name:"AES-GCM"},!1,["encrypt"]),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},a,t),i=new Uint8Array(n.length+s.byteLength);return i.set(n),i.set(new Uint8Array(s),n.length),btoa(String.fromCharCode(...i))}catch(t){throw console.error("Encryption failed:",t),new Error("Failed to encrypt token")}}async decryptData(e){try{const t=new Uint8Array(atob(e).split("").map(e=>e.charCodeAt(0))),n=t.slice(0,12),a=t.slice(12),s=await crypto.subtle.importKey("raw",new Uint8Array(this.encryptionKey.match(/.{2}/g).map(e=>parseInt(e,16))),{name:"AES-GCM"},!1,["decrypt"]),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:n},s,a);return(new TextDecoder).decode(i)}catch(t){throw console.error("Decryption failed:",t),new Error("Failed to decrypt token")}}async setToken(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{this.clearInsecureStorage();const n=await this.encryptData(e);if(sessionStorage.setItem(this.tokenKey,n),t){const e=await this.encryptData(t);sessionStorage.setItem(this.refreshKey,e)}return this.setTokenExpiration(),console.log("\ud83d\udd10 Token stored securely"),!0}catch(n){return console.error("Failed to store token securely:",n),!1}}async getToken(){try{const e=sessionStorage.getItem(this.tokenKey);return e?await this.decryptData(e):null}catch(e){return console.error("Failed to retrieve token:",e),this.clearTokens(),null}}async getRefreshToken(){try{const e=sessionStorage.getItem(this.refreshKey);return e?await this.decryptData(e):null}catch(e){return console.error("Failed to retrieve refresh token:",e),null}}clearTokens(){sessionStorage.removeItem(this.tokenKey),sessionStorage.removeItem(this.refreshKey),sessionStorage.removeItem("session_enc_key"),this.clearInsecureStorage(),console.log("\ud83e\uddf9 All tokens cleared")}clearInsecureStorage(){localStorage.removeItem("token"),localStorage.removeItem("authToken"),localStorage.removeItem("user_token"),localStorage.removeItem("jwt_token");const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);n&&(n.includes("token")||n.includes("auth"))&&e.push(n)}e.forEach(e=>{localStorage.removeItem(e),console.warn("\ud83e\uddf9 Removed insecure storage: ".concat(e))})}setTokenExpiration(){this.expirationTimer&&clearTimeout(this.expirationTimer),this.expirationTimer=setTimeout(()=>{console.warn("\u23f0 Token expiring soon, clearing tokens"),this.clearTokens(),window.dispatchEvent(new CustomEvent("tokenExpiring"))},828e5)}async hasValidToken(){try{return!!await this.getToken()}catch(e){return!1}}async migrateFromLocalStorage(){const e=localStorage.getItem("token");return!!e&&(console.log("\ud83d\udd04 Migrating token from insecure localStorage"),await this.setToken(e),localStorage.removeItem("token"),console.log("\u2705 Token migration completed"),!0)}async getTokenForRequest(){let e=await this.getToken();if(e||(await this.migrateFromLocalStorage(),e=await this.getToken()),!e){const t=await this.getRefreshToken();t&&(e=await this.refreshAccessToken(t))}return e}async refreshAccessToken(e){try{const t=await fetch("/api/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e})});if(t.ok){const e=await t.json();return await this.setToken(e.token,e.refreshToken),e.token}return this.clearTokens(),null}catch(t){return console.error("Token refresh failed:",t),this.clearTokens(),null}}async verifyTokenIntegrity(){try{const t=await this.getToken();if(!t)return!1;const n=t.split(".");if(3!==n.length)return console.warn("\ud83d\udea8 Token structure invalid"),this.clearTokens(),!1;try{const e=JSON.parse(atob(n[1])),t=Math.floor(Date.now()/1e3);if(e.exp&&e.exp<t)return console.warn("\u23f0 Token expired"),this.clearTokens(),!1}catch(e){return console.warn("\ud83d\udea8 Token payload invalid"),this.clearTokens(),!1}return!0}catch(t){return console.error("Token integrity check failed:",t),this.clearTokens(),!1}}async initialize(){await this.migrateFromLocalStorage(),await this.verifyTokenIntegrity(),setInterval(()=>{this.verifyTokenIntegrity()},3e5),console.log("\ud83d\udd10 Secure token manager initialized")}},h="login",m="logout",p="page_view",g="feature_used",f="error_occurred",v="user_activity_log",y="user_session_data",b="user_analytics_data";const x=new class{constructor(){this.sessionStartTime=Date.now(),this.sessionId=this.generateSessionId(),this.lastActivityTime=Date.now(),this.isTrackingEnabled=!0,this.initializeSession(),this.setupCleanupInterval()}generateSessionId(){return"session_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}initializeSession(){try{const e={sessionId:this.sessionId,startTime:this.sessionStartTime,userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,screenResolution:"".concat(window.screen.width,"x").concat(window.screen.height),viewportSize:"".concat(window.innerWidth,"x").concat(window.innerHeight)};localStorage.setItem(y,JSON.stringify(e)),this.logActivity(h,{sessionId:this.sessionId,timestamp:this.sessionStartTime})}catch(e){console.error("Failed to initialize session:",e)}}logActivity(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isTrackingEnabled)try{const n={id:this.generateActivityId(),type:e,timestamp:Date.now(),sessionId:this.sessionId,data:c(c({},t),{},{url:window.location.href,referrer:document.referrer,viewportSize:"".concat(window.innerWidth,"x").concat(window.innerHeight)})};this.lastActivityTime=n.timestamp;const a=this.getActivityLog();a.push(n),a.length>1e3&&a.splice(0,a.length-1e3),localStorage.setItem(v,JSON.stringify(a)),this.updateAnalytics(n),window.dispatchEvent(new CustomEvent("userActivity",{detail:n}))}catch(n){console.error("Failed to log activity:",n)}}generateActivityId(){return"activity_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}getActivityLog(){try{const e=localStorage.getItem(v);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to get activity log:",e),[]}}clearActivityLog(){try{return localStorage.removeItem(v),localStorage.removeItem(b),!0}catch(e){return console.error("Failed to clear activity log:",e),!1}}getActivityStats(){try{var e,t,n;const a=this.getActivityLog(),s=Date.now(),i=(new Date).setHours(0,0,0,0),r=s-6048e5,o=s-2592e6,l={total:a.length,today:a.filter(e=>e.timestamp>=i).length,thisWeek:a.filter(e=>e.timestamp>=r).length,thisMonth:a.filter(e=>e.timestamp>=o).length,byType:{},byHour:new Array(24).fill(0),byDay:{},sessionDuration:s-this.sessionStartTime,lastActivity:this.lastActivityTime,mostActiveHour:0,mostActiveDay:"",topActivities:[]};a.forEach(e=>{const t=e.type;l.byType[t]=(l.byType[t]||0)+1;const n=new Date(e.timestamp).getHours();l.byHour[n]++;const a=new Date(e.timestamp).toDateString();l.byDay[a]=(l.byDay[a]||0)+1});const c=Math.max(...l.byHour||[]);l.mostActiveHour=null!==(e=null===(t=l.byHour)||void 0===t||null===(n=t.indexOf)||void 0===n?void 0:n.call(t,c))&&void 0!==e?e:-1;const d=Object.keys(l.byDay).reduce((e,t)=>l.byDay[e]>l.byDay[t]?e:t,"");return l.mostActiveDay=d,l.topActivities=Object.entries(l.byType).sort((e,t)=>{let[,n]=e,[,a]=t;return a-n}).slice(0,5).map(e=>{let[t,n]=e;return{type:t,count:n}}),l}catch(a){return console.error("Failed to get activity stats:",a),{total:0,today:0,thisWeek:0,thisMonth:0,byType:{},byHour:new Array(24).fill(0),byDay:{},sessionDuration:0,lastActivity:Date.now(),mostActiveHour:0,mostActiveDay:"",topActivities:[]}}}updateAnalytics(e){try{const t=this.getAnalyticsData(),n=(new Date).toDateString();t.daily[n]||(t.daily[n]={activities:0,types:{},firstActivity:e.timestamp,lastActivity:e.timestamp});const a=t.daily[n];a.activities++,a.types[e.type]=(a.types[e.type]||0)+1,a.lastActivity=e.timestamp,t.global.totalActivities++,t.global.types[e.type]=(t.global.types[e.type]||0)+1,t.global.lastUpdated=e.timestamp,localStorage.setItem(b,JSON.stringify(t))}catch(t){console.error("Failed to update analytics:",t)}}getAnalyticsData(){try{const e=localStorage.getItem(b);if(e)return JSON.parse(e)}catch(e){console.error("Failed to get analytics data:",e)}return{global:{totalActivities:0,types:{},firstActivity:Date.now(),lastUpdated:Date.now()},daily:{},weekly:{},monthly:{}}}setTrackingEnabled(e){this.isTrackingEnabled=e,localStorage.setItem("activity_tracking_enabled",e)}isTrackingEnabledCheck(){return this.isTrackingEnabled}trackPageView(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.logActivity(p,c({page:e},t))}trackFeatureUsage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.logActivity(g,c({feature:e},t))}trackError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.logActivity(f,{error:{message:e.message,stack:e.stack,name:e.name},context:t})}setupCleanupInterval(){setInterval(()=>{this.cleanupOldActivities()},36e5)}cleanupOldActivities(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;try{const t=this.getActivityLog(),n=Date.now()-24*e*60*60*1e3,a=t.filter(e=>e.timestamp>=n);localStorage.setItem(v,JSON.stringify(a)),console.log("Cleaned up ".concat(t.length-a.length," old activities"))}catch(t){console.error("Failed to cleanup old activities:",t)}}exportActivityData(){try{return{activities:this.getActivityLog(),analytics:this.getAnalyticsData(),session:JSON.parse(localStorage.getItem(y)||"{}"),exportedAt:Date.now()}}catch(e){return console.error("Failed to export activity data:",e),null}}importActivityData(e){try{return e.activities&&localStorage.setItem(v,JSON.stringify(e.activities)),e.analytics&&localStorage.setItem(b,JSON.stringify(e.analytics)),!0}catch(t){return console.error("Failed to import activity data:",t),!1}}getSessionInfo(){try{const e=localStorage.getItem(y);return e?JSON.parse(e):null}catch(e){return console.error("Failed to get session info:",e),null}}},w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x.logActivity(e,t)};const S=new class{constructor(){this.STORAGE_KEYS={USER_DATA:"quibish_user_data",USER_PROFILE:"quibish_user_profile",MESSAGES:"quibish_messages",CONVERSATIONS:"quibish_conversations",SETTINGS:"quibish_settings",AUTH_TOKEN:"quibish_auth_token",SESSION_DATA:"quibish_session_data",REMEMBER_ME:"quibish_remember_me"},this.listeners={},this.initializeStorage()}initializeStorage(){try{this.isStorageAvailable("localStorage")?this.primaryStorage=localStorage:(console.warn("\u26a0\ufe0f localStorage not available, using sessionStorage"),this.primaryStorage=sessionStorage),this.migrateOldData(),console.log("\u2705 Persistent storage initialized")}catch(e){console.error("\u274c Failed to initialize storage:",e)}}isStorageAvailable(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,"test"),t.removeItem(n),!0}catch(t){return!1}}migrateOldData(){try{const e=localStorage.getItem("user")||sessionStorage.getItem("user");if(e&&!this.getUserData()){const t=JSON.parse(e);this.setUserData(t),console.log("\ud83d\udce6 Migrated user data to persistent storage")}const t=localStorage.getItem("quibish_messages");if(t&&!this.getMessages().length){const e=JSON.parse(t);this.setMessages(e),console.log("\ud83d\udce6 Migrated messages to persistent storage")}const n=localStorage.getItem("authToken")||sessionStorage.getItem("authToken");n&&!this.getAuthToken()&&(this.setAuthToken(n),console.log("\ud83d\udce6 Migrated auth token to persistent storage"))}catch(e){console.warn("\u26a0\ufe0f Error during data migration:",e)}}setItem(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];try{const a="string"===typeof t?t:JSON.stringify(t);return n&&this.getRememberMe()?(localStorage.setItem(e,a),console.log("\ud83d\udcbe Stored ".concat(e," persistently"))):(sessionStorage.setItem(e,a),console.log("\ud83d\udcf1 Stored ".concat(e," for session"))),this.isCriticalData(e)&&localStorage.setItem(e,a),this.notifyListeners(e,t),!0}catch(a){return console.error("\u274c Failed to store ".concat(e,":"),a),!1}}getItem(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{let a=localStorage.getItem(e);if(a||(a=sessionStorage.getItem(e)),!a)return null;if(!t||e===this.STORAGE_KEYS.AUTH_TOKEN)return a;try{return JSON.parse(a)}catch(n){return console.warn("\u26a0\ufe0f Could not parse ".concat(e," as JSON, returning raw value")),a}}catch(a){return console.error("\u274c Failed to retrieve ".concat(e,":"),a),null}}removeItem(e){try{return localStorage.removeItem(e),sessionStorage.removeItem(e),this.notifyListeners(e,null),console.log("\ud83d\uddd1\ufe0f Removed ".concat(e," from all storage")),!0}catch(t){return console.error("\u274c Failed to remove ".concat(e,":"),t),!1}}isCriticalData(e){return[this.STORAGE_KEYS.USER_DATA,this.STORAGE_KEYS.USER_PROFILE,this.STORAGE_KEYS.MESSAGES,this.STORAGE_KEYS.AUTH_TOKEN].includes(e)}setUserData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null===t&&(t=this.getRememberMe());const n=this.setItem(this.STORAGE_KEYS.USER_DATA,e,t);return n&&this.setUserProfile(e,t),n}getUserData(){return this.getItem(this.STORAGE_KEYS.USER_DATA)}updateUserData(e){const t=c(c(c({},this.getUserData()||{}),e),{},{updatedAt:(new Date).toISOString()});return this.setUserData(t)}setUserProfile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===t&&(t=this.getRememberMe()),this.setItem(this.STORAGE_KEYS.USER_PROFILE,e,t)}getUserProfile(){return this.getItem(this.STORAGE_KEYS.USER_PROFILE)}updateUserProfile(e){const t=c(c(c({},this.getUserProfile()||{}),e),{},{updatedAt:(new Date).toISOString()});return this.setUserProfile(t),this.updateUserData(e),t}setMessages(e){return this.setItem(this.STORAGE_KEYS.MESSAGES,e,!0)}getMessages(){return this.getItem(this.STORAGE_KEYS.MESSAGES)||[]}addMessage(e){const t=this.getMessages();return t.push(c(c({},e),{},{id:e.id||Date.now().toString(),timestamp:e.timestamp||(new Date).toISOString()})),t.length>1e3&&t.splice(0,t.length-1e3),this.setMessages(t)}updateMessage(e,t){const n=this.getMessages(),a=n.findIndex(t=>t.id===e);return-1!==a&&(n[a]=c(c(c({},n[a]),t),{},{updatedAt:(new Date).toISOString()}),this.setMessages(n))}deleteMessage(e){const t=this.getMessages().filter(t=>t.id!==e);return this.setMessages(t)}setAuthToken(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===t&&(t=this.getRememberMe()),this.setItem(this.STORAGE_KEYS.AUTH_TOKEN,e,t)}getAuthToken(){return this.getItem(this.STORAGE_KEYS.AUTH_TOKEN,!1)}setRememberMe(e){return localStorage.setItem(this.STORAGE_KEYS.REMEMBER_ME,e.toString()),e}getRememberMe(){return"true"===localStorage.getItem(this.STORAGE_KEYS.REMEMBER_ME)}setSettings(e){return this.setItem(this.STORAGE_KEYS.SETTINGS,e,!0)}getSettings(){return this.getItem(this.STORAGE_KEYS.SETTINGS)||{}}updateSettings(e){const t=c(c(c({},this.getSettings()),e),{},{updatedAt:(new Date).toISOString()});return this.setSettings(t)}setConversations(e){return this.setItem(this.STORAGE_KEYS.CONVERSATIONS,e,!0)}getConversations(){return this.getItem(this.STORAGE_KEYS.CONVERSATIONS)||[]}addConversation(e){const t=this.getConversations();return t.push(c(c({},e),{},{id:e.id||Date.now().toString(),createdAt:e.createdAt||(new Date).toISOString()})),this.setConversations(t)}setSessionData(e){return this.setItem(this.STORAGE_KEYS.SESSION_DATA,e,!1)}getSessionData(){return this.getItem(this.STORAGE_KEYS.SESSION_DATA)}clearAllData(){Object.values(this.STORAGE_KEYS).forEach(e=>{this.removeItem(e)});["user","authToken","token","quibish_messages"].forEach(e=>{localStorage.removeItem(e),sessionStorage.removeItem(e)}),console.log("\ud83e\uddf9 Cleared all persistent data")}clearSessionData(){sessionStorage.clear(),this.removeItem(this.STORAGE_KEYS.SESSION_DATA),console.log("\ud83e\uddf9 Cleared session data")}exportAllData(){const e={};return Object.entries(this.STORAGE_KEYS).forEach(t=>{let[n,a]=t;const s=this.getItem(a);s&&(e[n]=s)}),c(c({},e),{},{exportDate:(new Date).toISOString(),version:"1.0"})}importAllData(e){try{return Object.entries(e).forEach(e=>{let[t,n]=e;this.STORAGE_KEYS[t]&&this.setItem(this.STORAGE_KEYS[t],n,!0)}),console.log("\u2705 Data imported successfully"),!0}catch(t){return console.error("\u274c Failed to import data:",t),!1}}getStorageStats(){const e={localStorage:{},sessionStorage:{},total:{localStorage:0,sessionStorage:0}};return Object.entries(this.STORAGE_KEYS).forEach(t=>{let[n,a]=t;const s=localStorage.getItem(a),i=sessionStorage.getItem(a);if(s){const t=new Blob([s]).size;e.localStorage[n]=t,e.total.localStorage+=t}if(i){const t=new Blob([i]).size;e.sessionStorage[n]=t,e.total.sessionStorage+=t}}),e}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(e=>e!==t))}notifyListeners(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>{try{e(t)}catch(n){console.error("\u274c Error in storage listener:",n)}})}healthCheck(){try{const e="__health_check__",t="test";localStorage.setItem(e,t);const n=localStorage.getItem(e);localStorage.removeItem(e),sessionStorage.setItem(e,t);const a=sessionStorage.getItem(e);return sessionStorage.removeItem(e),{healthy:!0,localStorage:n===t,sessionStorage:a===t,timestamp:(new Date).toISOString()}}catch(e){return{healthy:!1,error:e.message,timestamp:(new Date).toISOString()}}}};var k=n(414);const j=(0,a.createContext)(),N=e=>{let{children:t}=e;const[n,s]=(0,a.useState)(null),[i,r]=(0,a.useState)(null),[o,l]=(0,a.useState)(!0),[d,p]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{console.log("\ud83d\udd04 Initializing authentication...");const e=S.getUserData(),t=S.getAuthToken(),n=S.getRememberMe();if(console.log("\ud83d\udce6 Storage check:",{hasUser:!!e,hasToken:!!t,remembered:n}),t&&e)try{r(t),p(n);const o="true"==={NODE_ENV:"production",PUBLIC_URL:"/quibish",WDS_SOCKET_HOST:"localhost",WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:"5001",FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"http://localhost:5001/api",REACT_APP_ENV:"dev",REACT_APP_WEBSOCKET_URL:"ws://localhost:5001"}.REACT_APP_OFFLINE_MODE;let l=!o;if(!1&&!o)try{const e=new AbortController,t=setTimeout(()=>e.abort(),500),n=await fetch("http://localhost:5001/api/health",{method:"HEAD",signal:e.signal});clearTimeout(t),l=n.ok}catch(a){l=!1,console.log("\ud83d\udce1 Backend server not available - using offline mode")}if(l)try{const a=new AbortController,i=setTimeout(()=>a.abort(),2e3),r=await fetch("http://localhost:5001/api/users/profile",{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},signal:a.signal});if(clearTimeout(i),!r.ok)throw new Error("Invalid token");{const t=await r.json();if(t.success&&t.user){const e=t.user;s(e),S.setUserData(e,n),console.log("\u2705 Restored session with fresh profile data:",{remembered:n,user:e.username,theme:e.theme,language:e.language})}else s(e),console.log("\ud83d\udcf1 Used stored session data (profile fetch failed):",{remembered:n,user:e.username})}}catch(i){"AbortError"===i.name?console.log("\ud83d\udd04 Backend connection timeout - working in offline mode"):i.message.includes("Failed to fetch")||i.message.includes("ERR_CONNECTION_REFUSED")?console.log("\ud83d\udce1 Backend server not available - working in offline mode"):console.warn("\u26a0\ufe0f Could not fetch fresh profile, using stored data:",i.message),s(e),console.log("\ud83d\udcbe Using stored session data (offline mode):",{remembered:n,user:e.username})}else s(e),console.log("\ud83d\udcbe Using stored session data (offline mode - backend unavailable):",{remembered:n,user:e.username})}catch(o){console.error("\u274c Error initializing auth with stored data:",o),S.clearAllData()}else console.log("\ud83d\udd0d No valid session found");l(!1)})()},[]);return(0,k.jsx)(j.Provider,{value:{isAuthenticated:!!i,user:n,token:i,loading:o,rememberMe:d,login:async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s(e),r(t),p(n);try{S.setRememberMe(n),S.setAuthToken(t,n),S.setUserData(e,n),console.log("\ud83d\udd10 User session saved persistently (".concat(n?"remembered":"temporary",")"));try{await u.setToken(t),await u.clearInsecureStorage()}catch(a){console.warn("\u26a0\ufe0f Secure token storage failed, using persistent storage fallback")}w(h,{userId:e.id||"anonymous",method:"manual",remembered:n,secure:!0})}catch(a){console.error("\u274c Error storing session data:",a);const s=n?localStorage:sessionStorage;s.setItem("authToken",t),s.setItem("user",JSON.stringify(e))}},logout:async()=>{n&&w(m,{userId:n.id||"anonymous"}),s(null),r(null),p(!1),S.clearAllData();try{await u.clearTokens()}catch(e){console.warn("\u26a0\ufe0f Error clearing secure tokens:",e)}console.log("\ud83d\udd10 User session cleared from all storage")},refreshUser:async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(n&&i){try{if(e){const e=await fetch("http://localhost:5001/api/users/profile",{headers:{Authorization:"Bearer ".concat(i),"Content-Type":"application/json"}});if(e.ok){const t=await e.json();if(t.success&&t.user){const e=t.user;return s(e),S.updateUserData(e),console.log("\u2705 User data refreshed from backend"),e}}}const t=S.getUserData();if(t)return s(t),console.log("\ud83d\udcf1 User data refreshed from storage"),t}catch(t){console.error("\u274c Error refreshing user data:",t)}return n}},updateUser:e=>{if(!n)return;const t=c(c(c({},n),e),{},{updatedAt:(new Date).toISOString()});return s(t),S.updateUserData(t),console.log("\ud83d\udc64 User data updated:",Object.keys(e)),t}},children:t})},C=()=>{const e=(0,a.useContext)(j);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e};var E=n(308);const T=e=>{let{isOpen:t,onClose:n,user:s,onUpdateProfile:i}=e;console.log("\ud83d\ude80 UserProfileModal rendered with props:",{isOpen:t,user:s,hasOnClose:!!n,hasOnUpdateProfile:!!i});const[r,o]=(0,a.useState)({name:"",email:"",phone:"",bio:"",avatar:null,status:"online",theme:"light",notifications:!0,privacy:"friends"}),[l,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(null),[g,f]=(0,a.useState)("profile");(0,a.useEffect)(()=>{s&&(o({name:s.name||"",email:s.email||"",phone:s.phone||"",bio:s.bio||"",avatar:s.avatar||null,status:s.status||"online",theme:s.theme||"light",notifications:!1!==s.notifications,privacy:s.privacy||"friends"}),p(s.avatar))},[s]);const v=(e,t)=>{o(n=>c(c({},n),{},{[e]:t}))};return t?(0,k.jsx)("div",{className:"profile-modal-overlay",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,k.jsxs)("div",{className:"profile-modal",children:[(0,k.jsxs)("div",{className:"profile-modal-header",children:[(0,k.jsx)("h3",{children:"Profile Settings"}),(0,k.jsx)("button",{className:"close-btn",onClick:n,children:"\xd7"})]}),(0,k.jsxs)("div",{className:"profile-modal-tabs",children:[(0,k.jsx)("button",{className:"tab-btn ".concat("profile"===g?"active":""),onClick:()=>f("profile"),children:"Profile"}),(0,k.jsx)("button",{className:"tab-btn ".concat("preferences"===g?"active":""),onClick:()=>f("preferences"),children:"Preferences"}),(0,k.jsx)("button",{className:"tab-btn ".concat("privacy"===g?"active":""),onClick:()=>f("privacy"),children:"Privacy"})]}),(0,k.jsxs)("div",{className:"profile-modal-content",children:["profile"===g&&(0,k.jsxs)("div",{className:"profile-tab",children:[(0,k.jsx)("div",{className:"avatar-section",children:(0,k.jsxs)("div",{className:"avatar-container",children:[(0,k.jsxs)("div",{className:"profile-avatar ".concat(u?"loading":""),children:[u?(0,k.jsxs)("div",{className:"avatar-loading",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("span",{children:"Processing..."})]}):m?(0,k.jsx)("img",{src:m,alt:"Profile",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}):(0,k.jsx)("div",{className:"avatar-placeholder",children:r.name.charAt(0).toUpperCase()||"U"}),(0,k.jsx)("div",{className:"status-indicator","data-status":r.status})]}),l&&(0,k.jsxs)("div",{className:"avatar-upload",children:[(0,k.jsx)("input",{type:"file",id:"avatar-upload",accept:"image/*",onChange:async e=>{const t=e.target.files[0];if(!t)return;if(["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(t.type))if(t.size>5242880)alert("File size must be less than 5MB");else{h(!0);try{const e=await E.default.optimizeAvatar(t),n=(100*(1-e.size/t.size)).toFixed(1);console.log("\ud83c\udfa8 Avatar optimized: ".concat((t.size/1024).toFixed(0),"KB \u2192 ").concat((e.size/1024).toFixed(0),"KB (").concat(n,"% smaller)"));const a=new FileReader;a.onload=e=>{const t=e.target.result;p(t),o(e=>c(c({},e),{},{avatar:t})),h(!1)},a.onerror=()=>{alert("Error reading optimized image"),h(!1)},a.readAsDataURL(e)}catch(n){console.error("Error optimizing image:",n);const e=new FileReader;e.onload=e=>{const t=e.target.result;p(t),o(e=>c(c({},e),{},{avatar:t})),h(!1)},e.onerror=()=>{alert("Error reading file"),h(!1)},e.readAsDataURL(t)}}else alert("Please select a valid image file (JPEG, PNG, GIF, or WebP)")},style:{display:"none"},disabled:u}),(0,k.jsx)("label",{htmlFor:"avatar-upload",className:"upload-btn ".concat(u?"disabled":""),children:u?"Processing...":"Change Photo"})]})]})}),(0,k.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const t=(()=>{var e;const t={};return null!==(e=r.name)&&void 0!==e&&e.trim()?r.name.trim().length<2&&(t.name="Name must be at least 2 characters"):t.name="Name is required",r.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email)&&(t.email="Please enter a valid email address"),r.phone&&!/^[\+]?[0-9\s\-\(\)]{10,}$/.test(r.phone)&&(t.phone="Please enter a valid phone number"),r.bio&&r.bio.length>500&&(t.bio="Bio must be less than 500 characters"),t})();if(Object.keys(t).length>0){const e=Object.values(t).join("\n");return void alert(e)}h(!0);try{await new Promise((e,t)=>{setTimeout(()=>{Math.random()<.1?t(new Error("Network error")):e()},1e3)}),i&&i(r);const e=c(c({},JSON.parse(localStorage.getItem("user")||sessionStorage.getItem("user")||"{}")),r);localStorage.getItem("user")&&localStorage.setItem("user",JSON.stringify(e)),sessionStorage.getItem("user")&&sessionStorage.setItem("user",JSON.stringify(e)),d(!1),alert("Profile updated successfully!")}catch(n){console.error("Error updating profile:",n),alert("Failed to update profile: ".concat(n.message,". Please try again."))}finally{h(!1)}},className:"profile-form",children:[(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{children:"Display Name *"}),(0,k.jsx)("input",{type:"text",value:r.name,onChange:e=>v("name",e.target.value),disabled:!l,required:!0})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{children:"Email"}),(0,k.jsx)("input",{type:"email",value:r.email,onChange:e=>v("email",e.target.value),disabled:!l})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{children:"Phone"}),(0,k.jsx)("input",{type:"tel",value:r.phone,onChange:e=>v("phone",e.target.value),disabled:!l})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{children:"Bio"}),(0,k.jsx)("textarea",{value:r.bio,onChange:e=>v("bio",e.target.value),disabled:!l,rows:"3",placeholder:"Tell others about yourself..."})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{children:"Status"}),(0,k.jsxs)("select",{value:r.status,onChange:e=>v("status",e.target.value),disabled:!l,children:[(0,k.jsx)("option",{value:"online",children:"\ud83d\udfe2 Online"}),(0,k.jsx)("option",{value:"away",children:"\ud83d\udfe1 Away"}),(0,k.jsx)("option",{value:"busy",children:"\ud83d\udd34 Busy"}),(0,k.jsx)("option",{value:"offline",children:"\u26ab Offline"})]})]}),(0,k.jsx)("div",{className:"form-actions",children:l?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("button",{type:"button",onClick:()=>{s&&(o({name:s.name||"",email:s.email||"",phone:s.phone||"",bio:s.bio||"",avatar:s.avatar||null,status:s.status||"online",theme:s.theme||"light",notifications:!1!==s.notifications,privacy:s.privacy||"friends"}),p(s.avatar)),d(!1)},className:"cancel-btn",children:"Cancel"}),(0,k.jsx)("button",{type:"submit",disabled:u,className:"save-btn",children:u?"Saving...":"Save Changes"})]}):(0,k.jsx)("button",{type:"button",onClick:()=>d(!0),className:"edit-btn",children:"Edit Profile"})})]})]}),"preferences"===g&&(0,k.jsxs)("div",{className:"preferences-tab",children:[(0,k.jsxs)("div",{className:"pref-group",children:[(0,k.jsx)("label",{children:"Theme"}),(0,k.jsxs)("div",{className:"theme-options",children:[(0,k.jsxs)("label",{className:"radio-option",children:[(0,k.jsx)("input",{type:"radio",name:"theme",value:"light",checked:"light"===r.theme,onChange:e=>v("theme",e.target.value)}),(0,k.jsx)("span",{children:"\u2600\ufe0f Light"})]}),(0,k.jsxs)("label",{className:"radio-option",children:[(0,k.jsx)("input",{type:"radio",name:"theme",value:"dark",checked:"dark"===r.theme,onChange:e=>v("theme",e.target.value)}),(0,k.jsx)("span",{children:"\ud83c\udf19 Dark"})]}),(0,k.jsxs)("label",{className:"radio-option",children:[(0,k.jsx)("input",{type:"radio",name:"theme",value:"auto",checked:"auto"===r.theme,onChange:e=>v("theme",e.target.value)}),(0,k.jsx)("span",{children:"\ud83d\udd04 Auto"})]})]})]}),(0,k.jsx)("div",{className:"pref-group",children:(0,k.jsxs)("label",{className:"checkbox-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:r.notifications,onChange:e=>v("notifications",e.target.checked)}),(0,k.jsx)("span",{children:"Enable Notifications"})]})})]}),"privacy"===g&&(0,k.jsxs)("div",{className:"privacy-tab",children:[(0,k.jsxs)("div",{className:"pref-group",children:[(0,k.jsx)("label",{children:"Profile Visibility"}),(0,k.jsxs)("select",{value:r.privacy,onChange:e=>v("privacy",e.target.value),children:[(0,k.jsx)("option",{value:"public",children:"\ud83c\udf10 Public"}),(0,k.jsx)("option",{value:"friends",children:"\ud83d\udc65 Friends Only"}),(0,k.jsx)("option",{value:"private",children:"\ud83d\udd12 Private"})]})]}),(0,k.jsxs)("div",{className:"privacy-info",children:[(0,k.jsx)("h4",{children:"Privacy Settings"}),(0,k.jsxs)("ul",{children:[(0,k.jsxs)("li",{children:[(0,k.jsx)("strong",{children:"Public:"})," Your profile is visible to everyone"]}),(0,k.jsxs)("li",{children:[(0,k.jsx)("strong",{children:"Friends Only:"})," Only your contacts can see your profile"]}),(0,k.jsxs)("li",{children:[(0,k.jsx)("strong",{children:"Private:"})," Your profile is hidden from others"]})]})]})]})]})]})}):null},I=e=>{let{isOpen:t,onClose:n,initialSection:s="general"}=e;const{user:i,updateUser:r}=C(),[o,l]=(0,a.useState)(s),[d,u]=(0,a.useState)({theme:"light",language:"en",timezone:"auto",notifications:{desktop:!0,sound:!0,vibration:!0,email:!1,newMessages:!0,mentions:!0,calls:!0},privacy:{profileVisibility:"friends",lastSeen:!0,readReceipts:!0,typing:!0,blockedUsers:[]},chat:{fontSize:"medium",enterToSend:!0,autoDownload:!0,encryption:!0,backupEnabled:!0},media:{autoPlayVideos:!0,autoDownloadImages:!0,quality:"high",compression:"auto"}}),[h,m]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&(()=>{try{const e=localStorage.getItem("quibish_settings");e&&u(t=>c(c({},t),JSON.parse(e))),i&&u(e=>c(c({},e),{},{theme:i.theme||e.theme,notifications:c(c({},e.notifications),i.notifications),privacy:c(c({},e.privacy),i.privacy)}))}catch(e){console.error("Error loading settings:",e)}})()},[t,i]);const p=(e,t,n)=>{u(a=>c(c({},a),{},{[e]:"object"!==typeof a[e]||Array.isArray(a[e])?n:c(c({},a[e]),{},{[t]:n})}))};return t?(0,k.jsx)("div",{className:"settings-modal-overlay",onClick:e=>e.target===e.currentTarget&&n(),children:(0,k.jsxs)("div",{className:"settings-modal",children:[(0,k.jsxs)("div",{className:"settings-header",children:[(0,k.jsx)("h2",{children:"Settings"}),(0,k.jsx)("button",{className:"close-btn",onClick:n,children:"\xd7"})]}),(0,k.jsxs)("div",{className:"settings-content",children:[(0,k.jsx)("div",{className:"settings-nav",children:[{id:"general",name:"General",icon:"\u2699\ufe0f"},{id:"notifications",name:"Notifications",icon:"\ud83d\udd14"},{id:"privacy",name:"Privacy",icon:"\ud83d\udd12"},{id:"chat",name:"Chat",icon:"\ud83d\udcac"},{id:"media",name:"Media",icon:"\ud83d\udcf1"},{id:"account",name:"Account",icon:"\ud83d\udc64"}].map(e=>(0,k.jsxs)("button",{className:"nav-item ".concat(o===e.id?"active":""),onClick:()=>l(e.id),children:[(0,k.jsx)("span",{className:"nav-icon",children:e.icon}),(0,k.jsx)("span",{className:"nav-text",children:e.name})]},e.id))}),(0,k.jsxs)("div",{className:"settings-panel",children:["general"===o&&(0,k.jsxs)("div",{className:"settings-section",children:[(0,k.jsx)("h3",{children:"General Settings"}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Theme"}),(0,k.jsxs)("select",{value:d.theme,onChange:e=>p("theme",null,e.target.value),children:[(0,k.jsx)("option",{value:"light",children:"Light"}),(0,k.jsx)("option",{value:"dark",children:"Dark"}),(0,k.jsx)("option",{value:"auto",children:"Auto (System)"})]})]}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Language"}),(0,k.jsxs)("select",{value:d.language,onChange:e=>p("language",null,e.target.value),children:[(0,k.jsx)("option",{value:"en",children:"English"}),(0,k.jsx)("option",{value:"es",children:"Espa\xf1ol"}),(0,k.jsx)("option",{value:"fr",children:"Fran\xe7ais"}),(0,k.jsx)("option",{value:"de",children:"Deutsch"})]})]}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Timezone"}),(0,k.jsxs)("select",{value:d.timezone,onChange:e=>p("timezone",null,e.target.value),children:[(0,k.jsx)("option",{value:"auto",children:"Auto-detect"}),(0,k.jsx)("option",{value:"UTC",children:"UTC"}),(0,k.jsx)("option",{value:"America/New_York",children:"Eastern Time"}),(0,k.jsx)("option",{value:"America/Los_Angeles",children:"Pacific Time"})]})]})]}),"notifications"===o&&(0,k.jsxs)("div",{className:"settings-section",children:[(0,k.jsx)("h3",{children:"Notification Settings"}),(0,k.jsx)("div",{className:"setting-group",children:(0,k.jsxs)("label",{className:"toggle-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:d.notifications.desktop,onChange:e=>p("notifications","desktop",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"}),"Desktop Notifications"]})}),(0,k.jsx)("div",{className:"setting-group",children:(0,k.jsxs)("label",{className:"toggle-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:d.notifications.sound,onChange:e=>p("notifications","sound",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"}),"Sound Notifications"]})}),(0,k.jsx)("div",{className:"setting-group",children:(0,k.jsxs)("label",{className:"toggle-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:d.notifications.newMessages,onChange:e=>p("notifications","newMessages",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"}),"New Messages"]})}),(0,k.jsx)("div",{className:"setting-group",children:(0,k.jsxs)("label",{className:"toggle-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:d.notifications.mentions,onChange:e=>p("notifications","mentions",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"}),"Mentions & Replies"]})})]}),"privacy"===o&&(0,k.jsxs)("div",{className:"settings-section",children:[(0,k.jsx)("h3",{children:"Privacy Settings"}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Profile Visibility"}),(0,k.jsxs)("select",{value:d.privacy.profileVisibility,onChange:e=>p("privacy","profileVisibility",e.target.value),children:[(0,k.jsx)("option",{value:"public",children:"Public"}),(0,k.jsx)("option",{value:"friends",children:"Friends Only"}),(0,k.jsx)("option",{value:"private",children:"Private"})]})]}),(0,k.jsx)("div",{className:"setting-group",children:(0,k.jsxs)("label",{className:"toggle-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:d.privacy.lastSeen,onChange:e=>p("privacy","lastSeen",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"}),"Show Last Seen"]})}),(0,k.jsx)("div",{className:"setting-group",children:(0,k.jsxs)("label",{className:"toggle-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:d.privacy.readReceipts,onChange:e=>p("privacy","readReceipts",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"}),"Read Receipts"]})})]}),"chat"===o&&(0,k.jsxs)("div",{className:"settings-section",children:[(0,k.jsx)("h3",{children:"Chat Settings"}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Font Size"}),(0,k.jsxs)("select",{value:d.chat.fontSize,onChange:e=>p("chat","fontSize",e.target.value),children:[(0,k.jsx)("option",{value:"small",children:"Small"}),(0,k.jsx)("option",{value:"medium",children:"Medium"}),(0,k.jsx)("option",{value:"large",children:"Large"}),(0,k.jsx)("option",{value:"extra-large",children:"Extra Large"})]})]}),(0,k.jsx)("div",{className:"setting-group",children:(0,k.jsxs)("label",{className:"toggle-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:d.chat.enterToSend,onChange:e=>p("chat","enterToSend",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"}),"Enter to Send Messages"]})}),(0,k.jsx)("div",{className:"setting-group",children:(0,k.jsxs)("label",{className:"toggle-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:d.chat.encryption,onChange:e=>p("chat","encryption",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"}),"End-to-End Encryption"]})})]}),"media"===o&&(0,k.jsxs)("div",{className:"settings-section",children:[(0,k.jsx)("h3",{children:"Media Settings"}),(0,k.jsx)("div",{className:"setting-group",children:(0,k.jsxs)("label",{className:"toggle-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:d.media.autoPlayVideos,onChange:e=>p("media","autoPlayVideos",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"}),"Auto-play Videos"]})}),(0,k.jsx)("div",{className:"setting-group",children:(0,k.jsxs)("label",{className:"toggle-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:d.media.autoDownloadImages,onChange:e=>p("media","autoDownloadImages",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"}),"Auto-download Images"]})}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Media Quality"}),(0,k.jsxs)("select",{value:d.media.quality,onChange:e=>p("media","quality",e.target.value),children:[(0,k.jsx)("option",{value:"low",children:"Low"}),(0,k.jsx)("option",{value:"medium",children:"Medium"}),(0,k.jsx)("option",{value:"high",children:"High"}),(0,k.jsx)("option",{value:"original",children:"Original"})]})]})]}),"account"===o&&(0,k.jsxs)("div",{className:"settings-section",children:[(0,k.jsx)("h3",{children:"Account Settings"}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Account Information"}),(0,k.jsxs)("div",{className:"account-info",children:[(0,k.jsxs)("p",{children:[(0,k.jsx)("strong",{children:"Name:"})," ",(null===i||void 0===i?void 0:i.name)||"Demo User"]}),(0,k.jsxs)("p",{children:[(0,k.jsx)("strong",{children:"Email:"})," ",(null===i||void 0===i?void 0:i.email)||"demo@quibish.com"]}),(0,k.jsxs)("p",{children:[(0,k.jsx)("strong",{children:"Status:"})," ",(null===i||void 0===i?void 0:i.status)||"Online"]})]})]}),(0,k.jsx)("div",{className:"setting-group",children:(0,k.jsx)("button",{className:"danger-btn",onClick:()=>{confirm("Are you sure you want to reset all settings to defaults?")&&(localStorage.removeItem("quibish_settings"),window.location.reload())},children:"Reset All Settings"})})]})]})]}),(0,k.jsxs)("div",{className:"settings-footer",children:[(0,k.jsx)("button",{className:"btn-secondary",onClick:n,children:"Cancel"}),(0,k.jsx)("button",{className:"btn-primary",onClick:async()=>{m(!0);try{localStorage.setItem("quibish_settings",JSON.stringify(d)),r&&i&&r(c(c({},i),{},{theme:d.theme,notifications:d.notifications,privacy:d.privacy})),document.documentElement.setAttribute("data-theme",d.theme),console.log("Settings saved successfully"),alert("Settings saved successfully!")}catch(e){console.error("Error saving settings:",e),alert("Failed to save settings. Please try again.")}finally{m(!1)}},disabled:h,children:h?"Saving...":"Save Settings"})]})]})}):null},P=e=>{let{isOpen:t,onClose:n,onGifSelect:s}=e;const[i,r]=(0,a.useState)(""),[o,l]=(0,a.useState)([]),[c,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)([]),m=[{id:"1",url:"https://media.giphy.com/media/3oKIPnAiaMCws8nOsE/giphy.gif",name:"Happy Dance",title:"Happy",size:1024e3,width:480,height:270},{id:"2",url:"https://media.giphy.com/media/l0MYrLAFex1R71l0A/giphy.gif",name:"Funny Cat",title:"Funny",size:856e3,width:480,height:360},{id:"3",url:"https://media.giphy.com/media/3o7TKTDn976rzVgky4/giphy.gif",name:"Excited Jump",title:"Excited",size:975e3,width:400,height:300},{id:"4",url:"https://media.giphy.com/media/l1J9u3TZfpmeDLkD6/giphy.gif",name:"Thumbs Up",title:"Approval",size:642e3,width:480,height:480},{id:"5",url:"https://media.giphy.com/media/3o7aD2saalBwwftBIY/giphy.gif",name:"Party Time",title:"Celebration",size:12e5,width:500,height:375},{id:"6",url:"https://media.giphy.com/media/26AHPxxnSw1L9T1rW/giphy.gif",name:"Mind Blown",title:"Surprised",size:89e4,width:480,height:270},{id:"7",url:"https://media.giphy.com/media/l3vR85PnGsBwu1PFK/giphy.gif",name:"Love Hearts",title:"Love",size:756e3,width:480,height:360},{id:"8",url:"https://media.giphy.com/media/3o6Zt0hNCfak3QCqsw/giphy.gif",name:"Crying Sad",title:"Sad",size:623e3,width:400,height:400}];(0,a.useEffect)(()=>{t&&(h(m),l(m))},[t]);const p=(0,a.useCallback)(async e=>{if(e.trim()){d(!0);try{const t=m.filter(t=>t.title.toLowerCase().includes(e.toLowerCase())||t.name.toLowerCase().includes(e.toLowerCase()));0===t.length?l(u.slice(0,3)):l(t)}catch(t){console.error("GIF search failed:",t),l(u.slice(0,3))}d(!1)}else l(u)},[u,m]);(0,a.useEffect)(()=>{const e=e=>{"Escape"===e.key&&n()};return t&&(document.addEventListener("keydown",e),setTimeout(()=>{const e=document.querySelector(".gif-search-input");e&&e.focus()},100)),()=>{document.removeEventListener("keydown",e)}},[t,n]);const g=e=>{console.log("GIF selected:",e),s(e),n()};return t?(0,k.jsx)("div",{className:"gif-picker-overlay",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,k.jsxs)("div",{className:"gif-picker-modal",children:[(0,k.jsxs)("div",{className:"gif-picker-header",children:[(0,k.jsx)("h3",{children:"Choose a GIF"}),(0,k.jsx)("button",{className:"close-btn",onClick:n,children:"\xd7"})]}),(0,k.jsx)("div",{className:"gif-search",children:(0,k.jsx)("input",{type:"text",placeholder:"Search for GIFs...",value:i,onChange:e=>{const t=e.target.value;r(t),window.gifSearchTimeout&&clearTimeout(window.gifSearchTimeout),window.gifSearchTimeout=setTimeout(()=>{p(t)},300)},className:"gif-search-input"})}),(0,k.jsx)("div",{className:"gif-grid",children:c?(0,k.jsxs)("div",{className:"gif-loading",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("p",{children:"Loading GIFs..."}),(0,k.jsx)("span",{children:"Finding the perfect reaction"})]}):o.length>0?o.map(e=>(0,k.jsxs)("div",{className:"gif-item",onClick:()=>g(e),role:"button",tabIndex:0,"aria-label":"Select ".concat(e.name||e.title," GIF"),onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),g(e))},children:[(0,k.jsx)("img",{src:e.url,alt:e.name||e.title,loading:"lazy",onError:e=>{e.target.style.display="none",e.target.parentElement.style.background="#f0f0f0",e.target.parentElement.innerHTML+='<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#999;font-size:12px;">Failed to load</div>'}}),(0,k.jsx)("div",{className:"gif-overlay",children:(0,k.jsx)("span",{children:e.name||e.title})})]},e.id)):(0,k.jsxs)("div",{className:"no-results",children:[(0,k.jsx)("p",{children:"No GIFs found"}),(0,k.jsx)("span",{children:"Try searching for something else"}),(0,k.jsx)("button",{className:"reset-search-btn",onClick:()=>{r(""),l(u)},children:"Show Trending"})]})}),!i&&(0,k.jsxs)("div",{className:"gif-categories",children:[(0,k.jsx)("h4",{children:"Popular Categories"}),(0,k.jsx)("div",{className:"category-buttons",children:["Happy","Funny","Love","Sad","Excited","Surprised","Celebration","Approval"].map(e=>(0,k.jsx)("button",{className:"category-btn",onClick:()=>{r(e),p(e)},children:e},e))})]})]})}):null};function D(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(-1!==t.indexOf(a))continue;n[a]=e[a]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}const A=new class{constructor(){this.isInitialized=!1,this.backupTypes=["localStorage","indexedDB","periodicBackup","emergencyBackup"]}async initialize(e){this.contactService=e;try{return await this.setupPersistenceLayers(),await this.performIntegrityCheck(),this.setupMonitoring(),this.isInitialized=!0,console.log("\ud83d\udee1\ufe0f Contact Persistence Manager initialized successfully"),{success:!0}}catch(t){return console.error("\u274c Failed to initialize Contact Persistence Manager:",t),{success:!1,error:t.message}}}async setupPersistenceLayers(){await this.contactService.setupIndexedDB(),this.setupAutomaticBackups(),this.setupCriticalSaveHandlers()}setupAutomaticBackups(){this.rapidBackupInterval=setInterval(()=>{this.contactService.isModified&&this.performRapidBackup()},3e4),this.fullBackupInterval=setInterval(()=>{this.performFullBackup()},3e5),this.cleanupInterval=setInterval(()=>{this.cleanupOldBackups()},36e5),console.log("\u23f0 Automatic backup systems activated")}setupCriticalSaveHandlers(){window.addEventListener("beforeunload",e=>{this.criticalSave("beforeunload")}),document.addEventListener("visibilitychange",()=>{document.hidden&&this.criticalSave("visibilitychange")}),window.addEventListener("blur",()=>{this.criticalSave("blur")}),document.addEventListener("freeze",()=>{this.criticalSave("freeze")}),window.addEventListener("pagehide",()=>{this.criticalSave("pagehide")}),window.addEventListener("online",()=>{this.handleConnectionRestored()}),window.addEventListener("offline",()=>{this.criticalSave("offline")}),console.log("\ud83d\udea8 Critical save handlers activated")}criticalSave(e){try{const t=(new Date).toISOString(),n=this.contactService.contacts,a=this.contactService.contactGroups;return localStorage.setItem("quibish_contacts",JSON.stringify(n)),localStorage.setItem("quibish_contacts_backup",JSON.stringify(n)),localStorage.setItem("quibish_critical_".concat(e,"_").concat(Date.now()),JSON.stringify({contacts:n,groups:a,timestamp:t,trigger:e})),localStorage.setItem("quibish_contact_groups",JSON.stringify(a)),localStorage.setItem("quibish_contact_groups_backup",JSON.stringify(a)),localStorage.setItem("quibish_last_critical_save",t),localStorage.setItem("quibish_last_save_trigger",e),console.log("\ud83d\udea8 Critical save completed (trigger: ".concat(e,") - ").concat(n.length," contacts protected")),!0}catch(t){console.error("\u274c Critical save failed (trigger: ".concat(e,"):"),t);try{localStorage.setItem("emergency_contacts_".concat(Date.now()),JSON.stringify(this.contactService.contacts)),console.log("\ud83c\udd98 Emergency backup created")}catch(n){console.error("\ud83c\udd98 Even emergency backup failed:",n)}return!1}}async performRapidBackup(){try{const e=this.contactService.contacts,t=this.contactService.contactGroups;await this.contactService.saveToIndexedDB("contacts",e),await this.contactService.saveToIndexedDB("groups",t);const n=(new Date).toISOString();localStorage.setItem("quibish_rapid_".concat(n.split("T")[0]),JSON.stringify({contacts:e,groups:t,timestamp:n,type:"rapid"})),console.log("\u26a1 Rapid backup completed")}catch(e){console.error("\u274c Rapid backup failed:",e)}}async performFullBackup(){try{const t=this.contactService.contacts,n=this.contactService.contactGroups,a=(new Date).toISOString(),s={contacts:t,groups:n,timestamp:a,type:"full",version:"1.0",metadata:{contactCount:t.length,groupCount:n.length,lastModified:this.contactService.lastModified||a}};localStorage.setItem("quibish_full_backup_".concat(a.split("T")[0]),JSON.stringify(s)),await this.contactService.saveToIndexedDB("fullBackup",[s]);try{await this.contactService.syncWithBackend()}catch(e){console.warn("\u26a0\ufe0f Backend sync failed during full backup:",e)}console.log("\ud83d\udce6 Full backup completed")}catch(t){console.error("\u274c Full backup failed:",t)}}async handleConnectionRestored(){console.log("\ud83c\udf10 Connection restored - attempting sync...");try{await this.contactService.syncWithBackend(),console.log("\u2705 Data synced with backend after connection restore")}catch(e){console.error("\u274c Sync failed after connection restore:",e)}}async performIntegrityCheck(){try{const e=await this.contactService.performDataIntegrityCheck();return e&&(console.log("\ud83d\udcca Data Integrity Check:",e),this.detectDataDiscrepancy(e)&&await this.attemptDataRecovery()),e}catch(e){return console.error("\u274c Integrity check failed:",e),null}}detectDataDiscrepancy(e){const t=[e.localStorage,e.backup,e.indexedDB,e.current],n=Math.max(...t);return n-Math.min(...t)>Math.max(.1*n,5)}async attemptDataRecovery(){console.log("\ud83d\udd27 Attempting data recovery...");try{const t=await this.gatherDataFromAllSources(),n=this.findBestDataSource(t);var e;if(n)return this.contactService.contacts=n.contacts,this.contactService.contactGroups=n.groups||[],this.contactService.saveContactsToStorage(),this.contactService.saveGroupsToStorage(),console.log("\u2705 Data recovered from ".concat(n.source," (").concat(n.contacts.length," contacts)")),window.dispatchEvent(new CustomEvent("contactDataRecovered",{detail:{source:n.source,contactCount:n.contacts.length,groupCount:(null===(e=n.groups)||void 0===e?void 0:e.length)||0}})),!0}catch(t){console.error("\u274c Data recovery failed:",t)}return!1}async gatherDataFromAllSources(){const e={};try{const t=localStorage.getItem("quibish_contacts");t&&(e.localStorage={contacts:JSON.parse(t),source:"localStorage"})}catch(t){console.warn("Failed to load from localStorage:",t)}try{const t=localStorage.getItem("quibish_contacts_backup");t&&(e.backup={contacts:JSON.parse(t),source:"backup"})}catch(t){console.warn("Failed to load from backup:",t)}try{const t=await this.contactService.loadFromIndexedDB("contacts");t.length>0&&(e.indexedDB={contacts:t,source:"indexedDB"})}catch(t){console.warn("Failed to load from IndexedDB:",t)}try{const t=Object.keys(localStorage);t.filter(e=>e.startsWith("quibish_critical_")||e.startsWith("emergency_contacts_")).forEach(t=>{try{const n=JSON.parse(localStorage.getItem(t));(n.contacts||Array.isArray(n))&&(e[t]={contacts:n.contacts||n,source:"emergency-".concat(t),timestamp:n.timestamp})}catch(n){console.warn("Failed to parse emergency backup ".concat(t,":"),n)}})}catch(t){console.warn("Failed to load emergency backups:",t)}return e}findBestDataSource(e){const t=Object.values(e);if(0===t.length)return null;return t.map(e=>c(c({},e),{},{score:this.calculateSourceScore(e)})).sort((e,t)=>t.score-e.score)[0]}calculateSourceScore(e){let t=0;if(t+=10*e.contacts.length,e.timestamp){const n=(Date.now()-new Date(e.timestamp).getTime())/36e5;t+=Math.max(0,100-n)}return t+={localStorage:100,backup:90,indexedDB:85}[e.source]||50,t}cleanupOldBackups(){try{const e=Object.keys(localStorage),t=Date.now()-6048e5;e.forEach(e=>{if(e.startsWith("quibish_backup_")||e.startsWith("quibish_critical_")||e.startsWith("quibish_rapid_")||e.startsWith("quibish_full_backup_"))try{const n=localStorage.getItem(e),a=JSON.parse(n);if(a.timestamp){new Date(a.timestamp).getTime()<t&&(localStorage.removeItem(e),console.log("\ud83e\uddf9 Cleaned up old backup: ".concat(e)))}}catch(n){localStorage.removeItem(e),console.log("\ud83e\uddf9 Removed corrupt backup: ".concat(e))}}),console.log("\ud83e\uddf9 Backup cleanup completed")}catch(e){console.error("\u274c Backup cleanup failed:",e)}}getPersistenceStatus(){return{initialized:this.isInitialized,backupTypes:this.backupTypes,lastCriticalSave:localStorage.getItem("quibish_last_critical_save"),lastSaveTrigger:localStorage.getItem("quibish_last_save_trigger"),storageAvailable:{localStorage:"undefined"!==typeof Storage,indexedDB:"indexedDB"in window,sessionStorage:"undefined"!==typeof sessionStorage}}}async manualBackup(){console.log("\ud83d\udd18 Manual backup triggered...");try{return await this.performFullBackup(),this.criticalSave("manual"),{success:!0,message:"Backup completed - ".concat(this.contactService.contacts.length," contacts saved")}}catch(e){return console.error("\u274c Manual backup failed:",e),{success:!1,error:e.message}}}destroy(){this.rapidBackupInterval&&clearInterval(this.rapidBackupInterval),this.fullBackupInterval&&clearInterval(this.fullBackupInterval),this.cleanupInterval&&clearInterval(this.cleanupInterval),this.criticalSave("destroy"),console.log("\ud83d\udee1\ufe0f Contact Persistence Manager destroyed - final backup completed")}},M=["timestamp"];const R=new class{constructor(){this.contacts=[],this.contactGroups=[],this.storageKey="quibish_contacts",this.groupStorageKey="quibish_contact_groups",this.backupKey="quibish_contacts_backup",this.groupBackupKey="quibish_contact_groups_backup",this.lastSyncKey="quibish_contacts_last_sync",this.autoSaveInterval=null,this.isModified=!1,this.lastModified=null,this.initializePersistence()}async initialize(){return await this.loadContactsFromStorage(),await this.loadGroupsFromStorage(),await A.initialize(this),console.log("\ud83d\udcf1 Contact Service initialized: ".concat(this.contacts.length," contacts, ").concat(this.contactGroups.length," groups")),{success:!0,contactCount:this.contacts.length,groupCount:this.contactGroups.length,persistenceEnabled:!0}}initializePersistence(){this.setupIndexedDB(),this.startAutoSave(),this.setupLifecycleHandlers(),this.markAsModified=()=>{this.isModified=!0,this.lastModified=(new Date).toISOString(),console.log("\ud83d\udd04 Contacts marked as modified")}}async setupIndexedDB(){try{return new Promise((e,t)=>{const n=indexedDB.open("quibishContacts",1);n.onerror=()=>t(n.error),n.onsuccess=()=>{this.db=n.result,console.log("\u2705 IndexedDB initialized successfully"),e(this.db)},n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("contacts")){t.createObjectStore("contacts",{keyPath:"id",autoIncrement:!0}).createIndex("timestamp","timestamp",{unique:!1})}if(!t.objectStoreNames.contains("groups")){t.createObjectStore("groups",{keyPath:"id",autoIncrement:!0}).createIndex("timestamp","timestamp",{unique:!1})}t.objectStoreNames.contains("metadata")||t.createObjectStore("metadata",{keyPath:"key"})}})}catch(e){console.error("\u274c Failed to setup IndexedDB:",e)}}async saveToIndexedDB(e,t){this.db||await this.setupIndexedDB();try{const n=this.db.transaction([e],"readwrite").objectStore(e);await new Promise((e,t)=>{const a=n.clear();a.onsuccess=()=>e(),a.onerror=()=>t(a.error)});for(const e of t)await new Promise((t,a)=>{const s=n.put(c(c({},e),{},{timestamp:(new Date).toISOString()}));s.onsuccess=()=>t(),s.onerror=()=>a(s.error)});console.log("\ud83d\udce6 Saved ".concat(t.length," items to IndexedDB (").concat(e,")"))}catch(n){console.error("\u274c Failed to save to IndexedDB (".concat(e,"):"),n)}}async loadFromIndexedDB(e){this.db||await this.setupIndexedDB();try{return new Promise((t,n)=>{const a=this.db.transaction([e],"readonly").objectStore(e).getAll();a.onsuccess=()=>{const n=a.result.map(e=>{const{timestamp:t}=e;return D(e,M)});console.log("\ud83d\udce6 Loaded ".concat(n.length," items from IndexedDB (").concat(e,")")),t(n)},a.onerror=()=>n(a.error)})}catch(t){return console.error("\u274c Failed to load from IndexedDB (".concat(e,"):"),t),[]}}startAutoSave(){this.autoSaveInterval&&clearInterval(this.autoSaveInterval),this.autoSaveInterval=setInterval(()=>{this.isModified&&(console.log("\ud83d\udd04 Auto-saving contacts..."),this.saveContactsToStorage(),this.saveGroupsToStorage())},5e3),console.log("\u23f0 Auto-save mechanism started")}setupLifecycleHandlers(){window.addEventListener("beforeunload",()=>{this.emergencySave()}),document.addEventListener("visibilitychange",()=>{document.hidden&&this.emergencySave()}),window.addEventListener("blur",()=>{this.emergencySave()}),setInterval(()=>{this.createPeriodicBackup()},6e4),console.log("\ud83d\udee1\ufe0f Lifecycle handlers setup for data protection")}emergencySave(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.contacts)),localStorage.setItem(this.groupStorageKey,JSON.stringify(this.contactGroups)),localStorage.setItem("".concat(this.storageKey,"_emergency_").concat(Date.now()),JSON.stringify(this.contacts)),localStorage.setItem("quibish_last_emergency_save",(new Date).toISOString()),console.log("\ud83d\udea8 Emergency save completed")}catch(e){console.error("\u274c Emergency save failed:",e)}}async createPeriodicBackup(){try{const e=(new Date).toISOString(),t={contacts:this.contacts,groups:this.contactGroups,timestamp:e};localStorage.setItem("quibish_backup_".concat(e.split("T")[0]),JSON.stringify(t)),this.cleanOldBackups(),console.log("\ud83d\udcc5 Periodic backup created")}catch(e){console.error("\u274c Periodic backup failed:",e)}}cleanOldBackups(){try{const e=Object.keys(localStorage);e.filter(e=>e.startsWith("quibish_backup_")).sort().slice(0,-7).forEach(e=>{localStorage.removeItem(e)})}catch(e){console.error("\u274c Backup cleanup failed:",e)}}notifyDataRecoveryIssue(){const e="Warning: Contact data could not be fully recovered. Some contacts may be missing.";console.warn("\u26a0\ufe0f",e),window.dispatchEvent(new CustomEvent("contactDataRecoveryIssue",{detail:{message:e}}))}async performDataIntegrityCheck(){try{const e=localStorage.getItem(this.storageKey),t=localStorage.getItem(this.backupKey),n=await this.loadFromIndexedDB("contacts"),a={localStorage:e?JSON.parse(e).length:0,backup:t?JSON.parse(t).length:0,indexedDB:n.length,current:this.contacts.length};return console.log("\ud83d\udcca Data integrity report:",a),a}catch(e){return console.error("\u274c Data integrity check failed:",e),null}}async getContacts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{search:t,group:n,limit:a=100,offset:s=0}=e;try{const e=await fetch("/api/contacts?limit=".concat(a,"&offset=").concat(s).concat(t?"&search=".concat(encodeURIComponent(t)):"").concat(n?"&group=".concat(encodeURIComponent(n)):""),{headers:{Authorization:"Bearer ".concat(await u.getTokenForRequest())}});if(e.ok){const t=await e.json();if(t.success)return this.contacts=t.contacts,this.saveContactsToStorage(),this.contacts}}catch(i){console.warn("API unavailable, using local contacts:",i)}return this.filterContacts(this.contacts,{search:t,group:n})}filterContacts(e,t){let{search:n,group:a}=t,s=[...e];if(n){const e=n.toLowerCase();s=s.filter(t=>{var a,s,i;return(null===(a=t.name)||void 0===a?void 0:a.toLowerCase().includes(e))||(null===(s=t.email)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(i=t.phone)||void 0===i?void 0:i.includes(n))})}return a&&(s=s.filter(e=>{var t;return null===(t=e.groups)||void 0===t?void 0:t.includes(a)})),s.sort((e,t)=>e.name.localeCompare(t.name))}async addContact(e){try{const n=c({id:Date.now().toString(),createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},e),a=this.validateContact(n);if(!a.valid)return{success:!1,errors:a.errors};try{const e=await fetch("/api/contacts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(await u.getTokenForRequest())},body:JSON.stringify(n)});if(!e.ok){const t=await e.json();return{success:!1,errors:t.errors||[t.error||"Unknown error"]}}{const t=await e.json();if(t.success)return this.contacts.push(t.contact),this.saveContactsToStorage(),this.markAsModified(),{success:!0,contact:t.contact}}}catch(t){console.warn("API unavailable, saving locally:",t)}return this.contacts.push(n),this.saveContactsToStorage(),this.markAsModified(),{success:!0,contact:n,offline:!0}}catch(n){return console.error("Failed to add contact:",n),{success:!1,error:n.message}}}async updateContact(e,t){try{const a=this.contacts.findIndex(t=>t.id===e);if(-1===a)return{success:!1,error:"Contact not found"};const s=c(c(c({},this.contacts[a]),t),{},{updatedAt:(new Date).toISOString()}),i=this.validateContact(s);if(!i.valid)return{success:!1,errors:i.errors};try{const t=await fetch("/api/contacts/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(await u.getTokenForRequest())},body:JSON.stringify(s)});if(!t.ok){const e=await t.json();return{success:!1,errors:e.errors||[e.error||"Unknown error"]}}{const e=await t.json();if(e.success)return this.contacts[a]=e.contact,this.saveContactsToStorage(),this.markAsModified(),{success:!0,contact:e.contact}}}catch(n){console.warn("API unavailable, updating locally:",n)}return this.contacts[a]=s,this.saveContactsToStorage(),this.markAsModified(),{success:!0,contact:s,offline:!0}}catch(a){return console.error("Failed to update contact:",a),{success:!1,error:a.message}}}async deleteContact(e){try{const n=this.contacts.findIndex(t=>t.id===e);if(-1===n)return{success:!1,error:"Contact not found"};try{const t=await fetch("/api/contacts/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(await u.getTokenForRequest())}});if(!t.ok){return{success:!1,error:(await t.json()).error||"Unknown error"}}if((await t.json()).success)return this.contacts.splice(n,1),this.saveContactsToStorage(),this.markAsModified(),{success:!0}}catch(t){console.warn("API unavailable, deleting locally:",t)}return this.contacts.splice(n,1),this.saveContactsToStorage(),this.markAsModified(),{success:!0,offline:!0}}catch(n){return console.error("Failed to delete contact:",n),{success:!1,error:n.message}}}async toggleFavorite(e){const t=this.contacts.find(t=>t.id===e);return t?this.updateContact(e,{favorite:!t.favorite}):{success:!1,error:"Contact not found"}}async toggleBlock(e){const t=this.contacts.find(t=>t.id===e);return t?this.updateContact(e,{blocked:!t.blocked}):{success:!1,error:"Contact not found"}}validateContact(e){const t=[];return(!e.name||e.name.trim().length<1)&&t.push("Name is required"),e.email&&!this.isValidEmail(e.email)&&t.push("Invalid email format"),e.phone&&!this.isValidPhone(e.phone)&&t.push("Invalid phone format"),e.name&&e.name.length>100&&t.push("Name must be less than 100 characters"),{valid:0===t.length,errors:t}}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidPhone(e){return/^[+]?[1-9][\d]{0,15}$/.test(e.replace(/[\s\-()]/g,""))}createGroup(e){const t=c({id:Date.now().toString(),createdAt:(new Date).toISOString()},e);return this.contactGroups.push(t),this.saveGroupsToStorage(),{success:!0,group:t}}getGroups(){return this.contactGroups}addContactToGroup(e,t){const n=this.contacts.find(t=>t.id===e);return n?(n.groups||(n.groups=[]),n.groups.includes(t)||(n.groups.push(t),this.saveContactsToStorage()),{success:!0}):{success:!1,error:"Contact not found"}}removeContactFromGroup(e,t){const n=this.contacts.find(t=>t.id===e);return n&&n.groups?(n.groups=n.groups.filter(e=>e!==t),this.saveContactsToStorage(),{success:!0}):{success:!1,error:"Contact or group not found"}}async importFromDevice(){if(!("contacts"in navigator)||!("ContactsManager"in window))return{success:!1,error:"Contact API not supported"};try{const a=["name","email","tel"],s={multiple:!0},i=await navigator.contacts.select(a,s),r=[];for(const o of i){var e,t,n;const a={name:(null===(e=o.name)||void 0===e?void 0:e[0])||"Unknown",email:null===(t=o.email)||void 0===t?void 0:t[0],phone:null===(n=o.tel)||void 0===n?void 0:n[0]},s=await this.addContact(a);s.success&&r.push(s.contact)}return{success:!0,imported:r.length,contacts:r}}catch(a){return{success:!1,error:a.message}}}exportContacts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"json";try{let t,n,a;if("csv"===e)t=this.contactsToCSV(),n="contacts.csv",a="text/csv";else t=JSON.stringify(this.contacts,null,2),n="contacts.json",a="application/json";const s=new Blob([t],{type:a}),i=URL.createObjectURL(s),r=document.createElement("a");return r.href=i,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),{success:!0}}catch(t){return console.error("Failed to export contacts:",t),{success:!1,error:t.message}}}contactsToCSV(){return[["Name","Email","Phone","Created At"],...this.contacts.map(e=>[e.name||"",e.email||"",e.phone||"",e.createdAt||""])].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")}saveContactsToStorage(){try{const e=JSON.stringify(this.contacts);return localStorage.setItem(this.storageKey,e),localStorage.setItem(this.backupKey,e),this.saveToIndexedDB("contacts",this.contacts),localStorage.setItem(this.lastSyncKey,(new Date).toISOString()),this.isModified=!1,console.log("\u2705 Contacts saved successfully to multiple storage layers"),!0}catch(e){console.error("\u274c Failed to save contacts to storage:",e);try{localStorage.setItem("".concat(this.storageKey,"_emergency"),JSON.stringify(this.contacts)),console.log("\ud83d\udcbe Emergency backup created")}catch(t){console.error("\u274c Emergency backup failed:",t)}return!1}}async loadContactsFromStorage(){try{let t=localStorage.getItem(this.storageKey),n="primary";if(t||(t=localStorage.getItem(this.backupKey),n="backup",console.log("\ud83d\udcc1 Loading contacts from backup storage")),!t)try{const e=await this.loadFromIndexedDB("contacts");if(e&&e.length>0)return this.contacts=e,n="indexeddb",console.log("\ud83d\uddc4\ufe0f Contacts recovered from IndexedDB"),void this.saveContactsToStorage()}catch(e){console.warn("\u26a0\ufe0f IndexedDB recovery failed:",e)}if(t||(t=localStorage.getItem("".concat(this.storageKey,"_emergency")),n="emergency",console.log("\ud83d\udea8 Loading contacts from emergency backup")),t){const e=JSON.parse(t);this.contacts=Array.isArray(e)?e:[],console.log("\u2705 Loaded ".concat(this.contacts.length," contacts from ").concat(n," storage")),"primary"!==n&&(this.saveContactsToStorage(),console.log("\ud83d\udd04 Contacts restored to primary storage"))}else console.log("\ud83d\udcdd No contacts found, starting with empty list"),this.contacts=[]}catch(t){console.error("\u274c Failed to load contacts from any storage:",t),this.contacts=[],this.notifyDataRecoveryIssue()}}saveGroupsToStorage(){try{const e=JSON.stringify(this.contactGroups);return localStorage.setItem(this.groupStorageKey,e),localStorage.setItem(this.groupBackupKey,e),this.saveToIndexedDB("groups",this.contactGroups),console.log("\u2705 Contact groups saved successfully"),!0}catch(e){console.error("\u274c Failed to save groups to storage:",e);try{localStorage.setItem("".concat(this.groupStorageKey,"_emergency"),JSON.stringify(this.contactGroups))}catch(t){console.error("\u274c Emergency group backup failed:",t)}return!1}}async loadGroupsFromStorage(){try{let t=localStorage.getItem(this.groupStorageKey),n="primary";if(t||(t=localStorage.getItem(this.groupBackupKey),n="backup"),!t)try{const e=await this.loadFromIndexedDB("groups");if(e&&e.length>0)return this.contactGroups=e,void this.saveGroupsToStorage()}catch(e){console.warn("\u26a0\ufe0f IndexedDB group recovery failed:",e)}if(t||(t=localStorage.getItem("".concat(this.groupStorageKey,"_emergency")),n="emergency"),t){const e=JSON.parse(t);this.contactGroups=Array.isArray(e)?e:[],console.log("\u2705 Loaded ".concat(this.contactGroups.length," contact groups from ").concat(n," storage")),"primary"!==n&&this.saveGroupsToStorage()}else this.contactGroups=[]}catch(t){console.error("\u274c Failed to load groups from storage:",t),this.contactGroups=[]}}getStatistics(){const e=this.contacts.length,t=this.contacts.filter(e=>e.email).length,n=this.contacts.filter(e=>e.phone).length;return{total:e,withEmail:t,withPhone:n,groups:this.contactGroups.length,emailPercentage:e>0?Math.round(t/e*100):0,phonePercentage:e>0?Math.round(n/e*100):0}}},F=e=>{let{isOpen:t,onClose:n,onCreateChat:s}=e;const[i,r]=(0,a.useState)("direct"),[o,l]=(0,a.useState)([]),[c,d]=(0,a.useState)(""),[u,h]=(0,a.useState)(""),[m,p]=(0,a.useState)([]),[g,f]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&v()},[t]);const v=async()=>{f(!0);try{const e=await R.getContacts({search:u});p(e)}catch(e){console.error("Failed to load contacts:",e),p([])}f(!1)},y=e=>{l("direct"===i?[e]:t=>t.find(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])},b=()=>{r("direct"),l([]),d(""),h(""),n()};return t?(0,k.jsx)("div",{className:"new-chat-overlay",onClick:e=>{e.target===e.currentTarget&&b()},children:(0,k.jsxs)("div",{className:"new-chat-modal",children:[(0,k.jsxs)("div",{className:"new-chat-header",children:[(0,k.jsx)("h3",{children:"Start New Chat"}),(0,k.jsx)("button",{className:"close-btn",onClick:b,children:"\xd7"})]}),(0,k.jsx)("div",{className:"chat-type-selector",children:(0,k.jsxs)("div",{className:"chat-type-tabs",children:[(0,k.jsx)("button",{className:"tab ".concat("direct"===i?"active":""),onClick:()=>r("direct"),children:"Direct Message"}),(0,k.jsx)("button",{className:"tab ".concat("group"===i?"active":""),onClick:()=>r("group"),children:"Group Chat"})]})}),"group"===i&&(0,k.jsx)("div",{className:"group-settings",children:(0,k.jsx)("input",{type:"text",placeholder:"Enter group name...",value:c,onChange:e=>d(e.target.value),className:"group-name-input"})}),(0,k.jsx)("div",{className:"contact-search",children:(0,k.jsx)("input",{type:"text",placeholder:"Search contacts...",value:u,onChange:e=>{h(e.target.value),setTimeout(()=>v(),300)},className:"contact-search-input"})}),(0,k.jsx)("div",{className:"selected-contacts",children:o.length>0&&(0,k.jsxs)("div",{className:"selected-list",children:[(0,k.jsxs)("h4",{children:["Selected (",o.length,"):"]}),(0,k.jsx)("div",{className:"selected-items",children:o.map(e=>(0,k.jsxs)("div",{className:"selected-contact",children:[(0,k.jsx)("span",{children:e.name}),(0,k.jsx)("button",{onClick:()=>y(e),className:"remove-btn",children:"\xd7"})]},e.id))})]})}),(0,k.jsx)("div",{className:"contact-list",children:g?(0,k.jsxs)("div",{className:"loading-state",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("p",{children:"Loading contacts..."})]}):m.length>0?(0,k.jsx)("div",{className:"contacts",children:m.map(e=>{const t=o.find(t=>t.id===e.id);return(0,k.jsxs)("div",{className:"contact-item ".concat(t?"selected":""),onClick:()=>y(e),children:[(0,k.jsx)("div",{className:"contact-avatar",children:e.avatar?(0,k.jsx)("img",{src:e.avatar,alt:e.name}):(0,k.jsx)("div",{className:"avatar-placeholder",children:e.name.charAt(0).toUpperCase()})}),(0,k.jsxs)("div",{className:"contact-info",children:[(0,k.jsx)("h4",{children:e.name}),e.email&&(0,k.jsx)("p",{className:"contact-email",children:e.email}),e.phone&&(0,k.jsx)("p",{className:"contact-phone",children:e.phone})]}),(0,k.jsx)("div",{className:"contact-actions",children:t?(0,k.jsx)("div",{className:"selected-indicator",children:"\u2713"}):(0,k.jsx)("div",{className:"select-indicator",children:"+"})})]},e.id)})}):(0,k.jsxs)("div",{className:"no-contacts",children:[(0,k.jsx)("p",{children:"No contacts found"}),(0,k.jsx)("span",{children:"Try adjusting your search or add some contacts first"})]})}),(0,k.jsxs)("div",{className:"new-chat-footer",children:[(0,k.jsx)("button",{className:"cancel-btn",onClick:b,children:"Cancel"}),(0,k.jsx)("button",{className:"create-btn",onClick:()=>{if(0===o.length)return void alert("Please select at least one contact");if("group"===i&&!c.trim())return void alert("Please enter a group name");const e={type:i,participants:o,name:"group"===i?c:null,createdAt:(new Date).toISOString()};s(e),b()},disabled:0===o.length,children:"direct"===i?"Start Chat":"Create Group"})]})]})}):null};const L=new class{constructor(){this.feedbackHistory=[],this.feedbackCategories=["bug_report","feature_request","improvement","ui_ux","performance","general"],this.apiEndpoint="/api/feedback"}async submitFeedback(e){try{const n=c(c({id:Date.now().toString(),timestamp:(new Date).toISOString()},e),{},{status:"submitted"}),a=this.validateFeedback(n);if(!a.valid)return{success:!1,errors:a.errors};try{const e=await fetch(this.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(e.ok){const t=await e.json();return this.feedbackHistory.push(n),{success:!0,feedbackId:t.id||n.id,message:"Feedback submitted successfully"}}}catch(t){console.warn("API submission failed, storing locally:",t)}return this.feedbackHistory.push(n),this.saveFeedbackToStorage(),{success:!0,feedbackId:n.id,message:"Feedback saved locally",offline:!0}}catch(n){return console.error("Feedback submission failed:",n),{success:!1,error:n.message}}}getFeedback(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{category:t,status:n,limit:a=50}=e;let s=[...this.feedbackHistory];return t&&(s=s.filter(e=>e.category===t)),n&&(s=s.filter(e=>e.status===n)),s.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)),s.slice(0,a)}validateFeedback(e){const t=[];return(!e.title||e.title.trim().length<3)&&t.push("Title must be at least 3 characters long"),(!e.description||e.description.trim().length<10)&&t.push("Description must be at least 10 characters long"),e.category&&this.feedbackCategories.includes(e.category)||t.push("Invalid category selected"),e.title&&e.title.length>200&&t.push("Title must be less than 200 characters"),e.description&&e.description.length>2e3&&t.push("Description must be less than 2000 characters"),{valid:0===t.length,errors:t}}saveFeedbackToStorage(){try{localStorage.setItem("quibish_feedback",JSON.stringify(this.feedbackHistory))}catch(e){console.error("Failed to save feedback to storage:",e)}}loadFeedbackFromStorage(){try{const e=localStorage.getItem("quibish_feedback");e&&(this.feedbackHistory=JSON.parse(e))}catch(e){console.error("Failed to load feedback from storage:",e),this.feedbackHistory=[]}}getCategories(){return this.feedbackCategories.map(e=>({id:e,name:this.formatCategoryName(e),description:this.getCategoryDescription(e)}))}formatCategoryName(e){return e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}getCategoryDescription(e){return{bug_report:"Report bugs, errors, or unexpected behavior",feature_request:"Suggest new features or functionality",improvement:"Suggest improvements to existing features",ui_ux:"Feedback about user interface and user experience",performance:"Report performance issues or slow loading",general:"General feedback and suggestions"}[e]||"General feedback"}async updateFeedbackStatus(e,t){try{const a=this.feedbackHistory.find(t=>t.id===e);if(!a)return{success:!1,error:"Feedback not found"};a.status=t,a.lastUpdated=(new Date).toISOString();try{if((await fetch("".concat(this.apiEndpoint,"/").concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})})).ok)return this.saveFeedbackToStorage(),{success:!0}}catch(n){console.warn("Failed to update feedback on server:",n)}return this.saveFeedbackToStorage(),{success:!0,offline:!0}}catch(a){return console.error("Failed to update feedback status:",a),{success:!1,error:a.message}}}deleteFeedback(e){try{const t=this.feedbackHistory.findIndex(t=>t.id===e);return-1===t?{success:!1,error:"Feedback not found"}:(this.feedbackHistory.splice(t,1),this.saveFeedbackToStorage(),{success:!0})}catch(t){return console.error("Failed to delete feedback:",t),{success:!1,error:t.message}}}getStatistics(){const e=this.feedbackHistory.length,t={},n={};return this.feedbackCategories.forEach(e=>{t[e]=0}),this.feedbackHistory.forEach(e=>{t.hasOwnProperty(e.category)&&t[e.category]++,n[e.status]?n[e.status]++:n[e.status]=1}),{total:e,byCategory:t,byStatus:n,averagePerDay:this.calculateAveragePerDay()}}calculateAveragePerDay(){if(0===this.feedbackHistory.length)return 0;const e=this.feedbackHistory.map(e=>new Date(e.timestamp).toDateString()),t=[...new Set(e)];return this.feedbackHistory.length/t.length}initialize(){return this.loadFeedbackFromStorage(),{success:!0,feedbackCount:this.feedbackHistory.length,categories:this.getCategories()}}},z=e=>{let{isOpen:t,onClose:n}=e;const[s,i]=(0,a.useState)({title:"",description:"",category:"general",priority:"medium",email:""}),[r,o]=(0,a.useState)(!1),[l,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)([]),m=L.getCategories(),p=e=>{const{name:t,value:n}=e.target;i(e=>c(c({},e),{},{[t]:n})),u.length>0&&h([])},g=()=>{i({title:"",description:"",category:"general",priority:"medium",email:""}),h([]),d(!1),n()};return t?(0,k.jsx)("div",{className:"feedback-overlay",onClick:e=>{e.target===e.currentTarget&&g()},children:(0,k.jsxs)("div",{className:"feedback-modal",children:[(0,k.jsxs)("div",{className:"feedback-header",children:[(0,k.jsx)("h3",{children:"Send Feedback"}),(0,k.jsx)("button",{className:"close-btn",onClick:g,children:"\xd7"})]}),l?(0,k.jsxs)("div",{className:"success-message",children:[(0,k.jsx)("div",{className:"success-icon",children:"\u2713"}),(0,k.jsx)("h4",{children:"Thank you for your feedback!"}),(0,k.jsx)("p",{children:"We appreciate your input and will review it carefully."})]}):(0,k.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),o(!0),h([]);try{const e=await L.submitFeedback(s);e.success?(d(!0),i({title:"",description:"",category:"general",priority:"medium",email:""}),setTimeout(()=>{g()},2e3)):h(e.errors||["Failed to submit feedback"])}catch(t){h(["An unexpected error occurred. Please try again."])}o(!1)},className:"feedback-form",children:[u.length>0&&(0,k.jsx)("div",{className:"error-messages",children:u.map((e,t)=>(0,k.jsx)("div",{className:"error-message",children:e},t))}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{htmlFor:"title",children:"Subject *"}),(0,k.jsx)("input",{type:"text",id:"title",name:"title",value:s.title,onChange:p,placeholder:"Brief description of your feedback...",required:!0,maxLength:200}),(0,k.jsxs)("span",{className:"char-count",children:[s.title.length,"/200"]})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{htmlFor:"category",children:"Category *"}),(0,k.jsx)("select",{id:"category",name:"category",value:s.category,onChange:p,required:!0,children:m.map(e=>(0,k.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{htmlFor:"priority",children:"Priority"}),(0,k.jsxs)("select",{id:"priority",name:"priority",value:s.priority,onChange:p,children:[(0,k.jsx)("option",{value:"low",children:"Low"}),(0,k.jsx)("option",{value:"medium",children:"Medium"}),(0,k.jsx)("option",{value:"high",children:"High"}),(0,k.jsx)("option",{value:"urgent",children:"Urgent"})]})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{htmlFor:"description",children:"Description *"}),(0,k.jsx)("textarea",{id:"description",name:"description",value:s.description,onChange:p,placeholder:"Please provide detailed feedback...",required:!0,rows:5,maxLength:2e3}),(0,k.jsxs)("span",{className:"char-count",children:[s.description.length,"/2000"]})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{htmlFor:"email",children:"Email (optional)"}),(0,k.jsx)("input",{type:"email",id:"email",name:"email",value:s.email,onChange:p,placeholder:"your.email@example.com"}),(0,k.jsx)("small",{children:"We'll only use this to follow up on your feedback if needed."})]}),(0,k.jsxs)("div",{className:"form-footer",children:[(0,k.jsx)("button",{type:"button",className:"cancel-btn",onClick:g,disabled:r,children:"Cancel"}),(0,k.jsx)("button",{type:"submit",className:"submit-btn",disabled:r||!s.title.trim()||!s.description.trim(),children:r?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("span",{className:"loading-spinner"}),"Sending..."]}):"Send Feedback"})]})]})]})}):null},O=e=>{let{isOpen:t,onClose:n}=e;const[s,i]=(0,a.useState)("getting-started"),[r,o]=(0,a.useState)(""),l={"getting-started":{title:"Getting Started",icon:"\ud83d\ude80",content:[{question:"How do I start a new chat?",answer:'Click the "New Chat" button in the sidebar or use the \u2795 icon in the header. You can start direct messages or create group chats with multiple contacts.'},{question:"How do I add contacts?",answer:'Go to the Contacts section and click "Add Contact". You can manually add contacts or import them from your device if supported.'},{question:"How do I send my first message?",answer:"Select a conversation from the sidebar, type your message in the input field at the bottom, and press Enter or click the send button."}]},messaging:{title:"Messaging Features",icon:"\ud83d\udcac",content:[{question:"How do I send files and images?",answer:"Click the attachment icon (\ud83d\udcce) next to the message input. You can send images, documents, videos, and other file types."},{question:"How do I add reactions to messages?",answer:"Hover over a message and click the reaction button, or long-press on mobile. Choose from available emoji reactions."},{question:"Can I edit or delete messages?",answer:"Yes! Click the three dots menu on any message to edit, delete, or perform other actions on your messages."},{question:"How do I search for messages?",answer:"Use the search icon in the header to search through your conversation history. You can search by text content or contact names."}]},"voice-video":{title:"Voice & Video Calls",icon:"\ud83d\udcde",content:[{question:"How do I start a voice call?",answer:"In any conversation, click the phone icon to start a voice call. Make sure you have microphone permissions enabled."},{question:"How do I start a video call?",answer:"Click the video camera icon in the conversation header. Ensure your camera and microphone permissions are granted."},{question:"Can I mute myself during a call?",answer:"Yes, use the mute button during any call to toggle your microphone on/off. Other participants will see a mute indicator."},{question:"How do voice calls work?",answer:"All voice and video calls use secure internet-based connections through WebRTC technology for the best quality and privacy."}]},settings:{title:"Settings & Customization",icon:"\u2699\ufe0f",content:[{question:"How do I change my profile picture?",answer:"Go to your user profile settings and click on your current avatar. Upload a new image to change your profile picture across all conversations."},{question:"Can I enable dark mode?",answer:"Yes! Look for the theme toggle in your settings or profile menu. Dark mode helps reduce eye strain in low-light environments."},{question:"How do I manage notifications?",answer:"Access notification settings through the main settings menu. You can customize notification sounds, frequency, and which events trigger notifications."},{question:"Is my data encrypted?",answer:"Yes, Quibish uses end-to-end encryption for your messages and calls to ensure your privacy and security."}]},troubleshooting:{title:"Troubleshooting",icon:"\ud83d\udd27",content:[{question:"Messages are not sending",answer:"Check your internet connection. If offline, messages will be saved and sent when you reconnect. Try refreshing the page if issues persist."},{question:"Voice/video calls not working",answer:"Ensure microphone and camera permissions are granted. Check your browser settings and try using a different browser if problems continue."},{question:"App is running slowly",answer:"Clear your browser cache, close other tabs, or restart your browser. Large conversation histories may impact performance."},{question:"I lost my conversation history",answer:"Conversation history is stored locally and on our servers. Try logging out and back in, or contact support if data appears to be missing."}]},privacy:{title:"Privacy & Security",icon:"\ud83d\udd12",content:[{question:"How is my data protected?",answer:"We use industry-standard encryption, secure servers, and follow best practices for data protection. Your conversations are private and secure."},{question:"Who can see my profile information?",answer:"Only your contacts can see your profile information. You control what information is shared and with whom."},{question:"Can I delete my account?",answer:"Yes, you can delete your account and all associated data through the account settings. This action is permanent and cannot be undone."},{question:"How do I report inappropriate content?",answer:"Use the report function on any message or contact. Our moderation team reviews all reports and takes appropriate action."}]}};if(!t)return null;const d=(()=>{if(!r.trim())return l[s].content;return Object.values(l).flatMap(e=>e.content.map(t=>c(c({},t),{},{section:e.title}))).filter(e=>e.question.toLowerCase().includes(r.toLowerCase())||e.answer.toLowerCase().includes(r.toLowerCase()))})();return(0,k.jsx)("div",{className:"help-overlay",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,k.jsxs)("div",{className:"help-modal",children:[(0,k.jsxs)("div",{className:"help-header",children:[(0,k.jsx)("h3",{children:"Help & Support"}),(0,k.jsx)("button",{className:"close-btn",onClick:n,children:"\xd7"})]}),(0,k.jsx)("div",{className:"help-search",children:(0,k.jsx)("input",{type:"text",placeholder:"Search help topics...",value:r,onChange:e=>o(e.target.value),className:"help-search-input"})}),(0,k.jsxs)("div",{className:"help-content",children:[!r&&(0,k.jsx)("div",{className:"help-sidebar",children:(0,k.jsx)("nav",{className:"help-nav",children:Object.entries(l).map(e=>{let[t,n]=e;return(0,k.jsxs)("button",{className:"nav-item ".concat(s===t?"active":""),onClick:()=>i(t),children:[(0,k.jsx)("span",{className:"nav-icon",children:n.icon}),(0,k.jsx)("span",{className:"nav-title",children:n.title})]},t)})})}),(0,k.jsx)("div",{className:"help-main ".concat(r?"search-mode":""),children:r?(0,k.jsxs)("div",{className:"search-results",children:[(0,k.jsxs)("h4",{children:["Search Results (",d.length,")"]}),d.length>0?(0,k.jsx)("div",{className:"faq-list",children:d.map((e,t)=>(0,k.jsxs)("div",{className:"faq-item",children:[e.section&&(0,k.jsx)("div",{className:"faq-section",children:e.section}),(0,k.jsx)("h5",{className:"faq-question",children:e.question}),(0,k.jsx)("p",{className:"faq-answer",children:e.answer})]},t))}):(0,k.jsxs)("div",{className:"no-results",children:[(0,k.jsxs)("p",{children:['No results found for "',r,'"']}),(0,k.jsx)("span",{children:"Try different keywords or browse categories"})]})]}):(0,k.jsxs)("div",{className:"section-content",children:[(0,k.jsxs)("div",{className:"section-header",children:[(0,k.jsx)("span",{className:"section-icon",children:l[s].icon}),(0,k.jsx)("h4",{children:l[s].title})]}),(0,k.jsx)("div",{className:"faq-list",children:l[s].content.map((e,t)=>(0,k.jsxs)("div",{className:"faq-item",children:[(0,k.jsx)("h5",{className:"faq-question",children:e.question}),(0,k.jsx)("p",{className:"faq-answer",children:e.answer})]},t))})]})})]}),(0,k.jsx)("div",{className:"help-footer",children:(0,k.jsxs)("div",{className:"footer-content",children:[(0,k.jsx)("p",{children:"Still need help?"}),(0,k.jsxs)("div",{className:"footer-actions",children:[(0,k.jsx)("button",{className:"contact-support-btn",children:"\ud83d\udce7 Contact Support"}),(0,k.jsx)("button",{className:"feedback-btn",children:"\ud83d\udcdd Send Feedback"})]})]})})]})})},_=e=>{let{isOpen:t,onClose:n,onCapture:s,mode:i="photo"}=e;const[r,o]=(0,a.useState)(!1),[l,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[h,m]=(0,a.useState)(null),[p,g]=(0,a.useState)("user"),[f,v]=(0,a.useState)(!1),[y,b]=(0,a.useState)([]),[x,w]=(0,a.useState)("off"),S=(0,a.useRef)(null),j=(0,a.useRef)(null),N=(0,a.useRef)(null),C=(0,a.useRef)(null);(0,a.useEffect)(()=>(t?E():T(),()=>{T()}),[t,p]);const E=async()=>{o(!0),c(null);try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera access is not supported in this browser");const e={video:{facingMode:p,width:{ideal:1280},height:{ideal:720}},audio:"video"===i},t=await navigator.mediaDevices.getUserMedia(e);m(t),C.current=t,u(!0),S.current&&(S.current.srcObject=t,await S.current.play())}catch(e){console.error("Camera initialization error:",e),c(I(e)),u(!1)}finally{o(!1)}},T=()=>{C.current&&(C.current.getTracks().forEach(e=>e.stop()),C.current=null,m(null)),N.current&&f&&(N.current.stop(),v(!1))},I=e=>"NotAllowedError"===e.name||"PermissionDeniedError"===e.name?"Camera permission denied. Please enable camera access and try again.":"NotFoundError"===e.name||"DevicesNotFoundError"===e.name?"No camera found on this device.":"NotReadableError"===e.name||"TrackStartError"===e.name?"Camera is already in use by another application.":"OverconstrainedError"===e.name?"Camera does not support the requested settings.":e.message||"Failed to access camera. Please try again.";return t?(0,k.jsx)("div",{className:"camera-overlay",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,k.jsxs)("div",{className:"camera-modal",children:[(0,k.jsxs)("div",{className:"camera-header",children:[(0,k.jsx)("button",{className:"camera-close",onClick:n,children:"\xd7"}),(0,k.jsx)("div",{className:"camera-title",children:"photo"===i?"\ud83d\udcf7 Camera":"\ud83c\udfa5 Video"}),(0,k.jsxs)("div",{className:"camera-actions",children:[(0,k.jsx)("button",{className:"flash-btn ".concat("on"===x?"active":""),onClick:async()=>{if(h)try{const e=h.getVideoTracks()[0];if(e.getCapabilities().torch){const t="off"===x?"on":"off";await e.applyConstraints({advanced:[{torch:"on"===t}]}),w(t)}}catch(e){console.error("Flash toggle error:",e)}},title:"Toggle Flash",children:"\u26a1"}),(0,k.jsx)("button",{className:"switch-camera-btn",onClick:()=>{g(e=>"user"===e?"environment":"user")},title:"Switch Camera",children:"\ud83d\udd04"})]})]}),(0,k.jsxs)("div",{className:"camera-content",children:[r&&(0,k.jsxs)("div",{className:"camera-loading",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("p",{children:"Initializing camera..."})]}),l&&(0,k.jsxs)("div",{className:"camera-error",children:[(0,k.jsx)("div",{className:"error-icon",children:"\ud83d\udea8"}),(0,k.jsx)("h4",{children:"Camera Error"}),(0,k.jsx)("p",{children:l}),(0,k.jsx)("button",{className:"retry-btn",onClick:E,children:"Try Again"})]}),d&&!l&&(0,k.jsxs)("div",{className:"camera-view",children:[(0,k.jsx)("video",{ref:S,className:"camera-video",autoPlay:!0,playsInline:!0,muted:!0}),(0,k.jsx)("canvas",{ref:j,className:"camera-canvas",style:{display:"none"}}),f&&(0,k.jsxs)("div",{className:"recording-indicator",children:[(0,k.jsx)("div",{className:"recording-dot"}),(0,k.jsx)("span",{children:"Recording..."})]})]})]}),d&&!l&&(0,k.jsx)("div",{className:"camera-controls",children:"photo"===i?(0,k.jsx)("button",{className:"capture-btn",onClick:()=>{if(!S.current||!j.current)return;const e=S.current,t=j.current,a=t.getContext("2d");t.width=e.videoWidth,t.height=e.videoHeight,a.drawImage(e,0,0,t.width,t.height),t.toBlob(e=>{if(e&&s){const t=new File([e],"photo_".concat(Date.now(),".jpg"),{type:"image/jpeg"});s(t,"photo"),n()}},"image/jpeg",.9)},children:"\ud83d\udcf7 Capture Photo"}):(0,k.jsx)("div",{className:"video-controls",children:f?(0,k.jsx)("button",{className:"stop-btn",onClick:()=>{N.current&&f&&(N.current.stop(),v(!1))},children:"\u23f9\ufe0f Stop Recording"}):(0,k.jsx)("button",{className:"record-btn",onClick:()=>{if(h)try{const e={mimeType:"video/webm;codecs=vp9,opus"};MediaRecorder.isTypeSupported(e.mimeType)||(e.mimeType="video/webm",MediaRecorder.isTypeSupported(e.mimeType)||(e.mimeType="video/mp4"));const t=new MediaRecorder(h,e);N.current=t;const a=[];t.ondataavailable=e=>{e.data.size>0&&a.push(e.data)},t.onstop=()=>{const e=new Blob(a,{type:t.mimeType}),i=new File([e],"video_".concat(Date.now(),".webm"),{type:e.type});s&&s(i,"video"),b([]),n()},t.start(1e3),v(!0),b(a)}catch(e){console.error("Recording start error:",e),c("Failed to start recording. Please try again.")}},children:"\u25cf Start Recording"})})})]})}):null},U=e=>{let{isOpen:t,onClose:n,onContactsSelected:s,multiple:i=!0}=e;const[r,o]=(0,a.useState)([]),[l,d]=(0,a.useState)([]),[u,h]=(0,a.useState)([]),[m,p]=(0,a.useState)(""),[g,f]=(0,a.useState)(!1),[v,y]=(0,a.useState)(null),[b,x]=(0,a.useState)(null),[w,S]=(0,a.useState)(null);(0,a.useEffect)(()=>{t&&j()},[t]),(0,a.useEffect)(()=>{if(m.trim()){const e=r.filter(e=>e.name.toLowerCase().includes(m.toLowerCase())||e.email&&e.email.toLowerCase().includes(m.toLowerCase())||e.phone&&e.phone.includes(m));d(e)}else d(r)},[r,m]);const j=async()=>{if(f(!0),y(null),"contacts"in navigator&&"ContactsManager"in window)try{const e=await navigator.contacts.getProperties();S({supported:!0,properties:e,api:"ContactsManager"}),await C()}catch(e){console.error("ContactsManager error:",e),N()}else if("contacts"in navigator)try{S({supported:!0,properties:["name","email","tel"],api:"ContactPicker"}),await C()}catch(e){console.error("ContactPicker error:",e),N()}else N()},N=()=>{S({supported:!1,reason:"Contact access is not supported in this browser",api:"none"}),E(),f(!1)},C=async()=>{try{if("ContactsManager"===(null===w||void 0===w?void 0:w.api)){const e=(await navigator.contacts.select(["name","email","tel"],{multiple:i})).map((e,t)=>{var n,a,s;return{id:"native_".concat(t),name:(null===(n=e.name)||void 0===n?void 0:n[0])||"Unknown",email:(null===(a=e.email)||void 0===a?void 0:a[0])||"",phone:(null===(s=e.tel)||void 0===s?void 0:s[0])||"",source:"device"}});o(e),x(!0)}else{const e=(await navigator.contacts.select(["name","email","tel"],{multiple:i})).map((e,t)=>({id:"picker_".concat(t),name:e.name||"Unknown",email:e.email||"",phone:e.tel||"",source:"device"}));o(e),x(!0)}}catch(e){console.error("Contact permission error:",e),"NotAllowedError"===e.name?(y("Contact access permission denied. Please enable contact access."),x(!1)):"NotSupportedError"===e.name?(y("Contact access is not supported on this device."),x(!1)):(y("Failed to access contacts. Using manual entry mode."),x(!1)),E()}finally{f(!1)}},E=()=>{const e=[{id:"fallback_1",name:"Manual Entry",email:"",phone:"",source:"manual",isManualEntry:!0}];try{const t=JSON.parse(localStorage.getItem("app_contacts")||"[]");e.push(...t.map(e=>c(c({},e),{},{source:"saved"})))}catch(t){console.error("Error loading saved contacts:",t)}o(e),x(!1)},T=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u;e.length>0&&s&&s(e),n()},I=e=>u.find(t=>t.id===e.id);return t?(0,k.jsx)("div",{className:"contact-picker-overlay",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,k.jsxs)("div",{className:"contact-picker-modal",children:[(0,k.jsxs)("div",{className:"contact-picker-header",children:[(0,k.jsx)("h3",{children:i?"\ud83d\udcde Select Contacts":"\ud83d\udcde Select Contact"}),(0,k.jsx)("button",{className:"close-btn",onClick:n,children:"\xd7"})]}),g&&(0,k.jsxs)("div",{className:"contact-picker-loading",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("p",{children:"Accessing contacts..."})]}),v&&(0,k.jsxs)("div",{className:"contact-picker-error",children:[(0,k.jsx)("div",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,k.jsx)("p",{children:v}),(0,k.jsx)("button",{className:"retry-btn",onClick:j,children:"Try Again"})]}),!g&&!v&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"contact-picker-search",children:(0,k.jsx)("input",{type:"text",placeholder:"Search contacts...",value:m,onChange:e=>p(e.target.value),className:"search-input"})}),(0,k.jsx)("div",{className:"contact-picker-content",children:l.length>0?(0,k.jsx)("div",{className:"contacts-list",children:l.map(e=>(0,k.jsxs)("div",{className:"contact-item ".concat(I(e)?"selected":""," ").concat(e.isManualEntry?"manual-entry":""),onClick:()=>(e=>{if(e.isManualEntry){const e=prompt("Enter contact name:"),t=prompt("Enter email (optional):")||"",n=prompt("Enter phone number (optional):")||"";if(e){const a={id:"manual_".concat(Date.now()),name:e,email:t,phone:n,source:"manual"};i?h(e=>[...e,a]):(h([a]),T([a]))}return}i?h(t=>t.find(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e]):(h([e]),T([e]))})(e),children:[(0,k.jsx)("div",{className:"contact-avatar",children:e.isManualEntry?"\u2795":e.name.charAt(0).toUpperCase()}),(0,k.jsxs)("div",{className:"contact-info",children:[(0,k.jsxs)("div",{className:"contact-name",children:[e.name,"device"===e.source&&(0,k.jsx)("span",{className:"source-badge",children:"Device"}),"saved"===e.source&&(0,k.jsx)("span",{className:"source-badge saved",children:"Saved"})]}),e.email&&(0,k.jsx)("div",{className:"contact-email",children:e.email}),e.phone&&(0,k.jsx)("div",{className:"contact-phone",children:e.phone})]}),i&&!e.isManualEntry&&(0,k.jsx)("div",{className:"contact-checkbox",children:I(e)?"\u2713":""})]},e.id))}):(0,k.jsxs)("div",{className:"no-contacts",children:[(0,k.jsx)("div",{className:"no-contacts-icon",children:"\ud83d\udcde"}),(0,k.jsx)("h4",{children:"No contacts found"}),(0,k.jsx)("p",{children:m?'No contacts match "'.concat(m,'"'):"No contacts available"})]})}),i&&u.length>0&&(0,k.jsxs)("div",{className:"contact-picker-footer",children:[(0,k.jsxs)("div",{className:"selected-count",children:[u.length," contact",1!==u.length?"s":""," selected"]}),(0,k.jsxs)("div",{className:"footer-actions",children:[(0,k.jsx)("button",{className:"cancel-btn",onClick:()=>h([]),children:"Clear"}),(0,k.jsx)("button",{className:"submit-btn",onClick:()=>T(),children:"Add Selected"})]})]})]})]})}):null},q=["id"],B=[["#667eea","#764ba2"],["#4facfe","#00f2fe"],["#43e97b","#38f9d7"],["#fa709a","#fee140"],["#a18cd1","#fbc2eb"],["#fd7043","#ff8a65"],["#26c6da","#00acc1"],["#66bb6a","#43a047"],["#ab47bc","#7b1fa2"],["#ef5350","#c62828"]];function H(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=0;for(let s=0;s<e.length;s++)t=e.charCodeAt(s)+((t<<5)-t);const[n,a]=B[Math.abs(t)%B.length];return"linear-gradient(135deg, ".concat(n,", ").concat(a,")")}function W(e){let{name:t="",size:n=48}=e;const a=t.split(" ").filter(Boolean).slice(0,2).map(e=>e[0].toUpperCase()).join("");return(0,k.jsx)("div",{className:"contact-avatar-circle",style:{width:n,height:n,minWidth:n,background:H(t),fontSize:Math.round(.36*n)},children:a||"?"})}function V(e){let{contact:t,viewMode:n,isSelected:s,onToggleSelect:i,onToggleFavorite:r,onToggleBlock:o,onDelete:l,onEdit:d,onOpenProfile:u,onStartChat:h,onStartCall:m}=e;const[p,g]=(0,a.useState)(!1),f=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!p)return;const e=e=>{f.current&&!f.current.contains(e.target)&&g(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[p]);const v=t.company||t.email||t.phone||"";return(0,k.jsxs)("div",{className:"contact-card".concat("grid"===n?" card-grid":" card-list").concat(s?" selected":"").concat(t.blocked?" blocked-card":""),children:[(0,k.jsx)("label",{className:"card-checkbox",onClick:e=>e.stopPropagation(),children:(0,k.jsx)("input",{type:"checkbox",checked:s,onChange:()=>i(t.id)})}),(0,k.jsxs)("div",{className:"card-main",onClick:()=>u(t),children:[(0,k.jsxs)("div",{className:"avatar-wrapper",children:[(0,k.jsx)(W,{name:t.name,size:"grid"===n?52:44}),t.favorite&&(0,k.jsx)("span",{className:"fav-badge",title:"Favorite",children:"\u2605"}),t.blocked&&(0,k.jsx)("span",{className:"blocked-badge",title:"Blocked",children:"\u26d4"})]}),(0,k.jsxs)("div",{className:"card-info",children:[(0,k.jsx)("div",{className:"card-name",children:t.name}),v&&(0,k.jsx)("div",{className:"card-secondary",children:v})]})]}),(0,k.jsxs)("div",{className:"card-actions",onClick:e=>e.stopPropagation(),children:[(0,k.jsx)("button",{className:"card-btn fav-btn".concat(t.favorite?" active":""),onClick:e=>r(t,e),title:t.favorite?"Remove from favorites":"Add to favorites",children:t.favorite?"\u2605":"\u2606"}),(0,k.jsx)("button",{className:"card-btn msg-btn",onClick:()=>h(t),title:"Send message",children:"\ud83d\udcac"}),t.phone&&(0,k.jsx)("button",{className:"card-btn call-btn",onClick:()=>m(t),title:"Call",children:"\ud83d\udcde"}),(0,k.jsxs)("div",{className:"menu-wrapper",ref:f,children:[(0,k.jsx)("button",{className:"card-btn more-btn",onClick:()=>g(e=>!e),title:"More options",children:"\xb7\xb7\xb7"}),p&&(0,k.jsxs)("div",{className:"card-dropdown",children:[(0,k.jsx)("button",{onClick:()=>{d(c({},t)),g(!1)},children:"\u270f\ufe0f Edit"}),(0,k.jsx)("button",{onClick:e=>{r(t,e),g(!1)},children:t.favorite?"\u2606 Remove favorite":"\u2605 Add to favorites"}),(0,k.jsx)("button",{onClick:e=>{o(t,e),g(!1)},children:t.blocked?"\u2705 Unblock":"\ud83d\udeab Block"}),(0,k.jsx)("button",{className:"dropdown-delete",onClick:()=>{l(t.id),g(!1)},children:"\ud83d\uddd1\ufe0f Delete"})]})]})]})]})}const K=e=>{let{isOpen:t,onClose:n,onStartChat:s,onStartCall:i,darkMode:r}=e;const[o,l]=(0,a.useState)([]),[d,u]=(0,a.useState)([]),[h,m]=(0,a.useState)(""),[p,g]=(0,a.useState)([]),[f,v]=(0,a.useState)(!1),[y,b]=(0,a.useState)(!1),[x,w]=(0,a.useState)(null),[S,j]=(0,a.useState)("name"),[N,C]=(0,a.useState)("list"),[E,T]=(0,a.useState)("all"),[I,P]=(0,a.useState)(null),[A,M]=(0,a.useState)({name:"",email:"",phone:"",company:"",notes:""});(0,a.useEffect)(()=>{t&&F()},[t]);const F=async()=>{v(!0);try{const e=await R.getContacts();l(Array.isArray(e)?e:(null===e||void 0===e?void 0:e.contacts)||[])}catch(e){console.error("Error loading contacts:",e)}finally{v(!1)}};(0,a.useEffect)(()=>{let e=o;if(e="favorites"===E?e.filter(e=>e.favorite):"blocked"===E?e.filter(e=>e.blocked):e.filter(e=>!e.blocked),h.trim()){const t=h.toLowerCase();e=e.filter(e=>{var n,a,s,i;return(null===(n=e.name)||void 0===n?void 0:n.toLowerCase().includes(t))||(null===(a=e.email)||void 0===a?void 0:a.toLowerCase().includes(t))||(null===(s=e.phone)||void 0===s?void 0:s.includes(h))||(null===(i=e.company)||void 0===i?void 0:i.toLowerCase().includes(t))})}e=[...e].sort((e,t)=>{switch(S){case"email":return(e.email||"").localeCompare(t.email||"");case"company":return(e.company||"").localeCompare(t.company||"");case"recent":return new Date(t.updatedAt||0)-new Date(e.updatedAt||0);default:return e.name.localeCompare(t.name)}}),u(e)},[o,h,S,E]);const L=async e=>{if(!window.confirm("Delete this contact?"))return;const t=await R.deleteContact(e);t.success?(l(t=>t.filter(t=>t.id!==e)),g(t=>t.filter(t=>t!==e)),(null===I||void 0===I?void 0:I.id)===e&&P(null)):alert("Failed to delete: ".concat(t.error))},z=async(e,t)=>{null===t||void 0===t||t.stopPropagation();if((await R.toggleFavorite(e.id)).success){const t=c(c({},e),{},{favorite:!e.favorite});l(n=>n.map(n=>n.id===e.id?t:n)),(null===I||void 0===I?void 0:I.id)===e.id&&P(t)}},O=async(e,t)=>{null===t||void 0===t||t.stopPropagation();if((await R.toggleBlock(e.id)).success){const t=c(c({},e),{},{blocked:!e.blocked});l(n=>n.map(n=>n.id===e.id?t:n)),(null===I||void 0===I?void 0:I.id)===e.id&&P(t)}},_=e=>{g(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},U={all:o.filter(e=>!e.blocked).length,favorites:o.filter(e=>e.favorite&&!e.blocked).length,blocked:o.filter(e=>e.blocked).length};if(!t)return null;const B="favorites"===E?{icon:"\u2b50",title:"No favorites yet",sub:"Star contacts to find them quickly"}:"blocked"===E?{icon:"\ud83d\udeab",title:"No blocked contacts",sub:""}:h?{icon:"\ud83d\udd0d",title:'No results for "'.concat(h,'"'),sub:""}:{icon:"\ud83d\udc65",title:"No contacts yet",sub:"Add your first contact to get started"};return(0,k.jsx)("div",{className:"cm-overlay",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,k.jsxs)("div",{className:"cm-modal".concat(r?" cm-dark":""),children:[(0,k.jsxs)("div",{className:"cm-header",children:[(0,k.jsxs)("div",{className:"cm-header-left",children:[(0,k.jsx)("span",{className:"cm-header-icon",children:"\ud83d\udc65"}),(0,k.jsx)("h3",{children:"Contacts"}),(0,k.jsx)("span",{className:"cm-total-badge",children:U[E]})]}),(0,k.jsxs)("div",{className:"cm-header-right",children:[(0,k.jsx)("button",{className:"cm-add-btn",onClick:()=>b(!0),children:"+ Add"}),(0,k.jsx)("button",{className:"cm-close-btn",onClick:n,children:"\u2715"})]})]}),(0,k.jsx)("div",{className:"cm-tabs",children:[{id:"all",label:"All",icon:"\ud83d\udc65"},{id:"favorites",label:"Favorites",icon:"\u2b50"},{id:"blocked",label:"Blocked",icon:"\ud83d\udeab"}].map(e=>(0,k.jsxs)("button",{className:"cm-tab".concat(E===e.id?" active":""),onClick:()=>T(e.id),children:[(0,k.jsx)("span",{children:e.icon}),(0,k.jsx)("span",{className:"cm-tab-label",children:e.label}),U[e.id]>0&&(0,k.jsx)("span",{className:"cm-tab-count",children:U[e.id]})]},e.id))}),(0,k.jsxs)("div",{className:"cm-toolbar",children:[(0,k.jsxs)("div",{className:"cm-search-wrap",children:[(0,k.jsx)("span",{className:"cm-search-icon",children:"\ud83d\udd0d"}),(0,k.jsx)("input",{type:"text",placeholder:"Search contacts\u2026",value:h,onChange:e=>m(e.target.value),className:"cm-search-input"}),h&&(0,k.jsx)("button",{className:"cm-search-clear",onClick:()=>m(""),children:"\u2715"})]}),(0,k.jsxs)("div",{className:"cm-toolbar-right",children:[p.length>0&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("button",{className:"cm-toolbar-btn",onClick:()=>{g(e=>e.length===d.length?[]:d.map(e=>e.id))},children:p.length===d.length?"Deselect all":"Select all"}),(0,k.jsxs)("button",{className:"cm-toolbar-btn cm-delete-sel-btn",onClick:async()=>{if(0===p.length)return;if(!window.confirm("Delete ".concat(p.length," contact(s)?")))return;const e=await Promise.all(p.map(e=>R.deleteContact(e))),t=p.filter((t,n)=>e[n].success);l(e=>e.filter(e=>!t.includes(e.id))),g([])},children:["\ud83d\uddd1 (",p.length,")"]})]}),(0,k.jsxs)("select",{value:S,onChange:e=>j(e.target.value),className:"cm-sort-select",children:[(0,k.jsx)("option",{value:"name",children:"Name"}),(0,k.jsx)("option",{value:"email",children:"Email"}),(0,k.jsx)("option",{value:"company",children:"Company"}),(0,k.jsx)("option",{value:"recent",children:"Recent"})]}),(0,k.jsxs)("div",{className:"cm-view-toggle",children:[(0,k.jsx)("button",{className:"cm-view-btn".concat("grid"===N?" active":""),onClick:()=>C("grid"),title:"Grid",children:"\u229e"}),(0,k.jsx)("button",{className:"cm-view-btn".concat("list"===N?" active":""),onClick:()=>C("list"),title:"List",children:"\u2261"})]})]})]}),(0,k.jsxs)("div",{className:"cm-body".concat(I?" panel-open":""),children:[(0,k.jsx)("div",{className:"cm-contacts-area".concat("grid"===N?" grid-mode":" list-mode"),children:f?(0,k.jsxs)("div",{className:"cm-loading",children:[(0,k.jsx)("div",{className:"cm-spinner"}),(0,k.jsx)("p",{children:"Loading contacts\u2026"})]}):0===d.length?(0,k.jsxs)("div",{className:"cm-empty",children:[(0,k.jsx)("div",{className:"cm-empty-icon",children:B.icon}),(0,k.jsx)("p",{className:"cm-empty-title",children:B.title}),B.sub&&(0,k.jsx)("p",{className:"cm-empty-sub",children:B.sub}),"all"===E&&!h&&(0,k.jsx)("button",{className:"cm-empty-add-btn",onClick:()=>b(!0),children:"Add Contact"})]}):d.map(e=>(0,k.jsx)(V,{contact:e,viewMode:N,isSelected:p.includes(e.id),onToggleSelect:_,onToggleFavorite:z,onToggleBlock:O,onDelete:L,onEdit:e=>w(e),onOpenProfile:e=>P(e),onStartChat:e=>{s&&s(e)},onStartCall:e=>{i&&i(e)}},e.id))}),I&&(0,k.jsxs)("div",{className:"cm-profile-panel",children:[(0,k.jsx)("button",{className:"profile-close-btn",onClick:()=>P(null),children:"\u2715"}),(0,k.jsxs)("div",{className:"profile-avatar-wrap",children:[(0,k.jsx)(W,{name:I.name,size:80}),I.favorite&&(0,k.jsx)("span",{className:"profile-fav-star",children:"\u2605"})]}),(0,k.jsx)("h2",{className:"profile-name",children:I.name}),I.company&&(0,k.jsx)("p",{className:"profile-company",children:I.company}),(0,k.jsxs)("div",{className:"profile-quick-btns",children:[(0,k.jsxs)("button",{className:"pq-btn pq-msg",onClick:()=>{s&&s(I)},children:[(0,k.jsx)("span",{children:"\ud83d\udcac"}),(0,k.jsx)("span",{children:"Message"})]}),I.phone&&(0,k.jsxs)("button",{className:"pq-btn pq-call",onClick:()=>{i&&i(I)},children:[(0,k.jsx)("span",{children:"\ud83d\udcde"}),(0,k.jsx)("span",{children:"Call"})]}),(0,k.jsxs)("button",{className:"pq-btn pq-fav".concat(I.favorite?" active":""),onClick:e=>z(I,e),children:[(0,k.jsx)("span",{children:I.favorite?"\u2605":"\u2606"}),(0,k.jsx)("span",{children:I.favorite?"Unfav":"Favorite"})]})]}),(0,k.jsxs)("div",{className:"profile-fields",children:[I.email&&(0,k.jsxs)("div",{className:"profile-field",children:[(0,k.jsx)("span",{className:"pf-icon",children:"\ud83d\udce7"}),(0,k.jsxs)("div",{children:[(0,k.jsx)("div",{className:"pf-label",children:"Email"}),(0,k.jsx)("div",{className:"pf-value",children:I.email})]})]}),I.phone&&(0,k.jsxs)("div",{className:"profile-field",children:[(0,k.jsx)("span",{className:"pf-icon",children:"\ud83d\udcf1"}),(0,k.jsxs)("div",{children:[(0,k.jsx)("div",{className:"pf-label",children:"Phone"}),(0,k.jsx)("div",{className:"pf-value",children:I.phone})]})]}),I.notes&&(0,k.jsxs)("div",{className:"profile-field",children:[(0,k.jsx)("span",{className:"pf-icon",children:"\ud83d\udcdd"}),(0,k.jsxs)("div",{children:[(0,k.jsx)("div",{className:"pf-label",children:"Notes"}),(0,k.jsx)("div",{className:"pf-value",children:I.notes})]})]}),(0,k.jsxs)("div",{className:"profile-field",children:[(0,k.jsx)("span",{className:"pf-icon",children:"\ud83d\uddd3"}),(0,k.jsxs)("div",{children:[(0,k.jsx)("div",{className:"pf-label",children:"Added"}),(0,k.jsx)("div",{className:"pf-value",children:new Date(I.createdAt).toLocaleDateString()})]})]})]}),(0,k.jsxs)("div",{className:"profile-footer-btns",children:[(0,k.jsx)("button",{className:"profile-edit-btn",onClick:()=>{w(c({},I)),P(null)},children:"\u270f\ufe0f Edit"}),(0,k.jsx)("button",{className:"profile-block-btn".concat(I.blocked?" unblock":""),onClick:e=>O(I,e),children:I.blocked?"\u2705 Unblock":"\ud83d\udeab Block"})]})]})]}),(0,k.jsxs)("div",{className:"cm-footer",children:[(0,k.jsxs)("span",{className:"cm-footer-total",children:[o.filter(e=>!e.blocked).length," contact",1!==o.filter(e=>!e.blocked).length?"s":""]}),(0,k.jsxs)("div",{className:"cm-footer-actions",children:[(0,k.jsx)("input",{type:"file",accept:".json,.csv",onChange:async e=>{const t=e.target.files[0];if(t){try{const e=await t.text();let n;if(t.name.endsWith(".json"))n=JSON.parse(e);else if(t.name.endsWith(".csv")){n=e.split("\n").slice(1).map(e=>{const t=e.split(",").map(e=>e.trim().replace(/"/g,""));return{name:t[0]||"Unknown",email:t[1]||"",phone:t[2]||"",company:t[3]||""}}).filter(e=>e.name&&"Unknown"!==e.name)}if(Array.isArray(n)){const e=(await Promise.all(n.map(e=>R.addContact(e)))).filter(e=>e.success);e.length>0?(l(t=>[...t,...e.map(e=>e.contact)]),alert("Imported ".concat(e.length," contact(s)"))):alert("No contacts were imported")}else alert("Invalid file format")}catch(n){console.error("Import error:",n),alert("Failed to import contacts")}e.target.value=""}},style:{display:"none"},id:"cm-import-input"}),(0,k.jsx)("label",{htmlFor:"cm-import-input",className:"cm-footer-btn",children:"\u2b06 Import"}),(0,k.jsx)("button",{className:"cm-footer-btn",onClick:()=>{const e=R.exportContacts("json");e.success||alert("Export failed: ".concat(e.error))},children:"\u2b07 Export"})]})]}),y&&(0,k.jsx)("div",{className:"cm-form-overlay",children:(0,k.jsxs)("div",{className:"cm-form-modal",children:[(0,k.jsxs)("div",{className:"cm-form-header",children:[(0,k.jsx)("h4",{children:"Add New Contact"}),(0,k.jsx)("button",{onClick:()=>b(!1),children:"\u2715"})]}),(0,k.jsxs)("div",{className:"cm-form-body",children:[(0,k.jsx)("input",{type:"text",placeholder:"Full Name *",value:A.name,onChange:e=>M(t=>c(c({},t),{},{name:e.target.value})),autoFocus:!0}),(0,k.jsx)("input",{type:"email",placeholder:"Email",value:A.email,onChange:e=>M(t=>c(c({},t),{},{email:e.target.value}))}),(0,k.jsx)("input",{type:"tel",placeholder:"Phone",value:A.phone,onChange:e=>M(t=>c(c({},t),{},{phone:e.target.value}))}),(0,k.jsx)("input",{type:"text",placeholder:"Company",value:A.company,onChange:e=>M(t=>c(c({},t),{},{company:e.target.value}))}),(0,k.jsx)("textarea",{placeholder:"Notes",value:A.notes,onChange:e=>M(t=>c(c({},t),{},{notes:e.target.value})),rows:3}),(0,k.jsxs)("div",{className:"cm-form-actions",children:[(0,k.jsx)("button",{className:"cm-cancel-btn",onClick:()=>b(!1),children:"Cancel"}),(0,k.jsx)("button",{className:"cm-save-btn",onClick:async()=>{if(!A.name.trim())return void alert("Please enter a contact name");const e=await R.addContact(c(c({},A),{},{favorite:!1,blocked:!1}));var t;e.success?(l(t=>[...t,e.contact]),M({name:"",email:"",phone:"",company:"",notes:""}),b(!1)):alert("Failed to add contact: ".concat((null===(t=e.errors)||void 0===t?void 0:t.join(", "))||e.error))},children:"Add Contact"})]})]})]})}),x&&(0,k.jsx)("div",{className:"cm-form-overlay",children:(0,k.jsxs)("div",{className:"cm-form-modal",children:[(0,k.jsxs)("div",{className:"cm-form-header",children:[(0,k.jsx)("h4",{children:"Edit Contact"}),(0,k.jsx)("button",{onClick:()=>w(null),children:"\u2715"})]}),(0,k.jsxs)("div",{className:"cm-form-body",children:[(0,k.jsx)("input",{type:"text",placeholder:"Full Name *",value:x.name,onChange:e=>w(t=>c(c({},t),{},{name:e.target.value})),autoFocus:!0}),(0,k.jsx)("input",{type:"email",placeholder:"Email",value:x.email||"",onChange:e=>w(t=>c(c({},t),{},{email:e.target.value}))}),(0,k.jsx)("input",{type:"tel",placeholder:"Phone",value:x.phone||"",onChange:e=>w(t=>c(c({},t),{},{phone:e.target.value}))}),(0,k.jsx)("input",{type:"text",placeholder:"Company",value:x.company||"",onChange:e=>w(t=>c(c({},t),{},{company:e.target.value}))}),(0,k.jsx)("textarea",{placeholder:"Notes",value:x.notes||"",onChange:e=>w(t=>c(c({},t),{},{notes:e.target.value})),rows:3}),(0,k.jsxs)("div",{className:"cm-form-actions",children:[(0,k.jsx)("button",{className:"cm-cancel-btn",onClick:()=>w(null),children:"Cancel"}),(0,k.jsx)("button",{className:"cm-save-btn",onClick:async()=>{var e;if(null===x||void 0===x||null===(e=x.name)||void 0===e||!e.trim())return void alert("Please enter a contact name");const{id:t}=x,n=D(x,q),a=await R.updateContact(t,n);var s;a.success?(l(e=>e.map(e=>e.id===a.contact.id?a.contact:e)),(null===I||void 0===I?void 0:I.id)===t&&P(a.contact),w(null)):alert("Failed to update contact: ".concat((null===(s=a.errors)||void 0===s?void 0:s.join(", "))||a.error))},children:"Save Changes"})]})]})]})})]})})};const G=new class{constructor(){this.cache=new Map,this.cacheTimeout=3e5}async searchUsers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{limit:n=10,includeCurrentUser:a=!1}=t;if(!e||e.trim().length<2)return{success:!1,error:"Search query must be at least 2 characters long",users:[]};const s=e.trim(),i="search:".concat(s,":").concat(n,":").concat(a);if(this.cache.has(i)){const e=this.cache.get(i);if(Date.now()-e.timestamp<this.cacheTimeout)return e.data;this.cache.delete(i)}try{const e=await u.getTokenForRequest();if(!e)return{success:!1,error:"Authentication required",users:[]};const t=await fetch("/api/users/search?q=".concat(encodeURIComponent(s),"&limit=").concat(n),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(t.ok){const e=await t.json();return e.success?(this.cache.set(i,{data:{success:!0,users:e.users,query:s,count:e.count},timestamp:Date.now()}),{success:!0,users:e.users,query:s,count:e.count}):{success:!1,error:e.error||"Search failed",users:[]}}return{success:!1,error:(await t.json()).error||"Search request failed",users:[]}}catch(r){return console.error("User search error:",r),{success:!1,error:"Network error during search",users:[]}}}async getUserById(e){try{const t=await u.getTokenForRequest();if(!t)return{success:!1,error:"Authentication required"};const n=await fetch("/api/users/".concat(e),{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});if(n.ok){return await n.json()}return{success:!1,error:(await n.json()).error||"Failed to get user"}}catch(t){return console.error("Get user error:",t),{success:!1,error:"Network error"}}}clearCache(){this.cache.clear()}getRecentSearches(){try{const e=localStorage.getItem("recentUserSearches");return e?JSON.parse(e):[]}catch(e){return console.error("Error getting recent searches:",e),[]}}addToRecentSearches(e,t){try{const n=this.getRecentSearches(),a={query:e.trim(),user:{id:t.id,name:t.name,username:t.username,avatar:t.avatar},timestamp:Date.now()},s=[a,...n.filter(n=>n.user.id!==t.id&&n.query.toLowerCase()!==e.toLowerCase())].slice(0,10);localStorage.setItem("recentUserSearches",JSON.stringify(s))}catch(n){console.error("Error saving recent search:",n)}}clearRecentSearches(){try{localStorage.removeItem("recentUserSearches")}catch(e){console.error("Error clearing recent searches:",e)}}formatUserForDisplay(e){return{id:e.id,name:e.name||e.username,username:e.username,displayName:e.displayName||e.name,avatar:e.avatar,status:e.status||"offline",bio:e.bio,location:e.location,company:e.company,isOnline:"online"===e.status}}debounce(e,t){let n;return function(){for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...s)},t)}}createDebouncedSearch(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return this.debounce(async function(n){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.trim().length>=2){const s=await t.searchUsers(n,a);e(s)}else e({success:!0,users:[],query:"",count:0})},n)}},J=e=>{let{isOpen:t,onClose:n,onUserSelect:s,searchQuery:i="",onSearchQueryChange:r}=e;const[o,l]=(0,a.useState)([]),[c,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)(""),[m,p]=(0,a.useState)([]),[g,f]=(0,a.useState)(i),[v,y]=(0,a.useState)(null),b=(0,a.useRef)(null);(0,a.useEffect)(()=>{t&&(p(G.getRecentSearches()),f(i),setTimeout(()=>{b.current&&b.current.focus()},100))},[t,i]);const x=G.createDebouncedSearch(e=>{d(!1),e.success?(l(e.users),h("")):(h(e.error),l([]))},300),w=async e=>{if(v!==e.id)try{y(e.id),g.trim()&&G.addToRecentSearches(g,e),await s(e),n()}catch(u){console.error("Error creating chat:",u)}finally{y(null)}};return t?(0,k.jsx)("div",{className:"user-search-overlay",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,k.jsxs)("div",{className:"user-search-modal",onKeyDown:e=>{"Escape"===e.key&&n()},children:[(0,k.jsxs)("div",{className:"user-search-header",children:[(0,k.jsx)("h3",{children:"\ud83d\udd0d Search Users"}),(0,k.jsx)("button",{className:"close-btn",onClick:n,children:"\xd7"})]}),(0,k.jsxs)("div",{className:"user-search-content",children:[(0,k.jsx)("div",{className:"search-input-section",children:(0,k.jsxs)("div",{className:"search-input-container",children:[(0,k.jsx)("span",{className:"search-icon",children:"\ud83d\udd0d"}),(0,k.jsx)("input",{ref:b,type:"text",placeholder:"Search users by name, username, or email...",value:g,onChange:e=>{const t=e.target.value;f(t),null===r||void 0===r||r(t),t.trim().length>=2?(d(!0),h(""),x(t)):(l([]),d(!1),h(""))},className:"user-search-input",autoComplete:"off"}),g&&(0,k.jsx)("button",{className:"clear-search-btn",onClick:()=>{f(""),null===r||void 0===r||r(""),l([]),h("")},children:"\xd7"})]})}),c&&(0,k.jsxs)("div",{className:"search-loading",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("p",{children:"Searching users..."})]}),u&&(0,k.jsxs)("div",{className:"search-error",children:[(0,k.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,k.jsx)("p",{children:u})]}),!c&&!u&&g.trim().length>=2&&(0,k.jsxs)("div",{className:"search-results",children:[(0,k.jsxs)("div",{className:"results-header",children:[(0,k.jsx)("h4",{children:"Search Results"}),o.length>0&&(0,k.jsxs)("span",{className:"results-count",children:[o.length," user",1!==o.length?"s":""," found"]})]}),o.length>0?(0,k.jsx)("div",{className:"users-list",children:o.map(e=>(0,k.jsxs)("div",{className:"user-item",onClick:()=>w(e),children:[(0,k.jsxs)("div",{className:"user-avatar",children:[e.avatar?(0,k.jsx)("img",{src:e.avatar,alt:e.name,onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}):null,(0,k.jsx)("div",{className:"avatar-fallback",style:{display:e.avatar?"none":"flex"},children:(e.name||e.username||"?").charAt(0).toUpperCase()}),(0,k.jsx)("div",{className:"status-indicator ".concat(e.status||"offline")})]}),(0,k.jsxs)("div",{className:"user-info",children:[(0,k.jsx)("div",{className:"user-name",children:e.name||e.username}),(0,k.jsxs)("div",{className:"user-details",children:[(0,k.jsxs)("span",{className:"username",children:["@",e.username]}),e.bio&&(0,k.jsx)("span",{className:"bio",children:e.bio}),e.location&&(0,k.jsxs)("span",{className:"location",children:["\ud83d\udccd ",e.location]})]})]}),(0,k.jsx)("div",{className:"user-actions",children:(0,k.jsx)("button",{className:"chat-btn ".concat(v===e.id?"loading":""),title:v===e.id?"Creating chat...":"Start Chat",disabled:v===e.id,children:v===e.id?(0,k.jsx)("div",{className:"loading-spinner-small"}):"\ud83d\udcac"})})]},e.id))}):(0,k.jsxs)("div",{className:"no-results",children:[(0,k.jsx)("span",{className:"no-results-icon",children:"\ud83d\udd0d"}),(0,k.jsx)("h4",{children:"No users found"}),(0,k.jsx)("p",{children:"Try searching with different keywords"})]})]}),!c&&!u&&g.trim().length<2&&m.length>0&&(0,k.jsxs)("div",{className:"recent-searches",children:[(0,k.jsxs)("div",{className:"recent-header",children:[(0,k.jsx)("h4",{children:"Recent Searches"}),(0,k.jsx)("button",{className:"clear-recent-btn",onClick:()=>{G.clearRecentSearches(),p([])},children:"Clear All"})]}),(0,k.jsx)("div",{className:"recent-list",children:m.map((e,t)=>(0,k.jsxs)("div",{className:"recent-item",onClick:()=>(async e=>{f(e.query),null===r||void 0===r||r(e.query),await w(e.user)})(e),children:[(0,k.jsx)("div",{className:"recent-avatar",children:e.user.avatar?(0,k.jsx)("img",{src:e.user.avatar,alt:e.user.name}):(0,k.jsx)("div",{className:"avatar-fallback",children:(e.user.name||e.user.username||"?").charAt(0).toUpperCase()})}),(0,k.jsxs)("div",{className:"recent-info",children:[(0,k.jsx)("div",{className:"recent-name",children:e.user.name||e.user.username}),(0,k.jsxs)("div",{className:"recent-query",children:['"',e.query,'"']})]}),(0,k.jsx)("div",{className:"recent-time",children:new Date(e.timestamp).toLocaleDateString()})]},"".concat(e.user.id,"-").concat(t)))})]}),!c&&!u&&g.trim().length<2&&0===m.length&&(0,k.jsxs)("div",{className:"empty-state",children:[(0,k.jsx)("span",{className:"empty-icon",children:"\ud83d\udc65"}),(0,k.jsx)("h4",{children:"Search for Users"}),(0,k.jsx)("p",{children:"Enter at least 2 characters to search for other users"}),(0,k.jsxs)("div",{className:"search-tips",children:[(0,k.jsx)("h5",{children:"Search Tips:"}),(0,k.jsxs)("ul",{children:[(0,k.jsx)("li",{children:'\ud83d\udd24 Search by name: "John Doe"'}),(0,k.jsx)("li",{children:'\ud83d\udce7 Search by username: "johndoe"'}),(0,k.jsx)("li",{children:'\u2709\ufe0f Search by email: "john@example.com"'})]})]})]})]})]})}):null};const Y=new class{constructor(){this.searchHistory=[],this.searchIndex=new Map,this.maxHistoryItems=50,this.loadSearchHistory()}async initIndexedDB(){return new Promise((e,t)=>{const n=indexedDB.open("QuibishSearchDB",1);n.onerror=()=>t(n.error),n.onsuccess=()=>e(n.result),n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("searchIndex")){t.createObjectStore("searchIndex",{keyPath:"term"}).createIndex("term","term",{unique:!0})}if(!t.objectStoreNames.contains("searchHistory")){const e=t.createObjectStore("searchHistory",{keyPath:"id",autoIncrement:!0});e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("query","query",{unique:!1})}}})}async buildSearchIndex(e){console.log("\ud83d\udd0d Building search index from",e.length,"messages..."),this.searchIndex.clear();for(const n of e){if(!n.text)continue;const e=this.tokenize(n.text);for(const t of e)this.searchIndex.has(t)||this.searchIndex.set(t,[]),this.searchIndex.get(t).push({messageId:n.id,conversationId:n.conversationId,userId:n.userId,timestamp:n.timestamp,text:n.text,type:n.type||"text"})}try{const e=await this.initIndexedDB(),t=e.transaction(["searchIndex"],"readwrite").objectStore("searchIndex");t.clear();for(const[n,a]of this.searchIndex.entries())t.add({term:n,results:a});console.log("\u2705 Search index built with",this.searchIndex.size,"unique terms")}catch(t){console.error("\u274c Failed to save search index to IndexedDB:",t)}}tokenize(e){return e?e.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>=2).filter(e=>!this.isStopWord(e)):[]}isStopWord(e){return new Set(["the","is","at","which","on","a","an","and","or","but","in","with","to","for","of","as","by","that","this","it"]).has(e)}calculateLevenshteinDistance(e,t){const n=[];for(let a=0;a<=t.length;a++)n[a]=[a];for(let a=0;a<=e.length;a++)n[0][a]=a;for(let a=1;a<=t.length;a++)for(let s=1;s<=e.length;s++)t.charAt(a-1)===e.charAt(s-1)?n[a][s]=n[a-1][s-1]:n[a][s]=Math.min(n[a-1][s-1]+1,n[a][s-1]+1,n[a-1][s]+1);return n[t.length][e.length]}findSimilarTerms(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const n=[];for(const a of this.searchIndex.keys()){const s=this.calculateLevenshteinDistance(e,a);s<=t&&n.push({term:a,distance:s})}return n.sort((e,t)=>e.distance-t.distance)}async search(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{conversationId:n=null,userId:a=null,messageType:s=null,dateFrom:i=null,dateTo:r=null,hasAttachments:o=null,fuzzyMatch:l=!0,limit:d=100,offset:u=0}=t;if(console.log("\ud83d\udd0d Searching for:",e,"with filters:",t),0===this.searchIndex.size){const e=S.getMessages();await this.buildSearchIndex(e)}const h=this.tokenize(e);let m=[];for(const g of h)if(this.searchIndex.has(g)&&m.push(...this.searchIndex.get(g)),l){const e=this.findSimilarTerms(g,2);for(const{term:t}of e)if(this.searchIndex.has(t)){const e=this.searchIndex.get(t).map(e=>c(c({},e),{},{fuzzyMatch:!0,matchedTerm:t}));m.push(...e)}}let p=Array.from(new Map(m.map(e=>[e.messageId,e])).values());if(n&&(p=p.filter(e=>e.conversationId===n)),a&&(p=p.filter(e=>e.userId===a)),s&&(p=p.filter(e=>e.type===s)),i){const e=new Date(i);p=p.filter(t=>new Date(t.timestamp)>=e)}if(r){const e=new Date(r);p=p.filter(t=>new Date(t.timestamp)<=e)}null!==o&&(p=p.filter(e=>{const t=e.attachments&&e.attachments.length>0;return o?t:!t})),p.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)),e.trim().length>0&&this.addToSearchHistory({query:e,filters:t,resultCount:p.length,timestamp:(new Date).toISOString()});return{success:!0,results:p.slice(u,u+d),total:p.length,query:e,filters:t,page:Math.floor(u/d)+1,totalPages:Math.ceil(p.length/d),hasMore:u+d<p.length}}async searchWithHighlights(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await this.search(e,t),a=this.tokenize(e);return n.results=n.results.map(e=>c(c({},e),{},{highlightedText:this.highlightText(e.text,a)})),n}highlightText(e,t){let n=e;for(const a of t){const e=new RegExp("\\b(".concat(a,")\\b"),"gi");n=n.replace(e,"<mark>$1</mark>")}return n}async getSearchSuggestions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;const n=new Set,a=e.toLowerCase();for(const s of this.searchIndex.keys())if(s.startsWith(a)&&(n.add(s),n.size>=t))break;return this.searchHistory.filter(e=>e.query.toLowerCase().includes(a)).slice(0,t-n.size).map(e=>e.query).forEach(e=>n.add(e)),Array.from(n).slice(0,t)}loadSearchHistory(){try{const e=localStorage.getItem("quibish_search_history");e&&(this.searchHistory=JSON.parse(e))}catch(e){console.error("Failed to load search history:",e),this.searchHistory=[]}}saveSearchHistory(){try{localStorage.setItem("quibish_search_history",JSON.stringify(this.searchHistory))}catch(e){console.error("Failed to save search history:",e)}}addToSearchHistory(e){this.searchHistory=this.searchHistory.filter(t=>t.query!==e.query),this.searchHistory.unshift(e),this.searchHistory.length>this.maxHistoryItems&&(this.searchHistory=this.searchHistory.slice(0,this.maxHistoryItems)),this.saveSearchHistory()}getSearchHistory(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this.searchHistory.slice(0,e)}clearSearchHistory(){this.searchHistory=[],this.saveSearchHistory()}async indexMessage(e){if(!e.text)return;const t=this.tokenize(e.text);for(const n of t)this.searchIndex.has(n)||this.searchIndex.set(n,[]),this.searchIndex.get(n).push({messageId:e.id,conversationId:e.conversationId,userId:e.userId,timestamp:e.timestamp,text:e.text,type:e.type||"text"})}async removeFromIndex(e){for(const[t,n]of this.searchIndex.entries()){const a=n.filter(t=>t.messageId!==e);0===a.length?this.searchIndex.delete(t):this.searchIndex.set(t,a)}}getSearchStats(){return{indexedTerms:this.searchIndex.size,totalMessages:Array.from(this.searchIndex.values()).reduce((e,t)=>e+t.length,0),historyCount:this.searchHistory.length,lastSearched:this.searchHistory.length>0?this.searchHistory[0].timestamp:null}}clearSearchIndex(){this.searchIndex.clear(),console.log("\ud83e\uddf9 Search index cleared")}},Q=e=>{let{isOpen:t,onClose:n,onResultSelect:s,currentConversationId:i=null}=e;const[r,o]=(0,a.useState)(""),[l,d]=(0,a.useState)([]),[u,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(!1),[g,f]=(0,a.useState)([]),[v,y]=(0,a.useState)([]),[b,x]=(0,a.useState)(1),[w,S]=(0,a.useState)(1),[j,N]=(0,a.useState)(0),[C,E]=(0,a.useState)(-1),T=(0,a.useRef)(null),I=(0,a.useRef)(null),[P,D]=(0,a.useState)({conversationId:i,userId:null,messageType:null,dateFrom:null,dateTo:null,hasAttachments:null,fuzzyMatch:!0,limit:20,offset:0});(0,a.useEffect)(()=>{t&&(y(Y.getSearchHistory()),setTimeout(()=>{T.current&&T.current.focus()},100))},[t]),(0,a.useEffect)(()=>{if(r.length>=2){const e=setTimeout(async()=>{const e=await Y.getSearchSuggestions(r,5);f(e)},300);return()=>clearTimeout(e)}f([])},[r]);const A=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e.trim()){h(!0),E(-1);try{const n=c(c({},P),{},{offset:(t-1)*P.limit}),a=await Y.searchWithHighlights(e,n);d(a.results),N(a.total),S(a.totalPages),x(t),console.log("\u2705 Found ".concat(a.total,' results for "').concat(e,'"'))}catch(n){console.error("Search failed:",n),d([])}finally{h(!1),f([])}}else d([])},[r,P]),M=(0,a.useCallback)(e=>{null===e||void 0===e||e.preventDefault(),A(r,1)},[r,A]),R=(0,a.useCallback)((e,t)=>{D(n=>c(c({},n),{},{[e]:t}))},[]),F=(0,a.useCallback)(()=>{A(r,1),p(!1)},[r,A]),L=(0,a.useCallback)(()=>{D({conversationId:i,userId:null,messageType:null,dateFrom:null,dateTo:null,hasAttachments:null,fuzzyMatch:!0,limit:20,offset:0})},[i]),z=(0,a.useCallback)(e=>{s&&s(e),n()},[s,n]),O=(0,a.useCallback)(e=>{e>=1&&e<=w&&A(r,e)},[r,w,A]);(0,a.useEffect)(()=>{const e=e=>{if(t)switch(e.key){case"Escape":n();break;case"ArrowDown":e.preventDefault(),E(e=>e<l.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),E(e=>e>0?e-1:-1);break;case"Enter":C>=0&&l[C]&&z(l[C])}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,l,C,n,z]),(0,a.useEffect)(()=>{if(C>=0&&I.current){const e=I.current.children[C];e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})}},[C]);const _=(0,a.useCallback)(e=>{o(e),A(e,1)},[A]),U=(0,a.useCallback)(e=>{o(e.query),D(t=>c(c({},t),e.filters)),A(e.query,1)},[A]),q=(0,a.useCallback)(()=>{Y.clearSearchHistory(),y([])},[]);return t?(0,k.jsx)("div",{className:"advanced-search-modal-overlay",onClick:n,children:(0,k.jsxs)("div",{className:"advanced-search-modal",onClick:e=>e.stopPropagation(),children:[(0,k.jsxs)("div",{className:"search-modal-header",children:[(0,k.jsx)("h2",{children:"\ud83d\udd0d Advanced Search"}),(0,k.jsx)("button",{className:"close-btn",onClick:n,children:"\u2715"})]}),(0,k.jsxs)("form",{onSubmit:M,className:"search-form",children:[(0,k.jsxs)("div",{className:"search-input-wrapper",children:[(0,k.jsx)("span",{className:"search-icon",children:"\ud83d\udd0d"}),(0,k.jsx)("input",{ref:T,type:"text",className:"search-input",placeholder:"Search messages, conversations, users...",value:r,onChange:e=>o(e.target.value),autoComplete:"off"}),r&&(0,k.jsx)("button",{type:"button",className:"clear-query-btn",onClick:()=>o(""),title:"Clear search",children:"\u2715"})]}),(0,k.jsxs)("div",{className:"search-actions",children:[(0,k.jsx)("button",{type:"submit",className:"search-btn primary",disabled:!r.trim()||u,children:u?"\u23f3 Searching...":"\ud83d\udd0d Search"}),(0,k.jsx)("button",{type:"button",className:"filter-toggle-btn ".concat(m?"active":""),onClick:()=>p(!m),children:"\ud83c\udf9b\ufe0f Filters"})]})]}),g.length>0&&!u&&(0,k.jsxs)("div",{className:"search-suggestions",children:[(0,k.jsx)("div",{className:"suggestions-label",children:"Suggestions:"}),g.map((e,t)=>(0,k.jsx)("button",{className:"suggestion-item",onClick:()=>_(e),children:e},t))]}),m&&(0,k.jsxs)("div",{className:"filters-panel",children:[(0,k.jsxs)("div",{className:"filters-grid",children:[(0,k.jsxs)("div",{className:"filter-group",children:[(0,k.jsx)("label",{children:"Message Type"}),(0,k.jsxs)("select",{value:P.messageType||"",onChange:e=>R("messageType",e.target.value||null),children:[(0,k.jsx)("option",{value:"",children:"All Types"}),(0,k.jsx)("option",{value:"text",children:"Text"}),(0,k.jsx)("option",{value:"image",children:"Image"}),(0,k.jsx)("option",{value:"video",children:"Video"}),(0,k.jsx)("option",{value:"file",children:"File"}),(0,k.jsx)("option",{value:"voice",children:"Voice"})]})]}),(0,k.jsxs)("div",{className:"filter-group",children:[(0,k.jsx)("label",{children:"From Date"}),(0,k.jsx)("input",{type:"date",value:P.dateFrom||"",onChange:e=>R("dateFrom",e.target.value||null)})]}),(0,k.jsxs)("div",{className:"filter-group",children:[(0,k.jsx)("label",{children:"To Date"}),(0,k.jsx)("input",{type:"date",value:P.dateTo||"",onChange:e=>R("dateTo",e.target.value||null)})]}),(0,k.jsxs)("div",{className:"filter-group",children:[(0,k.jsx)("label",{children:"Attachments"}),(0,k.jsxs)("select",{value:null===P.hasAttachments?"":P.hasAttachments.toString(),onChange:e=>{const t=e.target.value;R("hasAttachments",""===t?null:"true"===t)},children:[(0,k.jsx)("option",{value:"",children:"Any"}),(0,k.jsx)("option",{value:"true",children:"With Attachments"}),(0,k.jsx)("option",{value:"false",children:"Without Attachments"})]})]}),(0,k.jsx)("div",{className:"filter-group checkbox-group",children:(0,k.jsxs)("label",{children:[(0,k.jsx)("input",{type:"checkbox",checked:P.fuzzyMatch,onChange:e=>R("fuzzyMatch",e.target.checked)}),(0,k.jsx)("span",{children:"Enable fuzzy matching (typo tolerance)"})]})}),(0,k.jsx)("div",{className:"filter-group checkbox-group",children:(0,k.jsxs)("label",{children:[(0,k.jsx)("input",{type:"checkbox",checked:!!P.conversationId,onChange:e=>R("conversationId",e.target.checked?i:null)}),(0,k.jsx)("span",{children:"Search only in current conversation"})]})})]}),(0,k.jsxs)("div",{className:"filters-actions",children:[(0,k.jsx)("button",{className:"apply-filters-btn",onClick:F,children:"\u2705 Apply Filters"}),(0,k.jsx)("button",{className:"clear-filters-btn",onClick:L,children:"\ud83e\uddf9 Clear Filters"})]})]}),!r&&v.length>0&&(0,k.jsxs)("div",{className:"search-history",children:[(0,k.jsxs)("div",{className:"history-header",children:[(0,k.jsx)("h3",{children:"Recent Searches"}),(0,k.jsx)("button",{className:"clear-history-btn",onClick:q,children:"Clear"})]}),(0,k.jsx)("div",{className:"history-list",children:v.map((e,t)=>(0,k.jsxs)("div",{className:"history-item",onClick:()=>U(e),children:[(0,k.jsxs)("span",{className:"history-query",children:["\ud83d\udd0d ",e.query]}),(0,k.jsxs)("span",{className:"history-count",children:[e.resultCount," results"]})]},t))})]}),(0,k.jsxs)("div",{className:"search-results-container",children:[u&&(0,k.jsxs)("div",{className:"search-loading",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("p",{children:"Searching messages..."})]}),!u&&l.length>0&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"results-header",children:[(0,k.jsxs)("span",{className:"results-count",children:["Found ",j," result",1!==j?"s":"",' for "',r,'"']}),(0,k.jsxs)("span",{className:"results-page",children:["Page ",b," of ",w]})]}),(0,k.jsx)("div",{className:"search-results",ref:I,children:l.map((e,t)=>(0,k.jsxs)("div",{className:"search-result-item ".concat(t===C?"selected":""," ").concat(e.fuzzyMatch?"fuzzy-match":""),onClick:()=>z(e),children:[(0,k.jsxs)("div",{className:"result-header",children:[(0,k.jsx)("span",{className:"result-user",children:e.userId||"Unknown User"}),(0,k.jsx)("span",{className:"result-timestamp",children:new Date(e.timestamp).toLocaleString()})]}),(0,k.jsx)("div",{className:"result-text",dangerouslySetInnerHTML:{__html:e.highlightedText||e.text}}),e.fuzzyMatch&&(0,k.jsx)("div",{className:"fuzzy-badge",title:"Matched term: ".concat(e.matchedTerm),children:"~ Fuzzy Match"})]},e.messageId))}),w>1&&(0,k.jsxs)("div",{className:"search-pagination",children:[(0,k.jsx)("button",{className:"page-btn",onClick:()=>O(b-1),disabled:1===b,children:"\u2190 Previous"}),(0,k.jsx)("div",{className:"page-numbers",children:Array.from({length:Math.min(w,5)},(e,t)=>{let n;return n=w<=5||b<=3?t+1:b>=w-2?w-4+t:b-2+t,(0,k.jsx)("button",{className:"page-number ".concat(b===n?"active":""),onClick:()=>O(n),children:n},n)})}),(0,k.jsx)("button",{className:"page-btn",onClick:()=>O(b+1),disabled:b===w,children:"Next \u2192"})]})]}),!u&&r&&0===l.length&&(0,k.jsxs)("div",{className:"no-results",children:[(0,k.jsx)("div",{className:"no-results-icon",children:"\ud83d\udd0d"}),(0,k.jsx)("h3",{children:"No results found"}),(0,k.jsx)("p",{children:"Try different keywords or adjust your filters"})]}),!u&&!r&&0===l.length&&(0,k.jsxs)("div",{className:"search-tips",children:[(0,k.jsx)("h3",{children:"\ud83d\udca1 Search Tips"}),(0,k.jsxs)("ul",{children:[(0,k.jsx)("li",{children:"Use specific keywords for better results"}),(0,k.jsx)("li",{children:"Enable fuzzy matching to find messages with typos"}),(0,k.jsx)("li",{children:"Use date filters to narrow down your search"}),(0,k.jsx)("li",{children:"Filter by message type (text, image, video, etc.)"}),(0,k.jsx)("li",{children:"Use keyboard shortcuts: \u2191\u2193 to navigate, Enter to select, Esc to close"})]})]})]}),(0,k.jsxs)("div",{className:"search-shortcuts",children:[(0,k.jsxs)("span",{className:"shortcut",children:[(0,k.jsx)("kbd",{children:"\u2191"})," ",(0,k.jsx)("kbd",{children:"\u2193"})," Navigate"]}),(0,k.jsxs)("span",{className:"shortcut",children:[(0,k.jsx)("kbd",{children:"Enter"})," Select"]}),(0,k.jsxs)("span",{className:"shortcut",children:[(0,k.jsx)("kbd",{children:"Esc"})," Close"]}),(0,k.jsxs)("span",{className:"shortcut",children:[(0,k.jsx)("kbd",{children:"Ctrl"})," + ",(0,k.jsx)("kbd",{children:"F"})," Search"]})]})]})}):null};const $=new class{constructor(){this.isInitialized=!1,this.smartReplyCache=new Map,this.translationCache=new Map,this.sentimentCache=new Map,this.replyPatterns={greetings:{patterns:[/\b(hi|hello|hey|good morning|good afternoon|good evening)\b/i],replies:["\ud83d\udc4b Hello! How are you?","Hey there! \ud83d\ude0a","Hi! What's up?","Hello! Nice to hear from you!","Hey! How's it going?"]},questions:{patterns:[/\bhow are you\b/i,/\bhow's it going\b/i,/\bwhat's up\b/i],replies:["I'm doing great, thanks! How about you?","Pretty good! What about you?","All good here! How are things with you?","Doing well! How's your day going?","Great! Thanks for asking! \ud83d\ude0a"]},thanks:{patterns:[/\b(thank you|thanks|thx|appreciate it)\b/i],replies:["You're welcome! \ud83d\ude0a","No problem!","Happy to help!","Anytime!","My pleasure! \ud83d\udc4d"]},agreement:{patterns:[/\b(yes|yeah|yep|sure|okay|ok|sounds good)\b/i],replies:["\ud83d\udc4d Perfect!","Great! \u2728","Awesome! \ud83c\udf89","Cool! \ud83d\ude0e","Sounds good! \ud83d\udc4c"]},disagreement:{patterns:[/\b(no|nope|nah|not really|disagree)\b/i],replies:["I understand.","No worries!","That's okay!","Got it. \ud83d\udc4d","Fair enough!"]},help:{patterns:[/\b(help|need|problem|issue|stuck)\b/i],replies:["I'm here to help! What's the issue?","What do you need help with?","I'd be happy to assist! What's up?","Let me help you with that!","Tell me more about the problem."]},apology:{patterns:[/\b(sorry|apologize|my bad|oops)\b/i],replies:["No worries at all! \ud83d\ude0a","It's all good!","Don't worry about it!","No problem whatsoever!","All is forgiven! \ud83d\udc99"]},meeting:{patterns:[/\b(meet|meeting|call|schedule|appointment)\b/i],replies:["\ud83d\udcc5 When works best for you?","Sure! What time is good?","Let's schedule it! When are you free?","I'm available. What day works?","Great! Let me know your availability."]},goodbye:{patterns:[/\b(bye|goodbye|see you|talk later|ttyl)\b/i],replies:["\ud83d\udc4b See you later!","Goodbye! Take care!","Talk to you soon! \ud83d\ude0a","Bye! Have a great day!","See ya! \ud83d\udc4b"]},excitement:{patterns:[/\b(awesome|amazing|great|fantastic|excellent|wonderful)\b/i],replies:["\ud83c\udf89 That's fantastic!","So happy for you! \u2728","Awesome! \ud83d\ude4c","That's wonderful news!","Incredible! \ud83d\ude04"]}},this.sentimentKeywords={positive:["happy","great","good","excellent","awesome","love","wonderful","fantastic","amazing","perfect","thanks","appreciate"],negative:["bad","terrible","awful","hate","angry","upset","disappointed","sad","sorry","problem","issue","wrong"],neutral:["okay","fine","alright","maybe","perhaps","think","consider","understand"]},this.emojiSuggestions={happy:["\ud83d\ude0a","\ud83d\ude04","\ud83c\udf89","\u2728","\ud83d\udc99","\ud83c\udf1f"],sad:["\ud83d\ude22","\ud83d\ude14","\ud83d\udc94","\ud83d\ude1e","\ud83e\udd7a"],angry:["\ud83d\ude20","\ud83d\ude21","\ud83d\udca2","\ud83e\udd2c"],love:["\u2764\ufe0f","\ud83d\udc95","\ud83d\udc96","\ud83d\ude0d","\ud83e\udd70"],laugh:["\ud83d\ude02","\ud83e\udd23","\ud83d\ude06","\ud83d\ude01"],thinking:["\ud83e\udd14","\ud83d\udcad","\ud83e\uddd0"],celebration:["\ud83c\udf89","\ud83c\udf8a","\ud83e\udd73","\ud83c\udf7e","\u2728"],work:["\ud83d\udcbc","\ud83d\udcca","\ud83d\udcbb","\ud83d\udcdd","\u2705"],food:["\ud83c\udf55","\ud83c\udf54","\ud83c\udf70","\u2615","\ud83c\udf5c"]},this.initialize()}async initialize(){try{console.log("\ud83e\udd16 Initializing AI Service..."),this.capabilities={translation:"Intl"in window,textAnalysis:!0,speechRecognition:"webkitSpeechRecognition"in window||"SpeechRecognition"in window},this.isInitialized=!0,console.log("\u2705 AI Service initialized",this.capabilities)}catch(e){console.error("\u274c Failed to initialize AI Service:",e)}}async generateSmartReplies(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];try{const n="".concat(e,"-").concat(t.length);if(this.smartReplyCache.has(n))return this.smartReplyCache.get(n);const a=[],s=e.text||e,i=s.toLowerCase();for(const[e,t]of Object.entries(this.replyPatterns))for(const n of t.patterns)if(n.test(i)){const n=this.getRandomReplies(t.replies,2);a.push(...n.map(t=>({text:t,category:e,confidence:.8+.2*Math.random()})))}if(t.length>0){const e=this.generateContextualReplies(s,t);a.push(...e)}const r=this.suggestEmoji(s);r&&a.push(r);const o=this.deduplicateReplies(a).sort((e,t)=>t.confidence-e.confidence).slice(0,6);return this.smartReplyCache.set(n,o),o}catch(n){return console.error("Failed to generate smart replies:",n),[]}}generateContextualReplies(e,t){const n=[];return e.includes("?")&&n.push({text:"Yes, absolutely! \u2705",category:"contextual",confidence:.75},{text:"No, not really.",category:"contextual",confidence:.75},{text:"Let me think about it \ud83e\udd14",category:"contextual",confidence:.7}),/\b(when|time|date|schedule)\b/i.test(e)&&n.push({text:"How about tomorrow?",category:"contextual",confidence:.8},{text:"I'm free this week!",category:"contextual",confidence:.8}),/\b(confirm|verify|check|make sure)\b/i.test(e)&&n.push({text:"Confirmed! \u2705",category:"contextual",confidence:.85},{text:"Yes, I can confirm that.",category:"contextual",confidence:.85}),n}suggestEmoji(e){const t=e.toLowerCase();if(/\b(happy|joy|great|awesome|love|wonderful)\b/i.test(t)){return{text:this.emojiSuggestions.happy[0],category:"emoji",confidence:.7,isEmoji:!0}}if(/\b(haha|lol|funny|hilarious)\b/i.test(t)){return{text:this.emojiSuggestions.laugh[0],category:"emoji",confidence:.7,isEmoji:!0}}if(/\b(think|wonder|consider|maybe)\b/i.test(t)){return{text:this.emojiSuggestions.thinking[0],category:"emoji",confidence:.65,isEmoji:!0}}if(/\b(celebrate|party|congrats|yay)\b/i.test(t)){return{text:this.emojiSuggestions.celebration[0],category:"emoji",confidence:.75,isEmoji:!0}}return null}async analyzeSentiment(e){try{const t=e.text||e,n=t.toLowerCase().split(/\s+/);let a=0,s=0,i=0;n.forEach(e=>{this.sentimentKeywords.positive.some(t=>e.includes(t))&&a++,this.sentimentKeywords.negative.some(t=>e.includes(t))&&s++,this.sentimentKeywords.neutral.some(t=>e.includes(t))&&i++}),/!+/.test(t)&&(a+=.5),/\?{2,}/.test(t)&&(i+=.5),/\.{3,}/.test(t)&&(i+=.5);const r=t.match(/(?:\uD83D[\uDE00-\uDE4F])/g)||[];r.length>0&&(a+=.3*r.length);const o=a+s+i||1;return{positive:a/o,negative:s/o,neutral:i/o,overall:a>s?"positive":s>a?"negative":"neutral",confidence:Math.max(a,s,i)/o,score:(a-s)/o}}catch(t){return console.error("Failed to analyze sentiment:",t),{positive:.33,negative:.33,neutral:.34,overall:"neutral",confidence:.5,score:0}}}async translateMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto";try{const a="".concat(e,"-").concat(n,"-").concat(t);if(this.translationCache.has(a))return this.translationCache.get(a);const s={text:e,sourceLanguage:"auto"===n?this.detectLanguage(e):n,targetLanguage:t,confidence:.85,translatedText:await this.mockTranslate(e,t)};return this.translationCache.set(a,s),s}catch(a){return console.error("Translation failed:",a),{text:e,sourceLanguage:"unknown",targetLanguage:t,confidence:0,translatedText:e,error:a.message}}}async mockTranslate(e,t){const n=e.toLowerCase(),a={es:{hello:"hola",goodbye:"adi\xf3s",thanks:"gracias"},fr:{hello:"bonjour",goodbye:"au revoir",thanks:"merci"},de:{hello:"hallo",goodbye:"auf wiedersehen",thanks:"danke"},it:{hello:"ciao",goodbye:"arrivederci",thanks:"grazie"},pt:{hello:"ol\xe1",goodbye:"tchau",thanks:"obrigado"},ja:{hello:"\u3053\u3093\u306b\u3061\u306f",goodbye:"\u3055\u3088\u3046\u306a\u3089",thanks:"\u3042\u308a\u304c\u3068\u3046"},zh:{hello:"\u4f60\u597d",goodbye:"\u518d\u89c1",thanks:"\u8c22\u8c22"}}[t];if(a){if(n.includes("hello")||n.includes("hi"))return a.hello;if(n.includes("bye")||n.includes("goodbye"))return a.goodbye;if(n.includes("thank"))return a.thanks}return"[".concat(t,"] ").concat(e)}detectLanguage(e){return/[\u4e00-\u9fa5]/.test(e)?"zh":/[\u3040-\u309f\u30a0-\u30ff]/.test(e)?"ja":/[\u0600-\u06ff]/.test(e)?"ar":/[\u0400-\u04ff]/.test(e)?"ru":/[\u0e00-\u0e7f]/.test(e)?"th":"en"}async enhanceMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{tone:n="neutral",fixGrammar:a=!0,addEmoji:s=!1}=t;try{let t=e;if(a&&(t=this.fixCommonGrammar(t)),t=this.adjustTone(t,n),s){const e=this.getSuggestedEmojiForTone(n);e&&(t+=" ".concat(e))}return{original:e,enhanced:t,changes:this.getChanges(e,t),tone:n}}catch(i){return console.error("Failed to enhance message:",i),{original:e,enhanced:e,changes:[],tone:n,error:i.message}}}fixCommonGrammar(e){let t=e;t=t.charAt(0).toUpperCase()+t.slice(1);return Object.entries({teh:"the",recieve:"receive",definately:"definitely",seperate:"separate",occured:"occurred",untill:"until",wierd:"weird"}).forEach(e=>{let[n,a]=e;const s=new RegExp("\\b".concat(n,"\\b"),"gi");t=t.replace(s,a)}),/[.!?]$/.test(t)||(t+="."),t}adjustTone(e,t){switch(t){case"professional":return e.replace(/\b(hey|hi)\b/gi,"Hello").replace(/\b(yeah|yep)\b/gi,"Yes").replace(/\b(nope|nah)\b/gi,"No").replace(/\b(gonna)\b/gi,"going to").replace(/\b(wanna)\b/gi,"want to");case"casual":return e.replace(/\bHello\b/g,"Hey").replace(/\bYes\b/g,"Yeah").replace(/\bNo\b/g,"Nope");case"friendly":return e.includes("!")||(e=e.replace(/\.$/,"!")),e;case"formal":return e.replace(/!/g,".").replace(/\b(hi|hey)\b/gi,"Greetings").replace(/\b(thanks)\b/gi,"Thank you");default:return e}}getSuggestedEmojiForTone(e){return{casual:"\ud83d\ude0a",professional:"\ud83d\udce7",friendly:"\ud83c\udf1f",formal:"",happy:"\ud83d\ude04",excited:"\ud83c\udf89"}[e]||""}getChanges(e,t){const n=[];return e!==t&&n.push({type:"text",from:e,to:t}),n}getRandomReplies(e,t){return[...e].sort(()=>Math.random()-.5).slice(0,t)}deduplicateReplies(e){const t=new Set;return e.filter(e=>{const n=e.text.toLowerCase();return!t.has(n)&&(t.add(n),!0)})}async autoComplete(e){const t=[],n=e.toLowerCase();return n.startsWith("how ")?t.push("How are you?","How can I help?","How about tomorrow?"):n.startsWith("what ")?t.push("What do you think?","What time works?","What about later?"):n.startsWith("can ")&&t.push("Can we schedule a call?","Can you help me?","Can we meet?"),t.slice(0,3)}clearCaches(){this.smartReplyCache.clear(),this.translationCache.clear(),this.sentimentCache.clear()}getStats(){return{initialized:this.isInitialized,capabilities:this.capabilities,cacheSize:{smartReplies:this.smartReplyCache.size,translations:this.translationCache.size,sentiment:this.sentimentCache.size}}}},X=e=>{let{lastMessage:t,conversationHistory:n=[],onReplySelect:s,onClose:i,isVisible:r=!1}=e;const[o,l]=(0,a.useState)([]),[c,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)(null);(0,a.useEffect)(()=>{t&&r&&(m(),p())},[t,r]);const m=(0,a.useCallback)(async()=>{if(t){d(!0);try{const e=await $.generateSmartReplies(t,n);l(e)}catch(e){console.error("Failed to generate smart replies:",e),l([])}finally{d(!1)}}},[t,n]),p=(0,a.useCallback)(async()=>{if(t)try{const e=await $.analyzeSentiment(t);h(e)}catch(e){console.error("Failed to analyze sentiment:",e)}},[t]);return r?(0,k.jsxs)("div",{className:"smart-replies-panel",children:[(0,k.jsxs)("div",{className:"smart-replies-header",children:[(0,k.jsxs)("div",{className:"header-left",children:[(0,k.jsx)("span",{className:"ai-icon",children:"\ud83e\udd16"}),(0,k.jsx)("h4",{children:"Smart Replies"})]}),u&&(0,k.jsxs)("div",{className:"sentiment-indicator",style:{color:u?"positive"===u.overall?"#10b981":"negative"===u.overall?"#ef4444":"#6b7280":"#9ca3af"},children:[(0,k.jsx)("span",{className:"sentiment-emoji",children:u?"positive"===u.overall?"\ud83d\ude0a":"negative"===u.overall?"\ud83d\ude1f":"\ud83d\ude10":"\ud83d\ude10"}),(0,k.jsx)("span",{className:"sentiment-label",children:u.overall})]})]}),c&&(0,k.jsxs)("div",{className:"smart-replies-loading",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("p",{children:"Generating suggestions..."})]}),!c&&o.length>0&&(0,k.jsx)("div",{className:"smart-replies-list",children:o.map((e,t)=>(0,k.jsxs)("button",{className:"smart-reply-btn ".concat(e.isEmoji?"emoji-reply":""),onClick:()=>(e=>{s&&s(e.text)})(e),title:"".concat(Math.round(100*e.confidence),"% confidence"),children:[(0,k.jsx)("span",{className:"reply-text",children:e.text}),e.confidence>.8&&!e.isEmoji&&(0,k.jsx)("span",{className:"confidence-badge",children:"\u2728"}),e.category&&!e.isEmoji&&(0,k.jsx)("span",{className:"category-tag",children:e.category})]},t))}),!c&&0===o.length&&(0,k.jsxs)("div",{className:"smart-replies-empty",children:[(0,k.jsx)("span",{className:"empty-icon",children:"\ud83d\udcad"}),(0,k.jsx)("p",{children:"No suggestions available"})]}),(0,k.jsxs)("div",{className:"smart-replies-footer",children:[(0,k.jsx)("button",{className:"refresh-btn",onClick:m,children:"\ud83d\udd04 Refresh"}),(0,k.jsx)("span",{className:"ai-powered",children:"Powered by AI"})]})]}):null},Z=e=>{let{message:t,onTranslate:n,onEnhance:s,onClose:i,isVisible:r=!1}=e;const[o,l]=(0,a.useState)("translate"),[c,d]=(0,a.useState)("es"),[u,h]=(0,a.useState)("professional"),[m,p]=(0,a.useState)(!1),[g,f]=(0,a.useState)(null);return r?(0,k.jsxs)("div",{className:"ai-enhancement-panel",children:[(0,k.jsxs)("div",{className:"enhancement-header",children:[(0,k.jsx)("h4",{children:"\ud83e\udd16 AI Enhancement"}),(0,k.jsx)("button",{className:"close-btn",onClick:i,children:"\xd7"})]}),(0,k.jsxs)("div",{className:"enhancement-tabs",children:[(0,k.jsx)("button",{className:"tab-btn ".concat("translate"===o?"active":""),onClick:()=>l("translate"),children:"\ud83c\udf10 Translate"}),(0,k.jsx)("button",{className:"tab-btn ".concat("enhance"===o?"active":""),onClick:()=>l("enhance"),children:"\u2728 Enhance"})]}),(0,k.jsxs)("div",{className:"original-message",children:[(0,k.jsx)("div",{className:"message-label",children:"Original:"}),(0,k.jsx)("div",{className:"message-text",children:(null===t||void 0===t?void 0:t.text)||t})]}),"translate"===o&&(0,k.jsxs)("div",{className:"translate-content",children:[(0,k.jsxs)("div",{className:"language-selector",children:[(0,k.jsx)("label",{children:"Target Language:"}),(0,k.jsx)("div",{className:"language-grid",children:[{code:"es",name:"Spanish",flag:"\ud83c\uddea\ud83c\uddf8"},{code:"fr",name:"French",flag:"\ud83c\uddeb\ud83c\uddf7"},{code:"de",name:"German",flag:"\ud83c\udde9\ud83c\uddea"},{code:"it",name:"Italian",flag:"\ud83c\uddee\ud83c\uddf9"},{code:"pt",name:"Portuguese",flag:"\ud83c\uddf5\ud83c\uddf9"},{code:"ja",name:"Japanese",flag:"\ud83c\uddef\ud83c\uddf5"},{code:"zh",name:"Chinese",flag:"\ud83c\udde8\ud83c\uddf3"},{code:"ko",name:"Korean",flag:"\ud83c\uddf0\ud83c\uddf7"},{code:"ar",name:"Arabic",flag:"\ud83c\uddf8\ud83c\udde6"},{code:"ru",name:"Russian",flag:"\ud83c\uddf7\ud83c\uddfa"}].map(e=>(0,k.jsxs)("button",{className:"language-btn ".concat(c===e.code?"active":""),onClick:()=>d(e.code),children:[(0,k.jsx)("span",{className:"flag",children:e.flag}),(0,k.jsx)("span",{className:"lang-name",children:e.name})]},e.code))})]}),(0,k.jsx)("button",{className:"action-btn translate-btn",onClick:async()=>{if(t){p(!0);try{const e=t.text||t,a=await $.translateMessage(e,c);f(a),n&&n(a)}catch(e){console.error("Translation failed:",e)}finally{p(!1)}}},disabled:m,children:m?"\u23f3 Translating...":"\ud83c\udf10 Translate Now"})]}),"enhance"===o&&(0,k.jsxs)("div",{className:"enhance-content",children:[(0,k.jsxs)("div",{className:"tone-selector",children:[(0,k.jsx)("label",{children:"Select Tone:"}),(0,k.jsx)("div",{className:"tone-grid",children:[{value:"professional",label:"Professional",icon:"\ud83d\udcbc"},{value:"casual",label:"Casual",icon:"\ud83d\ude0a"},{value:"friendly",label:"Friendly",icon:"\ud83c\udf1f"},{value:"formal",label:"Formal",icon:"\ud83c\udfa9"}].map(e=>(0,k.jsxs)("button",{className:"tone-btn ".concat(u===e.value?"active":""),onClick:()=>h(e.value),children:[(0,k.jsx)("span",{className:"tone-icon",children:e.icon}),(0,k.jsx)("span",{className:"tone-label",children:e.label})]},e.value))})]}),(0,k.jsxs)("div",{className:"enhancement-options",children:[(0,k.jsxs)("label",{className:"checkbox-label",children:[(0,k.jsx)("input",{type:"checkbox",defaultChecked:!0}),(0,k.jsx)("span",{children:"Fix grammar & spelling"})]}),(0,k.jsxs)("label",{className:"checkbox-label",children:[(0,k.jsx)("input",{type:"checkbox",defaultChecked:!0}),(0,k.jsx)("span",{children:"Add appropriate emoji"})]})]}),(0,k.jsx)("button",{className:"action-btn enhance-btn",onClick:async()=>{if(t){p(!0);try{const e=t.text||t,n=await $.enhanceMessage(e,{tone:u,fixGrammar:!0,addEmoji:!0});f(n),s&&s(n)}catch(e){console.error("Enhancement failed:",e)}finally{p(!1)}}},disabled:m,children:m?"\u23f3 Enhancing...":"\u2728 Enhance Message"})]}),g&&(0,k.jsxs)("div",{className:"result-section",children:[(0,k.jsxs)("div",{className:"result-header",children:[(0,k.jsx)("span",{className:"result-label",children:"translate"===o?"\ud83c\udf10 Translation:":"\u2728 Enhanced:"}),(0,k.jsx)("button",{className:"copy-btn",onClick:()=>(async e=>{try{await navigator.clipboard.writeText(e),alert("Copied to clipboard!")}catch(t){console.error("Failed to copy:",t)}})("translate"===o?g.translatedText:g.enhanced),children:"\ud83d\udccb Copy"})]}),(0,k.jsx)("div",{className:"result-text",children:"translate"===o?g.translatedText:g.enhanced}),"translate"===o&&g.confidence&&(0,k.jsxs)("div",{className:"result-meta",children:[(0,k.jsxs)("span",{className:"confidence-badge",children:["Confidence: ",Math.round(100*g.confidence),"%"]}),(0,k.jsxs)("span",{className:"lang-badge",children:[g.sourceLanguage," \u2192 ",g.targetLanguage]})]}),"enhance"===o&&g.changes&&g.changes.length>0&&(0,k.jsxs)("div",{className:"result-meta",children:[(0,k.jsxs)("span",{className:"changes-badge",children:[g.changes.length," change",1!==g.changes.length?"s":""," made"]}),(0,k.jsxs)("span",{className:"tone-badge",children:["Tone: ",g.tone]})]})]}),(0,k.jsx)("div",{className:"enhancement-footer",children:(0,k.jsx)("span",{className:"ai-notice",children:"\u26a1 Powered by AI \u2022 Results may vary"})})]}):null},ee=e=>{let{isOpen:t,onClose:n,onCall:s,initialNumber:i=""}=e;const[r,o]=(0,a.useState)(i),[l,c]=(0,a.useState)("US"),[d,u]=(0,a.useState)(""),[h,m]=(0,a.useState)(!1),[p,g]=(0,a.useState)([]),[f,v]=(0,a.useState)(!1),y=[{code:"US",name:"United States",dialCode:"+1",flag:"\ud83c\uddfa\ud83c\uddf8"},{code:"CA",name:"Canada",dialCode:"+1",flag:"\ud83c\udde8\ud83c\udde6"},{code:"GB",name:"United Kingdom",dialCode:"+44",flag:"\ud83c\uddec\ud83c\udde7"},{code:"DE",name:"Germany",dialCode:"+49",flag:"\ud83c\udde9\ud83c\uddea"},{code:"FR",name:"France",dialCode:"+33",flag:"\ud83c\uddeb\ud83c\uddf7"},{code:"IT",name:"Italy",dialCode:"+39",flag:"\ud83c\uddee\ud83c\uddf9"},{code:"ES",name:"Spain",dialCode:"+34",flag:"\ud83c\uddea\ud83c\uddf8"},{code:"NL",name:"Netherlands",dialCode:"+31",flag:"\ud83c\uddf3\ud83c\uddf1"},{code:"AU",name:"Australia",dialCode:"+61",flag:"\ud83c\udde6\ud83c\uddfa"},{code:"JP",name:"Japan",dialCode:"+81",flag:"\ud83c\uddef\ud83c\uddf5"},{code:"KR",name:"South Korea",dialCode:"+82",flag:"\ud83c\uddf0\ud83c\uddf7"},{code:"CN",name:"China",dialCode:"+86",flag:"\ud83c\udde8\ud83c\uddf3"},{code:"IN",name:"India",dialCode:"+91",flag:"\ud83c\uddee\ud83c\uddf3"},{code:"BR",name:"Brazil",dialCode:"+55",flag:"\ud83c\udde7\ud83c\uddf7"},{code:"MX",name:"Mexico",dialCode:"+52",flag:"\ud83c\uddf2\ud83c\uddfd"},{code:"RU",name:"Russia",dialCode:"+7",flag:"\ud83c\uddf7\ud83c\uddfa"},{code:"ZA",name:"South Africa",dialCode:"+27",flag:"\ud83c\uddff\ud83c\udde6"},{code:"EG",name:"Egypt",dialCode:"+20",flag:"\ud83c\uddea\ud83c\uddec"},{code:"NG",name:"Nigeria",dialCode:"+234",flag:"\ud83c\uddf3\ud83c\uddec"},{code:"KE",name:"Kenya",dialCode:"+254",flag:"\ud83c\uddf0\ud83c\uddea"},{code:"SG",name:"Singapore",dialCode:"+65",flag:"\ud83c\uddf8\ud83c\uddec"},{code:"TH",name:"Thailand",dialCode:"+66",flag:"\ud83c\uddf9\ud83c\uddad"},{code:"VN",name:"Vietnam",dialCode:"+84",flag:"\ud83c\uddfb\ud83c\uddf3"},{code:"PH",name:"Philippines",dialCode:"+63",flag:"\ud83c\uddf5\ud83c\uddad"},{code:"ID",name:"Indonesia",dialCode:"+62",flag:"\ud83c\uddee\ud83c\udde9"},{code:"MY",name:"Malaysia",dialCode:"+60",flag:"\ud83c\uddf2\ud83c\uddfe"},{code:"PK",name:"Pakistan",dialCode:"+92",flag:"\ud83c\uddf5\ud83c\uddf0"},{code:"BD",name:"Bangladesh",dialCode:"+880",flag:"\ud83c\udde7\ud83c\udde9"},{code:"LK",name:"Sri Lanka",dialCode:"+94",flag:"\ud83c\uddf1\ud83c\uddf0"},{code:"AE",name:"UAE",dialCode:"+971",flag:"\ud83c\udde6\ud83c\uddea"},{code:"SA",name:"Saudi Arabia",dialCode:"+966",flag:"\ud83c\uddf8\ud83c\udde6"},{code:"TR",name:"Turkey",dialCode:"+90",flag:"\ud83c\uddf9\ud83c\uddf7"},{code:"IL",name:"Israel",dialCode:"+972",flag:"\ud83c\uddee\ud83c\uddf1"},{code:"AR",name:"Argentina",dialCode:"+54",flag:"\ud83c\udde6\ud83c\uddf7"},{code:"CL",name:"Chile",dialCode:"+56",flag:"\ud83c\udde8\ud83c\uddf1"},{code:"CO",name:"Colombia",dialCode:"+57",flag:"\ud83c\udde8\ud83c\uddf4"},{code:"PE",name:"Peru",dialCode:"+51",flag:"\ud83c\uddf5\ud83c\uddea"}];(0,a.useEffect)(()=>{const e=JSON.parse(localStorage.getItem("international_call_history")||"[]");g(e)},[]);const b=y.find(e=>e.code===l)||y[0],x=y.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())||e.dialCode.includes(d)||e.code.toLowerCase().includes(d.toLowerCase())),w=e=>{o(t=>t+e)},S=()=>r.length>=3;return t?(0,k.jsx)("div",{className:"dialer-overlay",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,k.jsxs)("div",{className:"dialer-modal",children:[(0,k.jsxs)("div",{className:"dialer-header",children:[(0,k.jsx)("h3",{children:"\ud83c\udf0d International Dialer"}),(0,k.jsx)("button",{className:"close-btn",onClick:n,children:"\xd7"})]}),(0,k.jsxs)("div",{className:"dialer-content",children:[(0,k.jsxs)("div",{className:"country-selector",children:[(0,k.jsxs)("button",{className:"country-btn",onClick:()=>m(!h),children:[(0,k.jsx)("span",{className:"country-flag",children:b.flag}),(0,k.jsxs)("span",{className:"country-info",children:[(0,k.jsx)("span",{className:"country-name",children:b.name}),(0,k.jsx)("span",{className:"country-code",children:b.dialCode})]}),(0,k.jsx)("span",{className:"dropdown-arrow",children:"\u25bc"})]}),h&&(0,k.jsxs)("div",{className:"country-dropdown",children:[(0,k.jsx)("div",{className:"country-search",children:(0,k.jsx)("input",{type:"text",placeholder:"Search countries...",value:d,onChange:e=>u(e.target.value),className:"country-search-input"})}),(0,k.jsx)("div",{className:"country-list",children:x.map(e=>(0,k.jsxs)("button",{className:"country-item",onClick:()=>(e=>{c(e.code),m(!1),u("")})(e),children:[(0,k.jsx)("span",{className:"country-flag",children:e.flag}),(0,k.jsxs)("span",{className:"country-details",children:[(0,k.jsx)("span",{className:"country-name",children:e.name}),(0,k.jsx)("span",{className:"country-code",children:e.dialCode})]})]},e.code))})]})]}),(0,k.jsxs)("div",{className:"number-display",children:[(0,k.jsx)("input",{type:"text",value:(j=r,N=b,j?"".concat(N.dialCode," ").concat(j):N.dialCode),readOnly:!0,className:"number-input",placeholder:"".concat(b.dialCode," Enter number")}),(0,k.jsxs)("div",{className:"display-actions",children:[r&&(0,k.jsx)("button",{className:"clear-btn",onClick:()=>{o("")},children:"\ud83d\uddd1\ufe0f"}),(0,k.jsx)("button",{className:"history-btn",onClick:()=>v(!f),title:"Call History",children:"\ud83d\udd70\ufe0f"})]})]}),f&&p.length>0&&(0,k.jsxs)("div",{className:"call-history",children:[(0,k.jsx)("h4",{children:"Recent Calls"}),(0,k.jsx)("div",{className:"history-list",children:p.slice(0,5).map(e=>(0,k.jsxs)("button",{className:"history-item",onClick:()=>{return c((t=e).country.code),o(t.localNumber),void v(!1);var t},children:[(0,k.jsx)("span",{className:"history-flag",children:e.country.flag}),(0,k.jsx)("span",{className:"history-number",children:e.number}),(0,k.jsx)("span",{className:"history-time",children:new Date(e.timestamp).toLocaleDateString()})]},e.id))})]}),(0,k.jsxs)("div",{className:"number-pad",children:[(0,k.jsxs)("div",{className:"pad-row",children:[(0,k.jsx)("button",{onClick:()=>w("1"),children:"1"}),(0,k.jsxs)("button",{onClick:()=>w("2"),children:["2",(0,k.jsx)("span",{children:"ABC"})]}),(0,k.jsxs)("button",{onClick:()=>w("3"),children:["3",(0,k.jsx)("span",{children:"DEF"})]})]}),(0,k.jsxs)("div",{className:"pad-row",children:[(0,k.jsxs)("button",{onClick:()=>w("4"),children:["4",(0,k.jsx)("span",{children:"GHI"})]}),(0,k.jsxs)("button",{onClick:()=>w("5"),children:["5",(0,k.jsx)("span",{children:"JKL"})]}),(0,k.jsxs)("button",{onClick:()=>w("6"),children:["6",(0,k.jsx)("span",{children:"MNO"})]})]}),(0,k.jsxs)("div",{className:"pad-row",children:[(0,k.jsxs)("button",{onClick:()=>w("7"),children:["7",(0,k.jsx)("span",{children:"PQRS"})]}),(0,k.jsxs)("button",{onClick:()=>w("8"),children:["8",(0,k.jsx)("span",{children:"TUV"})]}),(0,k.jsxs)("button",{onClick:()=>w("9"),children:["9",(0,k.jsx)("span",{children:"WXYZ"})]})]}),(0,k.jsxs)("div",{className:"pad-row",children:[(0,k.jsx)("button",{onClick:()=>w("*"),children:"*"}),(0,k.jsxs)("button",{onClick:()=>w("0"),children:["0",(0,k.jsx)("span",{children:"+"})]}),(0,k.jsx)("button",{onClick:()=>w("#"),children:"#"})]})]}),(0,k.jsxs)("div",{className:"dialer-actions",children:[(0,k.jsx)("button",{className:"backspace-btn",onClick:()=>{o(e=>e.slice(0,-1))},disabled:!r,children:"\u232b"}),(0,k.jsx)("button",{className:"call-btn ".concat(S()?"enabled":"disabled"),onClick:()=>{if(!S())return void alert("Please enter a valid phone number");const e="".concat(b.dialCode).concat(r),t=[{id:Date.now(),number:e,country:b,localNumber:r,timestamp:(new Date).toISOString(),type:"outgoing"},...p.slice(0,49)];g(t),localStorage.setItem("international_call_history",JSON.stringify(t)),s&&s({number:e,country:b,localNumber:r}),n()},disabled:!S(),children:"\ud83d\udcde Call"})]})]})]})}):null;var j,N};const te=new class{constructor(){this.threads=new Map,this.messageToThread=new Map,this.listeners={onThreadCreated:[],onReplyAdded:[],onThreadUpdated:[],onThreadDeleted:[]},this.initialized=!1,console.log("\ud83d\udcac Message Thread Service created")}async initialize(){try{return console.log("\ud83d\udd04 Initializing Message Thread Service..."),await this.loadThreadsFromStorage(),this.initialized=!0,console.log("\u2705 Message Thread Service initialized"),!0}catch(e){return console.error("\u274c Failed to initialize thread service:",e),!1}}createThread(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const a=e.id;if(!this.threads.has(a)){const t=c({id:a,parentMessage:e,replies:[],createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),replyCount:0,participants:new Set([e.user.id]),isCollapsed:!1},n);this.threads.set(a,t),console.log("\ud83d\udcdd Created new thread:",a)}return this.addReply(a,t),this.emit("onThreadCreated",{threadId:a,thread:this.threads.get(a)}),this.threads.get(a)}catch(a){return console.error("\u274c Failed to create thread:",a),null}}addReply(e,t){try{const n=this.threads.get(e);if(!n)return console.warn("\u26a0\ufe0f Thread not found:",e),!1;const a=c(c({},t),{},{threadId:e,replyTo:e,depth:this.calculateReplyDepth(e,t.id),createdAt:t.timestamp||(new Date).toISOString()});return n.replies.push(a),n.replyCount=n.replies.length,n.updatedAt=(new Date).toISOString(),n.participants.add(t.user.id),this.messageToThread.set(t.id,e),this.saveThreadToStorage(n),this.emit("onReplyAdded",{threadId:e,reply:a,thread:n}),console.log("\ud83d\udcac Added reply to thread:",e,"Reply count:",n.replyCount),!0}catch(n){return console.error("\u274c Failed to add reply:",n),!1}}calculateReplyDepth(e,t){return 1}getThread(e){if(this.threads.has(e))return this.threads.get(e);const t=this.messageToThread.get(e);return t?this.threads.get(t):null}getAllThreads(){return Array.from(this.threads.values()).sort((e,t)=>new Date(t.updatedAt)-new Date(e.updatedAt))}getThreadsForConversation(e){return this.getAllThreads().filter(t=>t.parentMessage.conversationId===e)}getReplies(e){const t=this.threads.get(e);return t?t.replies:[]}toggleThreadCollapse(e){const t=this.threads.get(e);return!!t&&(t.isCollapsed=!t.isCollapsed,this.emit("onThreadUpdated",{threadId:e,thread:t}),t.isCollapsed)}deleteThread(e){try{const t=this.threads.get(e);return!!t&&(t.replies.forEach(e=>{this.messageToThread.delete(e.id)}),this.threads.delete(e),this.removeThreadFromStorage(e),this.emit("onThreadDeleted",{threadId:e}),console.log("\ud83d\uddd1\ufe0f Deleted thread:",e),!0)}catch(t){return console.error("\u274c Failed to delete thread:",t),!1}}deleteReply(e,t){try{const n=this.threads.get(e);if(!n)return!1;const a=n.replies.findIndex(e=>e.id===t);return a>-1&&(n.replies.splice(a,1),n.replyCount=n.replies.length,n.updatedAt=(new Date).toISOString(),this.messageToThread.delete(t),this.saveThreadToStorage(n),this.emit("onThreadUpdated",{threadId:e,thread:n}),console.log("\ud83d\uddd1\ufe0f Deleted reply from thread:",e),!0)}catch(n){return console.error("\u274c Failed to delete reply:",n),!1}}isInThread(e){return this.threads.has(e)||this.messageToThread.has(e)}hasReplies(e){const t=this.threads.get(e);return t&&t.replies.length>0}getReplyCount(e){const t=this.threads.get(e);return t?t.replyCount:0}getThreadParticipants(e){const t=this.threads.get(e);return t?Array.from(t.participants):[]}searchThreads(e){const t=e.toLowerCase();return this.getAllThreads().filter(e=>!!e.parentMessage.text.toLowerCase().includes(t)||e.replies.some(e=>e.text.toLowerCase().includes(t)))}getThreadStats(e){var t,n;const a=this.threads.get(e);return a?{replyCount:a.replyCount,participantCount:a.participants.size,firstReplyAt:null===(t=a.replies[0])||void 0===t?void 0:t.createdAt,lastReplyAt:null===(n=a.replies[a.replies.length-1])||void 0===n?void 0:n.createdAt,isActive:this.isThreadActive(a)}:null}isThreadActive(e){if(!e.updatedAt)return!1;const t=new Date(e.updatedAt);return(new Date-t)/36e5<24}async loadThreadsFromStorage(){try{const e=(await this.openDatabase()).transaction(["threads"],"readonly"),t=e.objectStore("threads").getAll();return new Promise((e,n)=>{t.onsuccess=()=>{const n=t.result;n.forEach(e=>{e.participants=new Set(e.participants),this.threads.set(e.id,e),e.replies.forEach(t=>{this.messageToThread.set(t.id,e.id)})}),console.log("\ud83d\udcda Loaded ".concat(n.length," threads from storage")),e()},t.onerror=()=>{console.error("\u274c Failed to load threads:",t.error),n(t.error)}})}catch(e){console.error("\u274c Error loading threads:",e)}}async saveThreadToStorage(e){try{const t=(await this.openDatabase()).transaction(["threads"],"readwrite"),n=t.objectStore("threads"),a=c(c({},e),{},{participants:Array.from(e.participants)});return n.put(a),new Promise((e,n)=>{t.oncomplete=()=>e(),t.onerror=()=>n(t.error)})}catch(t){console.error("\u274c Error saving thread:",t)}}async removeThreadFromStorage(e){try{const t=(await this.openDatabase()).transaction(["threads"],"readwrite");return t.objectStore("threads").delete(e),new Promise((e,n)=>{t.oncomplete=()=>e(),t.onerror=()=>n(t.error)})}catch(t){console.error("\u274c Error removing thread:",t)}}async openDatabase(){return new Promise((e,t)=>{const n=indexedDB.open("QuibishThreads",1);n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("threads")){const e=t.createObjectStore("threads",{keyPath:"id"});e.createIndex("conversationId","parentMessage.conversationId",{unique:!1}),e.createIndex("updatedAt","updatedAt",{unique:!1})}},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})}async clearAllThreads(){try{this.threads.clear(),this.messageToThread.clear();const e=(await this.openDatabase()).transaction(["threads"],"readwrite");return e.objectStore("threads").clear(),console.log("\ud83d\uddd1\ufe0f Cleared all threads"),!0}catch(e){return console.error("\u274c Error clearing threads:",e),!1}}exportThreads(){return this.getAllThreads().map(e=>c(c({},e),{},{participants:Array.from(e.participants)}))}async importThreads(e){try{for(const t of e)t.participants=new Set(t.participants),this.threads.set(t.id,t),t.replies.forEach(e=>{this.messageToThread.set(e.id,t.id)}),await this.saveThreadToStorage(t);return console.log("\ud83d\udce5 Imported ".concat(e.length," threads")),!0}catch(t){return console.error("\u274c Error importing threads:",t),!1}}on(e,t){this.listeners[e]&&this.listeners[e].push(t)}off(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(e=>e!==t))}emit(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>e(t))}},ne=e=>{var t;let{thread:n,onReply:s,onClose:i,currentUser:r,compact:o=!1}=e;const[l,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(""),[h,m]=(0,a.useState)(!1);if(!n)return null;const{parentMessage:p,replies:g=[],replyCount:f}=n,v=()=>{if(!d.trim())return;const e={id:Date.now(),text:d,user:r,timestamp:(new Date).toISOString(),reactions:[]};s&&s(n.id,e),te.addReply(n.id,e),u(""),m(!1)},y=e=>{if(!e)return"";const t=new Date(e),n=new Date-t,a=Math.floor(n/6e4),s=Math.floor(a/60),i=Math.floor(s/24);return a<1?"Just now":a<60?"".concat(a,"m ago"):s<24?"".concat(s,"h ago"):i<7?"".concat(i,"d ago"):t.toLocaleDateString()};return(0,k.jsxs)("div",{className:"thread-view ".concat(o?"compact":""," ").concat(l?"":"collapsed"),children:[(0,k.jsxs)("div",{className:"thread-header",children:[(0,k.jsxs)("div",{className:"thread-info",children:[(0,k.jsx)("button",{className:"thread-toggle",onClick:()=>c(!l),title:l?"Collapse thread":"Expand thread",children:l?"\u25bc":"\u25b6"}),(0,k.jsxs)("span",{className:"thread-title",children:["Thread: ",f," ",1===f?"reply":"replies"]}),(0,k.jsx)("div",{className:"thread-participants",children:Array.from(n.participants||[]).slice(0,3).map((e,t)=>(0,k.jsx)("div",{className:"participant-avatar",style:{zIndex:3-t},children:"\ud83d\udc64"},e))})]}),i&&(0,k.jsx)("button",{className:"thread-close",onClick:i,title:"Close thread view",children:"\u2715"})]}),l&&(0,k.jsxs)("div",{className:"thread-content",children:[(0,k.jsxs)("div",{className:"thread-parent-message",children:[(0,k.jsxs)("div",{className:"message-header",children:[(0,k.jsx)("span",{className:"message-avatar",children:"\ud83d\udc64"}),(0,k.jsxs)("div",{className:"message-info",children:[(0,k.jsx)("span",{className:"message-author",children:(null===(t=p.user)||void 0===t?void 0:t.name)||"Unknown"}),(0,k.jsx)("span",{className:"message-time",children:y(p.timestamp)})]})]}),(0,k.jsx)("div",{className:"message-text",children:p.text})]}),(0,k.jsxs)("div",{className:"thread-divider",children:[(0,k.jsx)("span",{className:"divider-line"}),(0,k.jsxs)("span",{className:"divider-text",children:[f," ",1===f?"Reply":"Replies"]}),(0,k.jsx)("span",{className:"divider-line"})]}),(0,k.jsx)("div",{className:"thread-replies",children:g.map((e,t)=>{var n;return(0,k.jsxs)("div",{className:"thread-reply",children:[(0,k.jsx)("div",{className:"reply-connector"}),(0,k.jsxs)("div",{className:"reply-content",children:[(0,k.jsxs)("div",{className:"message-header",children:[(0,k.jsx)("span",{className:"message-avatar",children:"\ud83d\udc64"}),(0,k.jsxs)("div",{className:"message-info",children:[(0,k.jsx)("span",{className:"message-author",children:(null===(n=e.user)||void 0===n?void 0:n.name)||"Unknown"}),(0,k.jsx)("span",{className:"message-time",children:y(e.timestamp)})]})]}),(0,k.jsx)("div",{className:"message-text",children:e.text})]})]},e.id||t)})}),h?(0,k.jsxs)("div",{className:"thread-reply-input",children:[(0,k.jsx)("textarea",{value:d,onChange:e=>u(e.target.value),placeholder:"Write a reply...",className:"reply-textarea",rows:"3",autoFocus:!0,onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),v())}}),(0,k.jsxs)("div",{className:"reply-actions",children:[(0,k.jsx)("button",{className:"reply-cancel-btn",onClick:()=>{m(!1),u("")},children:"Cancel"}),(0,k.jsx)("button",{className:"reply-send-btn",onClick:v,disabled:!d.trim(),children:"Send Reply"})]})]}):(0,k.jsx)("button",{className:"thread-reply-btn",onClick:()=>m(!0),children:"\ud83d\udcac Reply to thread"})]})]})},ae=e=>{let{thread:t,onClick:n,compact:a=!1,showParticipants:s=!0}=e;if(!t)return null;const{replyCount:i=0,participants:r=new Set,updatedAt:o}=t,l=()=>{if(!o)return!1;return new Date-new Date(o)<864e5},c=()=>Array.from(r).length;return(0,k.jsxs)("div",{className:"thread-indicator ".concat(a?"compact":""," ").concat(l()?"active":""),onClick:n,role:"button",tabIndex:0,onKeyPress:e=>{"Enter"!==e.key&&" "!==e.key||null===n||void 0===n||n()},title:"".concat(i," ").concat(1===i?"reply":"replies"," \u2022 ").concat(c()," ").concat(1===c()?"participant":"participants"),children:[(0,k.jsx)("div",{className:"indicator-icon",children:"\ud83d\udcac"}),(0,k.jsxs)("div",{className:"indicator-content",children:[(0,k.jsx)("div",{className:"indicator-count",children:i}),!a&&(0,k.jsxs)("div",{className:"indicator-details",children:[s&&c()>0&&(0,k.jsxs)("span",{className:"indicator-participants",children:["\ud83d\udc65 ",c()]}),o&&(0,k.jsx)("span",{className:"indicator-time",children:(e=>{if(!e)return"";const t=new Date(e),n=new Date-t,a=Math.floor(n/6e4),s=Math.floor(a/60),i=Math.floor(s/24);return a<1?"Active now":a<60?"".concat(a,"m"):s<24?"".concat(s,"h"):i<7?"".concat(i,"d"):">1w"})(o)})]})]}),l()&&(0,k.jsx)("div",{className:"indicator-pulse"})]})},se=e=>{var t,n;let{isOpen:s,onClose:i,onDonate:r}=e;const[o,l]=(0,a.useState)(null),[d,u]=(0,a.useState)(""),[h,m]=(0,a.useState)("one-time"),[p,g]=(0,a.useState)("card"),[f,v]=(0,a.useState)(!1),[y,b]=(0,a.useState)({email:"",name:"",cardNumber:"",expiryDate:"",cvv:"",anonymous:!1}),x=[{id:"card",name:"Credit/Debit Card",icon:"\ud83d\udcb3",popular:!0},{id:"paypal",name:"PayPal",icon:"\ud83c\udf10",popular:!0},{id:"applepay",name:"Apple Pay",icon:"\ud83c\udf4f",popular:!1},{id:"googlepay",name:"Google Pay",icon:"\ud83c\udf08",popular:!1},{id:"crypto",name:"Cryptocurrency",icon:"\u20bf",popular:!1}],w=()=>d&&!isNaN(parseFloat(d))?parseFloat(d):o,S=()=>{const e=w();return e&&e>=1&&e<=1e4},j=(e,t)=>{b(n=>c(c({},n),{},{[e]:t}))},N=()=>{const{email:e,name:t,cardNumber:n,expiryDate:a,cvv:s}=y;return"card"===p?e&&t&&n&&a&&s:e&&t},C=()=>{l(null),u(""),m("one-time"),g("card"),v(!1),b({email:"",name:"",cardNumber:"",expiryDate:"",cvv:"",anonymous:!1})};return s?(0,k.jsx)("div",{className:"donation-overlay",onClick:e=>{e.target===e.currentTarget&&i()},children:(0,k.jsxs)("div",{className:"donation-modal",children:[(0,k.jsxs)("div",{className:"donation-header",children:[(0,k.jsx)("h3",{children:"\ud83d\udc96 Support Quibish"}),(0,k.jsx)("button",{className:"close-btn",onClick:i,children:"\xd7"})]}),f?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"payment-content",children:[(0,k.jsxs)("div",{className:"payment-header",children:[(0,k.jsx)("button",{className:"back-btn",onClick:()=>{v(!1)},children:"\u2190 Back"}),(0,k.jsxs)("div",{className:"payment-summary",children:[(0,k.jsxs)("h4",{children:["monthly"===h?"Monthly":"One-time","$",w().toFixed(2)]}),(0,k.jsxs)("p",{children:["via ",null===(t=x.find(e=>e.id===p))||void 0===t?void 0:t.name]})]})]}),(0,k.jsxs)("div",{className:"payment-form",children:[(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{children:"Email Address *"}),(0,k.jsx)("input",{type:"email",placeholder:"your@email.com",value:y.email,onChange:e=>j("email",e.target.value)})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{children:"Full Name *"}),(0,k.jsx)("input",{type:"text",placeholder:"John Doe",value:y.name,onChange:e=>j("name",e.target.value),disabled:y.anonymous})]}),(0,k.jsx)("div",{className:"form-group checkbox-group",children:(0,k.jsxs)("label",{className:"checkbox-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:y.anonymous,onChange:e=>j("anonymous",e.target.checked)}),(0,k.jsx)("span",{className:"checkmark"}),"Donate anonymously"]})}),"card"===p&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{children:"Card Number *"}),(0,k.jsx)("input",{type:"text",placeholder:"1234 5678 9012 3456",value:y.cardNumber,onChange:e=>j("cardNumber",e.target.value),maxLength:"19"})]}),(0,k.jsxs)("div",{className:"form-row",children:[(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{children:"Expiry Date *"}),(0,k.jsx)("input",{type:"text",placeholder:"MM/YY",value:y.expiryDate,onChange:e=>j("expiryDate",e.target.value),maxLength:"5"})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{children:"CVV *"}),(0,k.jsx)("input",{type:"text",placeholder:"123",value:y.cvv,onChange:e=>j("cvv",e.target.value),maxLength:"4"})]})]})]}),"card"!==p&&(0,k.jsx)("div",{className:"external-payment-info",children:(0,k.jsxs)("p",{children:["You will be redirected to ",null===(n=x.find(e=>e.id===p))||void 0===n?void 0:n.name,"to complete your payment securely."]})})]})]}),(0,k.jsxs)("div",{className:"payment-footer",children:[(0,k.jsxs)("div",{className:"security-info",children:[(0,k.jsx)("span",{className:"security-icon",children:"\ud83d\udd12"}),(0,k.jsx)("span",{children:"Your payment information is secure and encrypted"})]}),(0,k.jsxs)("button",{className:"submit-btn ".concat(N()?"enabled":"disabled"),onClick:()=>{if(!N())return void alert("Please fill in all required fields");const e={amount:w(),type:h,method:p,email:y.email,name:y.anonymous?"Anonymous":y.name,anonymous:y.anonymous,timestamp:(new Date).toISOString()};console.log("Processing donation:",e),r&&r(e),alert("Thank you for your ".concat(h," donation of $").concat(w(),"!")),i(),C()},disabled:!N(),children:["Complete ","monthly"===h?"Subscription":"Donation"]})]})]}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"donation-content",children:[(0,k.jsx)("div",{className:"donation-intro",children:(0,k.jsx)("p",{children:"Your support helps us keep Quibish free and continuously improve your communication experience. Every contribution matters!"})}),(0,k.jsx)("div",{className:"donation-type",children:(0,k.jsxs)("div",{className:"type-toggle",children:[(0,k.jsx)("button",{className:"type-btn ".concat("one-time"===h?"active":""),onClick:()=>m("one-time"),children:"One-time"}),(0,k.jsx)("button",{className:"type-btn ".concat("monthly"===h?"active":""),onClick:()=>m("monthly"),children:"Monthly"})]})}),(0,k.jsxs)("div",{className:"amount-selection",children:[(0,k.jsx)("h4",{children:"Choose Amount"}),(0,k.jsx)("div",{className:"amount-grid",children:[{value:5,label:"$5",description:"Coffee for the dev team"},{value:10,label:"$10",description:"Support server costs"},{value:25,label:"$25",description:"Help with development"},{value:50,label:"$50",description:"Sponsor new features"},{value:100,label:"$100",description:"Major contribution"},{value:250,label:"$250",description:"VIP supporter"}].map(e=>(0,k.jsxs)("button",{className:"amount-btn ".concat(o===e.value?"selected":""),onClick:()=>(e=>{l(e),u("")})(e.value),children:[(0,k.jsx)("span",{className:"amount-label",children:e.label}),(0,k.jsx)("span",{className:"amount-desc",children:e.description})]},e.value))}),(0,k.jsxs)("div",{className:"custom-amount",children:[(0,k.jsx)("label",{children:"Or enter custom amount:"}),(0,k.jsxs)("div",{className:"custom-input",children:[(0,k.jsx)("span",{className:"currency",children:"$"}),(0,k.jsx)("input",{type:"number",min:"1",max:"10000",step:"0.01",placeholder:"0.00",value:d,onChange:e=>{return t=e.target.value,u(t),void l(null);var t}})]})]})]}),(0,k.jsxs)("div",{className:"payment-methods",children:[(0,k.jsx)("h4",{children:"Payment Method"}),(0,k.jsx)("div",{className:"methods-grid",children:x.map(e=>(0,k.jsxs)("button",{className:"method-btn ".concat(p===e.id?"selected":""," ").concat(e.popular?"popular":""),onClick:()=>g(e.id),children:[(0,k.jsx)("span",{className:"method-icon",children:e.icon}),(0,k.jsx)("span",{className:"method-name",children:e.name}),e.popular&&(0,k.jsx)("span",{className:"popular-badge",children:"Popular"})]},e.id))})]})]}),(0,k.jsxs)("div",{className:"donation-footer",children:[(0,k.jsx)("div",{className:"donation-summary",children:w()&&(0,k.jsx)("p",{children:(0,k.jsxs)("strong",{children:["monthly"===h?"Monthly":"One-time"," donation: $",w().toFixed(2)]})})}),(0,k.jsxs)("button",{className:"donate-btn ".concat(S()?"enabled":"disabled"),onClick:()=>{S()?v(!0):alert("Please select a valid donation amount")},disabled:!S(),children:["monthly"===h?"Subscribe":"Donate",w()?"$".concat(w().toFixed(2)):""]})]})]})]})}):null},ie=e=>{let{isVisible:t,onClose:n,onOpenDonation:s,onDismiss:i}=e;const[r,o]=(0,a.useState)(0),[l,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(10),[h,m]=(0,a.useState)(!1),p=[{id:"support",emoji:"\u2764\ufe0f",title:"Love Quibish?",message:"Help us keep the app free and add amazing new features!",buttonText:"Support Us",color:"#ff6b6b"},{id:"coffee",emoji:"\u2615",title:"Buy us a coffee?",message:"Your support helps fuel late-night coding sessions and server costs.",buttonText:"Get Coffee",color:"#8b4513"},{id:"growth",emoji:"\ud83d\ude80",title:"Help Quibish grow!",message:"Every contribution helps us reach more users and build better features.",buttonText:"Contribute",color:"#667eea"},{id:"community",emoji:"\ud83c\udf89",title:"Join our supporters!",message:"Be part of the community that makes Quibish possible for everyone.",buttonText:"Join Community",color:"#28a745"},{id:"future",emoji:"\ud83c\udf1f",title:"Shape our future!",message:"Your support helps prioritize features and improvements you want to see.",buttonText:"Shape Future",color:"#ffc107"}];(0,a.useEffect)(()=>{if(!t)return;const e=setInterval(()=>{c(!0),setTimeout(()=>{o(e=>(e+1)%p.length),c(!1)},300)},4e3);return()=>clearInterval(e)},[t,p.length]),(0,a.useEffect)(()=>{if(!t||!h)return;const e=setInterval(()=>{u(e=>e<=1?(i("auto"),m(!1),10):e-1)},1e3);return()=>clearInterval(e)},[t,h,i]);if(!t)return null;const g=p[r];return(0,k.jsx)("div",{className:"donation-prompt-overlay",children:(0,k.jsxs)("div",{className:"donation-prompt",style:{"--prompt-color":g.color},children:[(0,k.jsx)("button",{className:"prompt-close",onClick:n,children:"\xd7"}),(0,k.jsxs)("div",{className:"prompt-content ".concat(l?"animating":""),children:[(0,k.jsx)("div",{className:"prompt-emoji",children:g.emoji}),(0,k.jsx)("h3",{className:"prompt-title",children:g.title}),(0,k.jsx)("p",{className:"prompt-message",children:g.message})]}),(0,k.jsxs)("div",{className:"prompt-actions",children:[(0,k.jsx)("button",{className:"prompt-btn secondary",onClick:h?()=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"manual";m(!1),u(10),i(e)}("manual"):()=>{m(!0)},children:h?"Dismiss (".concat(d,"s)"):"Maybe Later"}),(0,k.jsx)("button",{className:"prompt-btn primary",onClick:()=>{s(),n()},children:g.buttonText})]}),(0,k.jsx)("div",{className:"prompt-indicators",children:p.map((e,t)=>(0,k.jsx)("div",{className:"indicator ".concat(t===r?"active":""),onClick:()=>o(t)},t))}),(0,k.jsx)("div",{className:"prompt-footer",children:(0,k.jsx)("span",{className:"prompt-note",children:"\ud83d\udd12 Secure donation \u2022 Cancel anytime"})})]})})},re={BASE_URL:"http://localhost:5001/api",WS_URL:"ws://localhost:5001",TIMEOUT:1e4},oe=e=>{const t=e.startsWith("/")?e.slice(1):e;return"".concat(re.BASE_URL,"/").concat(t)},le=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=oe(e),a=new AbortController,s=setTimeout(()=>a.abort(),re.TIMEOUT),i=localStorage.getItem("token"),r=c(c({},t),{},{signal:a.signal,headers:c(c({"Content-Type":"application/json"},i&&{Authorization:"Bearer ".concat(i)}),t.headers)});try{const e=await fetch(n,r);if(clearTimeout(s),!e.ok)throw new Error("HTTP error! status: ".concat(e.status));const t=e.headers.get("content-type");if(t&&t.includes("application/json")){return await e.json()}return await e.text()}catch(o){if(clearTimeout(s),"AbortError"===o.name)throw console.error("API request timed out for ".concat(n)),new Error("Request timeout after ".concat(re.TIMEOUT,"ms"));throw console.error("API request failed for ".concat(n,":"),o),o}};const ce=new class{constructor(){this.vapidPublicKey=null,this.subscription=null,this.isSupported="serviceWorker"in navigator&&"PushManager"in window,this.permission="default",this.userId=null}async initialize(e){if(console.log("\ud83d\udd14 Initializing push notification service..."),this.userId=e,!this.isSupported)return console.warn("Push notifications not supported"),!1;try{return this.permission=await Notification.permission,console.log("Current notification permission:",this.permission),await this.registerServiceWorker(),"granted"===this.permission&&await this.setupPushSubscription(),!0}catch(t){return console.error("Failed to initialize push notifications:",t),!1}}async registerServiceWorker(){try{const e=await navigator.serviceWorker.register("".concat("/quibish","/sw.js"),{scope:"".concat("/quibish","/")});return console.log("\u2705 Service Worker registered for notifications"),e}catch(e){throw console.error("Service Worker registration failed:",e),e}}async requestPermission(){if(!this.isSupported)throw new Error("Push notifications not supported");try{const e=await Notification.requestPermission();if(this.permission=e,console.log("Notification permission result:",e),"granted"===e)return await this.setupPushSubscription(),!0;throw"denied"===e?new Error("Notification permission denied"):new Error("Notification permission not granted")}catch(e){throw console.error("Failed to request notification permission:",e),e}}async setupPushSubscription(){try{const e=await navigator.serviceWorker.ready;await this.getVapidKey();const t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(this.vapidPublicKey)});return this.subscription=t,console.log("\u2705 Push subscription created"),await this.sendSubscriptionToBackend(t),t}catch(e){throw console.error("Failed to setup push subscription:",e),e}}async getVapidKey(){try{const e=await fetch(oe("notifications/vapid-key"),{method:"GET",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}});if(!e.ok)throw new Error("Failed to get VAPID key");const t=await e.json();this.vapidPublicKey=t.publicKey,console.log("\u2705 VAPID key retrieved")}catch(e){console.error("Failed to get VAPID key:",e),this.vapidPublicKey="BMqSvZyI8NzEp_G-Jw5i5L7-8K9yJ8xI7qU6vN2mL4kP3oT8fF1R9eA2cX5nH7jQ6wE4dY9pM8vL3zK2aB1sC0f"}}async sendSubscriptionToBackend(e){try{if(!(await fetch(oe("notifications/subscribe"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify({subscription:e.toJSON(),userId:this.userId})})).ok)throw new Error("Failed to send subscription to backend");console.log("\u2705 Subscription sent to backend")}catch(t){throw console.error("Failed to send subscription to backend:",t),t}}async testNotification(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Test notification from Quibish!";if("granted"!==this.permission)throw new Error("Notification permission not granted");try{const t=new Notification("Quibish",{body:e,icon:"/logo192.png",badge:"/logo192.png",tag:"test-notification",requireInteraction:!1,actions:[{action:"open",title:"Open App"},{action:"dismiss",title:"Dismiss"}]});return t.onclick=()=>{window.focus(),t.close()},console.log("\u2705 Test notification sent"),t}catch(t){throw console.error("Failed to send test notification:",t),t}}showMessageNotification(e){if("granted"!==this.permission)return void console.warn("Cannot show notification: permission not granted");const t=new Notification("New message from ".concat(e.sender),{body:e.text||"You have a new message",icon:e.senderAvatar||"/logo192.png",badge:"/logo192.png",tag:"message-".concat(e.id),requireInteraction:!0,actions:[{action:"reply",title:"Reply"},{action:"view",title:"View"}],data:{messageId:e.id,conversationId:e.conversationId,senderId:e.senderId}});return t.onclick=()=>{window.focus(),window.postMessage({type:"OPEN_CONVERSATION",conversationId:e.conversationId},"*"),t.close()},t}async unsubscribe(){try{this.subscription&&(await this.subscription.unsubscribe(),console.log("\u2705 Unsubscribed from push notifications")),await fetch(oe("notifications/unsubscribe"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify({userId:this.userId})}),this.subscription=null}catch(e){throw console.error("Failed to unsubscribe:",e),e}}getSubscriptionStatus(){return{isSupported:this.isSupported,permission:this.permission,hasSubscription:!!this.subscription,userId:this.userId}}urlBase64ToUint8Array(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(t),a=new Uint8Array(n.length);for(let s=0;s<n.length;++s)a[s]=n.charCodeAt(s);return a}isUserOnline(){return navigator.onLine&&"visible"===document.visibilityState}setupPresenceDetection(){document.addEventListener("visibilitychange",()=>{const e="visible"===document.visibilityState;console.log("User visibility changed:",e?"visible":"hidden"),this.updateUserPresence(e)}),window.addEventListener("online",()=>{console.log("User came online"),this.updateUserPresence(!0)}),window.addEventListener("offline",()=>{console.log("User went offline"),this.updateUserPresence(!1)})}async updateUserPresence(e){try{await fetch(oe("users/presence"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify({userId:this.userId,isOnline:e,lastSeen:(new Date).toISOString()})})}catch(t){console.error("Failed to update user presence:",t)}}},de=e=>{let{isOpen:t,onClose:n,user:s}=e;const[i,r]=(0,a.useState)({pushEnabled:!1,emailEnabled:!0,soundEnabled:!0,vibrationEnabled:!0,showPreview:!0,quietHours:{enabled:!1,start:"22:00",end:"08:00"},emailFrequency:"immediate",notifyOnMention:!0,notifyOnDM:!0,notifyOnGroupMessage:!1}),[o,l]=(0,a.useState)({isSupported:!1,permission:"default",hasSubscription:!1}),[d,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)(""),[p,g]=(0,a.useState)("");(0,a.useEffect)(()=>{t&&(f(),v())},[t]);const f=async()=>{try{const e=await fetch("/api/users/notification-preferences",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(e.ok){const t=await e.json();r(e=>c(c({},e),t))}}catch(h){console.error("Failed to load notification settings:",h)}},v=()=>{const e=ce.getSubscriptionStatus();l(e)},y=(e,t)=>{r(n=>c(c({},n),{},{[e]:t}))},b=(e,t)=>{r(n=>c(c({},n),{},{quietHours:c(c({},n.quietHours),{},{[e]:t})}))};return t?(0,k.jsx)("div",{className:"notification-settings-overlay",children:(0,k.jsxs)("div",{className:"notification-settings-modal",children:[(0,k.jsxs)("div",{className:"notification-settings-header",children:[(0,k.jsx)("h2",{children:"\ud83d\udd14 Notification Settings"}),(0,k.jsx)("button",{className:"close-btn",onClick:n,children:"\xd7"})]}),(0,k.jsxs)("div",{className:"notification-settings-content",children:[h&&(0,k.jsx)("div",{className:"alert alert-error",children:(0,k.jsxs)("span",{children:["\u26a0\ufe0f ",h]})}),p&&(0,k.jsx)("div",{className:"alert alert-success",children:(0,k.jsxs)("span",{children:["\u2705 ",p]})}),(0,k.jsxs)("div",{className:"settings-section",children:[(0,k.jsx)("h3",{children:"\ud83d\udcf1 Push Notifications"}),(0,k.jsxs)("div",{className:"setting-item",children:[(0,k.jsxs)("div",{className:"setting-info",children:[(0,k.jsx)("label",{children:"Enable Push Notifications"}),(0,k.jsx)("span",{className:"setting-description",children:"Get notifications even when the app is closed"})]}),(0,k.jsx)("div",{className:"setting-controls",children:(0,k.jsxs)("label",{className:"toggle-switch",children:[(0,k.jsx)("input",{type:"checkbox",checked:i.pushEnabled,onChange:async()=>{if(o.isSupported){u(!0),m("");try{i.pushEnabled?(await ce.unsubscribe(),r(e=>c(c({},e),{},{pushEnabled:!1})),v()):(await ce.requestPermission(),r(e=>c(c({},e),{},{pushEnabled:!0})),v())}catch(h){console.error("Failed to toggle push notifications:",h),m("Failed to enable push notifications. Please check your browser settings.")}finally{u(!1)}}else m("Push notifications are not supported in this browser")},disabled:d||!o.isSupported}),(0,k.jsx)("span",{className:"toggle-slider"})]})})]}),!o.isSupported&&(0,k.jsx)("div",{className:"warning-message",children:"Push notifications are not supported in this browser"}),i.pushEnabled&&(0,k.jsxs)("div",{className:"push-status",children:[(0,k.jsxs)("p",{children:["Status: ",o.hasSubscription?"\u2705 Active":"\u26a0\ufe0f Not subscribed"]}),(0,k.jsx)("button",{className:"test-btn",onClick:async()=>{u(!0),m("");try{i.pushEnabled&&o.hasSubscription?(await ce.testNotification("Test notification from Quibish! \ud83c\udf89"),g("Test notification sent!"),setTimeout(()=>g(""),3e3)):m("Push notifications must be enabled first")}catch(h){console.error("Failed to send test notification:",h),m("Failed to send test notification")}finally{u(!1)}},disabled:d||!o.hasSubscription,children:"Send Test Notification"})]})]}),(0,k.jsxs)("div",{className:"settings-section",children:[(0,k.jsx)("h3",{children:"\ud83d\udce7 Email Notifications"}),(0,k.jsxs)("div",{className:"setting-item",children:[(0,k.jsxs)("div",{className:"setting-info",children:[(0,k.jsx)("label",{children:"Enable Email Notifications"}),(0,k.jsx)("span",{className:"setting-description",children:"Receive email alerts when you're offline"})]}),(0,k.jsx)("div",{className:"setting-controls",children:(0,k.jsxs)("label",{className:"toggle-switch",children:[(0,k.jsx)("input",{type:"checkbox",checked:i.emailEnabled,onChange:e=>y("emailEnabled",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"})]})})]}),i.emailEnabled&&(0,k.jsxs)("div",{className:"setting-item",children:[(0,k.jsxs)("div",{className:"setting-info",children:[(0,k.jsx)("label",{children:"Email Frequency"}),(0,k.jsx)("span",{className:"setting-description",children:"How often to send email notifications"})]}),(0,k.jsx)("div",{className:"setting-controls",children:(0,k.jsxs)("select",{value:i.emailFrequency,onChange:e=>y("emailFrequency",e.target.value),className:"frequency-select",children:[(0,k.jsx)("option",{value:"immediate",children:"Immediate"}),(0,k.jsx)("option",{value:"hourly",children:"Hourly digest"}),(0,k.jsx)("option",{value:"daily",children:"Daily digest"}),(0,k.jsx)("option",{value:"weekly",children:"Weekly digest"})]})})]})]}),(0,k.jsxs)("div",{className:"settings-section",children:[(0,k.jsx)("h3",{children:"\ud83d\udccb Notification Types"}),(0,k.jsxs)("div",{className:"setting-item",children:[(0,k.jsxs)("div",{className:"setting-info",children:[(0,k.jsx)("label",{children:"Direct Messages"}),(0,k.jsx)("span",{className:"setting-description",children:"Notify when you receive a direct message"})]}),(0,k.jsx)("div",{className:"setting-controls",children:(0,k.jsxs)("label",{className:"toggle-switch",children:[(0,k.jsx)("input",{type:"checkbox",checked:i.notifyOnDM,onChange:e=>y("notifyOnDM",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"})]})})]}),(0,k.jsxs)("div",{className:"setting-item",children:[(0,k.jsxs)("div",{className:"setting-info",children:[(0,k.jsx)("label",{children:"Mentions"}),(0,k.jsx)("span",{className:"setting-description",children:"Notify when someone mentions you"})]}),(0,k.jsx)("div",{className:"setting-controls",children:(0,k.jsxs)("label",{className:"toggle-switch",children:[(0,k.jsx)("input",{type:"checkbox",checked:i.notifyOnMention,onChange:e=>y("notifyOnMention",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"})]})})]}),(0,k.jsxs)("div",{className:"setting-item",children:[(0,k.jsxs)("div",{className:"setting-info",children:[(0,k.jsx)("label",{children:"Group Messages"}),(0,k.jsx)("span",{className:"setting-description",children:"Notify for all group messages"})]}),(0,k.jsx)("div",{className:"setting-controls",children:(0,k.jsxs)("label",{className:"toggle-switch",children:[(0,k.jsx)("input",{type:"checkbox",checked:i.notifyOnGroupMessage,onChange:e=>y("notifyOnGroupMessage",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"})]})})]})]}),(0,k.jsxs)("div",{className:"settings-section",children:[(0,k.jsx)("h3",{children:"\ud83d\udd0a Notification Behavior"}),(0,k.jsxs)("div",{className:"setting-item",children:[(0,k.jsxs)("div",{className:"setting-info",children:[(0,k.jsx)("label",{children:"Sound"}),(0,k.jsx)("span",{className:"setting-description",children:"Play sound for notifications"})]}),(0,k.jsx)("div",{className:"setting-controls",children:(0,k.jsxs)("label",{className:"toggle-switch",children:[(0,k.jsx)("input",{type:"checkbox",checked:i.soundEnabled,onChange:e=>y("soundEnabled",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"})]})})]}),(0,k.jsxs)("div",{className:"setting-item",children:[(0,k.jsxs)("div",{className:"setting-info",children:[(0,k.jsx)("label",{children:"Vibration"}),(0,k.jsx)("span",{className:"setting-description",children:"Vibrate on mobile devices"})]}),(0,k.jsx)("div",{className:"setting-controls",children:(0,k.jsxs)("label",{className:"toggle-switch",children:[(0,k.jsx)("input",{type:"checkbox",checked:i.vibrationEnabled,onChange:e=>y("vibrationEnabled",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"})]})})]}),(0,k.jsxs)("div",{className:"setting-item",children:[(0,k.jsxs)("div",{className:"setting-info",children:[(0,k.jsx)("label",{children:"Show Message Preview"}),(0,k.jsx)("span",{className:"setting-description",children:"Show message content in notifications"})]}),(0,k.jsx)("div",{className:"setting-controls",children:(0,k.jsxs)("label",{className:"toggle-switch",children:[(0,k.jsx)("input",{type:"checkbox",checked:i.showPreview,onChange:e=>y("showPreview",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"})]})})]})]}),(0,k.jsxs)("div",{className:"settings-section",children:[(0,k.jsx)("h3",{children:"\ud83c\udf19 Quiet Hours"}),(0,k.jsxs)("div",{className:"setting-item",children:[(0,k.jsxs)("div",{className:"setting-info",children:[(0,k.jsx)("label",{children:"Enable Quiet Hours"}),(0,k.jsx)("span",{className:"setting-description",children:"No notifications during specified hours"})]}),(0,k.jsx)("div",{className:"setting-controls",children:(0,k.jsxs)("label",{className:"toggle-switch",children:[(0,k.jsx)("input",{type:"checkbox",checked:i.quietHours.enabled,onChange:e=>b("enabled",e.target.checked)}),(0,k.jsx)("span",{className:"toggle-slider"})]})})]}),i.quietHours.enabled&&(0,k.jsxs)("div",{className:"quiet-hours-times",children:[(0,k.jsxs)("div",{className:"time-input-group",children:[(0,k.jsx)("label",{children:"From:"}),(0,k.jsx)("input",{type:"time",value:i.quietHours.start,onChange:e=>b("start",e.target.value),className:"time-input"})]}),(0,k.jsxs)("div",{className:"time-input-group",children:[(0,k.jsx)("label",{children:"To:"}),(0,k.jsx)("input",{type:"time",value:i.quietHours.end,onChange:e=>b("end",e.target.value),className:"time-input"})]})]})]})]}),(0,k.jsxs)("div",{className:"notification-settings-footer",children:[(0,k.jsx)("button",{className:"cancel-btn",onClick:n,disabled:d,children:"Cancel"}),(0,k.jsx)("button",{className:"save-btn",onClick:async()=>{u(!0),m(""),g("");try{if(!(await fetch("/api/users/notification-preferences",{method:"PUT",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify(i)})).ok)throw new Error("Failed to save settings");g("Notification settings saved successfully!"),setTimeout(()=>g(""),3e3)}catch(h){console.error("Failed to save notification settings:",h),m("Failed to save notification settings. Please try again.")}finally{u(!1)}},disabled:d,children:d?"Saving...":"Save Settings"})]})]})}):null};class ue{constructor(){this.mediaRecorder=null,this.audioStream=null,this.audioChunks=[],this.isRecording=!1,this.isPaused=!1,this.recordingStartTime=0,this.pausedDuration=0,this.audioContext=null,this.analyser=null,this.microphone=null,this.dataArray=null,this.animationFrame=null,this.config={mimeType:this.getSupportedMimeType(),audioBitsPerSecond:128e3,videoBitsPerSecond:null,sampleRate:44100,channelCount:1,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},this.listeners={onStart:[],onStop:[],onPause:[],onResume:[],onDataAvailable:[],onError:[],onVolumeChange:[]},console.log("\ud83c\udfa4 Voice Recorder Service created, awaiting initialization...")}async initialize(){try{if(console.log("\ud83d\udd04 Initializing Voice Recorder Service..."),!window.MediaRecorder)throw new Error("MediaRecorder is not supported in this browser");if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("getUserMedia is not supported in this browser");if(!this.getSupportedMimeType())throw new Error("No supported audio formats found");return console.log("\u2705 Voice Recorder Service initialized successfully"),console.log("\ud83d\udcca Configuration:",this.config),!0}catch(e){return console.error("\u274c Voice Recorder Service initialization failed:",e),this.emit("onError",{type:"initialization",error:e}),!1}}getSupportedMimeType(){const e=["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/ogg","audio/wav","audio/mp4","audio/aac"];for(const t of e)if(MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported(t))return console.log("\ud83d\udcf1 Using MIME type: ".concat(t)),t;return console.warn("\u26a0\ufe0f No preferred audio MIME type supported, using default"),MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm"),"audio/webm"}async testMicrophoneAccess(){try{console.log("\ud83d\udd0d Testing microphone access...");const e=await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:22050,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});return console.log("\u2705 Microphone access test successful"),e.getTracks().forEach(e=>e.stop()),{success:!0,message:"Microphone access granted"}}catch(e){console.error("\u274c Microphone access test failed:",e);let t=e.message;switch(e.name){case"NotAllowedError":t="Microphone permission denied. Please allow microphone access in your browser settings.";break;case"NotFoundError":t="No microphone found. Please connect a microphone and try again.";break;case"NotSupportedError":t="Voice recording is not supported in this browser.";break;case"AbortError":t="Microphone access was aborted. Please try again.";break;case"NotReadableError":t="Microphone is already in use by another application."}return{success:!1,error:e.name,message:t}}}async startRecording(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{if(this.isRecording)return console.warn("\u26a0\ufe0f Recording already in progress"),this.emit("onError",{type:"start",error:new Error("Recording already in progress")}),!1;if(e&&(e.bitrate&&(this.config.audioBitsPerSecond=e.bitrate),e.sampleRate&&(this.config.sampleRate=e.sampleRate),console.log("\ufffd\ufe0f Using quality config:",e)),console.log("\ufffd\ud83c\udfa4 Requesting microphone permission..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("getUserMedia is not supported in this browser");let n;try{n=await navigator.mediaDevices.getUserMedia({audio:{channelCount:this.config.channelCount,sampleRate:this.config.sampleRate,echoCancellation:this.config.echoCancellation,noiseSuppression:this.config.noiseSuppression,autoGainControl:this.config.autoGainControl}})}catch(t){console.warn("\u26a0\ufe0f Advanced audio settings failed, trying basic settings..."),n=await navigator.mediaDevices.getUserMedia({audio:!0})}return console.log("\u2705 Microphone permission granted"),this.audioStream=n,this.audioChunks=[],this.recordingStartTime=Date.now(),this.pausedDuration=0,this.mediaRecorder=new MediaRecorder(n,{mimeType:this.config.mimeType,audioBitsPerSecond:this.config.audioBitsPerSecond}),this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&(this.audioChunks.push(e.data),this.emit("onDataAvailable",{data:e.data}))},this.mediaRecorder.onstop=()=>{this.handleRecordingStop()},this.mediaRecorder.onerror=e=>{console.error("\u274c MediaRecorder error:",e.error),this.emit("onError",{type:"recording",error:e.error})},await this.setupAudioAnalysis(n),this.mediaRecorder.start(100),this.isRecording=!0,this.isPaused=!1,this.startVolumeMonitoring(),console.log("\ud83c\udfa4 Recording started successfully"),this.emit("onStart",{startTime:this.recordingStartTime,config:this.config}),!0}catch(n){console.error("\u274c Failed to start recording:",n);let e=n.message;"NotAllowedError"===n.name?e="Microphone permission denied. Please allow microphone access and try again.":"NotFoundError"===n.name?e="No microphone found. Please connect a microphone and try again.":"NotSupportedError"===n.name?e="Voice recording is not supported in this browser.":"AbortError"===n.name&&(e="Recording was aborted. Please try again.");const t=new Error(e);return t.originalError=n,this.emit("onError",{type:"start",error:t}),!1}}async stopRecording(){try{return this.isRecording?(this.mediaRecorder&&"recording"===this.mediaRecorder.state&&this.mediaRecorder.stop(),this.stopVolumeMonitoring(),this.audioStream&&(this.audioStream.getTracks().forEach(e=>e.stop()),this.audioStream=null),this.isRecording=!1,this.isPaused=!1,console.log("\ud83d\uded1 Recording stopped successfully"),new Promise(e=>{this.recordingStopResolver=e})):(console.warn("\u26a0\ufe0f No recording in progress"),null)}catch(e){return console.error("\u274c Failed to stop recording:",e),this.emit("onError",{type:"stop",error:e}),null}}handleRecordingStop(){try{const e=new Blob(this.audioChunks,{type:this.config.mimeType}),t=this.getRecordingDuration(),n=e.size;console.log("\ud83c\udfb5 Audio recorded: ".concat(t,"ms, ").concat((n/1024).toFixed(2),"KB"));const a={blob:e,duration:t,size:n,mimeType:this.config.mimeType,url:URL.createObjectURL(e),timestamp:(new Date).toISOString()};return this.emit("onStop",a),this.recordingStopResolver&&(this.recordingStopResolver(a),this.recordingStopResolver=null),a}catch(e){return console.error("\u274c Failed to process recording:",e),this.emit("onError",{type:"processing",error:e}),null}}pauseRecording(){try{return!(!this.isRecording||this.isPaused)&&(!(!this.mediaRecorder||"recording"!==this.mediaRecorder.state)&&(this.mediaRecorder.pause(),this.isPaused=!0,this.pauseStartTime=Date.now(),console.log("\u23f8\ufe0f Recording paused"),this.emit("onPause",{pauseTime:this.pauseStartTime}),!0))}catch(e){return console.error("\u274c Failed to pause recording:",e),this.emit("onError",{type:"pause",error:e}),!1}}resumeRecording(){try{return!(!this.isRecording||!this.isPaused)&&(!(!this.mediaRecorder||"paused"!==this.mediaRecorder.state)&&(this.mediaRecorder.resume(),this.isPaused=!1,this.pauseStartTime&&(this.pausedDuration+=Date.now()-this.pauseStartTime,this.pauseStartTime=0),console.log("\u25b6\ufe0f Recording resumed"),this.emit("onResume",{resumeTime:Date.now()}),!0))}catch(e){return console.error("\u274c Failed to resume recording:",e),this.emit("onError",{type:"resume",error:e}),!1}}cancelRecording(){try{return this.audioChunks=[],this.stopRecording(),console.log("\u274c Recording cancelled"),!0}catch(e){return console.error("\u274c Failed to cancel recording:",e),!1}}async setupAudioAnalysis(e){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.microphone=this.audioContext.createMediaStreamSource(e),this.analyser.fftSize=256,this.analyser.smoothingTimeConstant=.3,this.microphone.connect(this.analyser),this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),console.log("\ud83c\udfb5 Audio analysis setup complete")}catch(t){console.error("\u274c Failed to setup audio analysis:",t)}}startVolumeMonitoring(){if(!this.analyser||!this.dataArray)return;const e=()=>{if(!this.isRecording)return;this.analyser.getByteFrequencyData(this.dataArray);const t=this.dataArray.reduce((e,t)=>e+t,0)/this.dataArray.length,n=Math.round(t/255*100);this.emit("onVolumeChange",{volume:n,rawData:this.dataArray}),this.animationFrame=requestAnimationFrame(e)};e()}stopVolumeMonitoring(){this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),this.audioContext&&"closed"!==this.audioContext.state&&(this.audioContext.close(),this.audioContext=null)}getRecordingDuration(){if(!this.isRecording&&0===this.recordingStartTime)return 0;const e=this.isRecording?Date.now():this.recordingStartTime;return Math.max(0,e-this.recordingStartTime-this.pausedDuration)}formatDuration(e){const t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return n>0?"".concat(n,":").concat(a.toString().padStart(2,"0")):"0:".concat(a.toString().padStart(2,"0"))}getState(){return{isRecording:this.isRecording,isPaused:this.isPaused,duration:this.getRecordingDuration(),formattedDuration:this.formatDuration(this.getRecordingDuration()),hasPermission:!!this.audioStream,mimeType:this.config.mimeType}}async convertAudio(e,t){try{return e.type===t||console.warn("\u26a0\ufe0f Audio conversion from ".concat(e.type," to ").concat(t," not implemented")),e}catch(n){return console.error("\u274c Audio conversion failed:",n),e}}static isSupported(){return!!(window.MediaRecorder&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}static getCapabilities(){if(!ue.isSupported())return{supported:!1};const e={supported:!0,mimeTypes:[],features:{pause:!0,resume:!0,volumeMonitoring:!(!window.AudioContext&&!window.webkitAudioContext),realTimeAnalysis:!0}};return["audio/webm;codecs=opus","audio/webm","audio/ogg;codecs=opus","audio/ogg","audio/wav","audio/mp4","audio/aac"].forEach(t=>{MediaRecorder.isTypeSupported(t)&&e.mimeTypes.push(t)}),e}on(e,t){this.listeners[e]&&this.listeners[e].push(t)}off(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(e=>e!==t))}emit(e,t){this.listeners[e]&&this.listeners[e].forEach(n=>{try{n(t)}catch(a){console.error("\u274c Error in event listener for ".concat(e,":"),a)}})}cleanup(){this.cancelRecording(),this.stopVolumeMonitoring(),Object.keys(this.listeners).forEach(e=>{this.listeners[e]=[]}),console.log("\ud83e\uddf9 Voice Recorder Service cleaned up")}}const he=new ue,me=e=>{let{audioUrl:t,duration:n,className:s="",compact:i=!1}=e;const[r,o]=(0,a.useState)(!1),[l,c]=(0,a.useState)(0),[d,u]=(0,a.useState)(n||0),h=(0,a.useRef)(null);(0,a.useEffect)(()=>{const e=h.current;if(!e)return;const t=()=>{c(1e3*e.currentTime)},n=()=>{u(1e3*e.duration)},a=()=>{o(!1),c(0)};return e.addEventListener("timeupdate",t),e.addEventListener("durationchange",n),e.addEventListener("ended",a),()=>{e.removeEventListener("timeupdate",t),e.removeEventListener("durationchange",n),e.removeEventListener("ended",a)}},[]);const m=e=>{const t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return"".concat(n,":").concat(a.toString().padStart(2,"0"))};return(0,k.jsxs)("div",{className:"voice-message-player ".concat(i?"compact":""," ").concat(s),children:[(0,k.jsx)("audio",{ref:h,src:t,preload:"metadata"}),(0,k.jsx)("button",{className:"play-pause-btn",onClick:()=>{const e=h.current;e&&(r?(e.pause(),o(!1)):(e.play(),o(!0)))},title:r?"Pause":"Play",children:(0,k.jsx)("span",{className:"btn-icon",children:r?"\u23f8\ufe0f":"\u25b6\ufe0f"})}),(0,k.jsxs)("div",{className:"playback-info",children:[(0,k.jsx)("div",{className:"progress-container",onClick:e=>{const t=h.current;if(!t)return;const n=e.currentTarget.getBoundingClientRect(),a=(e.clientX-n.left)/n.width*(d/1e3);t.currentTime=a,c(1e3*a)},children:(0,k.jsx)("div",{className:"progress-track",children:(0,k.jsx)("div",{className:"progress-fill",style:{width:"".concat(d>0?l/d*100:0,"%")}})})}),(0,k.jsxs)("div",{className:"time-display",children:[(0,k.jsx)("span",{className:"current-time",children:m(l)}),(0,k.jsx)("span",{className:"duration",children:m(d)})]})]})]})},pe=e=>{let{onRecordingComplete:t,onRecordingCancel:n,onRecordingStart:s,onClose:i,maxDuration:r=3e5,minDuration:o=1e3,className:l="",compact:c=!1,autoStart:d=!1}=e;const[u,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(!1),[g,f]=(0,a.useState)(0),[v,y]=(0,a.useState)(0),[b,x]=(0,a.useState)(!1),[w,S]=(0,a.useState)(null),[j,N]=(0,a.useState)(!1),[C,E]=(0,a.useState)(0),[T,I]=(0,a.useState)(null),[P,D]=(0,a.useState)("standard"),A=(0,a.useRef)(null),M=(0,a.useRef)(null),R=(0,a.useRef)(null);(0,a.useEffect)(()=>{(async()=>{try{if(console.log("\ud83c\udfa4 Initializing voice recorder..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Voice recording not supported. Please use Chrome, Firefox, Edge, or Safari.");const e=await he.initialize();if(N(e),e)console.log("\u2705 Voice recorder initialized successfully"),S(null);else{const e="Voice recording is not supported in your browser";console.error("\u274c Voice recorder initialization failed:",e),S(e)}}catch(w){console.error("\u274c Voice recorder initialization error:",w),S("Failed to initialize: ".concat(w.message)),N(!1)}})();const e=e=>{h(!0),p(!1),S(null),x(!0),s&&s(e)},n=e=>{h(!1),p(!1),f(0),y(0),t&&t(e)},a=()=>{p(!0)},i=()=>{p(!1)},r=e=>{let{volume:t}=e;y(t),V(t)},o=e=>{let{error:t,type:n}=e;S("Recording error (".concat(n,"): ").concat(t.message||t)),h(!1),p(!1),"start"===n&&x(!1)};return he.on("onStart",e),he.on("onStop",n),he.on("onPause",a),he.on("onResume",i),he.on("onVolumeChange",r),he.on("onError",o),d&&j&&L(),()=>{he.off("onStart",e),he.off("onStop",n),he.off("onPause",a),he.off("onResume",i),he.off("onVolumeChange",r),he.off("onError",o),A.current&&clearInterval(A.current)}},[d,s,t]),(0,a.useEffect)(()=>(u&&!m?A.current=setInterval(()=>{const e=he.getRecordingDuration();f(e),e>=r&&O()},100):A.current&&(clearInterval(A.current),A.current=null),()=>{A.current&&clearInterval(A.current)}),[u,m,r]);const F=(0,a.useCallback)(async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return S("MediaDevices API not supported in this browser"),!1;if(navigator.permissions){const e=await navigator.permissions.query({name:"microphone"});if("denied"===e.state)return S("Microphone permission denied. Please enable in browser settings."),!1;"prompt"===e.state&&S("Click record to allow microphone access")}return!0}catch(w){return console.warn("Permission check failed:",w),!0}},[]);(0,a.useEffect)(()=>{j&&F()},[j,F]);const L=(0,a.useCallback)(async()=>{if(!j){console.log("\ud83d\udd04 Service not initialized, initializing now...");try{const e=await he.initialize();if(N(e),!e)return void S("Failed to initialize voice recorder")}catch(w){return console.error("\u274c Initialization failed:",w),void S("Initialization failed: ".concat(w.message))}}try{console.log("\ud83c\udfa4 Testing microphone access first..."),S("Testing microphone access...");const e=await he.testMicrophoneAccess();if(!e.success)return console.error("\u274c Microphone test failed:",e.message),void S(e.message);console.log("\u2705 Microphone test passed, starting recording..."),S(null),E(0);const t={low:{bitrate:64e3,sampleRate:22050},standard:{bitrate:128e3,sampleRate:44100},high:{bitrate:256e3,sampleRate:48e3}}[P];if(!await he.startRecording(t))throw new Error("Failed to start recording - unknown error");console.log("\u2705 Recording started successfully")}catch(w){console.error("\u274c Recording start error:",w),S("Recording failed: ".concat(w.message)),h(!1)}},[j,P]),z=(0,a.useCallback)(()=>{he.cancelRecording(),f(0),y(0),I(null),S(null),n&&n()},[n]),O=(0,a.useCallback)(async()=>{if(g<o)return S("Recording too short. Minimum duration is ".concat(o/1e3," seconds.")),setTimeout(()=>S(null),3e3),void z();try{console.log("\ud83d\uded1 Stopping recording...");const e=await he.stopRecording();e&&e.url&&I(e),console.log("\u2705 Recording stopped successfully")}catch(w){console.error("\u274c Stop recording error:",w),S("Stop failed: ".concat(w.message)),setTimeout(()=>S(null),5e3)}},[g,o,z]),_=(0,a.useCallback)(()=>{he.pauseRecording()},[]),U=(0,a.useCallback)(()=>{he.resumeRecording()},[]),q=(0,a.useCallback)(async()=>{const e=C+1;E(e),e>3?S("Too many failed attempts. Please check your microphone settings and refresh the page."):(S("Retrying..."),setTimeout(()=>{L()},1e3*e))},[C,L]),B=(0,a.useCallback)(()=>{T&&t&&(t(T),I(null))},[T,t]),H=(0,a.useCallback)(()=>{T&&T.url&&URL.revokeObjectURL(T.url),I(null)},[T]),W=(0,a.useCallback)(e=>{const t=M.current;if(!t)return;const n=t.getContext("2d"),a=t.width,s=t.height,i=n.getImageData(2,0,a-2,s);n.putImageData(i,0,0),n.clearRect(a-2,0,2,s);const r=e/100*s,o=n.createLinearGradient(0,s,0,s-r);o.addColorStop(0,"#ef4444"),o.addColorStop(.5,"#f59e0b"),o.addColorStop(1,"#22c55e"),n.fillStyle=o,n.fillRect(a-2,s-r,2,r)},[]),V=(0,a.useCallback)(e=>{if(R.current){const t=Math.min(100,Math.max(0,e));R.current.style.width="".concat(t,"%")}M.current&&u&&W(e)},[u,W]),K=e=>{const t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return"".concat(n,":").concat(a.toString().padStart(2,"0"))};return j?!w||b||u?(0,k.jsxs)("div",{className:"voice-recorder ".concat(u?"recording":""," ").concat(m?"paused":""," ").concat(c?"compact":""," ").concat(l),children:[i&&(0,k.jsx)("button",{className:"recorder-close-btn",onClick:i,title:"Close",children:"\u2715"}),u&&(0,k.jsxs)("div",{className:"recording-status",children:[(0,k.jsxs)("div",{className:"recording-indicator",children:[(0,k.jsx)("div",{className:"recording-dot"}),(0,k.jsx)("span",{className:"recording-text",children:m?"Paused":"Recording"})]}),(0,k.jsx)("div",{className:"recording-duration",children:K(g)})]}),u&&!c&&(0,k.jsxs)("div",{className:"volume-visualization",children:[(0,k.jsxs)("div",{className:"volume-meter",children:[(0,k.jsx)("div",{className:"volume-label",children:"Volume"}),(0,k.jsx)("div",{className:"volume-bar-container",children:(0,k.jsx)("div",{ref:R,className:"volume-bar",style:{backgroundColor:v<20?"#6b7280":v<50?"#22c55e":v<80?"#f59e0b":"#ef4444"}})}),(0,k.jsxs)("div",{className:"volume-value",children:[v,"%"]})]}),(0,k.jsx)("div",{className:"waveform-container",children:(0,k.jsx)("canvas",{ref:M,className:"waveform-canvas",width:"200",height:"60"})})]}),u&&(0,k.jsxs)("div",{className:"recording-progress",children:[(0,k.jsx)("div",{className:"progress-bar",style:{width:"".concat(Math.min(100,g/r*100),"%")}}),(0,k.jsxs)("div",{className:"progress-time",children:[K(r-g)," remaining"]})]}),T&&!u&&(0,k.jsxs)("div",{className:"audio-preview",children:[(0,k.jsxs)("div",{className:"preview-header",children:[(0,k.jsx)("span",{className:"preview-title",children:"\ud83c\udfb5 Recording Preview"}),(0,k.jsxs)("span",{className:"preview-info",children:[K(T.duration)," \u2022 ",(T.size/1024).toFixed(0),"KB"]})]}),(0,k.jsx)(me,{audioUrl:T.url,duration:T.duration,compact:!1}),(0,k.jsxs)("div",{className:"preview-actions",children:[(0,k.jsxs)("button",{className:"preview-btn save-btn",onClick:B,title:"Save recording",children:[(0,k.jsx)("span",{className:"btn-icon",children:"\u2705"}),(0,k.jsx)("span",{className:"btn-text",children:"Save & Send"})]}),(0,k.jsxs)("button",{className:"preview-btn discard-btn",onClick:H,title:"Record again",children:[(0,k.jsx)("span",{className:"btn-icon",children:"\ud83d\udd04"}),(0,k.jsx)("span",{className:"btn-text",children:"Record Again"})]})]})]}),!u&&!T&&!c&&(0,k.jsxs)("div",{className:"quality-selector",children:[(0,k.jsx)("label",{className:"quality-label",children:"Recording Quality:"}),(0,k.jsxs)("div",{className:"quality-options",children:[(0,k.jsx)("button",{className:"quality-btn ".concat("low"===P?"active":""),onClick:()=>D("low"),title:"Low quality - Smaller file size",children:"\ud83d\udcc9 Low"}),(0,k.jsx)("button",{className:"quality-btn ".concat("standard"===P?"active":""),onClick:()=>D("standard"),title:"Standard quality - Balanced",children:"\ud83d\udcca Standard"}),(0,k.jsx)("button",{className:"quality-btn ".concat("high"===P?"active":""),onClick:()=>D("high"),title:"High quality - Larger file size",children:"\ud83d\udcc8 High"})]}),(0,k.jsxs)("div",{className:"quality-info",children:["low"===P&&"22kHz, 64kbps - Best for voice notes","standard"===P&&"44kHz, 128kbps - Recommended","high"===P&&"48kHz, 256kbps - Best quality"]})]}),(0,k.jsx)("div",{className:"recording-controls",children:u?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("button",{className:"control-btn pause-resume-btn",onClick:m?U:_,title:m?"Resume recording":"Pause recording",children:[(0,k.jsx)("span",{className:"btn-icon",children:m?"\u25b6\ufe0f":"\u23f8\ufe0f"}),(0,k.jsx)("span",{className:"btn-text",children:m?"Resume":"Pause"})]}),(0,k.jsxs)("button",{className:"control-btn stop-btn",onClick:O,title:"Stop and save recording",children:[(0,k.jsx)("span",{className:"btn-icon",children:"\u23f9\ufe0f"}),(0,k.jsx)("span",{className:"btn-text",children:"Stop"})]}),(0,k.jsxs)("button",{className:"control-btn cancel-btn",onClick:z,title:"Cancel recording",children:[(0,k.jsx)("span",{className:"btn-icon",children:"\u274c"}),(0,k.jsx)("span",{className:"btn-text",children:"Cancel"})]})]}):(0,k.jsxs)("button",{className:"control-btn record-btn",onClick:L,title:"Start recording",children:[(0,k.jsx)("span",{className:"btn-icon",children:"\ud83c\udfa4"}),(0,k.jsx)("span",{className:"btn-text",children:"Record"})]})}),w&&(0,k.jsxs)("div",{className:"recorder-error",children:[(0,k.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,k.jsx)("span",{className:"error-text",children:w})]}),!u&&!c&&(0,k.jsxs)("div",{className:"recorder-info",children:[(0,k.jsxs)("div",{className:"info-item",children:[(0,k.jsx)("span",{className:"info-label",children:"Max Duration:"}),(0,k.jsx)("span",{className:"info-value",children:K(r)})]}),(0,k.jsxs)("div",{className:"info-item",children:[(0,k.jsx)("span",{className:"info-label",children:"Format:"}),(0,k.jsx)("span",{className:"info-value",children:he.config.mimeType.split(";")[0]})]})]})]}):(0,k.jsxs)("div",{className:"voice-recorder error ".concat(l),children:[i&&(0,k.jsx)("button",{className:"recorder-close-btn",onClick:i,title:"Close",children:"\u2715"}),(0,k.jsxs)("div",{className:"recorder-message",children:[(0,k.jsx)("span",{className:"error-icon",children:"\ud83c\udfa4\u274c"}),(0,k.jsx)("span",{className:"error-message",children:w}),(0,k.jsx)("div",{className:"error-help",children:(0,k.jsxs)("details",{children:[(0,k.jsx)("summary",{children:"How to fix microphone issues"}),(0,k.jsxs)("ul",{children:[(0,k.jsx)("li",{children:"\u2705 Click the lock icon in your browser's address bar"}),(0,k.jsx)("li",{children:"\u2705 Allow microphone permissions for this site"}),(0,k.jsx)("li",{children:"\u2705 Check your system microphone settings"}),(0,k.jsx)("li",{children:"\u2705 Make sure no other app is using the microphone"}),(0,k.jsx)("li",{children:"\u2705 Try refreshing the page"})]})]})}),(0,k.jsxs)("div",{className:"error-actions",children:[(0,k.jsxs)("button",{className:"retry-btn primary",onClick:q,disabled:C>=3,children:["\ud83d\udd04 ",C>0?"Retry (".concat(3-C," left)"):"Try Again"]}),(0,k.jsx)("button",{className:"test-btn secondary",onClick:async()=>{const e=await he.testMicrophoneAccess();e.success?(S('\u2705 Microphone test passed! Click "Try Again" to record.'),x(!0),setTimeout(()=>S(null),3e3)):S(e.message)},children:"\ud83d\udd0d Test Microphone"})]})]})]}):(0,k.jsx)("div",{className:"voice-recorder loading ".concat(l),children:(0,k.jsxs)("div",{className:"recorder-message",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("span",{children:"Initializing voice recorder..."})]})})};class ge{constructor(){if(ge.instance)return ge.instance;this.db=null,this.dbName="QuibishFileShare",this.version=1,this.initialized=!1,this.maxFileSize=104857600,this.allowedTypes={images:["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"],videos:["video/mp4","video/webm","video/ogg"],audio:["audio/mpeg","audio/wav","audio/ogg","audio/webm"],documents:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","text/csv"],archives:["application/zip","application/x-rar-compressed","application/x-7z-compressed"]},this.activeTransfers=new Map,this.listeners={onUploadProgress:[],onUploadComplete:[],onUploadError:[],onDownloadProgress:[],onDownloadComplete:[],onFileDeleted:[],onFileShared:[]},ge.instance=this}async initialize(){return!!this.initialized||new Promise((e,t)=>{const n=indexedDB.open(this.dbName,this.version);n.onerror=()=>{console.error("FileShareService: Failed to open database"),t(new Error("Failed to open database"))},n.onsuccess=t=>{this.db=t.target.result,this.initialized=!0,console.log("FileShareService: Database initialized"),e(!0)},n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("files")){const e=t.createObjectStore("files",{keyPath:"id"});e.createIndex("userId","userId",{unique:!1}),e.createIndex("conversationId","conversationId",{unique:!1}),e.createIndex("uploadDate","uploadDate",{unique:!1}),e.createIndex("fileType","fileType",{unique:!1})}if(!t.objectStoreNames.contains("fileChunks")){t.createObjectStore("fileChunks",{keyPath:"id"}).createIndex("fileId","fileId",{unique:!1})}if(!t.objectStoreNames.contains("sharedFiles")){const e=t.createObjectStore("sharedFiles",{keyPath:"id"});e.createIndex("fileId","fileId",{unique:!1}),e.createIndex("sharedWith","sharedWith",{unique:!1})}console.log("FileShareService: Database schema created")}})}validateFile(e){const t=[];e.size>this.maxFileSize&&t.push("File size exceeds ".concat(this.maxFileSize/1048576,"MB limit"));return Object.values(this.allowedTypes).flat().includes(e.type)||t.push("File type ".concat(e.type," is not allowed")),/^[\w\-. ]+$/.test(e.name)||t.push("File name contains invalid characters"),{valid:0===t.length,errors:t}}getFileCategory(e){for(const[t,n]of Object.entries(this.allowedTypes))if(n.includes(e))return t;return"other"}async generateThumbnail(e){return new Promise(t=>{const n=new FileReader;n.onload=n=>{if(e.type.startsWith("image/")){const e=new Image;e.onload=()=>{const n=document.createElement("canvas"),a=n.getContext("2d"),s=200;let i=e.width,r=e.height;i>r?i>s&&(r*=s/i,i=s):r>s&&(i*=s/r,r=s),n.width=i,n.height=r,a.drawImage(e,0,0,i,r),t(n.toDataURL("image/jpeg",.7))},e.src=n.target.result}else if(e.type.startsWith("video/")){const e=document.createElement("video");e.onloadeddata=()=>{e.currentTime=1},e.onseeked=()=>{const n=document.createElement("canvas"),a=n.getContext("2d"),s=200;let i=e.videoWidth,r=e.videoHeight;i>r?i>s&&(r*=s/i,i=s):r>s&&(i*=s/r,r=s),n.width=i,n.height=r,a.drawImage(e,0,0,i,r),t(n.toDataURL("image/jpeg",.7))},e.src=n.target.result}else t(null)},n.readAsDataURL(e)})}async uploadFile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await this.initialize();const n=this.validateFile(e);if(!n.valid){const t=new Error(n.errors.join(", "));throw this.emitEvent("onUploadError",{file:e,error:t}),t}const a="file_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),s={id:a,name:e.name,size:e.size,type:e.type,category:this.getFileCategory(e.type),uploadDate:(new Date).toISOString(),userId:t.userId||"anonymous",conversationId:t.conversationId||null,description:t.description||"",tags:t.tags||[],thumbnail:null,progress:0,status:"uploading"};if(e.type.startsWith("image/")||e.type.startsWith("video/"))try{s.thumbnail=await this.generateThumbnail(e)}catch(i){console.warn("Failed to generate thumbnail:",i)}this.activeTransfers.set(a,s);try{const t=await e.arrayBuffer(),n=65536;let i=0;const r=()=>new Promise(t=>{setTimeout(()=>{i+=n;const o=Math.min(100,i/e.size*100);s.progress=o,this.emitEvent("onUploadProgress",{fileId:a,progress:o,file:s}),o>=100?t():r().then(t)},50)});await r();const o=this.db.transaction(["files","fileChunks"],"readwrite"),l=o.objectStore("files"),c=o.objectStore("fileChunks");return s.status="completed",s.progress=100,l.put(s),c.put({id:"".concat(a,"_data"),fileId:a,data:t}),await new Promise((e,t)=>{o.oncomplete=e,o.onerror=t}),this.activeTransfers.delete(a),this.emitEvent("onUploadComplete",{fileId:a,file:s}),s}catch(r){throw s.status="error",s.error=r.message,this.emitEvent("onUploadError",{fileId:a,file:s,error:r}),this.activeTransfers.delete(a),r}}async uploadFiles(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=[];for(const s of e)try{const e=await this.uploadFile(s,t);n.push({success:!0,file:e})}catch(a){n.push({success:!1,file:s.name,error:a.message})}return n}async downloadFile(e){await this.initialize();const t=this.db.transaction(["files","fileChunks"],"readonly"),n=t.objectStore("files"),a=t.objectStore("fileChunks"),s=n.get(e),i=await new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=t});if(!i)throw new Error("File not found");const r=a.get("".concat(e,"_data")),o=await new Promise((e,t)=>{r.onsuccess=()=>e(r.result),r.onerror=t});if(!o)throw new Error("File data not found");const l=new Blob([o.data],{type:i.type}),c=URL.createObjectURL(l),d=document.createElement("a");return d.href=c,d.download=i.name,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c),this.emitEvent("onDownloadComplete",{fileId:e,file:i}),i}async getFile(e){await this.initialize();const t=this.db.transaction(["files"],"readonly").objectStore("files").get(e);return new Promise((e,n)=>{t.onsuccess=()=>e(t.result),t.onerror=n})}async getUserFiles(e){await this.initialize();const t=this.db.transaction(["files"],"readonly").objectStore("files").index("userId").getAll(e);return new Promise((e,n)=>{t.onsuccess=()=>{const n=t.result||[];e(n.sort((e,t)=>new Date(t.uploadDate)-new Date(e.uploadDate)))},t.onerror=n})}async getConversationFiles(e){await this.initialize();const t=this.db.transaction(["files"],"readonly").objectStore("files").index("conversationId").getAll(e);return new Promise((e,n)=>{t.onsuccess=()=>{const n=t.result||[];e(n.sort((e,t)=>new Date(t.uploadDate)-new Date(e.uploadDate)))},t.onerror=n})}async searchFiles(e){await this.initialize();const t=this.db.transaction(["files"],"readonly").objectStore("files").getAll();return new Promise((n,a)=>{t.onsuccess=()=>{const a=t.result||[],s=e.toLowerCase(),i=a.filter(e=>e.name.toLowerCase().includes(s)||e.description.toLowerCase().includes(s)||e.tags.some(e=>e.toLowerCase().includes(s)));n(i.sort((e,t)=>new Date(t.uploadDate)-new Date(e.uploadDate)))},t.onerror=a})}async deleteFile(e){await this.initialize();const t=this.db.transaction(["files","fileChunks"],"readwrite"),n=t.objectStore("files"),a=t.objectStore("fileChunks"),s=n.get(e),i=await new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=t});return n.delete(e),a.delete("".concat(e,"_data")),await new Promise((e,n)=>{t.oncomplete=e,t.onerror=n}),this.emitEvent("onFileDeleted",{fileId:e,file:i}),!0}async getFileBlob(e){await this.initialize();const t=this.db.transaction(["files","fileChunks"],"readonly"),n=t.objectStore("files"),a=t.objectStore("fileChunks"),s=n.get(e),i=await new Promise((e,t)=>{s.onsuccess=()=>e(s.result),s.onerror=t});if(!i)throw new Error("File not found");const r=a.get("".concat(e,"_data")),o=await new Promise((e,t)=>{r.onsuccess=()=>e(r.result),r.onerror=t});if(!o)throw new Error("File data not found");return{blob:new Blob([o.data],{type:i.type}),metadata:i}}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]}on(e,t){this.listeners[e]&&this.listeners[e].push(t)}off(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(e=>e!==t))}emitEvent(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>e(t))}async clearAllFiles(){await this.initialize();const e=this.db.transaction(["files","fileChunks","sharedFiles"],"readwrite");return e.objectStore("files").clear(),e.objectStore("fileChunks").clear(),e.objectStore("sharedFiles").clear(),await new Promise((t,n)=>{e.oncomplete=t,e.onerror=n}),console.log("FileShareService: All files cleared"),!0}}const fe=new ge,ve=e=>{let{userId:t,conversationId:n,onClose:s,onFileSelect:i}=e;const[r,o]=(0,a.useState)([]),[l,d]=(0,a.useState)([]),[u,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)("all"),[g,f]=(0,a.useState)(""),[v,y]=(0,a.useState)(new Set),b=(0,a.useRef)(null);(0,a.useEffect)(()=>(document.body.classList.add("file-share-open"),()=>{document.body.classList.remove("file-share-open")}),[]),(0,a.useEffect)(()=>{x();const e=e=>{let{fileId:t,progress:n,file:a}=e;d(e=>{const s=e.findIndex(e=>e.id===t);if(s>=0){const t=[...e];return t[s]=c(c({},t[s]),{},{progress:n}),t}return[...e,c(c({},a),{},{progress:n})]})},t=e=>{let{file:t}=e;d(e=>e.filter(e=>e.id!==t.id)),x()},n=e=>{let{fileId:t}=e;d(e=>e.filter(e=>e.id!==t))},a=()=>{x()};return fe.on("onUploadProgress",e),fe.on("onUploadComplete",t),fe.on("onUploadError",n),fe.on("onFileDeleted",a),()=>{fe.off("onUploadProgress",e),fe.off("onUploadComplete",t),fe.off("onUploadError",n),fe.off("onFileDeleted",a)}},[n,t]);const x=(0,a.useCallback)(async()=>{try{let e;e=n?await fe.getConversationFiles(n):await fe.getUserFiles(t),o(e)}catch(e){console.error("Failed to load files:",e)}},[n,t]),w=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?h(!0):"dragleave"===e.type&&h(!1)},[]),S=(0,a.useCallback)(async e=>{e.preventDefault(),e.stopPropagation(),h(!1);const t=Array.from(e.dataTransfer.files);t.length>0&&await N(t)},[t,n]),j=(0,a.useCallback)(async e=>{const t=Array.from(e.target.files);t.length>0&&await N(t),e.target.value=""},[t,n]),N=async e=>{try{await fe.uploadFiles(e,{userId:t,conversationId:n})}catch(a){console.error("Upload error:",a)}},C=e=>{const t={images:"\ud83d\uddbc\ufe0f",videos:"\ud83c\udfa5",audio:"\ud83c\udfb5",documents:"\ud83d\udcc4",archives:"\ud83d\udce6",other:"\ud83d\udcce"};return t[e.category]||t.other},E=r.filter(e=>{if("all"!==m&&e.category!==m)return!1;if(g){const t=g.toLowerCase();return e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.tags.some(e=>e.toLowerCase().includes(t))}return!0});return(0,k.jsxs)("div",{className:"file-share-panel",children:[(0,k.jsxs)("div",{className:"file-share-header",children:[(0,k.jsx)("h2",{children:"\ud83d\udcc1 File Sharing"}),(0,k.jsx)("button",{className:"close-btn",onClick:s,children:"\u2715"})]}),(0,k.jsxs)("div",{className:"upload-area ".concat(u?"drag-active":""),onDragEnter:w,onDragLeave:w,onDragOver:w,onDrop:S,onClick:()=>{var e;return null===(e=b.current)||void 0===e?void 0:e.click()},children:[(0,k.jsx)("input",{ref:b,type:"file",multiple:!0,onChange:j,style:{display:"none"}}),(0,k.jsx)("div",{className:"upload-icon",children:"\ud83d\udce4"}),(0,k.jsx)("p",{className:"upload-text",children:u?"Drop files here":"Click or drag files to upload"}),(0,k.jsx)("p",{className:"upload-hint",children:"Max 100MB \u2022 Images, Videos, Audio, Documents, Archives"})]}),l.length>0&&(0,k.jsxs)("div",{className:"uploading-section",children:[(0,k.jsxs)("h3",{children:["Uploading (",l.length,")"]}),l.map(e=>(0,k.jsxs)("div",{className:"upload-progress-item",children:[(0,k.jsxs)("div",{className:"upload-info",children:[(0,k.jsx)("span",{className:"file-icon",children:C(e)}),(0,k.jsxs)("div",{className:"upload-details",children:[(0,k.jsx)("div",{className:"upload-name",children:e.name}),(0,k.jsx)("div",{className:"upload-size",children:fe.formatFileSize(e.size)})]})]}),(0,k.jsx)("div",{className:"progress-bar",children:(0,k.jsx)("div",{className:"progress-fill",style:{width:"".concat(e.progress,"%")}})}),(0,k.jsxs)("div",{className:"progress-text",children:[Math.round(e.progress),"%"]})]},e.id))]}),(0,k.jsxs)("div",{className:"file-controls",children:[(0,k.jsxs)("div",{className:"filter-tabs",children:[(0,k.jsx)("button",{className:"all"===m?"active":"",onClick:()=>p("all"),children:"All"}),(0,k.jsx)("button",{className:"images"===m?"active":"",onClick:()=>p("images"),children:"\ud83d\uddbc\ufe0f Images"}),(0,k.jsx)("button",{className:"videos"===m?"active":"",onClick:()=>p("videos"),children:"\ud83c\udfa5 Videos"}),(0,k.jsx)("button",{className:"documents"===m?"active":"",onClick:()=>p("documents"),children:"\ud83d\udcc4 Docs"}),(0,k.jsx)("button",{className:"audio"===m?"active":"",onClick:()=>p("audio"),children:"\ud83c\udfb5 Audio"})]}),(0,k.jsx)("div",{className:"search-box",children:(0,k.jsx)("input",{type:"text",placeholder:"Search files...",value:g,onChange:e=>f(e.target.value)})})]}),v.size>0&&(0,k.jsxs)("div",{className:"bulk-actions",children:[(0,k.jsxs)("span",{children:[v.size," selected"]}),(0,k.jsx)("button",{onClick:async()=>{if(window.confirm("Delete ".concat(v.size," selected files?")))try{for(const e of v)await fe.deleteFile(e);y(new Set)}catch(e){console.error("Bulk delete error:",e)}},className:"bulk-delete-btn",children:"\ud83d\uddd1\ufe0f Delete Selected"}),(0,k.jsx)("button",{onClick:()=>y(new Set),className:"bulk-clear-btn",children:"Clear Selection"})]}),(0,k.jsx)("div",{className:"file-list",children:0===E.length?(0,k.jsxs)("div",{className:"empty-state",children:[(0,k.jsx)("div",{className:"empty-icon",children:"\ud83d\udced"}),(0,k.jsx)("p",{children:"No files found"}),(0,k.jsx)("p",{className:"empty-hint",children:"Upload files to get started"})]}):(0,k.jsx)("div",{className:"file-grid",children:E.map(e=>(0,k.jsxs)("div",{className:"file-item ".concat(v.has(e.id)?"selected":""),onClick:()=>(e=>{i&&i(e)})(e),children:[(0,k.jsx)("div",{className:"file-checkbox",children:(0,k.jsx)("input",{type:"checkbox",checked:v.has(e.id),onChange:t=>((e,t)=>{t.stopPropagation(),y(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})})(e.id,t)})}),e.thumbnail?(0,k.jsx)("div",{className:"file-thumbnail",style:{backgroundImage:"url(".concat(e.thumbnail,")")}}):(0,k.jsx)("div",{className:"file-icon-large",children:C(e)}),(0,k.jsxs)("div",{className:"file-details",children:[(0,k.jsx)("div",{className:"file-name",title:e.name,children:e.name}),(0,k.jsxs)("div",{className:"file-meta",children:[(0,k.jsx)("span",{children:fe.formatFileSize(e.size)}),(0,k.jsx)("span",{children:"\u2022"}),(0,k.jsx)("span",{children:new Date(e.uploadDate).toLocaleDateString()})]})]}),(0,k.jsxs)("div",{className:"file-actions",children:[(0,k.jsx)("button",{className:"file-action-btn download",onClick:t=>(async(e,t)=>{t.stopPropagation();try{await fe.downloadFile(e)}catch(n){console.error("Download error:",n)}})(e.id,t),title:"Download",children:"\u2b07\ufe0f"}),(0,k.jsx)("button",{className:"file-action-btn delete",onClick:t=>(async(e,t)=>{if(t.stopPropagation(),window.confirm("Are you sure you want to delete this file?"))try{await fe.deleteFile(e)}catch(n){console.error("Delete error:",n)}})(e.id,t),title:"Delete",children:"\ud83d\uddd1\ufe0f"})]})]},e.id))})})]})},ye=e=>{let{fileId:t,onClose:n}=e;const[s,i]=(0,a.useState)(null),[r,o]=(0,a.useState)(null),[l,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(null);(0,a.useEffect)(()=>(h(),()=>{r&&URL.revokeObjectURL(r)}),[t]);const h=async()=>{try{c(!0);const{blob:e,metadata:n}=await fe.getFileBlob(t),a=URL.createObjectURL(e);o(a),i(n),c(!1)}catch(e){console.error("Failed to load file:",e),u(e.message),c(!1)}},m=async()=>{try{await fe.downloadFile(t)}catch(e){console.error("Download failed:",e)}};return l?(0,k.jsx)("div",{className:"file-preview-modal",children:(0,k.jsxs)("div",{className:"file-preview-content loading",children:[(0,k.jsx)("div",{className:"loader-spinner"}),(0,k.jsx)("p",{children:"Loading preview..."})]})}):d?(0,k.jsx)("div",{className:"file-preview-modal",children:(0,k.jsxs)("div",{className:"file-preview-content error",children:[(0,k.jsx)("div",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,k.jsx)("h3",{children:"Failed to load file"}),(0,k.jsx)("p",{children:d}),(0,k.jsx)("button",{onClick:n,children:"Close"})]})}):(0,k.jsx)("div",{className:"file-preview-modal",onClick:n,children:(0,k.jsxs)("div",{className:"file-preview-content",onClick:e=>e.stopPropagation(),children:[(0,k.jsxs)("div",{className:"preview-header",children:[(0,k.jsxs)("div",{className:"preview-info",children:[(0,k.jsx)("h2",{children:s.name}),(0,k.jsxs)("div",{className:"preview-meta",children:[(0,k.jsx)("span",{children:fe.formatFileSize(s.size)}),(0,k.jsx)("span",{children:"\u2022"}),(0,k.jsx)("span",{children:new Date(s.uploadDate).toLocaleString()})]})]}),(0,k.jsx)("button",{className:"preview-close-btn",onClick:n,children:"\u2715"})]}),(()=>{if(!s||!r)return null;const{category:e,type:t}=s;return"images"===e?(0,k.jsx)("div",{className:"preview-content image-preview",children:(0,k.jsx)("img",{src:r,alt:s.name})}):"videos"===e?(0,k.jsx)("div",{className:"preview-content video-preview",children:(0,k.jsx)("video",{controls:!0,src:r,children:"Your browser does not support video playback."})}):"audio"===e?(0,k.jsxs)("div",{className:"preview-content audio-preview",children:[(0,k.jsx)("div",{className:"audio-icon",children:"\ud83c\udfb5"}),(0,k.jsx)("audio",{controls:!0,src:r,children:"Your browser does not support audio playback."})]}):"application/pdf"===t?(0,k.jsx)("div",{className:"preview-content pdf-preview",children:(0,k.jsx)("iframe",{src:r,title:s.name})}):"text/plain"===t?(0,k.jsx)("div",{className:"preview-content text-preview",children:(0,k.jsx)("iframe",{src:r,title:s.name})}):(0,k.jsxs)("div",{className:"preview-content generic-preview",children:[(0,k.jsx)("div",{className:"generic-icon",children:"\ud83d\udcc4"}),(0,k.jsx)("h3",{children:s.name}),(0,k.jsx)("p",{className:"generic-hint",children:"This file type cannot be previewed in the browser"}),(0,k.jsx)("button",{className:"download-preview-btn",onClick:m,children:"\u2b07\ufe0f Download to View"})]})})(),(0,k.jsxs)("div",{className:"preview-actions",children:[(0,k.jsx)("button",{className:"preview-btn download-btn",onClick:m,children:"\u2b07\ufe0f Download"}),(0,k.jsx)("button",{className:"preview-btn delete-btn",onClick:async()=>{if(window.confirm("Are you sure you want to delete this file?"))try{await fe.deleteFile(t),n()}catch(e){console.error("Delete failed:",e)}},children:"\ud83d\uddd1\ufe0f Delete"})]}),s.description&&(0,k.jsxs)("div",{className:"preview-description",children:[(0,k.jsx)("h4",{children:"Description"}),(0,k.jsx)("p",{children:s.description})]}),s.tags&&s.tags.length>0&&(0,k.jsxs)("div",{className:"preview-tags",children:[(0,k.jsx)("h4",{children:"Tags"}),(0,k.jsx)("div",{className:"tag-list",children:s.tags.map((e,t)=>(0,k.jsx)("span",{className:"tag",children:e},t))})]})]})})};class be{constructor(){if(be.instance)return be.instance;this.peerConnection=null,this.localStream=null,this.remoteStream=null,this.screenStream=null,this.mediaRecorder=null,this.recordedChunks=[],this.callState={active:!1,participants:[],callId:null,startTime:null,duration:0,isScreenSharing:!1,isRecording:!1,isMuted:!1,isVideoOff:!1,layout:"grid",quality:"auto"},this.devices={cameras:[],microphones:[],speakers:[],selectedCamera:null,selectedMicrophone:null,selectedSpeaker:null},this.virtualBackground={enabled:!1,type:"none",image:null,blurAmount:10},this.stats={bytesReceived:0,bytesSent:0,packetsLost:0,jitter:0,roundTripTime:0,bandwidth:0,quality:"good"},this.listeners={onCallStart:[],onCallEnd:[],onParticipantJoin:[],onParticipantLeave:[],onStreamUpdate:[],onScreenShare:[],onRecordingUpdate:[],onQualityChange:[],onError:[]},this.rtcConfig={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]},be.instance=this}async initialize(){try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.warn("\u26a0\ufe0f getUserMedia not supported"),!1;await this.enumerateDevices();const t=this.devices.cameras.length>0,n=this.devices.microphones.length>0;if(t||n)try{const e={};t&&(e.video=!0),n&&(e.audio=!0);(await navigator.mediaDevices.getUserMedia(e)).getTracks().forEach(e=>e.stop()),await this.enumerateDevices()}catch(e){console.warn("\u26a0\ufe0f Could not get device permissions:",e.message)}else console.warn("\u26a0\ufe0f No camera or microphone devices found");return console.log("EnhancedVideoCallService: Initialized"),!0}catch(t){return console.error("\u274c Failed to initialize video call service:",t),this.emitEvent("onError",{error:"Failed to initialize devices"}),!1}}async enumerateDevices(){try{const e=await navigator.mediaDevices.enumerateDevices();return this.devices.cameras=e.filter(e=>"videoinput"===e.kind),this.devices.microphones=e.filter(e=>"audioinput"===e.kind),this.devices.speakers=e.filter(e=>"audiooutput"===e.kind),!this.devices.selectedCamera&&this.devices.cameras.length>0&&(this.devices.selectedCamera=this.devices.cameras[0].deviceId),!this.devices.selectedMicrophone&&this.devices.microphones.length>0&&(this.devices.selectedMicrophone=this.devices.microphones[0].deviceId),!this.devices.selectedSpeaker&&this.devices.speakers.length>0&&(this.devices.selectedSpeaker=this.devices.speakers[0].deviceId),this.devices}catch(e){return console.error("Failed to enumerate devices:",e),this.devices}}getQualityConstraints(){const e={high:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},medium:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:24}},low:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:15}},auto:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:24}}};return e[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto"]||e.auto}async startCall(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const{callId:s="call_".concat(Date.now()),participants:i=[],quality:r="auto"}=e;if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("getUserMedia is not supported in this browser");const o=this.getQualityConstraints(r),l={video:c(c({},o),{},{deviceId:this.devices.selectedCamera?{ideal:this.devices.selectedCamera}:void 0}),audio:{deviceId:this.devices.selectedMicrophone?{ideal:this.devices.selectedMicrophone}:void 0,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}};try{this.localStream=await navigator.mediaDevices.getUserMedia(l)}catch(t){if("NotFoundError"!==t.name&&"OverconstrainedError"!==t.name)throw t;{console.warn("\u26a0\ufe0f Stored device not found, trying default devices"),this.devices.selectedCamera=null,this.devices.selectedMicrophone=null;const e={video:o,audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}};try{this.localStream=await navigator.mediaDevices.getUserMedia(e)}catch(n){if("NotFoundError"!==n.name)throw n;console.warn("\u26a0\ufe0f No camera found, trying audio-only");try{this.localStream=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(a){throw new Error("No camera or microphone found. Please connect a device and try again.")}}}}return this.callState={active:!0,participants:[{id:"local",name:"You",stream:this.localStream}],callId:s,startTime:new Date,duration:0,isScreenSharing:!1,isRecording:!1,isMuted:!1,isVideoOff:!1,layout:"grid",quality:r},this.startDurationTimer(),this.virtualBackground.enabled&&await this.applyVirtualBackground(),this.emitEvent("onCallStart",{callId:s,stream:this.localStream}),{success:!0,callId:s,stream:this.localStream}}catch(t){return console.error("Failed to start video call:",t),this.emitEvent("onError",{error:t.message}),{success:!1,error:t.message}}}async endCall(){try{this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null),this.remoteStream&&(this.remoteStream.getTracks().forEach(e=>e.stop()),this.remoteStream=null),this.screenStream&&(this.screenStream.getTracks().forEach(e=>e.stop()),this.screenStream=null),this.callState.isRecording&&await this.stopRecording(),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.stopDurationTimer();const e=c({},this.callState);return this.callState={active:!1,participants:[],callId:null,startTime:null,duration:0,isScreenSharing:!1,isRecording:!1,isMuted:!1,isVideoOff:!1,layout:"grid",quality:"auto"},this.emitEvent("onCallEnd",e),!0}catch(e){return console.error("Failed to end call:",e),!1}}toggleMute(){if(!this.localStream)return!1;return this.localStream.getAudioTracks().forEach(e=>{e.enabled=!e.enabled}),this.callState.isMuted=!this.callState.isMuted,this.emitEvent("onStreamUpdate",{type:"audio",muted:this.callState.isMuted}),this.callState.isMuted}toggleVideo(){if(!this.localStream)return!1;return this.localStream.getVideoTracks().forEach(e=>{e.enabled=!e.enabled}),this.callState.isVideoOff=!this.callState.isVideoOff,this.emitEvent("onStreamUpdate",{type:"video",off:this.callState.isVideoOff}),this.callState.isVideoOff}async startScreenShare(){try{return this.screenStream=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always",displaySurface:"monitor"},audio:!0}),this.screenStream.getVideoTracks()[0].onended=()=>{this.stopScreenShare()},this.callState.isScreenSharing=!0,this.emitEvent("onScreenShare",{started:!0,stream:this.screenStream}),this.screenStream}catch(e){return console.error("Failed to start screen share:",e),this.emitEvent("onError",{error:"Screen sharing failed"}),null}}stopScreenShare(){this.screenStream&&(this.screenStream.getTracks().forEach(e=>e.stop()),this.screenStream=null),this.callState.isScreenSharing=!1,this.emitEvent("onScreenShare",{started:!1})}async startRecording(){try{if(!this.localStream)throw new Error("No active stream to record");const e=document.createElement("canvas");e.width=1280,e.height=720;const t=e.getContext("2d"),n=document.createElement("video");n.srcObject=this.localStream,n.play();const a=e.captureStream(30);this.localStream.getAudioTracks().forEach(e=>a.addTrack(e)),this.mediaRecorder=new MediaRecorder(a,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:25e5}),this.recordedChunks=[],this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.recordedChunks.push(e.data)},this.mediaRecorder.onstop=()=>{const e=new Blob(this.recordedChunks,{type:"video/webm"}),t=URL.createObjectURL(e);this.emitEvent("onRecordingUpdate",{recording:!1,blob:e,url:t,duration:this.callState.duration})};const s=()=>{this.callState.isRecording&&(t.fillStyle="#000",t.fillRect(0,0,e.width,e.height),n.readyState===n.HAVE_ENOUGH_DATA&&t.drawImage(n,0,0,e.width,e.height),requestAnimationFrame(s))};return this.mediaRecorder.start(1e3),s(),this.callState.isRecording=!0,this.emitEvent("onRecordingUpdate",{recording:!0}),!0}catch(e){return console.error("Failed to start recording:",e),this.emitEvent("onError",{error:"Recording failed"}),!1}}async stopRecording(){return!(!this.mediaRecorder||"inactive"===this.mediaRecorder.state)&&(this.mediaRecorder.stop(),this.callState.isRecording=!1,!0)}async pauseRecording(){return!(!this.mediaRecorder||"recording"!==this.mediaRecorder.state)&&(this.mediaRecorder.pause(),!0)}async resumeRecording(){return!(!this.mediaRecorder||"paused"!==this.mediaRecorder.state)&&(this.mediaRecorder.resume(),!0)}setRecordingQuality(e){const t={low:1e6,medium:25e5,high:5e6};return this.recordingBitrate=t[e]||t.high,!0}downloadRecording(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"video-call-recording.webm";const n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}async changeQuality(e){if(!this.localStream)return!1;try{const t=this.localStream.getVideoTracks()[0],n=this.getQualityConstraints(e);return await t.applyConstraints(n),this.callState.quality=e,this.emitEvent("onQualityChange",{quality:e}),!0}catch(t){return console.error("Failed to change quality:",t),!1}}async switchCamera(e){if(!this.localStream)return!1;try{const t=this.localStream.getVideoTracks()[0];t.stop();const n={video:c(c({},this.getQualityConstraints(this.callState.quality)),{},{deviceId:{ideal:e}})},a=(await navigator.mediaDevices.getUserMedia(n)).getVideoTracks()[0];if(this.localStream.removeTrack(t),this.localStream.addTrack(a),this.peerConnection){const e=this.peerConnection.getSenders().find(e=>"video"===e.track.kind);e&&await e.replaceTrack(a)}return this.devices.selectedCamera=e,this.emitEvent("onStreamUpdate",{type:"camera",deviceId:e}),!0}catch(t){return console.error("\u274c Failed to switch camera:",t),"NotFoundError"===t.name&&console.error("Camera device not found:",e),!1}}async switchMicrophone(e){if(!this.localStream)return!1;try{const t=this.localStream.getAudioTracks()[0];t.stop();const n={audio:{deviceId:{ideal:e},echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}},a=(await navigator.mediaDevices.getUserMedia(n)).getAudioTracks()[0];if(this.localStream.removeTrack(t),this.localStream.addTrack(a),this.peerConnection){const e=this.peerConnection.getSenders().find(e=>"audio"===e.track.kind);e&&await e.replaceTrack(a)}return this.devices.selectedMicrophone=e,this.emitEvent("onStreamUpdate",{type:"microphone",deviceId:e}),!0}catch(t){return console.error("\u274c Failed to switch microphone:",t),"NotFoundError"===t.name&&console.error("Microphone device not found:",e),!1}}async enableBackgroundBlur(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this.virtualBackground={enabled:!0,type:"blur",image:null,blurAmount:e},this.localStream&&await this.applyVirtualBackground(),!0}async disableVirtualBackground(){return this.virtualBackground={enabled:!1,type:"none",image:null,blurAmount:10},this.callState.active,!0}async applyVirtualBackground(){return console.log("Virtual background applied:",this.virtualBackground.type),!0}changeLayout(e){return!!["grid","speaker","pip"].includes(e)&&(this.callState.layout=e,this.emitEvent("onStreamUpdate",{type:"layout",layout:e}),!0)}startDurationTimer(){this.durationInterval=setInterval(()=>{this.callState.startTime&&(this.callState.duration=Math.floor((new Date-this.callState.startTime)/1e3))},1e3)}stopDurationTimer(){this.durationInterval&&(clearInterval(this.durationInterval),this.durationInterval=null)}formatDuration(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),a=e%60;return t>0?"".concat(t,":").concat(String(n).padStart(2,"0"),":").concat(String(a).padStart(2,"0")):"".concat(n,":").concat(String(a).padStart(2,"0"))}getCallState(){return c({},this.callState)}getDevices(){return c({},this.devices)}getStats(){return c({},this.stats)}on(e,t){this.listeners[e]&&this.listeners[e].push(t)}off(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(e=>e!==t))}emitEvent(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>e(t))}}const xe=new be;class we{constructor(){if(we.instance)return we.instance;this.canvas=null,this.ctx=null,this.videoElement=null,this.outputStream=null,this.animationFrame=null,this.filters={smoothSkin:0,brighten:0,eyeEnhance:!1,lipEnhance:!1,slimFace:0,brightness:0,contrast:0,saturation:0,temperature:0,tint:0,exposure:0,highlights:0,shadows:0,vibrance:0,blur:0,sharpen:0,vignette:0,grain:0,arEffect:"none",arColor:"#ffffff",preset:"none"},this.presets={none:{},natural:{smoothSkin:30,brighten:10,saturation:5,vibrance:10},vivid:{brightness:10,contrast:15,saturation:30,vibrance:25,sharpen:20},dramatic:{contrast:35,shadows:-20,highlights:20,saturation:20,vignette:40},vintage:{saturation:-30,temperature:20,grain:30,vignette:50,contrast:-10},cool:{temperature:-40,tint:10,brightness:5,saturation:10},warm:{temperature:40,brightness:10,saturation:15,smoothSkin:20}},this.faceDetected=!1,this.facePosition=null,we.instance=this}initialize(e){return this.videoElement=e,this.canvas=document.createElement("canvas"),this.canvas.width=1280,this.canvas.height=720,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),console.log("VideoFiltersService: Initialized"),!0}startProcessing(){return this.videoElement&&this.canvas?(this.outputStream=this.canvas.captureStream(30),this.renderFrame(),this.outputStream):(console.error("Video filters not initialized"),null)}stopProcessing(){this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null),this.outputStream&&(this.outputStream.getTracks().forEach(e=>e.stop()),this.outputStream=null)}renderFrame(){if(!this.videoElement||this.videoElement.paused||this.videoElement.ended)return;this.ctx.drawImage(this.videoElement,0,0,this.canvas.width,this.canvas.height);let e=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);e=this.applyBeautyFilters(e),e=this.applyColorAdjustments(e),e=this.applyEffects(e),this.ctx.putImageData(e,0,0),this.applyAREffects(),this.animationFrame=requestAnimationFrame(()=>this.renderFrame())}applyBeautyFilters(e){const t=e.data;if(this.filters.smoothSkin>0){const t=Math.floor(this.filters.smoothSkin/20)+1;e=this.applyGaussianBlur(e,t)}if(this.filters.brighten>0){const e=1.5*this.filters.brighten;for(let n=0;n<t.length;n+=4)t[n]=Math.min(255,t[n]+e),t[n+1]=Math.min(255,t[n+1]+e),t[n+2]=Math.min(255,t[n+2]+e)}return e}applyColorAdjustments(e){const t=e.data;for(let n=0;n<t.length;n+=4){let e=t[n],a=t[n+1],s=t[n+2];if(0!==this.filters.brightness){const t=2.55*this.filters.brightness;e=Math.max(0,Math.min(255,e+t)),a=Math.max(0,Math.min(255,a+t)),s=Math.max(0,Math.min(255,s+t))}if(0!==this.filters.contrast){const t=259*(this.filters.contrast+255)/(255*(259-this.filters.contrast));e=Math.max(0,Math.min(255,t*(e-128)+128)),a=Math.max(0,Math.min(255,t*(a-128)+128)),s=Math.max(0,Math.min(255,t*(s-128)+128))}if(0!==this.filters.saturation){const t=.2989*e+.587*a+.114*s,n=1+this.filters.saturation/100;e=Math.max(0,Math.min(255,t+n*(e-t))),a=Math.max(0,Math.min(255,t+n*(a-t))),s=Math.max(0,Math.min(255,t+n*(s-t)))}if(0!==this.filters.temperature){const t=this.filters.temperature/100;t>0?(e=Math.min(255,e+30*t),s=Math.max(0,s-30*t)):(e=Math.max(0,e+30*t),s=Math.min(255,s-30*t))}if(0!==this.filters.tint){const t=this.filters.tint/100;t>0?a=Math.min(255,a+30*t):(e=Math.min(255,e-15*t),s=Math.min(255,s-15*t),a=Math.max(0,a+30*t))}if(0!==this.filters.exposure){const t=Math.pow(2,this.filters.exposure/100);e=Math.min(255,e*t),a=Math.min(255,a*t),s=Math.min(255,s*t)}if(0!==this.filters.vibrance){const t=Math.max(e,a,s),n=(e+a+s)/3,i=this.filters.vibrance/100*(1-t/255)*(t-n)/128;e=Math.max(0,Math.min(255,e+(e-n)*i)),a=Math.max(0,Math.min(255,a+(a-n)*i)),s=Math.max(0,Math.min(255,s+(s-n)*i))}t[n]=e,t[n+1]=a,t[n+2]=s}return e}applyEffects(e){return this.filters.sharpen>0&&(e=this.applySharpen(e,this.filters.sharpen/100)),this.filters.vignette>0&&(e=this.applyVignette(e,this.filters.vignette/100)),this.filters.grain>0&&(e=this.applyGrain(e,this.filters.grain/100)),e}applyGaussianBlur(e,t){const n=e.data,a=e.width,s=e.height,i=new Uint8ClampedArray(n);for(let r=0;r<s;r++)for(let e=0;e<a;e++){let o=0,l=0,c=0,d=0;for(let n=-t;n<=t;n++)for(let u=-t;u<=t;u++){const t=Math.min(a-1,Math.max(0,e+u)),h=4*(Math.min(s-1,Math.max(0,r+n))*a+t);o+=i[h],l+=i[h+1],c+=i[h+2],d++}const u=4*(r*a+e);n[u]=o/d,n[u+1]=l/d,n[u+2]=c/d}return e}applySharpen(e,t){const n=e.data,a=e.width,s=e.height,i=new Uint8ClampedArray(n),r=[0,-t,0,-t,1+4*t,-t,0,-t,0];for(let o=1;o<s-1;o++)for(let e=1;e<a-1;e++){let t=0,s=0,l=0;for(let n=-1;n<=1;n++)for(let c=-1;c<=1;c++){const d=4*((o+n)*a+(e+c)),u=r[3*(n+1)+(c+1)];t+=i[d]*u,s+=i[d+1]*u,l+=i[d+2]*u}const c=4*(o*a+e);n[c]=Math.max(0,Math.min(255,t)),n[c+1]=Math.max(0,Math.min(255,s)),n[c+2]=Math.max(0,Math.min(255,l))}return e}applyVignette(e,t){const n=e.data,a=e.width,s=e.height,i=a/2,r=s/2,o=Math.sqrt(i*i+r*r);for(let l=0;l<s;l++)for(let e=0;e<a;e++){const s=e-i,c=l-r,d=1-Math.sqrt(s*s+c*c)/o*t,u=4*(l*a+e);n[u]*=d,n[u+1]*=d,n[u+2]*=d}return e}applyGrain(e,t){const n=e.data,a=50*t;for(let s=0;s<n.length;s+=4){const e=(Math.random()-.5)*a;n[s]=Math.max(0,Math.min(255,n[s]+e)),n[s+1]=Math.max(0,Math.min(255,n[s+1]+e)),n[s+2]=Math.max(0,Math.min(255,n[s+2]+e))}return e}applyAREffects(){if("none"===this.filters.arEffect)return;const e=this.canvas.width,t=this.canvas.height,n=e/2,a=t/2.5,s=e/4,i=t/3;switch(this.ctx.save(),this.filters.arEffect){case"glasses":this.drawGlasses(n,a,s);break;case"hat":this.drawHat(n,a,s);break;case"mask":this.drawMask(n,a,s,i);break;case"ears":this.drawEars(n,a,s,i);break;case"mustache":this.drawMustache(n,a+i/3,s)}this.ctx.restore()}drawGlasses(e,t,n){const a=1.2*n,s=n/3,i=a/2.5;this.ctx.strokeStyle=this.filters.arColor,this.ctx.lineWidth=8,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),this.ctx.roundRect(e-a/2+20,t-s/2,i,s,10),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.roundRect(e+a/2-i-20,t-s/2,i,s,10),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(e-20,t),this.ctx.lineTo(e+20,t),this.ctx.stroke(),this.ctx.fillStyle="rgba(100, 100, 100, 0.3)",this.ctx.beginPath(),this.ctx.roundRect(e-a/2+20,t-s/2,i,s,10),this.ctx.fill(),this.ctx.beginPath(),this.ctx.roundRect(e+a/2-i-20,t-s/2,i,s,10),this.ctx.fill()}drawHat(e,t,n){const a=1.5*n,s=1.2*n;this.ctx.fillStyle=this.filters.arColor,this.ctx.strokeStyle="#000",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.ellipse(e,t-s,a/3,s/4,0,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.ellipse(e,t-s/2,a/2,s/8,0,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke()}drawMask(e,t,n,a){this.ctx.fillStyle=this.filters.arColor,this.ctx.strokeStyle="#000",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.ellipse(e,t,n/1.8,a/2.5,0,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.fillStyle="#000",this.ctx.beginPath(),this.ctx.ellipse(e-n/4,t-a/12,n/8,a/10,0,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.ellipse(e+n/4,t-a/12,n/8,a/10,0,0,2*Math.PI),this.ctx.fill()}drawEars(e,t,n,a){this.ctx.fillStyle=this.filters.arColor,this.ctx.strokeStyle="#000",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.ellipse(e-n/1.5,t-a/3,n/4,a/2.5,-.3,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.ellipse(e+n/1.5,t-a/3,n/4,a/2.5,.3,0,2*Math.PI),this.ctx.fill(),this.ctx.stroke(),this.ctx.fillStyle="rgba(255, 182, 193, 0.7)",this.ctx.beginPath(),this.ctx.ellipse(e-n/1.5,t-a/3,n/6,a/4,-.3,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),this.ctx.ellipse(e+n/1.5,t-a/3,n/6,a/4,.3,0,2*Math.PI),this.ctx.fill()}drawMustache(e,t,n){this.ctx.fillStyle=this.filters.arColor,this.ctx.strokeStyle="#000",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.bezierCurveTo(e-n/3,t-n/6,e-n/2,t+n/12,e-n/1.5,t),this.ctx.bezierCurveTo(e-n/1.5,t+n/8,e-n/4,t+n/10,e,t+n/20),this.ctx.bezierCurveTo(e+n/4,t+n/10,e+n/1.5,t+n/8,e+n/1.5,t),this.ctx.bezierCurveTo(e+n/2,t+n/12,e+n/3,t-n/6,e,t),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}setFilter(e,t){return!!this.filters.hasOwnProperty(e)&&(this.filters[e]=t,!0)}applyPreset(e){if(!this.presets[e])return!1;this.resetFilters();const t=this.presets[e];return Object.keys(t).forEach(e=>{this.filters[e]=t[e]}),this.filters.preset=e,!0}resetFilters(){this.filters={smoothSkin:0,brighten:0,eyeEnhance:!1,lipEnhance:!1,slimFace:0,brightness:0,contrast:0,saturation:0,temperature:0,tint:0,exposure:0,highlights:0,shadows:0,vibrance:0,blur:0,sharpen:0,vignette:0,grain:0,arEffect:"none",arColor:"#ffffff",preset:"none"}}getFilters(){return c({},this.filters)}getPresets(){return Object.keys(this.presets)}getAREffects(){return["none","glasses","hat","mask","ears","mustache"]}}const Se=new we,ke=e=>{let{onClose:t,callId:n,participants:s=[]}=e;const[i,r]=(0,a.useState)(null),[o,l]=(0,a.useState)(null),[c,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)("grid"),[g,f]=(0,a.useState)(!1),[v,y]=(0,a.useState)(null),[b,x]=(0,a.useState)("none"),[w,S]=(0,a.useState)("good"),[j,N]=(0,a.useState)(0),[C,E]=(0,a.useState)(0),[T,I]=(0,a.useState)(!1),[P,D]=(0,a.useState)(0),[A,M]=(0,a.useState)(!1),[R,F]=(0,a.useState)(""),[L,z]=(0,a.useState)(!1),[O,_]=(0,a.useState)(null),[U,q]=(0,a.useState)(!0),[B,H]=(0,a.useState)([]),[W,V]=(0,a.useState)(null),[K,G]=(0,a.useState)(!1),[J,Y]=(0,a.useState)(!1),[Q,$]=(0,a.useState)(!1),[X,Z]=(0,a.useState)("high"),ee=(0,a.useRef)(null),te=(0,a.useRef)(null),ne=(0,a.useRef)(null),ae=(0,a.useRef)(null),se=(0,a.useRef)(null),ie=(0,a.useRef)(null),re=(0,a.useRef)([]),oe=(0,a.useRef)(null),le=(0,a.useRef)(null),ce=(0,a.useRef)(null);(0,a.useEffect)(()=>{de();const e=()=>{t()},n=e=>{ue()},a=e=>{e.started&&ne.current&&(ne.current.srcObject=e.stream)},s=e=>{if(!e.recording&&e.blob){window.confirm("Recording complete! Download now?")&&xe.downloadRecording(e.blob)}};xe.on("onCallEnd",e),xe.on("onStreamUpdate",n),xe.on("onScreenShare",a),xe.on("onRecordingUpdate",s);const i=setInterval(()=>{const e=["excellent","good","poor"],t=e[Math.floor(Math.random()*e.length)];S(t)},1e4);return()=>{xe.off("onCallEnd",e),xe.off("onStreamUpdate",n),xe.off("onScreenShare",a),xe.off("onRecordingUpdate",s),clearInterval(i),oe.current&&clearInterval(oe.current),ie.current&&"inactive"!==ie.current.state&&ie.current.stop(),le.current&&le.current.stop(),ce.current&&clearInterval(ce.current)}},[]),(0,a.useEffect)(()=>{const e=se.current;if(!e)return;const t=e=>{N(e.touches[0].clientY)},n=e=>{const t=e.touches[0].clientY-j;t>0&&E(t)},a=()=>{C>100&&f(!0),E(0)};return e.addEventListener("touchstart",t),e.addEventListener("touchmove",n),e.addEventListener("touchend",a),()=>{e.removeEventListener("touchstart",t),e.removeEventListener("touchmove",n),e.removeEventListener("touchend",a)}},[j,C]);const de=async()=>{try{if(!await xe.initialize())return console.warn("\u26a0\ufe0f Video call service could not be fully initialized"),void y(Se.getFilters());const e=await xe.startCall({callId:n,participants:s,quality:"auto"});if(e.success){if(y(Se.getFilters()),ae.current){ae.current.srcObject=e.stream,await ae.current.play(),Se.initialize(ae.current);const t=Se.startProcessing();ee.current&&t&&(ee.current.srcObject=t)}}else console.warn("\u26a0\ufe0f Call start failed:",e.error),y(Se.getFilters())}catch(e){console.error("\u274c Failed to initialize call:",e.message||e),e.message&&e.message.includes("No camera or microphone")&&console.info("\u2139\ufe0f Tip: Connect a camera or microphone to use video calling features"),y(Se.getFilters())}ue(),he()},ue=()=>{r(xe.getCallState())},he=()=>{l(xe.getDevices())},me=(0,a.useCallback)(()=>{xe.endCall()},[]),pe=(0,a.useCallback)(()=>{xe.toggleMute(),ue()},[]),ge=(0,a.useCallback)(()=>{xe.toggleVideo(),ue()},[]),fe=(0,a.useCallback)(async()=>{null!==i&&void 0!==i&&i.isScreenSharing?xe.stopScreenShare():await xe.startScreenShare(),ue()},[i]),ve=(0,a.useCallback)(async()=>{null!==i&&void 0!==i&&i.isRecording?await xe.stopRecording():await xe.startRecording(),ue()},[i]),ye=(0,a.useCallback)(e=>{xe.changeLayout(e),p(e),ue()},[]),be=(0,a.useCallback)(async e=>{await xe.changeQuality(e),ue()},[]),we=(0,a.useCallback)(async e=>{await xe.switchCamera(e),he()},[]),ke=(0,a.useCallback)(async e=>{await xe.switchMicrophone(e),he()},[]),je=(0,a.useCallback)(async()=>{await xe.enableBackgroundBlur(15),ue()},[]),Ne=(0,a.useCallback)((e,t)=>{Se.setFilter(e,t),y(Se.getFilters())},[]),Ce=(0,a.useCallback)(e=>{Se.applyPreset(e),y(Se.getFilters()),x(e)},[]),Ee=(0,a.useCallback)(e=>{Se.setFilter("arEffect",e),y(Se.getFilters())},[]),Te=(0,a.useCallback)(()=>{Se.resetFilters(),y(Se.getFilters()),x("none")},[]),Ie=(0,a.useCallback)(async()=>{if(T)ie.current&&"inactive"!==ie.current.state&&ie.current.stop(),oe.current&&(clearInterval(oe.current),oe.current=null),I(!1),D(0);else try{const e=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"monitor",cursor:"always",width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});if(!window.MediaRecorder)throw new Error("Screen recording not supported in this browser");let t={mimeType:"video/webm;codecs=vp9"};MediaRecorder.isTypeSupported(t.mimeType)||(t={mimeType:"video/webm;codecs=vp8"},MediaRecorder.isTypeSupported(t.mimeType)||(t={mimeType:"video/webm"})),re.current=[],ie.current=new MediaRecorder(e,t),ie.current.ondataavailable=e=>{e.data&&e.data.size>0&&re.current.push(e.data)},ie.current.onstop=()=>{const t=new Blob(re.current,{type:"video/webm"}),n=URL.createObjectURL(t),a=document.createElement("a");a.style.display="none",a.href=n,a.download="screen-recording-".concat((new Date).toISOString().slice(0,19).replace(/:/g,"-"),".webm"),document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a),URL.revokeObjectURL(n)},100),e.getTracks().forEach(e=>e.stop()),re.current=[]},e.getVideoTracks()[0].onended=()=>{T&&Ie()},ie.current.start(1e3),I(!0),D(0),oe.current=setInterval(()=>{D(e=>e+1)},1e3)}catch(e){console.error("Failed to start screen recording:",e),alert(e.message||"Failed to start screen recording. Please ensure you granted permission.")}},[T]),Pe=e=>{const t=Math.floor(e/60),n=e%60;return"".concat(t,":").concat(n.toString().padStart(2,"0"))},De=(0,a.useCallback)(()=>{if(A)le.current&&(le.current.stop(),le.current=null),F("");else{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window))return void alert("Speech recognition not supported in this browser");{const e=window.SpeechRecognition||window.webkitSpeechRecognition;le.current=new e,le.current.continuous=!0,le.current.interimResults=!0,le.current.lang="en-US",le.current.onresult=e=>{let t="",n="";for(let a=e.resultIndex;a<e.results.length;a++){const s=e.results[a][0].transcript;e.results[a].isFinal?n+=s+" ":t+=s}F(n||t)},le.current.onerror=e=>{console.error("Speech recognition error:",e.error)},le.current.start()}}M(!A)},[A]),Ae=(0,a.useCallback)(()=>{if(q(!U),null!==i&&void 0!==i&&i.localStream){const e=i.localStream.getAudioTracks()[0];e&&e.applyConstraints({noiseSuppression:!U,echoCancellation:!0,autoGainControl:!0})}},[U,i]),Me=(0,a.useCallback)(()=>{L?(ce.current&&(clearInterval(ce.current),ce.current=null),_(null)):ce.current=setInterval(()=>{const e=xe.getStats();_({bandwidth:"".concat((e.bandwidth/1e3).toFixed(1)," kbps"),fps:"30",packetLoss:"".concat(e.packetsLost||0),latency:"".concat(e.roundTripTime||0," ms"),jitter:"".concat(e.jitter||0," ms"),quality:w})},1e3),z(!L)},[L,w]),Re=(0,a.useCallback)(e=>{const t={id:Date.now(),emoji:e,timestamp:Date.now()};H(e=>[...e,t]),setTimeout(()=>{H(e=>e.filter(e=>e.id!==t.id))},3e3)},[]),Fe=(0,a.useCallback)(()=>{G(!K),p(K?"grid":"speaker")},[K]),Le=(0,a.useCallback)(()=>{Y(!J),be(J?"auto":"low")},[J]),ze=(0,a.useCallback)(()=>{null!==i&&void 0!==i&&i.isRecording&&(Q?xe.resumeRecording():xe.pauseRecording(),$(!Q))},[Q,i]),Oe=(0,a.useCallback)(e=>{Z(e),xe.setRecordingQuality(e)},[]),_e=(0,a.useCallback)(()=>{if(!g){window.confirm("End video call?")&&me()}},[g,me]),Ue=v&&("none"!==b||v.smoothSkin>0||v.brighten>0||0!==v.brightness||0!==v.contrast||0!==v.saturation||0!==v.temperature||v.vibrance>0||v.sharpen>0||v.vignette>0||v.grain>0||"none"!==v.arEffect);if(!i)return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"video-call-backdrop",onClick:_e}),(0,k.jsxs)("div",{className:"video-call-panel loading",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("p",{children:"Starting video call..."})]})]});const qe=s.length+1;return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"video-call-backdrop",onClick:_e}),(0,k.jsxs)("div",{className:"video-call-panel ".concat(g?"minimized":""," layout-").concat(m),children:[(0,k.jsxs)("div",{className:"video-call-header",ref:se,children:[(0,k.jsxs)("div",{className:"call-info",children:[(0,k.jsxs)("span",{className:"call-status",children:["\ud83d\udd34 ",i.isRecording?"Recording":"Live"]}),(0,k.jsxs)("span",{className:"participant-badge",children:[(0,k.jsx)("span",{className:"badge-icon",children:"\ud83d\udc65"}),qe]}),(0,k.jsx)("span",{className:"call-duration",children:xe.formatDuration(i.duration)})]}),(0,k.jsxs)("div",{className:"connection-quality",children:[(0,k.jsx)("span",{className:"quality-dot ".concat(w)}),(0,k.jsx)("span",{children:"excellent"===w?"Excellent":"good"===w?"Good":"Poor"})]}),(0,k.jsxs)("div",{className:"header-actions",children:[(0,k.jsx)("button",{className:"header-btn ".concat(Ue?"has-filters":""),onClick:()=>{console.log("Filters button clicked. Current state:",u,"Filters:",v),h(!u)},title:"Filters & Effects",children:"\u2728"}),(0,k.jsx)("button",{className:"header-btn",onClick:()=>f(!g),title:g?"Maximize":"Minimize",children:g?"\ud83d\udd3c":"\ud83d\udd3d"}),(0,k.jsx)("button",{className:"header-btn",onClick:()=>d(!c),title:"Settings",children:"\u2699\ufe0f"})]})]}),!g&&(0,k.jsxs)("div",{className:"video-grid",children:[(0,k.jsx)("video",{ref:ae,style:{display:"none"},autoPlay:!0,playsInline:!0,muted:!0}),i.isScreenSharing&&(0,k.jsxs)("div",{className:"video-container screen-share",children:[(0,k.jsx)("video",{ref:ne,autoPlay:!0,playsInline:!0}),(0,k.jsx)("div",{className:"video-label",children:"\ud83d\udcfa Screen Share"})]}),(0,k.jsxs)("div",{className:"video-container local ".concat(i.isVideoOff?"video-off":""),children:[(0,k.jsx)("video",{ref:ee,autoPlay:!0,playsInline:!0,muted:!0}),i.isVideoOff&&(0,k.jsxs)("div",{className:"video-placeholder",children:[(0,k.jsx)("div",{className:"avatar-placeholder",children:"\ud83d\udc64"}),(0,k.jsx)("div",{className:"video-off-label",children:"Camera Off"})]}),(0,k.jsxs)("div",{className:"video-label",children:["You ",i.isMuted&&"\ud83d\udd07"]}),(0,k.jsx)("div",{className:"quality-badge",children:i.quality.toUpperCase()})]}),s.map((e,t)=>(0,k.jsxs)("div",{className:"video-container remote",children:[(0,k.jsx)("video",{ref:te,autoPlay:!0,playsInline:!0}),(0,k.jsx)("div",{className:"video-label",children:e.name})]},e.id||t)),0===s.length&&(0,k.jsx)("div",{className:"video-container waiting",children:(0,k.jsxs)("div",{className:"waiting-content",children:[(0,k.jsx)("div",{className:"waiting-icon",children:"\u23f3"}),(0,k.jsx)("p",{children:"Waiting for others to join..."})]})})]}),u&&!g&&(0,k.jsx)("div",{className:"filters-panel",children:v?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)("div",{className:"filters-header",children:[(0,k.jsx)("h3",{children:"\u2728 Filters & Effects"}),(0,k.jsx)("button",{className:"reset-btn",onClick:Te,children:"Reset All"})]}),(0,k.jsxs)("div",{className:"filter-section",children:[(0,k.jsx)("label",{className:"section-label",children:"Presets"}),(0,k.jsx)("div",{className:"preset-grid",children:Se.getPresets().map(e=>(0,k.jsxs)("button",{className:"preset-btn ".concat(b===e?"active":""),onClick:()=>Ce(e),children:[(0,k.jsxs)("div",{className:"preset-icon",children:["none"===e&&"\u25cb","natural"===e&&"\ud83c\udf3f","vivid"===e&&"\ud83c\udf08","dramatic"===e&&"\ud83c\udfad","vintage"===e&&"\ud83d\udcfd\ufe0f","cool"===e&&"\u2744\ufe0f","warm"===e&&"\u2600\ufe0f"]}),(0,k.jsx)("div",{className:"preset-name",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))})]}),(0,k.jsxs)("div",{className:"filter-section",children:[(0,k.jsx)("label",{className:"section-label",children:"\ud83d\udc84 Beauty"}),(0,k.jsxs)("div",{className:"slider-group",children:[(0,k.jsx)("label",{children:"Smooth Skin"}),(0,k.jsxs)("div",{className:"slider-container",children:[(0,k.jsx)("input",{type:"range",min:"0",max:"100",value:v.smoothSkin,onChange:e=>Ne("smoothSkin",parseInt(e.target.value))}),(0,k.jsx)("span",{className:"slider-value",children:v.smoothSkin})]})]}),(0,k.jsxs)("div",{className:"slider-group",children:[(0,k.jsx)("label",{children:"Brighten"}),(0,k.jsxs)("div",{className:"slider-container",children:[(0,k.jsx)("input",{type:"range",min:"0",max:"100",value:v.brighten,onChange:e=>Ne("brighten",parseInt(e.target.value))}),(0,k.jsx)("span",{className:"slider-value",children:v.brighten})]})]})]}),(0,k.jsxs)("div",{className:"filter-section",children:[(0,k.jsx)("label",{className:"section-label",children:"\ud83c\udfa8 Color"}),(0,k.jsxs)("div",{className:"slider-group",children:[(0,k.jsx)("label",{children:"Brightness"}),(0,k.jsxs)("div",{className:"slider-container",children:[(0,k.jsx)("input",{type:"range",min:"-100",max:"100",value:v.brightness,onChange:e=>Ne("brightness",parseInt(e.target.value))}),(0,k.jsx)("span",{className:"slider-value",children:v.brightness})]})]}),(0,k.jsxs)("div",{className:"slider-group",children:[(0,k.jsx)("label",{children:"Contrast"}),(0,k.jsxs)("div",{className:"slider-container",children:[(0,k.jsx)("input",{type:"range",min:"-100",max:"100",value:v.contrast,onChange:e=>Ne("contrast",parseInt(e.target.value))}),(0,k.jsx)("span",{className:"slider-value",children:v.contrast})]})]}),(0,k.jsxs)("div",{className:"slider-group",children:[(0,k.jsx)("label",{children:"Saturation"}),(0,k.jsxs)("div",{className:"slider-container",children:[(0,k.jsx)("input",{type:"range",min:"-100",max:"100",value:v.saturation,onChange:e=>Ne("saturation",parseInt(e.target.value))}),(0,k.jsx)("span",{className:"slider-value",children:v.saturation})]})]}),(0,k.jsxs)("div",{className:"slider-group",children:[(0,k.jsx)("label",{children:"Temperature"}),(0,k.jsxs)("div",{className:"slider-container",children:[(0,k.jsx)("input",{type:"range",min:"-100",max:"100",value:v.temperature,onChange:e=>Ne("temperature",parseInt(e.target.value))}),(0,k.jsxs)("span",{className:"slider-value",children:[v.temperature<0?"\u2744\ufe0f":"\ud83d\udd25"," ",Math.abs(v.temperature)]})]})]}),(0,k.jsxs)("div",{className:"slider-group",children:[(0,k.jsx)("label",{children:"Vibrance"}),(0,k.jsxs)("div",{className:"slider-container",children:[(0,k.jsx)("input",{type:"range",min:"0",max:"100",value:v.vibrance,onChange:e=>Ne("vibrance",parseInt(e.target.value))}),(0,k.jsx)("span",{className:"slider-value",children:v.vibrance})]})]})]}),(0,k.jsxs)("div",{className:"filter-section",children:[(0,k.jsx)("label",{className:"section-label",children:"\u2728 Effects"}),(0,k.jsxs)("div",{className:"slider-group",children:[(0,k.jsx)("label",{children:"Sharpen"}),(0,k.jsxs)("div",{className:"slider-container",children:[(0,k.jsx)("input",{type:"range",min:"0",max:"100",value:v.sharpen,onChange:e=>Ne("sharpen",parseInt(e.target.value))}),(0,k.jsx)("span",{className:"slider-value",children:v.sharpen})]})]}),(0,k.jsxs)("div",{className:"slider-group",children:[(0,k.jsx)("label",{children:"Vignette"}),(0,k.jsxs)("div",{className:"slider-container",children:[(0,k.jsx)("input",{type:"range",min:"0",max:"100",value:v.vignette,onChange:e=>Ne("vignette",parseInt(e.target.value))}),(0,k.jsx)("span",{className:"slider-value",children:v.vignette})]})]}),(0,k.jsxs)("div",{className:"slider-group",children:[(0,k.jsx)("label",{children:"Film Grain"}),(0,k.jsxs)("div",{className:"slider-container",children:[(0,k.jsx)("input",{type:"range",min:"0",max:"100",value:v.grain,onChange:e=>Ne("grain",parseInt(e.target.value))}),(0,k.jsx)("span",{className:"slider-value",children:v.grain})]})]})]}),(0,k.jsxs)("div",{className:"filter-section",children:[(0,k.jsx)("label",{className:"section-label",children:"\ud83c\udfad AR Effects"}),(0,k.jsx)("div",{className:"ar-effects-grid",children:Se.getAREffects().map(e=>(0,k.jsxs)("button",{className:"ar-effect-btn ".concat(v.arEffect===e?"active":""),onClick:()=>Ee(e),children:["none"===e&&"\u25cb","glasses"===e&&"\ud83d\udc53","hat"===e&&"\ud83c\udfa9","mask"===e&&"\ud83c\udfad","ears"===e&&"\ud83d\udc30","mustache"===e&&"\ud83d\udc68",(0,k.jsx)("div",{className:"ar-effect-name",children:e.charAt(0).toUpperCase()+e.slice(1)})]},e))}),"none"!==v.arEffect&&(0,k.jsxs)("div",{className:"slider-group",children:[(0,k.jsx)("label",{children:"Effect Color"}),(0,k.jsx)("input",{type:"color",value:v.arColor,onChange:e=>Ne("arColor",e.target.value),className:"color-picker"})]})]})]}):(0,k.jsxs)("div",{className:"filters-loading",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("p",{children:"Initializing filters..."})]})}),c&&!g&&(0,k.jsxs)("div",{className:"settings-panel",children:[(0,k.jsx)("h3",{children:"Call Settings"}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Camera"}),(0,k.jsx)("select",{value:(null===o||void 0===o?void 0:o.selectedCamera)||"",onChange:e=>we(e.target.value),children:null===o||void 0===o?void 0:o.cameras.map(e=>(0,k.jsx)("option",{value:e.deviceId,children:e.label||"Camera ".concat(e.deviceId.slice(0,8))},e.deviceId))})]}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Microphone"}),(0,k.jsx)("select",{value:(null===o||void 0===o?void 0:o.selectedMicrophone)||"",onChange:e=>ke(e.target.value),children:null===o||void 0===o?void 0:o.microphones.map(e=>(0,k.jsx)("option",{value:e.deviceId,children:e.label||"Microphone ".concat(e.deviceId.slice(0,8))},e.deviceId))})]}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Video Quality"}),(0,k.jsx)("div",{className:"quality-buttons",children:["low","medium","high","auto"].map(e=>(0,k.jsx)("button",{className:"quality-btn ".concat(i.quality===e?"active":""),onClick:()=>be(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Layout"}),(0,k.jsxs)("div",{className:"layout-buttons",children:[(0,k.jsx)("button",{className:"layout-btn ".concat("grid"===m?"active":""),onClick:()=>ye("grid"),title:"Grid View",children:"\u229e"}),(0,k.jsx)("button",{className:"layout-btn ".concat("speaker"===m?"active":""),onClick:()=>ye("speaker"),title:"Speaker View",children:"\u25ad"}),(0,k.jsx)("button",{className:"layout-btn ".concat("pip"===m?"active":""),onClick:()=>ye("pip"),title:"Picture in Picture",children:"\u22a1"})]})]}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Background Blur"}),(0,k.jsx)("button",{className:"toggle-btn",onClick:je,children:"Enable Blur"})]}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"\ud83c\udfaf Noise Cancellation"}),(0,k.jsx)("button",{className:"toggle-btn ".concat(U?"active":""),onClick:Ae,children:U?"\u2713 Enabled":"Enable"})]}),(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"\ud83d\udc64 Spotlight Mode"}),(0,k.jsx)("button",{className:"toggle-btn ".concat(K?"active":""),onClick:Fe,children:K?"\u2713 Active":"Activate"})]}),(0,k.jsxs)("div",{className:"setting-group mobile-only",children:[(0,k.jsx)("label",{children:"\ud83d\udd0b Battery Saver"}),(0,k.jsx)("button",{className:"toggle-btn ".concat(J?"active":""),onClick:Le,children:J?"\u2713 Enabled":"Enable"})]}),i.isRecording&&(0,k.jsxs)("div",{className:"setting-group",children:[(0,k.jsx)("label",{children:"Recording Quality"}),(0,k.jsx)("div",{className:"quality-buttons",children:["low","medium","high"].map(e=>(0,k.jsx)("button",{className:"quality-btn ".concat(X===e?"active":""),onClick:()=>Oe(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),A&&R&&(0,k.jsx)("div",{className:"captions-overlay",children:(0,k.jsx)("div",{className:"captions-text",children:R})}),L&&O&&(0,k.jsxs)("div",{className:"stats-dashboard",children:[(0,k.jsxs)("div",{className:"stats-header",children:[(0,k.jsx)("h4",{children:"\ud83d\udcca Call Statistics"}),(0,k.jsx)("button",{className:"close-stats",onClick:Me,children:"\xd7"})]}),(0,k.jsxs)("div",{className:"stats-grid",children:[(0,k.jsxs)("div",{className:"stat-item",children:[(0,k.jsx)("div",{className:"stat-label",children:"Bandwidth"}),(0,k.jsx)("div",{className:"stat-value",children:O.bandwidth})]}),(0,k.jsxs)("div",{className:"stat-item",children:[(0,k.jsx)("div",{className:"stat-label",children:"FPS"}),(0,k.jsx)("div",{className:"stat-value",children:O.fps})]}),(0,k.jsxs)("div",{className:"stat-item",children:[(0,k.jsx)("div",{className:"stat-label",children:"Packet Loss"}),(0,k.jsx)("div",{className:"stat-value",children:O.packetLoss})]}),(0,k.jsxs)("div",{className:"stat-item",children:[(0,k.jsx)("div",{className:"stat-label",children:"Latency"}),(0,k.jsx)("div",{className:"stat-value",children:O.latency})]}),(0,k.jsxs)("div",{className:"stat-item",children:[(0,k.jsx)("div",{className:"stat-label",children:"Jitter"}),(0,k.jsx)("div",{className:"stat-value",children:O.jitter})]}),(0,k.jsxs)("div",{className:"stat-item",children:[(0,k.jsx)("div",{className:"stat-label",children:"Quality"}),(0,k.jsx)("div",{className:"stat-value quality-".concat(O.quality),children:O.quality.toUpperCase()})]})]})]}),B.length>0&&(0,k.jsx)("div",{className:"gestures-overlay",children:B.map(e=>(0,k.jsx)("div",{className:"gesture-emoji",style:{animationDelay:"".concat((Date.now()-e.timestamp)/1e3,"s")},children:e.emoji},e.id))}),(0,k.jsxs)("div",{className:"video-controls",children:[(0,k.jsx)("button",{className:"control-btn ".concat(i.isMuted?"active":""),onClick:pe,title:i.isMuted?"Unmute":"Mute",children:i.isMuted?"\ud83d\udd07":"\ud83c\udfa4"}),(0,k.jsx)("button",{className:"control-btn ".concat(i.isVideoOff?"active":""),onClick:ge,title:i.isVideoOff?"Turn On Camera":"Turn Off Camera",children:i.isVideoOff?"\ud83d\udcf7\u274c":"\ud83d\udcf9"}),(0,k.jsx)("button",{className:"control-btn ".concat(i.isScreenSharing?"active":""),onClick:fe,title:i.isScreenSharing?"Stop Sharing":"Share Screen",children:"\ud83d\udda5\ufe0f"}),(0,k.jsx)("button",{className:"control-btn ".concat(i.isRecording?"active recording":""),onClick:ve,title:i.isRecording?"Stop Recording":"Start Recording",children:i.isRecording?"\u23f9\ufe0f":"\u23fa\ufe0f"}),i.isRecording&&(0,k.jsx)("button",{className:"control-btn ".concat(Q?"active":""),onClick:ze,title:Q?"Resume Recording":"Pause Recording",children:Q?"\u25b6\ufe0f":"\u23f8\ufe0f"}),(0,k.jsx)("button",{className:"control-btn screen-record-btn ".concat(T?"active recording":""),onClick:Ie,title:T?"Stop Screen Recording (".concat(Pe(P),")"):"Record Screen",children:T?(0,k.jsxs)("span",{className:"recording-indicator",children:["\u23fa\ufe0f",(0,k.jsx)("span",{className:"recording-time",children:Pe(P)})]}):"\ud83c\udfac"}),(0,k.jsx)("button",{className:"control-btn ".concat(A?"active":""),onClick:De,title:A?"Hide Captions":"Show Live Captions",children:"\ud83d\udcac"}),(0,k.jsx)("button",{className:"control-btn ".concat(L?"active":""),onClick:Me,title:L?"Hide Statistics":"Show Statistics",children:"\ud83d\udcca"}),(0,k.jsxs)("div",{className:"reactions-menu",children:[(0,k.jsx)("button",{className:"control-btn reactions-btn",title:"Send Reaction",children:"\u270b"}),(0,k.jsxs)("div",{className:"reactions-dropdown",children:[(0,k.jsx)("button",{onClick:()=>Re("\ud83d\udc4d"),children:"\ud83d\udc4d"}),(0,k.jsx)("button",{onClick:()=>Re("\u2764\ufe0f"),children:"\u2764\ufe0f"}),(0,k.jsx)("button",{onClick:()=>Re("\ud83d\ude02"),children:"\ud83d\ude02"}),(0,k.jsx)("button",{onClick:()=>Re("\ud83d\udc4f"),children:"\ud83d\udc4f"}),(0,k.jsx)("button",{onClick:()=>Re("\ud83c\udf89"),children:"\ud83c\udf89"}),(0,k.jsx)("button",{onClick:()=>Re("\u270b"),children:"\u270b"})]})]}),(0,k.jsx)("button",{className:"control-btn end-call",onClick:me,title:"End Call",children:"\ud83d\udcde\u274c"})]})]})]})};const je=new class{constructor(){this.messages=[],this.persistentStorage=S}loadMessagesFromStorage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const t=this.persistentStorage.getMessages();return e?t.filter(t=>t.conversationId===e):t}catch(t){return console.error("\u274c Failed to load messages from storage:",t),[]}}saveMessagesToStorage(e){try{return this.persistentStorage.setMessages(e)}catch(t){return console.error("\u274c Failed to save messages to storage:",t),!1}}async getMessages(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{conversationId:t,limit:n=50,offset:a=0}=e;try{const e=await fetch("/api/messages?conversationId=".concat(t,"&limit=").concat(n,"&offset=").concat(a));if(e.ok){return await e.json()}}catch(s){console.warn("API unavailable, loading from storage:",s)}return this.loadMessagesFromStorage(t)}async sendMessage(e){const t=c({id:Date.now().toString(),timestamp:(new Date).toISOString()},e);try{const e=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(e.ok){const t=await e.json();return this.persistentStorage.addMessage(t),t}}catch(n){console.warn("\u26a0\ufe0f API unavailable, saving locally:",n)}return this.persistentStorage.addMessage(t),console.log("\ud83d\udcbe Message saved to persistent storage"),t}async addReaction(e,t){try{const n=await fetch("/api/messages/".concat(e,"/reactions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:t})});if(n.ok){const t=await n.json();return this.persistentStorage.updateMessage(e,t),t}}catch(a){console.warn("\u26a0\ufe0f API unavailable for reactions:",a)}const n=this.loadMessagesFromStorage().find(t=>t.id===e);return n?(n.reactions||(n.reactions=[]),n.reactions.push({emoji:t,userId:"current-user",timestamp:(new Date).toISOString()}),this.persistentStorage.updateMessage(e,n),{success:!0}):{success:!1}}async deleteMessage(e){try{if((await fetch("/api/messages/".concat(e),{method:"DELETE"})).ok)return this.persistentStorage.deleteMessage(e),{success:!0}}catch(t){console.warn("\u26a0\ufe0f API unavailable for deletion:",t)}return this.persistentStorage.deleteMessage(e)?{success:!0}:{success:!1}}searchMessages(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.loadMessagesFromStorage(t).filter(t=>{var n,a;return(null===(n=t.text)||void 0===n?void 0:n.toLowerCase().includes(e.toLowerCase()))||(null===(a=t.user)||void 0===a?void 0:a.toLowerCase().includes(e.toLowerCase()))})}clearMessages(){this.persistentStorage.setMessages([]),console.log("\ud83e\uddf9 All messages cleared from persistent storage")}},Ne=e=>"e2e_privkey_".concat(e),Ce=e=>"e2e_pubkey_".concat(e),Ee=()=>localStorage.getItem("quibish_auth_token")||localStorage.getItem("auth_token")||null;const Te=new class{constructor(){this.privateKey=null,this.publicKey=null,this.publicKeyJwk=null,this.sharedKeys=new Map,this.userId=null,this.isInitialized=!1,this.encryptionEnabled=!1}async initializeEncryption(e){try{this.userId=String(e);const t=localStorage.getItem(Ne(this.userId)),n=localStorage.getItem(Ce(this.userId));if(t&&n){const e=JSON.parse(t),a=JSON.parse(n);this.publicKeyJwk=a,[this.privateKey,this.publicKey]=await Promise.all([crypto.subtle.importKey("jwk",e,{name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"]),crypto.subtle.importKey("jwk",a,{name:"ECDH",namedCurve:"P-256"},!0,[])])}else{const e=await crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]);this.privateKey=e.privateKey,this.publicKey=e.publicKey,this.publicKeyJwk=await crypto.subtle.exportKey("jwk",e.publicKey);const t=await crypto.subtle.exportKey("jwk",e.privateKey);localStorage.setItem(Ne(this.userId),JSON.stringify(t)),localStorage.setItem(Ce(this.userId),JSON.stringify(this.publicKeyJwk))}return await this._uploadPublicKey(),this.isInitialized=!0,this.encryptionEnabled=!0,{success:!0,message:"E2E encryption ready",keyGenerated:!t}}catch(t){return console.error("[E2E] Initialisation failed:",t),{success:!1,message:"Failed to initialise encryption",error:t.message}}}async _uploadPublicKey(){try{const e=Ee(),t=await fetch(oe("encryption/public-key"),{method:"POST",headers:c({"Content-Type":"application/json"},e?{Authorization:"Bearer ".concat(e)}:{}),body:JSON.stringify({publicKey:this.publicKeyJwk})});t.ok||console.warn("[E2E] Public key upload returned",t.status)}catch(e){console.warn("[E2E] Public key upload failed:",e.message)}}async _getSharedKey(e){const t=String(e);if(this.sharedKeys.has(t))return this.sharedKeys.get(t);const n=Ee(),a=await fetch(oe("encryption/public-key/".concat(t)),{headers:n?{Authorization:"Bearer ".concat(n)}:{}});if(!a.ok)throw new Error("Peer ".concat(t," has no public key on the server \u2014 they need to open the app first."));const{publicKey:s}=await a.json(),i=await crypto.subtle.importKey("jwk",s,{name:"ECDH",namedCurve:"P-256"},!1,[]),r=await crypto.subtle.deriveKey({name:"ECDH",public:i},this.privateKey,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]);return this.sharedKeys.set(t,r),r}async encryptFor(e,t){if(!this.isInitialized)throw new Error("E2E not initialised");const n=await this._getSharedKey(t),a=crypto.getRandomValues(new Uint8Array(12)),s=(new TextEncoder).encode(e),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},n,s),r=new Uint8Array(12+i.byteLength);return r.set(a,0),r.set(new Uint8Array(i),12),btoa(String.fromCharCode(...r))}async decryptFrom(e,t){if(!this.isInitialized)throw new Error("E2E not initialised");const n=await this._getSharedKey(t),a=Uint8Array.from(atob(e),e=>e.charCodeAt(0)),s=a.slice(0,12),i=a.slice(12),r=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},n,i);return(new TextDecoder).decode(r)}getEncryptionStatus(){return{initialized:this.isInitialized,enabled:this.encryptionEnabled,hasKey:!!this.privateKey}}encryptMessage(e){return e}decryptMessage(e){return e}async sendMessage(e){return c(c({},e),{},{id:Date.now().toString(),timestamp:(new Date).toISOString()})}async getMessages(){return[]}};const Ie=new class{constructor(){this.currentCall=null,this.localStream=null,this.remoteStream=null,this.peerConnection=null,this.isCallActive=!1,this.isMuted=!1,this.isVideoEnabled=!1,this.callHistory=[]}async initializeCall(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const{video:a=!1,audio:s=!0}=t;if(console.log("\ud83c\udfa4 Requesting media permissions - video:",a,"audio:",s),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.warn("\u26a0\ufe0f getUserMedia not supported"),this.currentCall={id:Date.now().toString(),targetUserId:e,startTime:new Date,type:a?"video":"voice",status:"connecting"},this.isCallActive=!0,{success:!0,callId:this.currentCall.id,localStream:null};try{this.localStream=await navigator.mediaDevices.getUserMedia({video:a,audio:s}),console.log("\u2705 Media stream obtained:",this.localStream)}catch(n){console.warn("\u26a0\ufe0f Failed to get media stream:",n.message),this.localStream=null}return this.peerConnection=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}),this.localStream&&this.localStream.getTracks().forEach(e=>{this.peerConnection.addTrack(e,this.localStream)}),this.peerConnection.ontrack=e=>{this.remoteStream=e.streams[0]},this.currentCall={id:Date.now().toString(),targetUserId:e,startTime:new Date,type:a?"video":"voice",status:"connecting"},this.isCallActive=!0,this.isVideoEnabled=a,console.log("\ud83d\udcde Call initialized successfully:",this.currentCall),{success:!0,callId:this.currentCall.id,localStream:this.localStream}}catch(a){return console.error("\u274c Call initialization failed:",a),{success:!1,error:a.message}}}async endCall(){try{return this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.currentCall&&(this.currentCall.endTime=new Date,this.currentCall.duration=this.currentCall.endTime-this.currentCall.startTime,this.currentCall.status="ended",this.callHistory.push(c({},this.currentCall)),this.currentCall=null),this.isCallActive=!1,this.isMuted=!1,this.isVideoEnabled=!1,{success:!0}}catch(e){return console.error("Error ending call:",e),{success:!1,error:e.message}}}toggleMute(){if(this.localStream){const e=this.localStream.getAudioTracks()[0];e&&(e.enabled=!e.enabled,this.isMuted=!e.enabled)}return this.isMuted}toggleVideo(){if(this.localStream){const e=this.localStream.getVideoTracks()[0];e&&(e.enabled=!e.enabled,this.isVideoEnabled=e.enabled)}return this.isVideoEnabled}getCallState(){return{active:this.isCallActive,muted:this.isMuted,videoEnabled:this.isVideoEnabled,currentCall:this.currentCall,hasLocalStream:!!this.localStream,hasRemoteStream:!!this.remoteStream}}getCallHistory(){return this.callHistory}async acceptCall(e){try{const t=await this.initializeCall(e.callerId,{video:e.hasVideo,audio:!0});return t.success&&(this.currentCall.status="active",this.currentCall.type="incoming"),t}catch(t){return console.error("Error accepting call:",t),{success:!1,error:t.message}}}rejectCall(e){return this.callHistory.push({id:e.id,targetUserId:e.callerId,startTime:new Date(e.timestamp),endTime:new Date,type:"incoming",status:"rejected",duration:0}),{success:!0}}async checkDeviceCapabilities(){try{const e=await navigator.mediaDevices.enumerateDevices(),t=e.some(e=>"videoinput"===e.kind);return{camera:t,microphone:e.some(e=>"audioinput"===e.kind),webRTC:!!window.RTCPeerConnection}}catch(e){return console.error("Error checking device capabilities:",e),{camera:!1,microphone:!1,webRTC:!1,error:e.message}}}async getAvailableCallMethods(e){console.log("\ud83d\udd0d Getting available call methods for user:",e);const t=await this.checkDeviceCapabilities();console.log("\ud83c\udfa4 Device capabilities:",t);const n=[];return t.microphone&&t.webRTC&&n.push({type:"voice",icon:"\ud83d\udcde",description:"Voice Call",quality:"high",estimated_quality:"HD Audio",latency:50+100*Math.random(),note:"High-quality voice call using WebRTC"}),t.camera&&t.microphone&&t.webRTC&&n.push({type:"video",icon:"\ud83d\udcf9",description:"Video Call",quality:"premium",estimated_quality:"HD Video",latency:80+120*Math.random(),note:"HD video call with voice"}),0===n.length&&n.push({type:"fallback",icon:"\ud83d\udcf1",description:"Audio Call (Fallback)",quality:"standard",estimated_quality:"Standard Audio",latency:200,note:"Basic audio call - check your device permissions"}),console.log("\ud83d\udcde Available methods:",n),n}async initiateEnhancedCall(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto";try{const n=await this.getAvailableCallMethods(e);let a;a="auto"===t?n[0]:n.find(e=>e.type===t)||n[0];const s="video"===a.type,i=await this.initializeCall(e.id||e.username,{video:s,audio:!0});if(i.success)return{success:!0,callId:i.callId,method:a,status:"connecting",connectionStatus:{quality:"good",latency:a.latency}};throw new Error(i.error)}catch(n){return console.error("Failed to initiate enhanced call:",n),{success:!1,error:n.message}}}};const Pe=new class{constructor(){this.isConnected=navigator.onLine,this.connectionType="unknown",this.lastConnectionCheck=Date.now(),this.connectionHistory=[],this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.websocket=null,this.eventListeners=new Map}async connect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const{autoReconnect:t=!0,websocketUrl:n=null}=e;this.setupNetworkMonitoring(),n&&await this.connectWebSocket(n);const a=await this.checkConnectionQuality();return this.connectionHistory.push({timestamp:new Date,status:"connected",quality:a,type:this.connectionType}),{connected:!0,quality:a,type:this.connectionType,websocketConnected:!!this.websocket}}catch(t){return console.error("Connection failed:",t),{connected:!1,error:t.message}}}async disconnect(){try{return this.websocket&&(this.websocket.close(),this.websocket=null),this.removeNetworkMonitoring(),this.connectionHistory.push({timestamp:new Date,status:"disconnected",manual:!0}),{success:!0}}catch(e){return console.error("Disconnect error:",e),{success:!1,error:e.message}}}getStatus(){var e;return{connected:this.isConnected,type:this.connectionType,lastCheck:this.lastConnectionCheck,websocketConnected:(null===(e=this.websocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN,reconnectAttempts:this.reconnectAttempts}}async checkConnectionQuality(){try{const e=Date.now(),t=(await fetch("/api/ping",{method:"HEAD",cache:"no-cache"}),Date.now()-e);let n="excellent";return t>1e3?n="poor":t>500?n="fair":t>200&&(n="good"),{latency:t,quality:n,timestamp:new Date}}catch(e){return{latency:-1,quality:"offline",error:e.message,timestamp:new Date}}}setupNetworkMonitoring(){const e=()=>{this.isConnected=!0,this.connectionType=this.getConnectionType(),this.emit("online",{timestamp:new Date}),this.reconnectAttempts>0&&(this.reconnectAttempts=0,this.emit("reconnected",{attempts:this.reconnectAttempts}))},t=()=>{this.isConnected=!1,this.emit("offline",{timestamp:new Date}),this.attemptReconnect()};window.addEventListener("online",e),window.addEventListener("offline",t),this.networkHandlers={handleOnline:e,handleOffline:t}}removeNetworkMonitoring(){this.networkHandlers&&(window.removeEventListener("online",this.networkHandlers.handleOnline),window.removeEventListener("offline",this.networkHandlers.handleOffline))}async attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts)return void this.emit("reconnectFailed",{attempts:this.reconnectAttempts});this.reconnectAttempts++,this.emit("reconnecting",{attempt:this.reconnectAttempts});const e=Math.min(1e3*Math.pow(2,this.reconnectAttempts),3e4);setTimeout(async()=>{try{(await this.connect()).connected?(this.reconnectAttempts=0,this.emit("reconnected",{attempts:this.reconnectAttempts})):this.attemptReconnect()}catch(e){this.attemptReconnect()}},e)}async connectWebSocket(e){return new Promise((t,n)=>{try{this.websocket=new WebSocket(e),this.websocket.onopen=()=>{this.emit("websocketConnected",{url:e}),t()},this.websocket.onerror=e=>{this.emit("websocketError",{error:e}),n(e)},this.websocket.onclose=()=>{this.emit("websocketDisconnected",{})},this.websocket.onmessage=e=>{this.emit("websocketMessage",{data:e.data})}}catch(a){n(a)}})}getConnectionType(){return"connection"in navigator&&navigator.connection.effectiveType||"unknown"}on(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}off(e,t){if(this.eventListeners.has(e)){var n,a;const s=this.eventListeners.get(e),i=null!==(n=null===s||void 0===s||null===(a=s.indexOf)||void 0===a?void 0:a.call(s,t))&&void 0!==n?n:-1;i>-1&&s.splice(i,1)}}emit(e,t){this.eventListeners.has(e)&&this.eventListeners.get(e).forEach(n=>{try{n(t)}catch(a){console.error("Error in event listener for ".concat(e,":"),a)}})}getConnectionHistory(){return this.connectionHistory}getConnectionStatus(){const e=navigator.onLine&&this.isConnected,t=this.getConnectionQuality(),n=this.connectionType||"unknown";let a="#10b981";return e?("poor"===t||"fair"===t)&&(a="#f59e0b"):a="#ef4444",{quality:e?t:"offline",type:e?n:"offline",color:a,connected:e,websocketConnected:!!this.websocket}}getConnectionQuality(){if(!navigator.onLine)return"offline";const e=this.connectionHistory.filter(e=>Date.now()-e.timestamp.getTime()<3e4).sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime());if(e.length>0&&e[0].quality)return e[0].quality;const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(t){const e=t.effectiveType;if("4g"===e)return"excellent";if("3g"===e)return"good";if("2g"===e)return"fair";if("slow-2g"===e)return"poor"}return"good"}};const De=new class{constructor(){this.features={camera:!1,microphone:!1,geolocation:!1,notifications:!1,vibration:!1,deviceMotion:!1,touchSupport:!1,fullscreen:!1},this.permissions={},this.isInitialized=!1}async initialize(){try{return await this.detectFeatures(),await this.checkPermissions(),this.isInitialized=!0,{success:!0,features:this.features,permissions:this.permissions}}catch(e){return console.error("Failed to initialize device features:",e),{success:!1,error:e.message}}}async detectFeatures(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{const e=await navigator.mediaDevices.enumerateDevices();this.features.camera=e.some(e=>"videoinput"===e.kind),this.features.microphone=e.some(e=>"audioinput"===e.kind)}catch(e){console.warn("Could not enumerate devices:",e),this.features.camera=!1,this.features.microphone=!1}this.features.geolocation="geolocation"in navigator,this.features.notifications="Notification"in window,this.features.vibration="vibrate"in navigator,this.features.deviceMotion="DeviceMotionEvent"in window,this.features.touchSupport="ontouchstart"in window||navigator.maxTouchPoints>0,this.features.fullscreen=!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled)}async checkPermissions(){if("permissions"in navigator){const t=["camera","microphone","geolocation","notifications"];for(const n of t)try{const e=await navigator.permissions.query({name:n});this.permissions[n]=e.state}catch(e){this.permissions[n]="unknown"}}}getFeatures(){return c(c({},this.features),{},{permissions:this.permissions,initialized:this.isInitialized})}async requestCamera(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{video:!0};if(!this.features.camera)return console.warn("\ud83d\udcf9 Camera feature not available"),{success:!1,error:"Camera not available"};try{var t;const n=await navigator.mediaDevices.getUserMedia(e);return{success:!0,stream:n,deviceId:null===(t=n.getVideoTracks()[0])||void 0===t?void 0:t.getSettings().deviceId}}catch(n){console.error("\u274c Camera access failed:",n);let e=n.message;return"NotFoundError"===n.name?e="No camera found. Please connect a camera and try again.":"NotAllowedError"===n.name?e="Camera permission denied. Please allow camera access in browser settings.":"NotReadableError"===n.name&&(e="Camera is already in use by another application."),{success:!1,error:e,name:n.name,originalMessage:n.message}}}async requestMicrophone(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!0};if(!this.features.microphone)return console.warn("\ud83c\udfa4 Microphone feature not available"),{success:!1,error:"Microphone not available"};try{var t;const n=await navigator.mediaDevices.getUserMedia(e);return{success:!0,stream:n,deviceId:null===(t=n.getAudioTracks()[0])||void 0===t?void 0:t.getSettings().deviceId}}catch(n){console.error("\u274c Microphone access failed:",n);let e=n.message;return"NotFoundError"===n.name?e="No microphone found. Please connect a microphone and try again.":"NotAllowedError"===n.name?e="Microphone permission denied. Please allow microphone access in browser settings.":"NotReadableError"===n.name&&(e="Microphone is already in use by another application."),{success:!1,error:e,name:n.name,originalMessage:n.message}}}async requestGeolocation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.features.geolocation?new Promise(t=>{navigator.geolocation.getCurrentPosition(e=>{t({success:!0,coords:{latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy},timestamp:e.timestamp})},e=>{t({success:!1,error:e.message,code:e.code})},c({enableHighAccuracy:!1,timeout:1e4,maximumAge:3e5},e))}):{success:!1,error:"Geolocation not available"}}async requestNotifications(){if(!this.features.notifications)return{success:!1,error:"Notifications not available"};try{const e=await Notification.requestPermission();return this.permissions.notifications=e,{success:"granted"===e,permission:e}}catch(e){return{success:!1,error:e.message}}}sendNotification(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.features.notifications||"granted"!==this.permissions.notifications)return{success:!1,error:"Notification permission not granted"};try{return{success:!0,notification:new Notification(e,c({icon:"/logo192.png",badge:"/logo192.png"},t))}}catch(n){return{success:!1,error:n.message}}}vibrate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[200,100,200];if(!this.features.vibration)return{success:!1,error:"Vibration not available"};try{return navigator.vibrate(e),{success:!0}}catch(t){return{success:!1,error:t.message}}}async enterFullscreen(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement;if(!this.features.fullscreen)return{success:!1,error:"Fullscreen not available"};try{return e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen?await e.webkitRequestFullscreen():e.mozRequestFullScreen&&await e.mozRequestFullScreen(),{success:!0}}catch(t){return{success:!1,error:t.message}}}async exitFullscreen(){try{return document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen&&await document.mozCancelFullScreen(),{success:!0}}catch(e){return{success:!1,error:e.message}}}startDeviceMotionListening(e){if(!this.features.deviceMotion)return{success:!1,error:"Device motion not available"};const t=t=>{e({acceleration:t.acceleration,accelerationIncludingGravity:t.accelerationIncludingGravity,rotationRate:t.rotationRate,interval:t.interval})};return window.addEventListener("devicemotion",t),{success:!0,stop:()=>window.removeEventListener("devicemotion",t)}}isSupported(e){const t={camera:"camera",microphone:"microphone",geolocation:"geolocation",notifications:"notifications",vibration:"vibration",deviceMotion:"deviceMotion",motion:"deviceMotion",touch:"touchSupport",touchSupport:"touchSupport",fullscreen:"fullscreen",contacts:!1}[e];return!1!==t&&(!(!t||!this.features.hasOwnProperty(t))&&this.features[t])}getSupportedFeatures(){return Object.keys(this.features).filter(e=>this.features[e])}getFeatureStatus(e){const t=this.isSupported(e),n=this.permissions[e]||"unknown";return{supported:t,permission:n,available:t&&"denied"!==n}}};const Ae=new class{constructor(){this.storageKey="quibish_conversations",this.conversations=this.loadConversationsFromStorage()}loadConversationsFromStorage(){try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):[]}catch(e){return console.error("Error loading conversations from storage:",e),[]}}saveConversationsToStorage(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.conversations))}catch(e){console.error("Error saving conversations to storage:",e)}}getAllConversations(){return this.conversations}getConversationById(e){return this.conversations.find(t=>t.id===e)}createConversationWithUser(e,t){const n=this.conversations.find(t=>t.participantId===e.id||t.participants&&t.participants.includes(e.id));if(n)return{success:!0,conversation:n,isNew:!1};const a={id:Date.now().toString(),name:e.name||e.username,avatar:e.avatar||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(e.name||e.username),"&background=667eea&color=fff&size=40"),lastMessage:"",lastMessageTime:"now",unreadCount:0,isOnline:"online"===e.status,isPinned:!1,isMuted:!1,messageStatus:null,timestamp:new Date,participantId:e.id,participants:[t,e.id],type:"direct",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),user:{id:e.id,name:e.name,username:e.username,avatar:e.avatar,status:e.status},messages:[]};return this.conversations.unshift(a),this.saveConversationsToStorage(),{success:!0,conversation:a,isNew:!0}}updateConversation(e,t){const n=this.conversations.findIndex(t=>t.id===e);return-1!==n?(this.conversations[n]=c(c(c({},this.conversations[n]),t),{},{updatedAt:(new Date).toISOString()}),this.saveConversationsToStorage(),this.conversations[n]):null}deleteConversation(e){const t=this.conversations.findIndex(t=>t.id===e);return-1!==t&&(this.conversations.splice(t,1),this.saveConversationsToStorage(),!0)}addMessageToConversation(e,t){const n=this.getConversationById(e);return n?(n.messages||(n.messages=[]),n.messages.push(t),n.lastMessage=t.text||t.content||"",n.lastMessageTime="now",n.timestamp=new Date,n.updatedAt=(new Date).toISOString(),this.saveConversationsToStorage(),n):null}searchConversations(e){if(!e||0===e.trim().length)return this.conversations;const t=e.toLowerCase().trim();return this.conversations.filter(e=>{var n,a,s,i,r,o;return(null===(n=e.name)||void 0===n?void 0:n.toLowerCase().includes(t))||(null===(a=e.lastMessage)||void 0===a?void 0:a.toLowerCase().includes(t))||(null===(s=e.user)||void 0===s||null===(i=s.name)||void 0===i?void 0:i.toLowerCase().includes(t))||(null===(r=e.user)||void 0===r||null===(o=r.username)||void 0===o?void 0:o.toLowerCase().includes(t))})}getStats(){return{total:this.conversations.length,unread:this.conversations.filter(e=>e.unreadCount>0).length,groups:this.conversations.filter(e=>"group"===e.type).length,direct:this.conversations.filter(e=>"direct"===e.type).length,pinned:this.conversations.filter(e=>e.isPinned).length}}initializeDefaultConversations(){if(0===this.conversations.length){const e=[{id:"welcome-1",name:"Welcome to Quibish",avatar:"https://ui-avatars.com/api/?name=Quibish&background=667eea&color=fff&size=40",lastMessage:"Welcome! Start chatting by searching for users above.",lastMessageTime:"now",unreadCount:1,isOnline:!1,isPinned:!0,isMuted:!1,messageStatus:"delivered",timestamp:new Date,type:"system",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),messages:[{id:"welcome-msg-1",text:"\ud83d\udc4b Welcome to Quibish! To start chatting with other users, click the \ud83d\udc65 button in the search bar above and search for people by name.",sender:"System",timestamp:(new Date).toISOString(),type:"system"}]}];this.conversations=e,this.saveConversationsToStorage()}}subscribe(e){this.updateCallback=e}notifyUpdate(){this.updateCallback&&this.updateCallback(this.conversations)}clearConversations(){this.conversations=[],this.saveConversationsToStorage()}},Me=(()=>{const e="ws://localhost:5001";if(e)return e.replace(/^http/,"ws")+"/ws";return"http://localhost:5001/api".replace("/api","").replace(/^http/,"ws")+"/ws"})();const Re=new class{constructor(){this.ws=null,this.userId=null,this.username=null,this.connected=!1,this.reconnectDelay=2e3,this.maxReconnectDelay=3e4,this.reconnectTimer=null,this.shouldReconnect=!1,this.listeners=new Map,this.pendingMessages=[]}connect(e,t){this.userId=String(e),this.username=t||"User",this.shouldReconnect=!0,this._open()}_open(){if(!this.ws||this.ws.readyState!==WebSocket.OPEN&&this.ws.readyState!==WebSocket.CONNECTING)try{this.ws=new WebSocket(Me),this.ws.onopen=()=>{for(this.connected=!0,this.reconnectDelay=2e3,console.log("\ud83d\udd0c RealtimeService connected"),this._send({type:"join",userId:this.userId,username:this.username});this.pendingMessages.length>0;)this._send(this.pendingMessages.shift());this._emit("connect",{})},this.ws.onclose=()=>{this.connected=!1,this._emit("disconnect",{}),this.shouldReconnect&&(console.log("\ud83d\udd04 Reconnecting in ".concat(this.reconnectDelay/1e3,"s\u2026")),this.reconnectTimer=setTimeout(()=>{this.reconnectDelay=Math.min(1.5*this.reconnectDelay,this.maxReconnectDelay),this._open()},this.reconnectDelay))},this.ws.onerror=e=>{console.warn("\u26a0\ufe0f RealtimeService WS error:",e.message||e)},this.ws.onmessage=e=>{let t;try{t=JSON.parse(e.data)}catch(n){return}this._emit(t.type,t)}}catch(e){console.warn("\u26a0\ufe0f Could not open WebSocket:",e.message),this.shouldReconnect&&(this.reconnectTimer=setTimeout(()=>this._open(),this.reconnectDelay))}}disconnect(){this.shouldReconnect=!1,clearTimeout(this.reconnectTimer),this.ws&&(this.ws.close(),this.ws=null),this.connected=!1}_send(e){return!(!this.ws||this.ws.readyState!==WebSocket.OPEN)&&(this.ws.send(JSON.stringify(e)),!0)}sendMessage(e){let{text:t,conversationId:n,recipientId:a,encrypted:s=!1}=e;const i=Date.now().toString(),r={type:"message",text:t,conversationId:n,recipientId:a,encrypted:s,clientId:i};return this._send(r)||this.pendingMessages.push(r),i}sendTyping(e){let{conversationId:t,recipientId:n}=e;this._send({type:"typing",conversationId:t,recipientId:n})}sendSignal(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._send(c({type:e,targetUserId:t},n))}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>this.off(e,t)}off(e,t){var n;null===(n=this.listeners.get(e))||void 0===n||n.delete(t)}_emit(e,t){var n;null===(n=this.listeners.get(e))||void 0===n||n.forEach(e=>{try{e(t)}catch(n){console.error("RealtimeService handler error:",n)}})}isConnected(){var e;return this.connected&&(null===(e=this.ws)||void 0===e?void 0:e.readyState)===WebSocket.OPEN}};class Fe{constructor(){this.notifications=[],this.unreadCount=0,this.listeners=new Set,this.lastFetchTime=null,this.pollInterval=null,this.socketConnection=null,this._fetchingUnreadCount=!1,this._rateLimitedUntil=null,this.loadFromLocalStorage(),this.startPolling()}addEventListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}removeEventListener(e){this.listeners.delete(e)}emit(e,t){this.listeners.forEach(n=>{try{n(e,t)}catch(a){console.error("Error in notification listener:",a)}})}loadFromLocalStorage(){try{const e=localStorage.getItem("quibish_notifications");if(e){const t=JSON.parse(e);this.notifications=t.notifications||[],this.unreadCount=t.unreadCount||0,this.lastFetchTime=t.lastFetchTime}}catch(e){console.error("Error loading notifications from localStorage:",e)}}saveToLocalStorage(){try{const e={notifications:this.notifications,unreadCount:this.unreadCount,lastFetchTime:this.lastFetchTime,savedAt:(new Date).toISOString()};localStorage.setItem("quibish_notifications",JSON.stringify(e))}catch(e){console.error("Error saving notifications to localStorage:",e)}}async fetchNotifications(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const{limit:t=50,offset:n=0,unread:a=!1,refresh:s=!1}=e,i=new URLSearchParams({limit:t.toString(),offset:n.toString()});a&&i.append("unread","true");const r=await le("/notifications?".concat(i));return this.notifications=s||0===n?r.notifications:[...this.notifications,...r.notifications],this.unreadCount=r.unreadCount,this.lastFetchTime=(new Date).toISOString(),this.saveToLocalStorage(),this.emit("notificationsUpdated",{notifications:this.notifications,unreadCount:this.unreadCount,total:r.total,hasMore:r.hasMore}),r}catch(t){return console.error("Error fetching notifications:",t),{notifications:this.notifications,unreadCount:this.unreadCount,total:this.notifications.length,hasMore:!1,fromCache:!0}}}async getUnreadCount(){if(this._fetchingUnreadCount)return this.unreadCount;if(this._rateLimitedUntil&&Date.now()<this._rateLimitedUntil)return this.unreadCount;const e=Date.now();if(this.lastFetchTime&&e-this.lastFetchTime<5e3)return this.unreadCount;this._fetchingUnreadCount=!0;try{const e=await le("/notifications/unread-count");return this.lastFetchTime=Date.now(),this.unreadCount=e.unreadCount,this.saveToLocalStorage(),this.emit("unreadCountUpdated",this.unreadCount),this.unreadCount}catch(t){return t.message&&(t.message.includes("429")||t.message.includes("Too Many"))?(console.warn("Rate limited on notification polling. Backing off..."),this.handleRateLimit()):console.error("Error fetching unread count:",t),this.unreadCount}finally{this._fetchingUnreadCount=!1}}async markAsRead(e){try{const t=this.notifications.find(t=>t.id===e);t&&!t.read&&(t.read=!0,this.unreadCount=Math.max(0,this.unreadCount-1),this.saveToLocalStorage(),this.emit("notificationRead",{notification:t,unreadCount:this.unreadCount}));return await le("/notifications/".concat(e,"/read"),{method:"PUT"})}catch(t){throw console.error("Error marking notification as read:",t),t}}async markAllAsRead(){try{const e=this.unreadCount;this.notifications.forEach(e=>{e.read||(e.read=!0)}),this.unreadCount=0,this.saveToLocalStorage(),this.emit("allNotificationsRead",{previousUnreadCount:e});return await le("/notifications/read-all",{method:"PUT"})}catch(e){throw console.error("Error marking all notifications as read:",e),e}}async deleteNotification(e){try{const t=this.notifications.findIndex(t=>t.id===e);let n=null;-1!==t&&(n=this.notifications[t],this.notifications.splice(t,1),n.read||(this.unreadCount=Math.max(0,this.unreadCount-1)),this.saveToLocalStorage(),this.emit("notificationDeleted",{notification:n,unreadCount:this.unreadCount}));return await le("/notifications/".concat(e),{method:"DELETE"})}catch(t){throw console.error("Error deleting notification:",t),t}}async createNotification(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{const s=await le("/notifications/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e,title:t,message:n,data:a})});return this.notifications.unshift(s.notification),this.unreadCount+=1,this.saveToLocalStorage(),this.emit("newNotification",s.notification),s}catch(s){throw console.error("Error creating notification:",s),s}}handleRealtimeNotification(e){this.notifications.unshift(e),e.read||(this.unreadCount+=1),this.notifications.length>200&&(this.notifications=this.notifications.slice(0,200)),this.saveToLocalStorage(),this.emit("newNotification",e),this.emit("unreadCountUpdated",this.unreadCount),this.showBrowserNotification(e)}async showBrowserNotification(e){if("Notification"in window&&"granted"===Notification.permission)try{const t=new Notification(e.title,{body:e.message,icon:"/logo192.png",tag:e.id,silent:!1,data:e.data});t.onclick=()=>{window.focus(),this.emit("notificationClicked",e),t.close()},setTimeout(()=>{t.close()},5e3)}catch(t){console.error("Error showing browser notification:",t)}}async requestPermission(){if(!("Notification"in window))return"not-supported";if("granted"===Notification.permission)return"granted";if("denied"===Notification.permission)return"denied";return await Notification.requestPermission()}startPolling(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e4;this.stopPolling(),this.pollInterval=setInterval(()=>{this.getUnreadCount()},e),"undefined"!==typeof window&&(window.__quibish_notification_intervals=window.__quibish_notification_intervals||new Set,window.__quibish_notification_intervals.add(this.pollInterval)),this.getUnreadCount()}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),"undefined"!==typeof window&&window.__quibish_notification_intervals&&window.__quibish_notification_intervals.delete(this.pollInterval),this.pollInterval=null)}handleRateLimit(){this.stopPolling();const e=6e4;this._rateLimitedUntil=Date.now()+e,console.log("Rate limited. Notification polling paused for ".concat(60,"s.")),this.pollInterval=setInterval(()=>{this.getUnreadCount()},e),"undefined"!==typeof window&&(window.__quibish_notification_intervals=window.__quibish_notification_intervals||new Set,window.__quibish_notification_intervals.add(this.pollInterval))}connectWebSocket(e){try{this.socketConnection=new WebSocket(e),this.socketConnection.onmessage=e=>{try{const t=JSON.parse(e.data);"notification"===t.type&&this.handleRealtimeNotification(t.notification)}catch(t){console.error("Error parsing WebSocket message:",t)}},this.socketConnection.onclose=()=>{console.log("Notification WebSocket disconnected"),setTimeout(()=>{this.connectWebSocket(e)},5e3)},this.socketConnection.onerror=e=>{console.error("Notification WebSocket error:",e)}}catch(t){console.error("Error connecting to notification WebSocket:",t)}}getNotifications(){return{notifications:this.notifications,unreadCount:this.unreadCount}}getNotificationsByType(e){return this.notifications.filter(t=>t.type===e)}getTodayNotifications(){const e=(new Date).toDateString();return this.notifications.filter(t=>new Date(t.createdAt).toDateString()===e)}attachRealtime(e){this._realtimeOff&&this._realtimeOff(),this._realtimeOff=e.on("notification",e=>{e&&e.notification&&this.handleRealtimeNotification(e.notification)})}destroy(){this.stopPolling(),this.socketConnection&&this.socketConnection.close(),this.listeners.clear(),this.saveToLocalStorage()}}Fe.TYPES={MESSAGE:"message",POST:"post",FRIEND_REQUEST:"friend_request",FRIEND_ACCEPTED:"friend_accepted",MENTION:"mention",VIDEO_CALL:"video_call",VOICE_CALL:"voice_call",FILE_SHARED:"file_shared",GROUP_INVITE:"group_invite",SYSTEM:"system"};let Le=null;const ze=(Le||("undefined"!==typeof window&&window.__quibish_notification_intervals&&(window.__quibish_notification_intervals.forEach(e=>clearInterval(e)),window.__quibish_notification_intervals.clear()),Le=new Fe),Le),Oe=e=>{let{isOpen:t,onClose:n,onNotificationClick:s}=e;const[i,r]=(0,a.useState)([]),[o,l]=(0,a.useState)(0),[d,u]=(0,a.useState)(!1),[h,m]=(0,a.useState)("all"),[p,g]=(0,a.useState)("all"),[f,v]=(0,a.useState)(!1),[y,b]=(0,a.useState)(0),[x,w]=(0,a.useState)(null),S=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!d||e){u(!0),w(null);try{const t={limit:20,offset:20*(e?0:y),unread:"unread"===h,refresh:e},n=await ze.fetchNotifications(t);e?(r(n.notifications),b(0)):r(e=>[...e,...n.notifications]),l(n.unreadCount),v(n.hasMore),e||b(e=>e+1)}catch(t){w("Failed to load notifications"),console.error("Error fetching notifications:",t)}finally{u(!1)}}},[d,y,h]),j=(0,a.useMemo)(()=>{let e=i;if("unread"===h)e=e.filter(e=>!e.read);else if("today"===h){const t=(new Date).toDateString();e=e.filter(e=>new Date(e.createdAt).toDateString()===t)}return"all"!==p&&(e=e.filter(e=>e.type===p)),e},[i,h,p]);(0,a.useEffect)(()=>ze.addEventListener((e,t)=>{switch(e){case"newNotification":r(e=>[t,...e]),l(e=>e+1);break;case"notificationRead":l(t.unreadCount);break;case"notificationDeleted":r(e=>e.filter(e=>e.id!==t.notification.id)),l(t.unreadCount);break;case"allNotificationsRead":r(e=>e.map(e=>c(c({},e),{},{read:!0}))),l(0);break;case"unreadCountUpdated":l(t)}}),[]),(0,a.useEffect)(()=>{t&&S(!0)},[t,S]);const N=(0,a.useCallback)(async e=>{try{await ze.markAsRead(e),r(t=>t.map(t=>t.id===e?c(c({},t),{},{read:!0}):t))}catch(x){console.error("Error marking notification as read:",x)}},[]),C=(0,a.useCallback)(async()=>{try{await ze.markAllAsRead()}catch(x){console.error("Error marking all notifications as read:",x)}},[]),E=(0,a.useCallback)(async e=>{try{await ze.deleteNotification(e)}catch(x){console.error("Error deleting notification:",x)}},[]),T=(0,a.useCallback)(e=>{e.read||N(e.id),s&&s(e),n()},[N,s,n]),I=(0,a.useCallback)(()=>{!d&&f&&S(!1)},[d,f,S]),P=(0,a.useCallback)(e=>{const t=new Date,n=new Date(e),a=t-n,s=Math.floor(a/6e4),i=Math.floor(s/60),r=Math.floor(i/24);return s<1?"Just now":s<60?"".concat(s,"m ago"):i<24?"".concat(i,"h ago"):r<7?"".concat(r,"d ago"):n.toLocaleDateString()},[]),D=(0,a.useCallback)(e=>({message:"\ud83d\udcac",friend_request:"\ud83d\udc65",friend_accepted:"\u2705",mention:"\ud83c\udff7\ufe0f",video_call:"\ud83d\udcf9",voice_call:"\ud83d\udcde",file_shared:"\ud83d\udcce",group_invite:"\ud83d\udc65",system:"\u2699\ufe0f"}[e]||"\ud83d\udd14"),[]);return t?(0,k.jsx)("div",{className:"notification-center-overlay",onClick:n,children:(0,k.jsxs)("div",{className:"notification-center",onClick:e=>e.stopPropagation(),children:[(0,k.jsxs)("div",{className:"notification-center-header",children:[(0,k.jsxs)("div",{className:"header-title",children:[(0,k.jsx)("h3",{children:"Notifications"}),o>0&&(0,k.jsx)("span",{className:"unread-badge",children:o})]}),(0,k.jsxs)("div",{className:"header-actions",children:[o>0&&(0,k.jsx)("button",{className:"mark-all-read-btn",onClick:C,title:"Mark all as read",children:"\u2713 All"}),(0,k.jsx)("button",{className:"close-btn",onClick:n,title:"Close",children:"\u2715"})]})]}),(0,k.jsxs)("div",{className:"notification-filters",children:[(0,k.jsxs)("div",{className:"filter-tabs",children:[(0,k.jsx)("button",{className:"filter-tab ".concat("all"===h?"active":""),onClick:()=>{m("all"),b(0),S(!0)},children:"All"}),(0,k.jsxs)("button",{className:"filter-tab ".concat("unread"===h?"active":""),onClick:()=>{m("unread"),b(0),S(!0)},children:["Unread (",o,")"]}),(0,k.jsx)("button",{className:"filter-tab ".concat("today"===h?"active":""),onClick:()=>{m("today"),b(0)},children:"Today"})]}),(0,k.jsxs)("select",{className:"type-filter",value:p,onChange:e=>g(e.target.value),children:[(0,k.jsx)("option",{value:"all",children:"All Types"}),(0,k.jsx)("option",{value:"message",children:"Messages"}),(0,k.jsx)("option",{value:"friend_request",children:"Friend Requests"}),(0,k.jsx)("option",{value:"video_call",children:"Video Calls"}),(0,k.jsx)("option",{value:"voice_call",children:"Voice Calls"}),(0,k.jsx)("option",{value:"file_shared",children:"Files"}),(0,k.jsx)("option",{value:"system",children:"System"})]})]}),x&&(0,k.jsxs)("div",{className:"error-message",children:[x,(0,k.jsx)("button",{onClick:()=>S(!0),children:"Retry"})]}),(0,k.jsx)("div",{className:"notifications-list",children:d&&0===i.length?(0,k.jsxs)("div",{className:"loading-state",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("p",{children:"Loading notifications..."})]}):0===j.length?(0,k.jsxs)("div",{className:"empty-state",children:[(0,k.jsx)("div",{className:"empty-icon",children:"\ud83d\udd14"}),(0,k.jsx)("h4",{children:"No notifications"}),(0,k.jsx)("p",{children:"unread"===h?"You're all caught up!":"You don't have any notifications yet."})]}):(0,k.jsxs)(k.Fragment,{children:[j.map(e=>(0,k.jsxs)("div",{className:"notification-item ".concat(e.read?"read":"unread"),onClick:()=>T(e),children:[(0,k.jsx)("div",{className:"notification-icon",children:D(e.type)}),(0,k.jsxs)("div",{className:"notification-content",children:[(0,k.jsxs)("div",{className:"notification-header",children:[(0,k.jsx)("h5",{className:"notification-title",children:e.title}),(0,k.jsx)("span",{className:"notification-time",children:P(e.createdAt)})]}),(0,k.jsx)("p",{className:"notification-message",children:e.message}),e.data&&(0,k.jsxs)("div",{className:"notification-metadata",children:[e.data.fromUserName&&(0,k.jsxs)("span",{className:"from-user",children:["From: ",e.data.fromUserName]}),e.data.conversationId&&(0,k.jsxs)("span",{className:"conversation",children:["Conversation: ",e.data.conversationId]})]})]}),(0,k.jsxs)("div",{className:"notification-actions",children:[!e.read&&(0,k.jsx)("button",{className:"mark-read-btn",onClick:t=>{t.stopPropagation(),N(e.id)},title:"Mark as read",children:"\u2713"}),(0,k.jsx)("button",{className:"delete-btn",onClick:t=>{t.stopPropagation(),E(e.id)},title:"Delete",children:"\ud83d\uddd1\ufe0f"})]})]},e.id)),f&&(0,k.jsx)("div",{className:"load-more-container",children:(0,k.jsx)("button",{className:"load-more-btn",onClick:I,disabled:d,children:d?"Loading...":"Load More"})})]})})]})}):null},_e=e=>{let{onClick:t,className:n="",style:s={}}=e;const[i,r]=(0,a.useState)(0),[o,l]=(0,a.useState)(!1),c=a.useRef(!1),d=(0,a.useCallback)(async()=>{if(!c.current){c.current=!0;try{const e=await ze.getUnreadCount();r(e)}catch(e){console.error("Error fetching unread count:",(null===e||void 0===e?void 0:e.message)||e)}finally{c.current=!1}}},[]);(0,a.useEffect)(()=>{const e=ze.addEventListener((e,t)=>{switch(e){case"newNotification":r(e=>e+1),l(!0),setTimeout(()=>{l(!1)},3e3);break;case"notificationRead":case"notificationDeleted":r(t.unreadCount);break;case"allNotificationsRead":r(0);break;case"unreadCountUpdated":r(t)}});return d(),e},[d]),(0,a.useEffect)(()=>{(async()=>{try{await ze.requestPermission()}catch(e){console.error("Error requesting notification permission:",e)}})()},[]);const u=(0,a.useCallback)(()=>{l(!1),t&&t()},[t]);return(0,k.jsx)("button",{className:"notification-button ".concat(n," ").concat(o?"has-new":""," ").concat(i>0?"has-unread":""),onClick:u,title:"Notifications".concat(i>0?" (".concat(i," unread)"):""),style:s,children:(0,k.jsxs)("div",{className:"notification-icon",children:["\ud83d\udd14",i>0&&(0,k.jsx)("span",{className:"notification-badge",children:i>99?"99+":i}),o&&(0,k.jsx)("div",{className:"notification-pulse"})]})})},Ue=e=>{let{onPermissionGranted:t,onPermissionDenied:n}=e;const[s,i]=(0,a.useState)(!1),[r,o]=(0,a.useState)(!1),[l,c]=(0,a.useState)(!1);(0,a.useEffect)(()=>{ce.isSupported&&(async()=>{if(l)return;if("default"!==Notification.permission)return;const e=localStorage.getItem("notificationPromptDismissed"),t=localStorage.getItem("notificationPromptDismissedTime");if("true"===e&&t&&(Date.now()-parseInt(t))/36e5<24)return;setTimeout(()=>{i(!0)},5e3)})()},[l]);const d=()=>{i(!1),c(!0),localStorage.setItem("notificationPromptDismissed","true"),localStorage.setItem("notificationPromptDismissedTime",Date.now().toString())};return s&&ce.isSupported?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"notification-prompt-backdrop",onClick:d}),(0,k.jsxs)("div",{className:"notification-permission-prompt",children:[(0,k.jsx)("button",{className:"notification-prompt-close",onClick:()=>{i(!1),c(!0),localStorage.setItem("notificationPromptDismissed","true"),localStorage.setItem("notificationPromptDismissedTime",Date.now().toString())},"aria-label":"Close",children:"\u2715"}),(0,k.jsx)("div",{className:"notification-prompt-icon",children:"\ud83d\udd14"}),(0,k.jsx)("h3",{className:"notification-prompt-title",children:"Stay Connected"}),(0,k.jsx)("p",{className:"notification-prompt-message",children:"Enable notifications to receive instant alerts when you get new messages, even when the app is closed. You can reply directly from notifications!"}),(0,k.jsxs)("div",{className:"notification-prompt-features",children:[(0,k.jsxs)("div",{className:"notification-feature",children:[(0,k.jsx)("span",{className:"feature-icon",children:"\ud83d\udcac"}),(0,k.jsx)("span",{className:"feature-text",children:"Instant message alerts"})]}),(0,k.jsxs)("div",{className:"notification-feature",children:[(0,k.jsx)("span",{className:"feature-icon",children:"\u26a1"}),(0,k.jsx)("span",{className:"feature-text",children:"Quick reply from notification"})]}),(0,k.jsxs)("div",{className:"notification-feature",children:[(0,k.jsx)("span",{className:"feature-icon",children:"\ud83d\udd12"}),(0,k.jsx)("span",{className:"feature-text",children:"Privacy protected"})]})]}),(0,k.jsxs)("div",{className:"notification-prompt-actions",children:[(0,k.jsx)("button",{className:"notification-btn notification-btn-primary",onClick:async()=>{o(!0);try{await ce.requestPermission()&&(console.log("\u2705 Notification permission granted"),i(!1),localStorage.removeItem("notificationPromptDismissed"),localStorage.removeItem("notificationPromptDismissedTime"),t&&t(),setTimeout(()=>{ce.testNotification("Great! You'll now receive message notifications even when the app is closed.")},500))}catch(e){console.error("Failed to request notification permission:",e),e.message.includes("denied")&&n&&n(),i(!1)}finally{o(!1)}},disabled:r,children:r?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("span",{className:"btn-spinner"}),"Enabling..."]}):"\u2713 Enable Notifications"}),(0,k.jsx)("button",{className:"notification-btn notification-btn-secondary",onClick:d,disabled:r,children:"Not Now"})]}),(0,k.jsx)("p",{className:"notification-prompt-footer",children:"You can change this in your browser settings anytime"})]})]}):null},qe=re.BASE_URL;const Be=new class{constructor(){this.baseURL=qe,this.token=localStorage.getItem("authToken")}setToken(e){this.token=e,e?localStorage.setItem("authToken",e):localStorage.removeItem("authToken")}getHeaders(){const e={"Content-Type":"application/json"};return this.token&&(e.Authorization="Bearer ".concat(this.token)),e}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n="".concat(this.baseURL).concat(e),a=c(c({},t),{},{headers:c(c({},this.getHeaders()),t.headers)});try{const e=await fetch(n,a);if(!e.ok){var s,i;let t="";try{t=await e.text()}catch(r){}let n=null;try{n=JSON.parse(t)}catch(r){}const a=(null===(s=n)||void 0===s?void 0:s.error)||(null===(i=n)||void 0===i?void 0:i.message)||"HTTP error! status: ".concat(e.status);throw new Error(a)}const t=await e.text();if(!t)return null;const o=t.trimStart();if(o.startsWith("{")||o.startsWith("["))try{return JSON.parse(t)}catch(r){}return t}catch(o){throw console.error("API request failed:",o),o}}async get(e){return this.request(e,{method:"GET"})}async post(e,t){return this.request(e,{method:"POST",body:JSON.stringify(t)})}async put(e,t){return this.request(e,{method:"PUT",body:JSON.stringify(t)})}async delete(e){return this.request(e,{method:"DELETE"})}},He={async login(e,t){try{if(await We()){const n=await Be.post("/auth/login",{username:e,password:t});if(console.log("Login response from backend:",JSON.stringify(n)),!n)throw new Error("Server returned an empty response. Please try again.");if("string"===typeof n)throw console.error("Login - unexpected text response:",n.slice(0,200)),new Error("Server returned an unexpected response. Please try again.");if(!1===n.success)throw new Error(n.error||n.message||"Login failed");if(!n.user)throw new Error(n.error||"Server returned an incomplete response. Please try again.");return n.token&&Be.setToken(n.token),n}{if(console.log("\ud83d\udd04 Backend unavailable - using offline mode login"),!e||!t)throw new Error("Please enter both username and password");if(t.length<3)throw new Error("Password too short for demo");const n={id:Date.now().toString(),username:e,email:e.includes("@")?e:"".concat(e,"@quibish.com"),name:e.charAt(0).toUpperCase()+e.slice(1),avatar:"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(e),"&background=6366f1&color=fff&size=40"),theme:"light",language:"en",isDemo:!0,joinedAt:(new Date).toISOString()},a=btoa(JSON.stringify({userId:n.id,username:e,timestamp:Date.now()}));return console.log("\u2705 Offline login successful for demo user:",e),{success:!0,user:n,token:a,message:"Logged in successfully (offline mode)"}}}catch(n){if(n.message.includes("fetch")||n.message.includes("network")||n.message.includes("Failed to fetch")||n.message.includes("HTTP error")){if(console.log("\ud83d\udd04 Network error detected - falling back to offline mode"),!e||!t)throw new Error("Please enter both username and password");const n={id:Date.now().toString(),username:e,email:e.includes("@")?e:"".concat(e,"@quibish.com"),name:e.charAt(0).toUpperCase()+e.slice(1),avatar:"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(e),"&background=6366f1&color=fff&size=40"),theme:"light",language:"en",isDemo:!0,joinedAt:(new Date).toISOString()};return{success:!0,user:n,token:btoa(JSON.stringify({userId:n.id,username:e,timestamp:Date.now()})),message:"Logged in successfully (offline mode)"}}throw new Error(n.message||"Login failed. Please check your credentials.")}},async register(e){try{if(await We()){const t=await Be.post("/auth/register",e);return t.token&&Be.setToken(t.token),t}{console.log("\ud83d\udd04 Backend unavailable - using offline mode registration");const{username:t,email:n,password:a,confirmPassword:s}=e;if(!t||!n||!a)throw new Error("Please fill in all required fields");if(a!==s)throw new Error("Passwords do not match");if(a.length<3)throw new Error("Password too short for demo");const i={id:Date.now().toString(),username:t,email:n,name:t.charAt(0).toUpperCase()+t.slice(1),avatar:"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(t),"&background=6366f1&color=fff&size=40"),theme:"light",language:"en",isDemo:!0,joinedAt:(new Date).toISOString()},r=btoa(JSON.stringify({userId:i.id,username:t,timestamp:Date.now()}));return console.log("\u2705 Offline registration successful for demo user:",t),{success:!0,user:i,token:r,message:"Registered successfully (offline mode)"}}}catch(t){if(t.message.includes("fetch")||t.message.includes("network")||t.message.includes("Failed to fetch")){console.log("\ud83d\udd04 Network error detected - falling back to offline mode registration");const{username:t,email:n,password:a,confirmPassword:s}=e;if(!t||!n||!a)throw new Error("Please fill in all required fields");if(a!==s)throw new Error("Passwords do not match");const i={id:Date.now().toString(),username:t,email:n,name:t.charAt(0).toUpperCase()+t.slice(1),avatar:"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(t),"&background=6366f1&color=fff&size=40"),theme:"light",language:"en",isDemo:!0,joinedAt:(new Date).toISOString()};return{success:!0,user:i,token:btoa(JSON.stringify({userId:i.id,username:t,timestamp:Date.now()})),message:"Registered successfully (offline mode)"}}throw new Error(t.message||"Registration failed. Please try again.")}},async logout(){try{await Be.post("/auth/logout")}catch(e){console.warn("Logout API call failed:",e)}finally{Be.setToken(null)}},async getCurrentUser(){try{return await Be.get("/auth/me")}catch(e){throw new Error("Failed to get current user.")}},async refreshToken(){try{const e=await Be.post("/auth/refresh");return e.token&&Be.setToken(e.token),e}catch(e){throw new Error("Token refresh failed.")}}},We=async()=>{try{return(await fetch("".concat(qe,"/health"))).ok}catch(e){return console.warn("API connection check failed:",e),!1}},Ve=Be;const Ke=new class{constructor(){this.baseURL="/api/posts"}async createPost(e){try{return(await Ve.post(this.baseURL,e)).data}catch(t){throw console.error("Error creating post:",t),this.handleError(t)}}async getFeed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const{page:t=1,limit:n=10,userId:a=null,visibility:s="public",sortBy:i="recent"}=e;return(await Ve.get("".concat(this.baseURL,"/feed"),{params:{page:t,limit:n,userId:a,visibility:s,sortBy:i}})).data}catch(t){throw console.error("Error fetching feed:",t),this.handleError(t)}}async getUserPosts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const{page:n=1,limit:a=10}=t;return(await Ve.get("".concat(this.baseURL,"/user/").concat(e),{params:{page:n,limit:a}})).data}catch(n){throw console.error("Error fetching user posts:",n),this.handleError(n)}}async getPost(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return(await Ve.get("".concat(this.baseURL,"/").concat(e),{params:{userId:t}})).data}catch(n){throw console.error("Error fetching post:",n),this.handleError(n)}}async updatePost(e,t){try{return(await Ve.put("".concat(this.baseURL,"/").concat(e),t)).data}catch(n){throw console.error("Error updating post:",n),this.handleError(n)}}async deletePost(e,t){try{return(await Ve.delete("".concat(this.baseURL,"/").concat(e),{data:{userId:t}})).data}catch(n){throw console.error("Error deleting post:",n),this.handleError(n)}}async togglePin(e,t,n){try{return(await Ve.patch("".concat(this.baseURL,"/").concat(e,"/pin"),{userId:t,isPinned:n})).data}catch(a){throw console.error("Error toggling pin:",a),this.handleError(a)}}async sharePost(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{return(await Ve.post(this.baseURL,{userId:t,content:n,type:"shared",sharedPostId:e,visibility:"public"})).data}catch(a){throw console.error("Error sharing post:",a),this.handleError(a)}}async toggleLike(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"like";try{return(await Ve.post("".concat(this.baseURL,"/").concat(e,"/").concat(t,"/like"),{userId:n,reactionType:a})).data}catch(s){throw console.error("Error toggling like:",s),this.handleError(s)}}async getLikes(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const{page:a=1,limit:s=20}=n;return(await Ve.get("".concat(this.baseURL,"/").concat(e,"/").concat(t,"/likes"),{params:{page:a,limit:s}})).data}catch(a){throw console.error("Error fetching likes:",a),this.handleError(a)}}async addComment(e,t){try{return(await Ve.post("".concat(this.baseURL,"/").concat(e,"/comments"),t)).data}catch(n){throw console.error("Error adding comment:",n),this.handleError(n)}}async getComments(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const{page:n=1,limit:a=20,userId:s=null}=t;return(await Ve.get("".concat(this.baseURL,"/").concat(e,"/comments"),{params:{page:n,limit:a,userId:s}})).data}catch(n){throw console.error("Error fetching comments:",n),this.handleError(n)}}async getReplies(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const{page:n=1,limit:a=10,userId:s=null}=t;return(await Ve.get("".concat(this.baseURL,"/comments/").concat(e,"/replies"),{params:{page:n,limit:a,userId:s}})).data}catch(n){throw console.error("Error fetching replies:",n),this.handleError(n)}}async updateComment(e,t){try{return(await Ve.put("".concat(this.baseURL,"/comments/").concat(e),t)).data}catch(n){throw console.error("Error updating comment:",n),this.handleError(n)}}async deleteComment(e,t){try{return(await Ve.delete("".concat(this.baseURL,"/comments/").concat(e),{data:{userId:t}})).data}catch(n){throw console.error("Error deleting comment:",n),this.handleError(n)}}async searchPosts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const{page:n=1,limit:a=10,userId:s=null}=t;return(await Ve.get("".concat(this.baseURL,"/search"),{params:{q:e,page:n,limit:a,userId:s}})).data}catch(n){throw console.error("Error searching posts:",n),this.handleError(n)}}handleError(e){return e.response?{message:e.response.data.error||"An error occurred",status:e.response.status,details:e.response.data.details}:e.request?{message:"No response from server",status:0}:{message:e.message||"An unexpected error occurred",status:-1}}formatPostData(e){return c(c({},e),{},{createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),timeAgo:this.getTimeAgo(e.createdAt)})}getTimeAgo(e){const t=new Date,n=new Date(e),a=Math.floor((t-n)/1e3);return a<60?"Just now":a<3600?"".concat(Math.floor(a/60),"m ago"):a<86400?"".concat(Math.floor(a/3600),"h ago"):a<604800?"".concat(Math.floor(a/86400),"d ago"):a<2592e3?"".concat(Math.floor(a/604800),"w ago"):n.toLocaleDateString()}extractHashtags(e){return e.match(/#[\w]+/g)||[]}extractMentions(e){return e.match(/@[\w]+/g)||[]}},Ge=e=>{let{user:t,onPostCreated:n,className:s=""}=e;const[i,r]=(0,a.useState)(""),[o,l]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)("public"),[m,p]=(0,a.useState)(""),[g,f]=(0,a.useState)(""),[v,y]=(0,a.useState)(!1),[b,x]=(0,a.useState)([]),[w,S]=(0,a.useState)(""),j=(0,a.useRef)(null),N=(0,a.useRef)(null),C=[{value:"happy",label:"\ud83d\ude0a Happy",emoji:"\ud83d\ude0a"},{value:"excited",label:"\ud83c\udf89 Excited",emoji:"\ud83c\udf89"},{value:"loved",label:"\u2764\ufe0f Loved",emoji:"\u2764\ufe0f"},{value:"grateful",label:"\ud83d\ude4f Grateful",emoji:"\ud83d\ude4f"},{value:"blessed",label:"\u2728 Blessed",emoji:"\u2728"},{value:"motivated",label:"\ud83d\udcaa Motivated",emoji:"\ud83d\udcaa"},{value:"relaxed",label:"\ud83d\ude0c Relaxed",emoji:"\ud83d\ude0c"},{value:"thoughtful",label:"\ud83e\udd14 Thoughtful",emoji:"\ud83e\udd14"}];return(0,k.jsxs)("div",{className:"post-composer ".concat(o?"expanded":""," ").concat(s),children:[(0,k.jsxs)("div",{className:"post-composer-header",children:[(0,k.jsx)("div",{className:"user-avatar",children:t.avatar?(0,k.jsx)("img",{src:t.avatar,alt:t.displayName||t.username}):(0,k.jsx)("div",{className:"avatar-placeholder",children:(t.displayName||t.username).charAt(0).toUpperCase()})}),o?(0,k.jsxs)("div",{className:"composer-content",children:[(0,k.jsx)("textarea",{ref:N,className:"composer-textarea",placeholder:"What's on your mind, ".concat(t.displayName||t.username,"?"),value:i,onChange:e=>{r(e.target.value),S("")},rows:4,disabled:c}),w&&(0,k.jsx)("div",{className:"composer-error",children:w}),b.length>0&&(0,k.jsx)("div",{className:"media-preview",children:b.map((e,t)=>(0,k.jsxs)("div",{className:"media-item",children:["image"===e.type?(0,k.jsx)("img",{src:e.url,alt:e.name}):(0,k.jsx)("video",{src:e.url}),(0,k.jsx)("button",{className:"remove-media",onClick:()=>(e=>{const t=[...b];URL.revokeObjectURL(t[e].url),t.splice(e,1),x(t)})(t),disabled:c,children:"\xd7"})]},t))}),(m||g)&&(0,k.jsxs)("div",{className:"post-meta",children:[m&&(0,k.jsxs)("span",{className:"meta-tag feeling",children:[(()=>{const e=C.find(e=>e.value===m);return e?e.emoji:""})()," Feeling ",m]}),g&&(0,k.jsxs)("span",{className:"meta-tag location",children:["\ud83d\udccd ",g]})]})]}):(0,k.jsx)("div",{className:"composer-trigger",onClick:()=>{l(!0),setTimeout(()=>{var e;return null===(e=N.current)||void 0===e?void 0:e.focus()},100)},children:(0,k.jsxs)("span",{className:"placeholder",children:["What's on your mind, ",t.displayName||t.username,"?"]})})]}),o&&(0,k.jsxs)(k.Fragment,{children:[v&&(0,k.jsxs)("div",{className:"options-panel",children:[(0,k.jsxs)("div",{className:"option-group",children:[(0,k.jsx)("label",{children:"Feeling/Activity"}),(0,k.jsxs)("select",{value:m,onChange:e=>p(e.target.value),children:[(0,k.jsx)("option",{value:"",children:"Select a feeling..."}),C.map(e=>(0,k.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,k.jsxs)("div",{className:"option-group",children:[(0,k.jsx)("label",{children:"Location"}),(0,k.jsx)("input",{type:"text",placeholder:"Add location...",value:g,onChange:e=>f(e.target.value)})]}),(0,k.jsxs)("div",{className:"option-group",children:[(0,k.jsx)("label",{children:"Privacy"}),(0,k.jsxs)("select",{value:u,onChange:e=>h(e.target.value),children:[(0,k.jsx)("option",{value:"public",children:"\ud83c\udf0d Public"}),(0,k.jsx)("option",{value:"friends",children:"\ud83d\udc65 Friends"}),(0,k.jsx)("option",{value:"private",children:"\ud83d\udd12 Only Me"})]})]})]}),(0,k.jsxs)("div",{className:"composer-actions",children:[(0,k.jsxs)("div",{className:"action-buttons",children:[(0,k.jsxs)("button",{className:"action-btn",onClick:()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.click()},disabled:c,title:"Add photo/video",children:[(0,k.jsx)("span",{className:"icon",children:"\ud83d\udcf7"}),(0,k.jsx)("span",{className:"label",children:"Photo/Video"})]}),(0,k.jsxs)("button",{className:"action-btn",onClick:()=>y(!v),disabled:c,title:"More options",children:[(0,k.jsx)("span",{className:"icon",children:"\u2699\ufe0f"}),(0,k.jsx)("span",{className:"label",children:"Options"})]}),(0,k.jsx)("input",{ref:j,type:"file",accept:"image/*,video/*",multiple:!0,style:{display:"none"},onChange:e=>{const t=Array.from(e.target.files).map(e=>({type:e.type.startsWith("image/")?"image":"video",file:e,url:URL.createObjectURL(e),name:e.name}));x([...b,...t])}})]}),(0,k.jsxs)("div",{className:"post-buttons",children:[(0,k.jsx)("button",{className:"btn-cancel",onClick:()=>{i||0!==b.length||(l(!1),y(!1),p(""),f(""))},disabled:c,children:"Cancel"}),(0,k.jsx)("button",{className:"btn-post",onClick:async()=>{if(i.trim()||0!==b.length){d(!0),S("");try{const e=Ke.extractHashtags(i),a=Ke.extractMentions(i),s={userId:t.id,content:i.trim(),type:b.length>0?"image"===b[0].type?"image":"video":"text",media:b.map(e=>({type:e.type,url:e.url,name:e.name})),visibility:u,tags:e,mentions:a,feeling:m||null,location:g||null},o=await Ke.createPost(s);o.success?(r(""),x([]),p(""),f(""),l(!1),y(!1),n&&n(o.post)):S(o.error||"Failed to create post")}catch(e){S(e.message||"Failed to create post")}finally{d(!1)}}else S("Please write something or add media")},disabled:c||!i.trim()&&0===b.length,children:c?"Posting...":"Post"})]})]})]})]})},Je=e=>{var t,n,s,i;let{comment:r,currentUser:o,postId:l}=e;const[c,d]=(0,a.useState)(r.isLikedByCurrentUser),[u,h]=(0,a.useState)(r.likesCount),[m,p]=(0,a.useState)(!1),[g,f]=(0,a.useState)(r.replies||[]),[v,y]=(0,a.useState)(""),[b,x]=(0,a.useState)(!1),[w,S]=(0,a.useState)(!1),j=async()=>{if(v.trim()){x(!0);try{const e=await Ke.addComment(l,{userId:o.id,content:v.trim(),parentCommentId:r.id});e.success&&(f([...g,e.comment]),y(""),S(!1))}catch(e){console.error("Error adding reply:",e)}finally{x(!1)}}};return(0,k.jsxs)("div",{className:"comment",children:[(0,k.jsx)("div",{className:"comment-avatar",children:null!==(t=r.author)&&void 0!==t&&t.avatar?(0,k.jsx)("img",{src:r.author.avatar,alt:r.author.displayName}):(0,k.jsx)("div",{className:"avatar-placeholder",children:null===(n=r.author)||void 0===n||null===(s=n.displayName)||void 0===s?void 0:s.charAt(0).toUpperCase()})}),(0,k.jsxs)("div",{className:"comment-content",children:[(0,k.jsxs)("div",{className:"comment-bubble",children:[(0,k.jsx)("div",{className:"comment-author",children:null===(i=r.author)||void 0===i?void 0:i.displayName}),(0,k.jsx)("div",{className:"comment-text",children:r.content})]}),(0,k.jsxs)("div",{className:"comment-actions",children:[(0,k.jsxs)("button",{className:"comment-action ".concat(c?"active":""),onClick:async()=>{try{const e=await Ke.toggleLike("comment",r.id,o.id);e.success&&(d(e.liked),h(e.likesCount))}catch(e){console.error("Error liking comment:",e)}},children:["Like ",u>0&&"(".concat(u,")")]}),(0,k.jsx)("button",{className:"comment-action",onClick:()=>S(!w),children:"Reply"}),(0,k.jsx)("span",{className:"comment-time",children:Ke.getTimeAgo(r.createdAt)})]}),w&&(0,k.jsxs)("div",{className:"reply-input",children:[(0,k.jsx)("input",{type:"text",placeholder:"Write a reply...",value:v,onChange:e=>y(e.target.value),onKeyPress:e=>"Enter"===e.key&&j(),disabled:b}),v&&(0,k.jsx)("button",{onClick:j,disabled:b,children:b?"...":"Reply"})]}),r.repliesCount>0&&(0,k.jsxs)("div",{className:"replies-section",children:[!m&&g.length<r.repliesCount&&(0,k.jsxs)("button",{className:"view-replies-btn",onClick:()=>p(!0),children:["View ",r.repliesCount," ",1===r.repliesCount?"reply":"replies"]}),(m||g.length>0)&&(0,k.jsx)("div",{className:"replies-list",children:g.map(e=>(0,k.jsx)(Je,{comment:e,currentUser:o,postId:l},e.id))})]})]})]})},Ye=e=>{var t,n,s,i,r,o,l,d,u;let{post:h,currentUser:m,onPostDeleted:p,onPostUpdated:g,className:f=""}=e;const[v,y]=(0,a.useState)(h),[b,x]=(0,a.useState)(!1),[w,S]=(0,a.useState)([]),[j,N]=(0,a.useState)(""),[C,E]=(0,a.useState)(!1),[T,I]=(0,a.useState)(!1),[P,D]=(0,a.useState)(!1),[A,M]=(0,a.useState)(!1),[R,F]=(0,a.useState)(v.content),[L,z]=(0,a.useState)(!1),O=(0,a.useRef)(null);(0,a.useEffect)(()=>{y(h)},[h]),(0,a.useEffect)(()=>{const e=e=>{O.current&&!O.current.contains(e.target)&&D(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const _=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"like";try{const t=await Ke.toggleLike("post",v.id,m.id,e);t.success&&y(c(c({},v),{},{isLikedByCurrentUser:t.liked,likesCount:t.likesCount})),z(!1)}catch(t){console.error("Error toggling like:",t)}},U=async()=>{if(w.length>0)x(!b);else{E(!0);try{const e=await Ke.getComments(v.id,{userId:m.id,limit:10});e.success&&(S(e.comments),x(!0))}catch(e){console.error("Error loading comments:",e)}finally{E(!1)}}},q=async()=>{if(j.trim()){I(!0);try{const e=await Ke.addComment(v.id,{userId:m.id,content:j.trim()});e.success&&(S([e.comment,...w]),N(""),y(c(c({},v),{},{commentsCount:v.commentsCount+1})))}catch(e){console.error("Error adding comment:",e)}finally{I(!1)}}},B=m&&v.author&&m.id===v.author.id;return(0,k.jsxs)("div",{className:"post-card ".concat(f),children:[(0,k.jsxs)("div",{className:"post-header",children:[(0,k.jsxs)("div",{className:"post-author",children:[(0,k.jsx)("div",{className:"author-avatar",children:null!==(t=v.author)&&void 0!==t&&t.avatar?(0,k.jsx)("img",{src:v.author.avatar,alt:v.author.displayName}):(0,k.jsx)("div",{className:"avatar-placeholder",children:(null===(n=v.author)||void 0===n||null===(s=n.displayName)||void 0===s?void 0:s.charAt(0).toUpperCase())||"U"})}),(0,k.jsxs)("div",{className:"author-info",children:[(0,k.jsxs)("div",{className:"author-name",children:[(null===(i=v.author)||void 0===i?void 0:i.displayName)||"Unknown User",v.isPinned&&(0,k.jsx)("span",{className:"pinned-badge",children:"\ud83d\udccc Pinned"})]}),(0,k.jsxs)("div",{className:"post-time",children:[Ke.getTimeAgo(v.createdAt),v.isEdited&&" \xb7 Edited","public"!==v.visibility&&" \xb7 ".concat("friends"===v.visibility?"\ud83d\udc65":"\ud83d\udd12"),v.feeling&&" \xb7 Feeling ".concat(v.feeling),v.location&&" \xb7 \ud83d\udccd ".concat(v.location)]})]})]}),B&&(0,k.jsxs)("div",{className:"post-options",ref:O,children:[(0,k.jsx)("button",{className:"options-btn",onClick:()=>D(!P),children:"\u22ef"}),P&&(0,k.jsxs)("div",{className:"options-menu",children:[(0,k.jsx)("button",{onClick:async()=>{try{const e=await Ke.togglePin(v.id,m.id,!v.isPinned);e.success&&(y(e.post),g&&g(e.post)),D(!1)}catch(e){console.error("Error toggling pin:",e)}},children:v.isPinned?"\ud83d\udccc Unpin":"\ud83d\udccc Pin to profile"}),(0,k.jsx)("button",{onClick:()=>{M(!0),F(v.content),D(!1)},children:"\u270f\ufe0f Edit post"}),(0,k.jsx)("button",{onClick:async()=>{if(window.confirm("Are you sure you want to delete this post?"))try{(await Ke.deletePost(v.id,m.id)).success&&p&&p(v.id)}catch(e){console.error("Error deleting post:",e)}},className:"danger",children:"\ud83d\uddd1\ufe0f Delete post"})]})]})]}),(0,k.jsxs)("div",{className:"post-content",children:[A?(0,k.jsxs)("div",{className:"edit-mode",children:[(0,k.jsx)("textarea",{value:R,onChange:e=>F(e.target.value),rows:4}),(0,k.jsxs)("div",{className:"edit-actions",children:[(0,k.jsx)("button",{onClick:()=>M(!1),children:"Cancel"}),(0,k.jsx)("button",{onClick:async()=>{try{const e=await Ke.updatePost(v.id,{userId:m.id,content:R});e.success&&(y(e.post),M(!1),g&&g(e.post))}catch(e){console.error("Error updating post:",e)}},className:"primary",children:"Save"})]})]}):(0,k.jsx)("p",{className:"post-text",children:v.content}),v.media&&v.media.length>0&&!A&&(0,k.jsx)("div",{className:"post-media media-count-".concat(v.media.length),children:v.media.map((e,t)=>(0,k.jsx)("div",{className:"media-item",children:"image"===e.type?(0,k.jsx)("img",{src:e.url,alt:""}):(0,k.jsx)("video",{controls:!0,children:(0,k.jsx)("source",{src:e.url})})},t))}),v.sharedPost&&!A&&(0,k.jsxs)("div",{className:"shared-post",children:[(0,k.jsxs)("div",{className:"shared-post-header",children:[(0,k.jsx)("div",{className:"shared-author-avatar",children:null!==(r=v.sharedPost.author)&&void 0!==r&&r.avatar?(0,k.jsx)("img",{src:v.sharedPost.author.avatar,alt:v.sharedPost.author.displayName}):(0,k.jsx)("div",{className:"avatar-placeholder",children:null===(o=v.sharedPost.author)||void 0===o||null===(l=o.displayName)||void 0===l?void 0:l.charAt(0).toUpperCase()})}),(0,k.jsx)("div",{className:"shared-author-name",children:null===(d=v.sharedPost.author)||void 0===d?void 0:d.displayName})]}),(0,k.jsx)("p",{className:"shared-post-content",children:v.sharedPost.content})]})]}),(v.likesCount>0||v.commentsCount>0||v.sharesCount>0)&&(0,k.jsxs)("div",{className:"post-stats",children:[(0,k.jsx)("div",{className:"stats-left",children:v.likesCount>0&&(0,k.jsxs)("button",{className:"stat-item",children:[(0,k.jsx)("span",{className:"stat-reactions",children:"\ud83d\udc4d"}),(0,k.jsx)("span",{className:"stat-count",children:v.likesCount})]})}),(0,k.jsxs)("div",{className:"stats-right",children:[v.commentsCount>0&&(0,k.jsxs)("button",{className:"stat-item",onClick:U,children:[v.commentsCount," ",1===v.commentsCount?"comment":"comments"]}),v.sharesCount>0&&(0,k.jsxs)("span",{className:"stat-item",children:[v.sharesCount," ",1===v.sharesCount?"share":"shares"]})]})]}),(0,k.jsxs)("div",{className:"post-actions",children:[(0,k.jsxs)("div",{className:"reaction-container",children:[(0,k.jsxs)("button",{className:"action-btn ".concat(v.isLikedByCurrentUser?"active":""),onClick:()=>_("like"),onMouseEnter:()=>z(!0),onMouseLeave:()=>setTimeout(()=>z(!1),300),children:[(0,k.jsx)("span",{className:"action-icon",children:(v.isLikedByCurrentUser,"\ud83d\udc4d")}),(0,k.jsx)("span",{className:"action-label",children:"Like"})]}),L&&(0,k.jsx)("div",{className:"reactions-picker",onMouseEnter:()=>z(!0),onMouseLeave:()=>z(!1),children:[{type:"like",emoji:"\ud83d\udc4d",label:"Like"},{type:"love",emoji:"\u2764\ufe0f",label:"Love"},{type:"haha",emoji:"\ud83d\ude02",label:"Haha"},{type:"wow",emoji:"\ud83d\ude2e",label:"Wow"},{type:"sad",emoji:"\ud83d\ude22",label:"Sad"},{type:"angry",emoji:"\ud83d\ude20",label:"Angry"}].map(e=>(0,k.jsx)("button",{className:"reaction-btn",onClick:()=>_(e.type),title:e.label,children:e.emoji},e.type))})]}),(0,k.jsxs)("button",{className:"action-btn",onClick:U,children:[(0,k.jsx)("span",{className:"action-icon",children:"\ud83d\udcac"}),(0,k.jsx)("span",{className:"action-label",children:"Comment"})]}),(0,k.jsxs)("button",{className:"action-btn",onClick:async()=>{try{(await Ke.sharePost(v.id,m.id)).success&&(y(c(c({},v),{},{sharesCount:v.sharesCount+1})),alert("Post shared successfully!"))}catch(e){console.error("Error sharing post:",e)}},children:[(0,k.jsx)("span",{className:"action-icon",children:"\ud83d\udd04"}),(0,k.jsx)("span",{className:"action-label",children:"Share"})]})]}),b&&(0,k.jsxs)("div",{className:"comments-section",children:[(0,k.jsxs)("div",{className:"comment-input",children:[(0,k.jsx)("div",{className:"commenter-avatar",children:m.avatar?(0,k.jsx)("img",{src:m.avatar,alt:m.displayName}):(0,k.jsx)("div",{className:"avatar-placeholder",children:null===(u=m.displayName)||void 0===u?void 0:u.charAt(0).toUpperCase()})}),(0,k.jsxs)("div",{className:"comment-input-wrapper",children:[(0,k.jsx)("input",{type:"text",placeholder:"Write a comment...",value:j,onChange:e=>N(e.target.value),onKeyPress:e=>"Enter"===e.key&&q(),disabled:T}),j&&(0,k.jsx)("button",{className:"send-comment-btn",onClick:q,disabled:T,children:T?"...":"\u27a4"})]})]}),C?(0,k.jsx)("div",{className:"loading-comments",children:"Loading comments..."}):(0,k.jsx)("div",{className:"comments-list",children:w.map(e=>(0,k.jsx)(Je,{comment:e,currentUser:m,postId:v.id},e.id))})]})]})},Qe=e=>{let{user:t,className:n=""}=e;const[s,i]=(0,a.useState)([]),[r,o]=(0,a.useState)(!1),[l,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(1),[h,m]=(0,a.useState)(!0),[p,g]=(0,a.useState)("recent"),[f,v]=(0,a.useState)("public"),y=(0,a.useRef)(null),b=(0,a.useRef)(null);(0,a.useEffect)(()=>{x(!0)},[p,f]),(0,a.useEffect)(()=>{if(!h||r)return;const e=new IntersectionObserver(e=>{e[0].isIntersecting&&w()},{root:null,rootMargin:"100px",threshold:.1});return b.current&&e.observe(b.current),y.current=e,()=>{y.current&&y.current.disconnect()}},[h,r,d]);const x=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!r){o(!0),c("");try{const n=e?1:d,a=await Ke.getFeed({page:n,limit:10,userId:t.id,visibility:f,sortBy:p});a.success?(e?(i(a.posts),u(2)):(i(e=>[...e,...a.posts]),u(e=>e+1)),m(a.pagination.hasMore)):c(a.error||"Failed to load feed")}catch(n){c(n.message||"Failed to load feed")}finally{o(!1)}}},w=(0,a.useCallback)(()=>{!r&&h&&x(!1)},[r,h,d]),S=e=>{i(s.filter(t=>t.id!==e))},j=e=>{i(s.map(t=>t.id===e.id?e:t))},N=()=>{u(1),x(!0)};return(0,k.jsxs)("div",{className:"news-feed ".concat(n),children:[(0,k.jsxs)("div",{className:"feed-header",children:[(0,k.jsx)("h2",{className:"feed-title",children:"News Feed"}),(0,k.jsxs)("div",{className:"feed-controls",children:[(0,k.jsxs)("div",{className:"filter-group",children:[(0,k.jsx)("label",{children:"Sort by:"}),(0,k.jsxs)("select",{value:p,onChange:e=>{return t=e.target.value,g(t),void u(1);var t},children:[(0,k.jsx)("option",{value:"recent",children:"Most Recent"}),(0,k.jsx)("option",{value:"popular",children:"Most Popular"}),(0,k.jsx)("option",{value:"trending",children:"Trending"})]})]}),(0,k.jsxs)("div",{className:"filter-group",children:[(0,k.jsx)("label",{children:"Show:"}),(0,k.jsxs)("select",{value:f,onChange:e=>{return t=e.target.value,v(t),void u(1);var t},children:[(0,k.jsx)("option",{value:"public",children:"Public Posts"}),(0,k.jsx)("option",{value:"all",children:"All Posts"})]})]}),(0,k.jsxs)("button",{className:"refresh-btn",onClick:N,disabled:r,children:["\ud83d\udd04 ",r?"Loading...":"Refresh"]})]})]}),(0,k.jsx)(Ge,{user:t,onPostCreated:e=>{i([e,...s])}}),(0,k.jsxs)("div",{className:"feed-content",children:[l&&(0,k.jsxs)("div",{className:"feed-error",children:[(0,k.jsx)("p",{children:l}),(0,k.jsx)("button",{onClick:N,children:"Try Again"})]}),0===s.length&&!r&&!l&&(0,k.jsxs)("div",{className:"feed-empty",children:[(0,k.jsx)("div",{className:"empty-icon",children:"\ud83d\udcdd"}),(0,k.jsx)("h3",{children:"No posts yet"}),(0,k.jsx)("p",{children:"Be the first to share something!"}),(0,k.jsxs)("div",{style:{marginTop:"20px"},children:[(0,k.jsx)("button",{onClick:async()=>{if(!r){o(!0),c("");try{const e=await fetch("http://localhost:5001/api/posts/seed",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.id,count:15})});(await e.json()).success?await x(!0):c("Failed to create sample posts")}catch(e){console.error("Error seeding posts:",e),c("Failed to create sample posts")}finally{o(!1)}}},className:"seed-posts-btn",style:{padding:"12px 24px",fontSize:"16px",backgroundColor:"#667eea",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},children:"Create Sample Posts"}),(0,k.jsx)("p",{style:{marginTop:"10px",fontSize:"14px",color:"#666"},children:"Click to populate your feed with sample content"})]})]}),s.map(e=>(0,k.jsx)(Ye,{post:e,currentUser:t,onPostDeleted:S,onPostUpdated:j},e.id)),r&&s.length>0&&(0,k.jsxs)("div",{className:"feed-loading",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("p",{children:"Loading more posts..."})]}),h&&!r&&(0,k.jsx)("div",{ref:b,className:"scroll-trigger"}),!h&&s.length>0&&(0,k.jsxs)("div",{className:"feed-end",children:[(0,k.jsx)("p",{children:"You've reached the end of your feed"}),(0,k.jsx)("button",{onClick:N,children:"Refresh Feed"})]})]})]})},$e=e=>{var t,s,i,r,o;let{user:l={id:"user1",name:"Current User",avatar:null},conversations:u=[],currentConversation:h=null,onLogout:m=()=>{},darkMode:p=!1,onToggleDarkMode:g=()=>{}}=e;const{user:f,updateUser:v,isAuthenticated:y}=C(),b=f||l;(0,a.useEffect)(()=>{b&&b.id&&(S.updateUserData(b),console.log("\ud83d\udcbe User data synced to persistent storage"))},[b]),(0,a.useEffect)(()=>{if(null===b||void 0===b||!b.id)return;Re.connect(b.id,b.name||b.username||"User"),ze.attachRealtime(Re);const e=Re.on("connect",()=>w(!0)),t=Re.on("disconnect",()=>w(!1)),n=Re.on("message",async e=>{let t=e.text;if(e.encrypted&&e.senderId)try{t=await Te.decryptFrom(e.text,String(e.senderId))}catch(n){console.warn("[E2E] Decryption failed for message from",e.senderId,"\u2014",n.message),t="\ud83d\udd12 [Encrypted message \u2014 could not decrypt]"}hn(n=>n.some(t=>t.id===e.id)?n:[...n,{id:e.id,text:t,user:{id:e.senderId,name:e.senderName},timestamp:e.timestamp,reactions:[],conversationId:e.conversationId}])}),a=Re.on("presence",e=>{D(t=>t.map(t=>{var n,a;return String(t.id)===String(e.userId)||null!==(n=t.participants)&&void 0!==n&&null!==(a=n.includes)&&void 0!==a&&a.call(n,e.userId)?c(c({},t),{},{isOnline:e.online}):t}))}),s=Re.on("typing",e=>{let{fromUsername:t}=e;Ca(t),clearTimeout(Ea.current),Ea.current=setTimeout(()=>Ca(null),3e3)});return()=>{e(),t(),n(),a(),s(),clearTimeout(Ea.current),Re.disconnect()}},[null===b||void 0===b?void 0:b.id]);const[x,w]=(0,a.useState)(!1),[j,N]=(0,a.useState)(()=>"undefined"!==typeof window&&window.innerWidth<=768),[E,D]=(0,a.useState)(()=>{const e=Ae.getAllConversations();return e.length>0?e:u.length>0?u:(Ae.initializeDefaultConversations(),Ae.getAllConversations())}),[A,M]=(0,a.useState)((null===(t=E[0])||void 0===t?void 0:t.id)||null),[q,B]=(0,a.useState)(""),[H,W]=(0,a.useState)("conversations"),[V,G]=(0,a.useState)(!1),[re,le]=(0,a.useState)("all"),[ue,he]=(0,a.useState)("recent"),[ge,fe]=(0,a.useState)(!0),[be,we]=(0,a.useState)(null),[Se,Ne]=(0,a.useState)({visible:!1,x:0,y:0,conversation:null}),[Ce,Ee]=(0,a.useState)(!1),[Me,Fe]=(0,a.useState)(new Set),[Le,qe]=(0,a.useState)(null),[Be,He]=(0,a.useState)(!1),[We,Ve]=(0,a.useState)(!1),[Ke,Ge]=(0,a.useState)(!1),[Je,Ye]=(0,a.useState)(!1),[$e,Xe]=(0,a.useState)(0),[Ze,et]=(0,a.useState)({open:!1,imageUrl:null,imageName:null,zoom:1,pan:{x:0,y:0},isDragging:!1,currentIndex:0,images:[],isLoading:!1}),[tt,nt]=(0,a.useState)({open:!1,videoUrl:null,videoName:null,poster:null,type:null}),[at,st]=(0,a.useState)(!1),[it,rt]=(0,a.useState)(!1),[ot,lt]=(0,a.useState)(!1),[ct,dt]=(0,a.useState)(!1),[ut,ht]=(0,a.useState)("photo"),[mt,pt]=(0,a.useState)(!1),[gt,ft]=(0,a.useState)(!1),[vt,yt]=(0,a.useState)(null),[bt,xt]=(0,a.useState)(!1),[wt,St]=(0,a.useState)(!1),[kt,jt]=(0,a.useState)(!1),[Nt,Ct]=(0,a.useState)(!1),[Et,Tt]=(0,a.useState)([]),[It,Pt]=(0,a.useState)(!1),[Dt,At]=(0,a.useState)(""),[Mt,Rt]=(0,a.useState)(null),[Ft,Lt]=(0,a.useState)(!1),[zt,Ot]=(0,a.useState)(new Map),[_t,Ut]=(0,a.useState)(!1),[qt,Bt]=(0,a.useState)(!1),[Ht,Wt]=(0,a.useState)(null),[Vt,Kt]=(0,a.useState)(!1),[Gt,Jt]=(0,a.useState)({enabled:!1}),[Yt,Qt]=(0,a.useState)(!0),[$t,Xt]=(0,a.useState)({isUploading:!1,fileName:"",progress:0,fileSize:0,uploadedSize:0}),[Zt,en]=(0,a.useState)(null),[tn,nn]=(0,a.useState)(null),an=(0,a.useRef)(null),sn=(0,a.useRef)(null),rn=(0,a.useRef)(null),on=(0,a.useRef)(null),ln=(0,a.useRef)(null),cn=(0,a.useRef)(null),dn=(0,a.useRef)(null);(0,a.useLayoutEffect)(()=>{const e="quibish-layout-fix";let t=document.getElementById(e);t||(t=document.createElement("style"),t.id=e,document.head.appendChild(t)),t.textContent=["@media screen and (max-width: 768px) {","  html body .pro-layout { height: 100vh !important; height: 100dvh !important; display: flex !important; flex-direction: column !important; overflow: hidden !important; padding: 0 !important; gap: 0 !important; }","  html body .pro-main { flex: 1 1 0% !important; min-height: 0 !important; height: auto !important; max-height: none !important; display: flex !important; flex-direction: column !important; overflow: hidden !important; padding: 0 !important; margin: 0 !important; gap: 0 !important; }","  html body .pro-main .enhanced-chat-header, html body .pro-main .pro-header { flex: 0 0 auto !important; position: relative !important; top: auto !important; height: auto !important; min-height: calc(env(safe-area-inset-top, 0px) + 56px) !important; max-height: none !important; padding: calc(env(safe-area-inset-top, 0px) + 8px) 12px 8px !important; margin: 0 !important; border-radius: 0 !important; box-shadow: none !important; background: #ffffff !important; }","  html body .pro-main .pro-content { flex: 1 1 0% !important; min-height: 0 !important; height: auto !important; max-height: none !important; display: flex !important; flex-direction: column !important; overflow: hidden !important; padding: 0 !important; margin: 0 !important; border-radius: 0 !important; box-shadow: none !important; border: none !important; backdrop-filter: none !important; background: #f5f5f5 !important; gap: 0 !important; }","  html body .pro-main .pro-message-list { flex: 1 1 0% !important; min-height: 0 !important; height: 0 !important; max-height: none !important; overflow-y: auto !important; overflow-x: hidden !important; padding: 12px 16px 20px !important; box-sizing: border-box !important; margin: 0 !important; border-radius: 0 !important; background: #f5f5f5 !important; }","  html body .pro-main .pro-chat-input-container { flex: 0 0 auto !important; position: relative !important; bottom: auto !important; left: auto !important; right: auto !important; margin: 0 !important; padding-bottom: max(8px, env(safe-area-inset-bottom, 0px)) !important; }","}"].join("\n")},[]);const[un,hn]=(0,a.useState)([]),[mn,pn]=(0,a.useState)(!0),[gn,fn]=(0,a.useState)(null),[vn,yn]=(0,a.useState)(null),[bn,xn]=(0,a.useState)(!1),wn=A&&E.find(e=>e.id===A)||null;(0,a.useEffect)(()=>{(async()=>{try{pn(!0),fn(null);try{const e=await Te.initializeEncryption(b.id);if(Kt(e),e){const e=Te.getEncryptionStatus();Jt(e),console.log("\ud83d\udd12 Encryption initialized for ProChat")}}catch(e){console.warn("\u26a0\ufe0f Encryption initialization failed:",e),Kt(!1)}const t=await Te.getMessages({limit:50});Array.isArray(t)?hn(t):(console.warn("Invalid messages format received:",t),hn([]))}catch(t){console.error("Failed to load messages:",t),fn("Failed to load messages");try{const e=S.getMessages();Array.isArray(e)&&e.length>0&&(hn(e),console.log("\ud83d\udcf1 Loaded messages from persistent storage"))}catch(n){console.error("\u274c Failed to load from persistent storage:",n)}}finally{pn(!1)}})()},[b.id]);const Sn=(0,a.useCallback)(()=>{ln.current&&ln.current.scrollIntoView({behavior:"smooth",block:"end"})},[]);(0,a.useEffect)(()=>{Sn()},[un,Sn]),(0,a.useEffect)(()=>{const e=()=>{Qa(Pe.getConnectionStatus())};e();const t=setInterval(e,1e4);return()=>clearInterval(t)},[]),(0,a.useEffect)(()=>(null!==b&&void 0!==b&&b.id&&(async()=>{try{if(console.log("\ud83d\udd14 Initializing notification system..."),await ce.initialize(b.id)){console.log("\u2705 Push notification service initialized"),ce.setupPresenceDetection();try{await fetch(oe("/notifications/presence"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify({userId:b.id,isOnline:!0,lastSeen:(new Date).toISOString()})}),console.log("\u2705 User presence set to online")}catch(e){console.warn("\u26a0\ufe0f Failed to update presence:",e)}}}catch(t){console.error("\u274c Failed to initialize notifications:",t)}})(),()=>{null!==b&&void 0!==b&&b.id&&fetch(oe("/notifications/presence"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify({userId:b.id,isOnline:!1,lastSeen:(new Date).toISOString()})}).catch(e=>{console.warn("\u26a0\ufe0f Failed to update offline presence:",e)})}),[null===b||void 0===b?void 0:b.id]),(0,a.useEffect)(()=>{(async()=>{try{console.log("\ud83d\udd0d Initializing search index...");const t=S.getMessages();if(await Y.buildSearchIndex(t),console.log("\u2705 Search index built successfully"),"serviceWorker"in navigator&&navigator.serviceWorker.controller)try{navigator.serviceWorker.controller.postMessage({type:"INDEX_MESSAGES"})}catch(e){console.warn("SW message failed:",e)}}catch(e){console.error("\u274c Failed to initialize search index:",e)}})()},[]),(0,a.useEffect)(()=>{(()=>{try{const e=new URLSearchParams(window.location.search),t=e.get("action"),n=e.get("conversation"),a=e.get("message");if("reply"===t&&n){console.log("\ud83d\udcec Opening conversation from notification:",n);E.find(e=>e.id===n)?(M(n),window.innerWidth<=768&&N(!1),setTimeout(()=>{const e=document.querySelector(".pro-message-input");e&&(e.focus(),e.scrollIntoView({behavior:"smooth",block:"center"}),console.log("\u2705 Quick reply ready - input focused"))},500),a&&setTimeout(()=>{const e=document.getElementById("message-".concat(a));e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),console.log("\u2705 Scrolled to message:",a))},700)):console.warn("\u26a0\ufe0f Conversation not found:",n);const e=window.location.pathname;window.history.replaceState({},document.title,e)}else if(n&&!t){console.log("\ud83d\udcac Opening conversation:",n);E.find(e=>e.id===n)&&(M(n),window.innerWidth<=768&&N(!1));const e=window.location.pathname;window.history.replaceState({},document.title,e)}}catch(e){console.error("\u274c Error handling notification action:",e)}})();const e=e=>{if(e.data&&"NOTIFICATION_CLICK"===e.data.type){const{action:t,conversationId:n,messageId:a}=e.data;if("reply"===t&&n){E.find(e=>e.id===n)&&(M(n),setTimeout(()=>{const e=document.querySelector(".pro-message-input");e&&e.focus()},300))}else n&&M(n)}};if("serviceWorker"in navigator)return navigator.serviceWorker.addEventListener("message",e),()=>{navigator.serviceWorker.removeEventListener("message",e)}},[E]),(0,a.useEffect)(()=>{const e=e=>{(e.ctrlKey||e.metaKey)&&"f"===e.key&&(e.preventDefault(),ft(!0)),"Escape"===e.key&&(gt?ft(!1):it&&rt(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[gt,it]),(0,a.useEffect)(()=>{const e=()=>{window.innerWidth<=768?N(!0):window.innerWidth>768&&N(!1)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,a.useEffect)(()=>{if(window.innerWidth<=480&&(Be||bn)){document.body.classList.add("emoji-picker-open");const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.classList.remove("emoji-picker-open"),document.body.style.overflow=e}}},[Be,bn]);const kn=(0,a.useCallback)(()=>{N(e=>!e)},[]),jn=(0,a.useCallback)(e=>{window.innerWidth<=768&&(nn(null),en(e.targetTouches[0].clientX))},[]),Nn=(0,a.useCallback)(e=>{window.innerWidth<=768&&nn(e.targetTouches[0].clientX)},[]),Cn=(0,a.useCallback)(()=>{if(!Zt||!tn)return;const e=Zt-tn,t=e>50,n=e<-50;window.innerWidth<=768&&(t&&!j?N(!0):n&&j&&N(!1)),en(null),nn(null)},[Zt,tn,j]),En=(0,a.useCallback)(()=>{window.innerWidth<=480&&N(!0)},[]),Tn=(0,a.useCallback)(async e=>{if(!e)return void console.warn("Invalid conversation ID provided");const t=E.find(t=>t.id===e);if(!t)return console.warn("Conversation not found:",e),void fn("Conversation not found");M(e);try{pn(!0),fn(null),console.log("Loading messages for conversation:",t.name,e);const n=await je.getMessages({conversationId:e,limit:50});Array.isArray(n)?(hn(n),console.log("Loaded conversation messages:",n.length),t.unreadCount>0&&console.log("Marked conversation as read:",t.name),setTimeout(()=>{Sn()},100)):(console.warn("Invalid conversation messages format received:",n),hn([]))}catch(n){console.error("Failed to load conversation messages:",n),fn("Failed to load conversation messages");try{const t=je.loadMessagesFromStorage(e);Array.isArray(t)&&t.length>0?(hn(t),console.log("Loaded conversation messages from cache")):hn([])}catch(a){console.error("Error loading conversation messages from storage:",a),hn([])}}finally{pn(!1),window.innerWidth<=768&&N(!0)}},[E,je,Sn]),In=(0,a.useCallback)(e=>{try{var t;const n=(null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value)||"";B(n)}catch(n){console.error("Error handling search change:",n),B("")}},[]),Pn=((0,a.useCallback)(()=>{const e="conversations"===H?"users":"conversations";W(e),B(""),"users"===e&&G(!0)},[H]),(0,a.useCallback)(()=>{W("users"),G(!0),window.innerWidth<=768&&N(!0)},[])),Dn=(0,a.useCallback)(async e=>{console.log("User selected for chat:",e);try{const t=Ae.createConversationWithUser(e,b.id);if(t.success){const n=Ae.getAllConversations();return D(n),M(t.conversation.id),G(!1),t.isNew?console.log("\u2705 Started new chat with ".concat(e.name||e.username)):console.log("\u2705 Opened existing chat with ".concat(e.name||e.username)),setTimeout(()=>{const e=document.querySelector(".pro-chat-container");e&&(e.scrollTop=0)},100),Promise.resolve(t)}return console.error("Failed to create conversation:",t.error),Promise.reject(new Error("Failed to start chat. Please try again."))}catch(t){return console.error("Error creating conversation:",t),Promise.reject(t)}},[b.id]);(0,a.useEffect)(()=>(Ae.subscribe(e=>{D(e)}),()=>{Ae.subscribe(null)}),[]),(0,a.useEffect)(()=>{E.length>0&&(Ae.conversations=E,Ae.saveConversationsToStorage())},[E]);(0,a.useCallback)((e,t)=>{we(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.id),e.currentTarget.classList.add("dragging")},[]),(0,a.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),(0,a.useCallback)((e,t)=>{if(e.preventDefault(),!be||be.id===t.id)return;const n=E.findIndex(e=>e.id===be.id),a=E.findIndex(e=>e.id===t.id),s=[...E];s.splice(n,1),s.splice(a,0,be),D(s),we(null),he("custom")},[be,E]),(0,a.useCallback)(e=>{e.currentTarget.classList.remove("dragging"),we(null)},[]),(0,a.useCallback)((e,t)=>{e.preventDefault(),Ne({visible:!0,x:e.clientX,y:e.clientY,conversation:t})},[]);const An=(0,a.useCallback)(()=>{Ne({visible:!1,x:0,y:0,conversation:null})},[]),Mn=(0,a.useCallback)(e=>{D(t=>t.map(t=>t.id===e?c(c({},t),{},{isPinned:!t.isPinned}):t)),An()},[An]),Rn=(0,a.useCallback)(e=>{D(t=>t.map(t=>t.id===e?c(c({},t),{},{isMuted:!t.isMuted}):t)),An()},[An]),Fn=((0,a.useCallback)(e=>{D(t=>t.map(t=>t.id===e?c(c({},t),{},{isArchived:!t.isArchived}):t)),An()},[An]),(0,a.useCallback)(e=>{var t;window.confirm("Are you sure you want to delete this conversation?")&&(D(t=>t.filter(t=>t.id!==e)),A===e&&M((null===(t=E[0])||void 0===t?void 0:t.id)||null));An()},[A,E,An]));(0,a.useCallback)(e=>{D(t=>t.map(t=>t.id===e?c(c({},t),{},{unreadCount:0}):t)),An()},[An]),(0,a.useCallback)(()=>{Ee(e=>!e),Fe(new Set)},[]),(0,a.useCallback)(e=>{Fe(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},[]),(0,a.useCallback)(()=>{D(e=>e.map(e=>Me.has(e.id)?c(c({},e),{},{unreadCount:0}):e)),Fe(new Set),Ee(!1)},[Me]),(0,a.useCallback)(()=>{D(e=>e.map(e=>Me.has(e.id)?c(c({},e),{},{isArchived:!0}):e)),Fe(new Set),Ee(!1)},[Me]),(0,a.useCallback)(()=>{window.confirm("Delete ".concat(Me.size," conversations?"))&&(D(e=>e.filter(e=>!Me.has(e.id))),Fe(new Set),Ee(!1))},[Me]);(0,a.useEffect)(()=>{if(Se.visible){const e=()=>An();return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}},[Se.visible,An]);const Ln=(0,a.useCallback)(e=>{le(e),window.innerWidth<=768&&N(!0)},[]),zn=(0,a.useCallback)(()=>{La(!0),window.innerWidth<=768&&N(!0)},[]),On=((0,a.useCallback)(()=>{La(!0),console.log("Create group clicked - opening new chat modal")},[]),(0,a.useCallback)(async e=>{try{var t,n,a,s;console.log("New chat created:",e);const i={id:e.id||"conv_".concat(Date.now()),name:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e||null===(t=e.participants)||void 0===t||null===(n=t.find(e=>(null===e||void 0===e?void 0:e.id)!==(null===b||void 0===b?void 0:b.id)))||void 0===n?void 0:n.name)||"New Chat",type:e.type,participants:e.participants,lastMessage:{text:"Chat created",timestamp:e.createdAt||(new Date).toISOString(),user:{name:"System"}},unreadCount:0,isOnline:!0,avatar:"group"===e.type?null:null===e||void 0===e||null===(a=e.participants)||void 0===a||null===(s=a.find(e=>(null===e||void 0===e?void 0:e.id)!==(null===b||void 0===b?void 0:b.id)))||void 0===s?void 0:s.avatar};console.log("Formatted conversation:",i),M(i.id)}catch(i){throw console.error("Failed to handle new chat:",i),i}},[b])),_n=(0,a.useCallback)(()=>{console.log("\u2699\ufe0f Settings button clicked!"),Ra({open:!0,section:"general"}),console.log("\u2705 Settings modal state set to open"),window.innerWidth<=1024&&N(!0)},[]),Un=(0,a.useCallback)(async e=>{const t=e.target.files;if(t&&t.length>0){for(const e of Array.from(t))if(console.log("Processing file:",e.name,e.type),e.type.startsWith("image/"))try{const t=(await Promise.resolve().then(n.bind(n,308))).default,a=await t.optimizeChatImage(e),s=(100*(1-a.size/e.size)).toFixed(1);console.log("\ud83d\udcf8 Image optimized: ".concat((e.size/1024).toFixed(0),"KB \u2192 ").concat((a.size/1024).toFixed(0),"KB (").concat(s,"% smaller)"));const i=new FileReader;i.onload=t=>{console.log("Optimized image loaded, creating message");const n={id:Date.now()+Math.random(),text:"\ud83d\udcf8 ".concat(e.name," (optimized)"),user:b,timestamp:(new Date).toISOString(),reactions:[],file:{name:e.name,size:a.size,originalSize:e.size,type:e.type,url:t.target.result,optimized:!0}};hn(e=>[...e,n]),setTimeout(()=>{Sn()},100)},i.onerror=e=>{console.error("Error reading optimized file:",e)},i.readAsDataURL(a)}catch(a){console.warn("Image optimization failed, using original:",a);const t=new FileReader;t.onload=t=>{const n={id:Date.now()+Math.random(),text:"\ud83d\udcf7 ".concat(e.name),user:b,timestamp:(new Date).toISOString(),reactions:[],file:{name:e.name,size:e.size,type:e.type,url:t.target.result}};hn(e=>[...e,n]),setTimeout(()=>Sn(),100)},t.readAsDataURL(e)}else{const t={id:Date.now()+Math.random(),text:"\ud83d\udcce ".concat(e.name," (").concat((e.size/1024).toFixed(1)," KB)"),user:b,timestamp:(new Date).toISOString(),reactions:[],file:{name:e.name,size:e.size,type:e.type,url:URL.createObjectURL(e)}};hn(e=>[...e,t]),setTimeout(()=>{Sn()},100)}e.target.value=""}},[b,Sn]),qn=(0,a.useCallback)(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),[]),Bn=(0,a.useCallback)(()=>{st(!0)},[]),Hn=(0,a.useCallback)(()=>{const e=document.createElement("input");e.type="file",e.accept="image/gif",e.multiple=!0,e.onchange=e=>{Un(e)},e.click()},[Un]),Wn=(0,a.useCallback)(e=>{const t={id:Date.now()+Math.random(),text:"\ud83c\udfad ".concat(e.name),user:b,timestamp:(new Date).toISOString(),reactions:[],file:{name:e.name||"selected.gif",size:e.size||0,type:"image/gif",url:e.url,isGif:!0}};hn(e=>[...e,t]),st(!1),setTimeout(()=>{Sn()},100)},[b,hn,Sn]),Vn=(0,a.useCallback)(()=>{st(!1)},[]),Kn=(0,a.useCallback)(()=>{},[]),Gn=(0,a.useCallback)(function(){ht(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"photo"),lt(!0)},[]),Jn=(0,a.useCallback)(()=>{lt(!1)},[]),Yn=(0,a.useCallback)(async(e,t,n)=>{try{const a=new File([e],"".concat(t,"-").concat(Date.now(),".").concat("photo"===t?"jpg":"mp4"),{type:e.type});await Un({target:{files:[a]}}),lt(!1),as({text:"\ud83d\udcf8 ".concat("photo"===t?"Photo":"Video"," captured from camera"),type:"system",metadata:n})}catch(a){console.error("Failed to handle camera capture:",a),as({text:"\u274c Failed to upload captured media",type:"system"})}},[]),Qn=(0,a.useCallback)(()=>{dt(!0)},[]),$n=(0,a.useCallback)(()=>{dt(!1)},[]),Xn=(0,a.useCallback)(e=>{try{const t=e.map(e=>{const t=[];return e.name&&t.push(e.name),e.phone&&t.push("\ud83d\udcf1 ".concat(e.phone)),e.email&&t.push("\ud83d\udce7 ".concat(e.email)),t.join("\n")}).join("\n\n");as({text:"\ud83d\udc65 Shared Contact".concat(e.length>1?"s":"",":\n\n").concat(t),type:"contact",metadata:{contacts:e,shared:!0}}),dt(!1)}catch(t){console.error("Failed to share contacts:",t),as({text:"\u274c Failed to share contacts",type:"system"})}},[]),Zn=(0,a.useCallback)(()=>{Ve(!0)},[]),ea=(0,a.useCallback)(()=>{rt(e=>!e)},[]),ta=(0,a.useCallback)(()=>{const e={conversation:(null===wn||void 0===wn?void 0:wn.name)||"Chat Export",messages:un,exportDate:(new Date).toISOString(),totalMessages:un.length},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(n),a.download="chat-export-".concat((new Date).toISOString().split("T")[0],".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),rt(!1);const s={id:"export_".concat(Date.now()),text:"\ud83d\udce5 Chat exported successfully",user:"System",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),type:"system",isSystemMessage:!0};hn(e=>[...e,s])},[un,wn]),na=(0,a.useCallback)(()=>{const e=!("true"===localStorage.getItem("notificationsMuted"));localStorage.setItem("notificationsMuted",e.toString()),rt(!1);const t={id:"mute_".concat(Date.now()),text:"\ud83d\udd14 Notifications ".concat(e?"muted":"unmuted"),user:"System",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),type:"system",isSystemMessage:!0};hn(e=>[...e,t])},[]),aa=(0,a.useCallback)(()=>{if(window.confirm("Are you sure you want to clear this chat? This action cannot be undone.")){hn([]),rt(!1);const e={id:"clear_".concat(Date.now()),text:"\ud83e\uddf9 Chat cleared",user:"System",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),type:"system",isSystemMessage:!0};hn([e])}},[]),sa=(0,a.useCallback)(()=>{pt(!0),rt(!1),window.innerWidth<=768&&N(!0),document.body.classList.add("contact-manager-open")},[]),ia=(0,a.useCallback)(async e=>{try{const t={id:"contact_chat_".concat(Date.now()),text:"\ud83d\udcac Starting chat with ".concat(e.name),user:"System",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),type:"system",isSystemMessage:!0,contactId:e.id};hn(e=>[...e,t]),pt(!1),await R.updateContactInteraction(e.id,"chat_started")}catch(t){console.error("Error starting chat with contact:",t)}},[]),ra=(0,a.useCallback)(async e=>{try{if(e.phoneNumbers&&e.phoneNumbers.length>0){const t=e.phoneNumbers[0],n={id:"contact_call_".concat(Date.now()),text:"\ud83d\udcde Calling ".concat(e.name," at ").concat(t.number),user:"System",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),type:"system",isSystemMessage:!0,contactId:e.id};hn(e=>[...e,n]),await R.updateContactInteraction(e.id,"call_made"),pt(!1)}else alert("No phone number available for this contact")}catch(t){console.error("Error calling contact:",t)}},[]),oa=(0,a.useCallback)(()=>{ft(!0),rt(!1)},[]),la=(0,a.useCallback)(e=>{console.log("Search result selected:",e),e.conversationId&&e.conversationId!==A&&M(e.conversationId),yt(e.messageId),setTimeout(()=>{const t=document.getElementById("message-".concat(e.messageId));t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{yt(null)},3e3))},300)},[A]),ca=(0,a.useCallback)(()=>{un.map(e=>"[".concat(e.timestamp,"] ").concat(e.user,": ").concat(e.text)).join("\n");const e=window.open("","_blank");e.document.write("\n      <html>\n        <head>\n          <title>Chat Print - ".concat((null===wn||void 0===wn?void 0:wn.name)||"Chat",'</title>\n          <style>\n            body { font-family: Arial, sans-serif; margin: 20px; }\n            .header { border-bottom: 2px solid #ccc; margin-bottom: 20px; padding-bottom: 10px; }\n            .message { margin-bottom: 10px; padding: 8px; border-left: 3px solid #007bff; }\n            .timestamp { color: #666; font-size: 0.9em; }\n            .user { font-weight: bold; color: #333; }\n            .text { margin-top: 5px; }\n          </style>\n        </head>\n        <body>\n          <div class="header">\n            <h1>Chat: ').concat((null===wn||void 0===wn?void 0:wn.name)||"Conversation","</h1>\n            <p>Exported on: ").concat((new Date).toLocaleString(),"</p>\n            <p>Total Messages: ").concat(un.length,'</p>\n          </div>\n          <div class="messages">\n            ').concat(un.map(e=>'\n              <div class="message">\n                <div class="timestamp">'.concat(e.timestamp,'</div>\n                <div class="user">').concat(e.user,'</div>\n                <div class="text">').concat(e.text,"</div>\n              </div>\n            ")).join(""),"\n          </div>\n        </body>\n      </html>\n    ")),e.document.close(),e.print(),rt(!1)},[un,wn]);(0,a.useEffect)(()=>{const e=e=>{!it||e.target.closest(".header-menu")||e.target.classList.contains("menu-btn")||e.target.classList.contains("action-btn")||(console.log("Closing menu due to outside click"),rt(!1))},t=setTimeout(()=>{document.addEventListener("click",e)},100);return()=>{clearTimeout(t),document.removeEventListener("click",e)}},[it]);const da=(0,a.useCallback)(async(e,t)=>{hn(n=>n.map(n=>{if(n.id===e){var a;const e=null===n||void 0===n||null===(a=n.reactions)||void 0===a?void 0:a.find(e=>(null===e||void 0===e?void 0:e.emoji)===t);return c(c({},n),{},e?{reactions:n.reactions.map(e=>e.emoji===t?c(c({},e),{},{count:e.count+1}):e)}:{reactions:[...n.reactions,{emoji:t,count:1,userId:b.id}]})}return n}));try{je.addReaction&&await je.addReaction(e,t)}catch(n){console.error("Failed to sync reaction with backend:",n)}},[b.id]),ua=(0,a.useCallback)(e=>{vn?da(vn,e):ja(t=>t+e),He(!1),xn(!1),yn(null)},[vn,da]),ha=(0,a.useCallback)(e=>{yn(e),xn(!0),He(!1)},[]),ma=(0,a.useCallback)(e=>{const t=Math.floor(e/1e3),n=Math.floor(t/60),a=t%60;return"".concat(n,":").concat(a.toString().padStart(2,"0"))},[]),pa=(0,a.useCallback)(e=>{Ge(!0),He(!1),console.log("Enhanced voice recording started",e)},[]),ga=(0,a.useCallback)(e=>{if(Ge(!1),e&&e.audioBlob&&e.duration>1e3){const t=URL.createObjectURL(e.audioBlob),n={id:Date.now(),text:"\ud83c\udfa4 Voice message (".concat(ma(e.duration),")"),user:b,timestamp:(new Date).toISOString(),reactions:[],type:"voice",duration:e.duration,audioUrl:t,audioBlob:e.audioBlob,mimeType:e.mimeType};hn(e=>[...e,n]),setTimeout(()=>{Sn()},100),console.log("Voice message sent:",e)}},[ma,b,Sn]),fa=(0,a.useCallback)(()=>{Ge(!1),console.log("Voice recording cancelled")},[]);(0,a.useCallback)(()=>{console.log("startRecording called - handled by VoiceRecorder component")},[]),(0,a.useCallback)(function(){console.log("stopRecording called - handled by VoiceRecorder component")},[]);(0,a.useEffect)(()=>()=>{},[]);const va=(0,a.useMemo)(()=>{if(!Array.isArray(E))return console.warn("Conversations is not an array:",E),[];let e=E.filter(e=>!!(e&&"object"===typeof e&&e.id&&e.name)&&(!e.isArchived||"archived"===re));if(null!==q&&void 0!==q&&q.trim()){const t=q.toLowerCase().trim();e=e.filter(e=>{var n,a;const s=(null===(n=e.name)||void 0===n?void 0:n.toLowerCase())||"",i=(null===(a=e.lastMessage)||void 0===a?void 0:a.toLowerCase())||"";return s.includes(t)||i.includes(t)})}try{switch(re){case"unread":e=e.filter(e=>(e.unreadCount||0)>0);break;case"groups":e=e.filter(e=>{const t=e.name||"";return t.includes("Team")||t.includes("Group")});break;case"archived":e=e.filter(e=>!0===e.isArchived)}}catch(t){console.error("Error applying conversation filter:",t)}try{switch(ue){case"unread":e.sort((e,t)=>(t.unreadCount||0)-(e.unreadCount||0));break;case"alphabetical":e.sort((e,t)=>(e.name||"").localeCompare(t.name||""));break;case"recent":e.sort((e,t)=>{const n=new Date(e.lastMessageTime||0).getTime();return new Date(t.lastMessageTime||0).getTime()-n})}e.sort((e,t)=>e.isPinned&&!t.isPinned?-1:!e.isPinned&&t.isPinned?1:0)}catch(t){console.error("Error sorting conversations:",t)}return e},[E,q,re,ue]);(0,a.useMemo)(()=>{if(!ge)return{"All Conversations":va};const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),n=new Date(t);n.setDate(n.getDate()-1);const a=new Date(t);a.setDate(a.getDate()-7);const s=new Date(t);s.setMonth(s.getMonth()-1);const i={Today:[],Yesterday:[],"This Week":[],"This Month":[],Older:[]};return va.forEach(e=>{const r=new Date(e.lastMessageTime||0),o=new Date(r.getFullYear(),r.getMonth(),r.getDate());o.getTime()===t.getTime()?i.Today.push(e):o.getTime()===n.getTime()?i.Yesterday.push(e):o>=a?i["This Week"].push(e):o>=s?i["This Month"].push(e):i.Older.push(e)}),Object.keys(i).forEach(e=>{0===i[e].length&&delete i[e]}),i},[va,ge]);(0,a.useEffect)(()=>{const e=e=>{if(j||"INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName)return;const t=va.findIndex(e=>e.id===A);switch(e.key){case"ArrowUp":e.preventDefault(),t>0&&Tn(va[t-1].id);break;case"ArrowDown":e.preventDefault(),t<va.length-1&&Tn(va[t+1].id);break;case"Delete":A&&e.shiftKey&&Fn(A);break;case"p":A&&e.ctrlKey&&(e.preventDefault(),Mn(A));break;case"m":A&&e.ctrlKey&&(e.preventDefault(),Rn(A))}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[A,va,j,Tn,Fn,Mn,Rn]);const ya=(0,a.useCallback)(e=>{switch(e.type){case"message":e.data.conversationId&&Tn(e.data.conversationId);break;case"friend_request":console.log("Friend request notification clicked:",e);break;case"video_call":case"voice_call":console.log("Call notification clicked:",e);break;default:console.log("Notification clicked:",e)}},[Tn]),ba=(0,a.useCallback)(()=>{Ye(!0)},[]),xa=(0,a.useCallback)(()=>{Ye(!1)},[]);(0,a.useEffect)(()=>{const e=ze.addEventListener((e,t)=>{switch(e){case"newNotification":"message"===t.type&&ze.showBrowserNotification(t);break;case"unreadCountUpdated":Xe(t)}});return ze.getUnreadCount().then(e=>{Xe(e)}),e},[]);const wa=(0,a.useMemo)(()=>{if(!Array.isArray(E))return{all:0,unread:0,groups:0};try{return{all:E.length,unread:E.filter(e=>e&&(e.unreadCount||0)>0).length,groups:E.filter(e=>{const t=(null===e||void 0===e?void 0:e.name)||"";return t.includes("Team")||t.includes("Group")}).length}}catch(e){return console.error("Error calculating filter counts:",e),{all:E.length,unread:0,groups:0}}},[E]),Sa=(0,a.useMemo)(()=>E.reduce((e,t)=>e+t.unreadCount,0),[E]),[ka,ja]=(0,a.useState)(""),[Na,Ca]=(0,a.useState)(null),Ea=a.useRef(null),Ta=a.useRef(0),[Ia,Pa]=(0,a.useState)(!1),[Da,Aa]=(0,a.useState)({open:!1,userId:null,username:null}),[Ma,Ra]=(0,a.useState)({open:!1,section:"profile"}),[Fa,La]=(0,a.useState)(!1),[za,Oa]=(0,a.useState)(!1),[_a,Ua]=(0,a.useState)(!1),[qa,Ba]=(0,a.useState)(!1),[Ha,Wa]=(0,a.useState)(!1),[Va,Ka]=(0,a.useState)({active:!1,withUser:null,minimized:!1,audioOnly:!1}),[Ga,Ja]=(0,a.useState)({active:!1,withUser:null,minimized:!1,audioOnly:!0}),[Ya,Qa]=(0,a.useState)(null),[$a,Xa]=(0,a.useState)([]),[Za,es]=(0,a.useState)(!1),ts=(0,a.useRef)(null),ns=(0,a.useRef)(null);(0,a.useEffect)(()=>{const e=Re.on("call-offer",async e=>{if(window.confirm("\ud83d\udcde Incoming ".concat(e.audioOnly?"voice":"video"," call from ").concat(e.fromUsername||"Someone",". Accept?")))try{const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});ts.current=t;const n=await navigator.mediaDevices.getUserMedia({audio:!0,video:!e.audioOnly}).catch(()=>null);n&&(ns.current=n,n.getTracks().forEach(e=>t.addTrack(e,n))),t.onicecandidate=t=>{t.candidate&&Re.sendSignal("ice-candidate",e.fromUserId,{candidate:t.candidate})},await t.setRemoteDescription(new RTCSessionDescription(e.offer));const a=await t.createAnswer();await t.setLocalDescription(a),Re.sendSignal("call-answer",e.fromUserId,{answer:a}),Ka({active:!0,withUser:{id:e.fromUserId,name:e.fromUsername},minimized:!1,audioOnly:!!e.audioOnly})}catch(t){console.error("Failed to handle incoming call:",t)}else Re.sendSignal("call-reject",e.fromUserId)}),t=Re.on("call-answer",async e=>{ts.current&&await ts.current.setRemoteDescription(new RTCSessionDescription(e.answer)).catch(console.error)}),n=Re.on("ice-candidate",async e=>{ts.current&&e.candidate&&await ts.current.addIceCandidate(new RTCIceCandidate(e.candidate)).catch(console.error)}),a=Re.on("call-end",()=>{ts.current&&(ts.current.close(),ts.current=null),ns.current&&(ns.current.getTracks().forEach(e=>e.stop()),ns.current=null),Ka({active:!1,withUser:null,minimized:!1,audioOnly:!1}),Ja({active:!1,withUser:null,minimized:!1,audioOnly:!0})});return()=>{e(),t(),n(),a()}},[]);const as=(0,a.useCallback)(async()=>{if(ka.trim())try{const n=(null===wn||void 0===wn?void 0:wn.participants)||[],a=n.find(e=>String(e)!==String(null===b||void 0===b?void 0:b.id))||null;let s=ka.trim(),i=!1;if(Vt&&a)try{s=await Te.encryptFor(ka.trim(),String(a)),i=!0}catch(e){console.warn("[E2E] Could not encrypt \u2014 sending plaintext. Reason:",e.message)}Re.sendMessage({text:s,conversationId:A,recipientId:a,encrypted:i});const r={text:ka.trim(),conversationId:A,user:(null===b||void 0===b?void 0:b.name)||"User"},o=await Te.sendMessage(r,{encrypt:Yt&&Vt,recipientId:a,conversationParticipants:n}),l={id:o.id||Date.now(),text:ka.trim(),user:b,timestamp:o.timestamp||(new Date).toISOString(),reactions:o.reactions||[],conversationId:A,isEncrypted:o.isEncrypted||!1,encryptionStatus:o.encryptionStatus};if(hn(e=>[...e,l]),ja(""),await Y.indexMessage(l),"serviceWorker"in navigator&&navigator.serviceWorker.controller)try{navigator.serviceWorker.controller.postMessage({type:"INDEX_NEW_MESSAGE",message:l})}catch(t){console.warn("SW message indexing failed:",t)}setTimeout(()=>{Sn()},100)}catch(t){console.error("Failed to send message:",t);const e={id:Date.now(),text:ka.trim(),user:b,timestamp:(new Date).toISOString(),reactions:[],pending:!0,conversationId:A};hn(t=>[...t,e]),ja(""),setTimeout(()=>{Sn()},100),console.warn("Message sent offline, will sync when connection is restored")}},[ka,b,A,Sn,wn,Yt,Vt]),ss=(0,a.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),as())},[as]),is=(0,a.useCallback)(e=>{ja(e),Ct(!1)},[]),rs=(0,a.useCallback)(()=>{ka.trim()&&(At(ka),Pt(!0))},[ka]),os=(0,a.useCallback)(e=>{ja(e),Pt(!1)},[]);(0,a.useEffect)(()=>{(async()=>{if(un.length>0){var e;const n=un[un.length-1];if((null===(e=n.user)||void 0===e?void 0:e.id)===b.id)return void Ct(!1);try{const e=await $.generateSmartReplies(n.text,{conversationHistory:un.slice(-5).map(e=>e.text),userName:b.name});Tt(e),Ct(e.length>0)}catch(t){console.error("Failed to generate smart replies:",t),Tt([]),Ct(!1)}}})()},[un,b]),(0,a.useEffect)(()=>{if(te.onThreadCreated=e=>{Ot(t=>new Map(t).set(e.id,e))},te.onReplyAdded=e=>{const t=te.getThread(e);t&&Ot(n=>new Map(n).set(e,t))},te.onThreadUpdated=e=>{Ot(t=>new Map(t).set(e.id,e))},te.onThreadDeleted=e=>{Ot(t=>{const n=new Map(t);return n.delete(e),n}),(null===Mt||void 0===Mt?void 0:Mt.id)===e&&(Rt(null),Lt(!1))},A){const e=te.getThreadsForConversation(A),t=new Map;e.forEach(e=>t.set(e.id,e)),Ot(t)}return()=>{te.onThreadCreated=null,te.onReplyAdded=null,te.onThreadUpdated=null,te.onThreadDeleted=null}},[A,Mt]);const ls=(0,a.useCallback)(e=>{try{const t=te.createThread(e,A);Rt(t),Lt(!0),console.log("Thread created:",t)}catch(t){console.error("Failed to create thread:",t),alert("Failed to create thread. Please try again.")}},[A]),cs=(0,a.useCallback)(e=>{const t=te.getThread(e);t&&(Rt(t),Lt(!0))},[]),ds=(0,a.useCallback)(()=>{Rt(null),Lt(!1)},[]),us=(0,a.useCallback)((e,t)=>{try{te.addReply(e,t),console.log("Reply added to thread:",e)}catch(n){console.error("Failed to add reply:",n),alert("Failed to add reply. Please try again.")}},[]),hs=(0,a.useCallback)(e=>Array.from(zt.values()).find(t=>t.parentMessage.id===e),[zt]),ms=(0,a.useCallback)((e,t)=>{console.log("\ud83c\udfaf Profile button clicked!",{userId:e,username:t,user:b}),console.log("\ud83d\udcf1 Current user data:",b),Aa({open:!0,userId:e,username:t}),console.log("\u2705 Profile modal state set to open"),window.innerWidth<=1024&&N(!0)},[b]),ps=(0,a.useCallback)(()=>{Aa({open:!1,userId:null,username:null})},[]),gs=(0,a.useCallback)(()=>{Ra({open:!1,section:"profile"})},[]),fs=(0,a.useCallback)(async e=>{try{console.log("Feedback submitted:",e);const t=L.formatFeedbackData(e);if(!L.validateFeedback(t).isValid)throw new Error("Please check your feedback and try again.");const n=await L.submitFeedback(t);return console.log("\u2705 Feedback submitted successfully:",n),n}catch(t){throw console.error("\u274c Failed to submit feedback:",t),t}},[]),vs=(0,a.useCallback)(()=>un.filter(e=>e.file&&e.file.type.startsWith("image/")).map(e=>({url:e.file.url,name:e.file.name,messageId:e.id})),[un]),ys=(0,a.useCallback)((e,t)=>{const n=vs(),a=n.findIndex(t=>t.url===e);et({open:!0,imageUrl:e,imageName:t,zoom:1,pan:{x:0,y:0},isDragging:!1,currentIndex:Math.max(0,a),images:n})},[vs]),bs=(0,a.useCallback)((e,t,n,a)=>{nt({open:!0,videoUrl:e,videoName:t,poster:n,type:a})},[]),xs=(0,a.useCallback)(()=>{nt({open:!1,videoUrl:null,videoName:null,poster:null,type:null})},[]),ws=(0,a.useCallback)(e=>{et(t=>{const n="next"===e?Math.min(t.currentIndex+1,t.images.length-1):Math.max(t.currentIndex-1,0),a=t.images[n];return a?c(c({},t),{},{currentIndex:n,imageUrl:a.url,imageName:a.name,zoom:1,pan:{x:0,y:0},isLoading:!0}):t})},[]),Ss=(0,a.useCallback)(()=>{et(e=>c(c({},e),{},{isLoading:!1}))},[]),ks=(0,a.useCallback)(()=>{et(e=>c(c({},e),{},{isLoading:!1}))},[]),js=(0,a.useCallback)(()=>{et({open:!1,imageUrl:null,imageName:null,zoom:1,pan:{x:0,y:0},isDragging:!1,currentIndex:0,images:[],isLoading:!1})},[]),Ns=(0,a.useCallback)(()=>{et(e=>c(c({},e),{},{zoom:Math.min(1.2*e.zoom,3)}))},[]),Cs=(0,a.useCallback)(()=>{et(e=>c(c({},e),{},{zoom:Math.max(e.zoom/1.2,.5),pan:e.zoom<=1?{x:0,y:0}:e.pan}))},[]),Es=(0,a.useCallback)(()=>{et(e=>c(c({},e),{},{zoom:1,pan:{x:0,y:0}}))},[]),Ts=(0,a.useCallback)(e=>{Ze.zoom>1&&et(e=>c(c({},e),{},{isDragging:!0}))},[Ze.zoom]),Is=(0,a.useCallback)(e=>{Ze.isDragging&&Ze.zoom>1&&et(t=>c(c({},t),{},{pan:{x:t.pan.x+e.movementX,y:t.pan.y+e.movementY}}))},[Ze.isDragging,Ze.zoom]),Ps=(0,a.useCallback)(()=>{et(e=>c(c({},e),{},{isDragging:!1}))},[]);(0,a.useEffect)(()=>{const e=e=>{if(Ze.open)switch(e.key){case"Escape":js();break;case"ArrowLeft":e.preventDefault(),ws("prev");break;case"ArrowRight":e.preventDefault(),ws("next");break;case"+":case"=":e.preventDefault(),Ns();break;case"-":e.preventDefault(),Cs();break;case"0":e.preventDefault(),Es()}else if(tt.open&&"Escape"===e.key)xs()},t=e=>{Ze.open&&(e.preventDefault(),e.deltaY<0?Ns():Cs())};return document.addEventListener("keydown",e),document.addEventListener("wheel",t,{passive:!1}),()=>{document.removeEventListener("keydown",e),document.removeEventListener("wheel",t)}},[Ze.open,js,ws,Ns,Cs,Es]);const Ds=(0,a.useCallback)(()=>{var e;const t=null===(e=Va.withUser)||void 0===e?void 0:e.id;t&&Re.sendSignal("call-end",t),ts.current&&(ts.current.close(),ts.current=null),ns.current&&(ns.current.getTracks().forEach(e=>e.stop()),ns.current=null),Ka(e=>c(c({},e),{},{active:!1}))},[null===(s=Va.withUser)||void 0===s?void 0:s.id]),As=(0,a.useCallback)(()=>{Ka(e=>c(c({},e),{},{minimized:!e.minimized}))},[]),Ms=(0,a.useCallback)(async()=>{let e=wn||h;!e&&E.length>0&&(e=E[0],console.log("\xef\xbf\xbd Using first conversation as fallback:",e)),e||(e={id:"demo-user",name:"Demo User",username:"demo",avatar:null,phone:"+1-555-0123"},console.log("\ud83d\udcde Using demo user for voice call test")),console.log("\xef\xbf\xbd\ud83d\udd0d Voice call debug - currentUser:",e),console.log("\ud83d\udd0d Voice call debug - currentSelectedConversation:",wn),console.log("\ud83d\udd0d Voice call debug - currentConversation:",h),console.log("\ud83d\udd0d Voice call debug - conversations:",E);try{console.log("\ud83d\udcde Starting voice call with user:",e.name||e.username);const t=await Ie.getAvailableCallMethods(e);if(console.log("\ud83d\udcde Available call methods:",t),Xa(t),t.length>1)return console.log("\ud83d\udcde Multiple methods available, showing selector"),void es(!0);console.log("\ud83d\udcde Starting enhanced voice call with auto method"),await Rs(e,"auto")}catch(t){console.error("\u274c Failed to start voice call:",t),alert("Failed to start voice call: ".concat(t.message))}},[wn,h,E]),Rs=(0,a.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto";try{console.log("\ud83d\ude80 Starting enhanced voice call - targetUser:",e,"method:",t);try{const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});ts.current=t;const n=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});ns.current=n,n.getTracks().forEach(e=>t.addTrack(e,n)),t.onicecandidate=t=>{t.candidate&&Re.sendSignal("ice-candidate",e.id,{candidate:t.candidate})};const a=await t.createOffer();await t.setLocalDescription(a),Re.sendSignal("call-offer",e.id,{offer:a,fromUser:{id:null===b||void 0===b?void 0:b.id,name:(null===b||void 0===b?void 0:b.name)||(null===b||void 0===b?void 0:b.username)},audioOnly:!0})}catch(n){console.warn("WebRTC voice call setup failed, falling back to stub:",n)}const a=await Ie.initiateEnhancedCall(e,t);if(console.log("\ud83d\udcde Call instance result:",a),!a.success)throw new Error(a.error||"Failed to initiate call");Ja({active:!0,withUser:{id:e.id,name:e.name||e.username,avatar:e.avatar,phone:e.phone},minimized:!1,audioOnly:!0,callInstance:a});const s={id:a.callId,text:"\ud83d\udcde ".concat(a.method.description," with ").concat(e.name||e.username),user:"You",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),type:"voice_call_enhanced",callStatus:a.status,callMethod:a.method,connectionQuality:a.connectionStatus.quality,isSystemMessage:!0};console.log("\ud83d\udcde Adding voice call message to chat:",s),hn(e=>[...e,s]),es(!1),alert("\ud83d\udcde Voice call initiated successfully!\n\nNote: This is a demo implementation. In a real app, you would hear audio and see call controls.")}catch(a){console.error("\u274c Failed to start enhanced voice call:",a),alert("Failed to start voice call: ".concat(a.message))}},[b]),Fs=(0,a.useCallback)(()=>{var e;const t=null===(e=Ga.withUser)||void 0===e?void 0:e.id;t&&Re.sendSignal("call-end",t),ts.current&&(ts.current.close(),ts.current=null),ns.current&&(ns.current.getTracks().forEach(e=>e.stop()),ns.current=null),Ja(e=>c(c({},e),{},{active:!1}))},[null===(i=Ga.withUser)||void 0===i?void 0:i.id]),Ls=(0,a.useCallback)(()=>{xt(!0)},[]),zs=(0,a.useCallback)(()=>{xt(!1),St(!0)},[]),Os=(0,a.useCallback)(e=>{console.log("\ud83d\udcde International call initiated:",e);const t={id:"call_".concat(Date.now()),text:"\ud83d\udcde Calling ".concat(e.number," (").concat(e.country.name,")"),user:"You",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),type:"international_call",callData:e,isSystemMessage:!0};hn(e=>[...e,t]),alert("\ud83d\udcde Calling ".concat(e.number,"\n\nNote: This is a demo implementation. In a real app, this would connect to a VoIP service provider like Twilio, WebRTC, or similar service to handle the actual phone call.")),St(!1)},[]),_s=(0,a.useCallback)(async()=>{console.log("\ud83c\udfaf handleAppCall called"),alert("App call clicked! Check console for debug info."),xt(!1),await Ms()},[Ms]),Us=(0,a.useCallback)(()=>{Ja(e=>c(c({},e),{},{minimized:!e.minimized}))},[]),qs=(0,a.useCallback)(async()=>{const e=wn||h;if(e)try{await xe.initialize();const t=e.id;if(t&&Re.isConnected()){const e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});ts.current=e;const n=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).catch(()=>null);n&&(ns.current=n,n.getTracks().forEach(t=>e.addTrack(t,n))),e.onicecandidate=e=>{e.candidate&&Re.sendSignal("ice-candidate",t,{candidate:e.candidate})};const a=await e.createOffer();await e.setLocalDescription(a),Re.sendSignal("call-offer",t,{offer:a,audioOnly:!1})}Ka({active:!0,withUser:{name:e.name,avatar:e.avatar,id:e.id},minimized:!1,audioOnly:!1,callId:"call_".concat(Date.now())});const n={id:"call_".concat(Date.now()),text:"\ud83d\udcf9 Video call with ".concat(e.name),user:"You",timestamp:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),type:"video_call",callStatus:"connecting",isSystemMessage:!0};hn(e=>[...e,n])}catch(t){console.error("Failed to start video call:",t),alert("Failed to start video call. Please check your camera and microphone permissions.")}else alert("Please select a conversation to start a video call")},[wn,h]),Bs=(0,a.useMemo)(()=>null,[Va,Ds,As]),Hs=(0,a.useMemo)(()=>null,[Ga,Fs,Us]),Ws=((0,a.useCallback)(e=>{const{text:t,file:n,reactions:a}=e;if(null!==n&&void 0!==n&&n.type.startsWith("image/"))return"\ud83d\udcf8 Image: ".concat(n.name);if(null!==n&&void 0!==n&&n.type.startsWith("video/"))return"\ud83c\udfa5 Video: ".concat(n.name);if(null!==n&&void 0!==n&&n.type.startsWith("audio/"))return"\ud83c\udfb5 Audio: ".concat(n.name);if(n&&!n.type.startsWith("image/")&&!n.type.startsWith("video/")&&!n.type.startsWith("audio/"))return"\ud83d\udcce File: ".concat(n.name);if(t.includes("```"))return"\ud83d\udcbb Code snippet";if(t.match(/https?:\/\/[^\s]+/))return"\ud83d\udd17 ".concat(t.substring(0,60),"...");if(t.includes("@")){const e=t.match(/@\w+/g);return"\ud83d\udcac ".concat(t.replace(/@\w+/g,"@user")).concat((null===e||void 0===e?void 0:e.length)>1?" (+".concat(e.length-1," mentions)"):"")}return(null===a||void 0===a?void 0:a.length)>0?"".concat(t.substring(0,60),"... (").concat(a.length," ").concat(1===a.length?"reaction":"reactions",")"):t.length>100?t.substring(0,100)+"...":t},[]),(0,a.useCallback)(e=>{const{text:t,file:n,user:a,reactions:s=[]}=e,i=t.length;return{length:i<=50?"short":i<=200?"medium":i<=500?"long":"very-long",type:n?n.type.startsWith("image/")?"image":n.type.startsWith("video/")?"video":n.type.startsWith("audio/")?"audio":"file":"text",priority:"admin"===a.role?"high":"moderator"===a.role?"medium":"normal",hasMedia:!!n,hasReactions:s.length>0,hasCode:t.includes("```")||t.includes("`"),hasLinks:/https?:\/\/[^\s]+/.test(t),hasMentions:/@\w+/.test(t),sentiment:t.includes("!")&&t.includes("urgent")?"urgent":t.includes("?")?"question":/[\ud83d\ude00\ud83d\ude03\ud83d\ude04\ud83d\ude01\ud83d\ude06\ud83d\ude05\ud83d\ude02\ud83e\udd23\ud83d\ude0a\ud83d\ude07\ud83d\ude42\ud83d\ude09\ud83d\ude0c\ud83d\ude0d\ud83e\udd70\ud83d\ude18\ud83d\ude17\ud83d\ude19\ud83d\ude1a\ud83d\ude0b\ud83d\ude1b\ud83d\ude1d\ud83d\ude1c\ud83e\udd2a\ud83e\udd28\ud83e\uddd0\ud83e\udd13\ud83d\ude0e\ud83e\udd29\ud83e\udd73\ud83d\ude0f\ud83d\ude12\ud83d\ude1e\ud83d\ude14\ud83d\ude1f\ud83d\ude15\ud83d\ude41\u2639\ufe0f\ud83d\ude23\ud83d\ude16\ud83d\ude2b\ud83d\ude29\ud83e\udd7a\ud83d\ude22\ud83d\ude2d\ud83d\ude24\ud83d\ude20\ud83d\ude21\ud83e\udd2c\ud83e\udd2f\ud83d\ude33\ud83e\udd75\ud83e\udd76\ud83d\ude31\ud83d\ude28\ud83d\ude30\ud83d\ude25\ud83d\ude13\ud83e\udd17\ud83e\udd14\ud83e\udd2d\ud83e\udd2b\ud83e\udd25\ud83d\ude36\ud83d\ude10\ud83d\ude11\ud83d\ude2c\ud83d\ude44\ud83d\ude2f\ud83d\ude26\ud83d\ude27\ud83d\ude2e\ud83d\ude32\ud83e\udd71\ud83d\ude34\ud83e\udd24\ud83d\ude2a\ud83d\ude35\ud83e\udd10\ud83e\udd74\ud83e\udd22\ud83e\udd2e\ud83e\udd27\ud83d\ude37\ud83e\udd12\ud83e\udd15\ud83e\udd11\ud83e\udd20\ud83d\ude08\ud83d\udc7f\ud83d\udc79\ud83d\udc7a\ud83e\udd21\ud83d\udca9\ud83d\udc7b\ud83d\udc80\u2620\ufe0f\ud83d\udc7d\ud83d\udc7e\ud83e\udd16\ud83c\udf83\ud83d\ude3a\ud83d\ude38\ud83d\ude39\ud83d\ude3b\ud83d\ude3c\ud83d\ude3d\ud83d\ude40\ud83d\ude3f\ud83d\ude3e]/.test(t)?"emoji":"neutral"}},[])),Vs=(0,a.useCallback)(e=>{const t=e.length;return t<=50?"short":t<=200?"medium":t<=500?"long":"very-long"},[]);return(0,k.jsxs)("div",{className:"pro-layout mobile-optimized smartphone-optimized",children:[(0,k.jsxs)("div",{className:"dynamic-background",children:[(0,k.jsx)("div",{className:"gradient-orb orb-1"}),(0,k.jsx)("div",{className:"gradient-orb orb-2"}),(0,k.jsx)("div",{className:"gradient-orb orb-3"}),(0,k.jsx)("div",{className:"gradient-orb orb-4"}),(0,k.jsx)("div",{className:"gradient-orb orb-5"}),(0,k.jsx)("div",{className:"floating-particles",children:[...Array(20)].map((e,t)=>(0,k.jsx)("div",{className:"particle particle-".concat(t+1)},t))})]}),Bs,Hs,(0,k.jsxs)("div",{ref:cn,className:"pro-sidebar enhanced-sidebar ".concat(j?"collapsed":""),onTouchStart:jn,onTouchMove:Nn,onTouchEnd:Cn,children:[(0,k.jsxs)("div",{className:"pro-sidebar-header simplified",children:[(0,k.jsxs)("div",{className:"sidebar-logo",children:[(0,k.jsxs)("div",{className:"logo-icon","data-tooltip":"Quibish Chat",children:[(0,k.jsx)("span",{className:"logo-emoji",children:"\ud83d\udcac"}),Sa>0&&(0,k.jsx)("div",{className:"logo-unread-badge",children:Sa>99?"99+":Sa})]}),!j&&(0,k.jsx)("h2",{className:"logo-text",children:"Quibish"})]}),(0,k.jsx)("button",{onClick:kn,className:"sidebar-toggle-btn",title:j?"Expand sidebar":"Collapse sidebar",children:j?"\u2b9e":"\u2b9c"})]}),(0,k.jsxs)("div",{className:"sidebar-user-profile simplified",children:[(0,k.jsxs)("div",{className:"user-avatar ".concat("admin"===(null===b||void 0===b?void 0:b.role)?"admin-user":""),"data-tooltip":"admin"===(null===b||void 0===b?void 0:b.role)?"".concat((null===b||void 0===b?void 0:b.name)||"Admin"," (Administrator)"):(null===b||void 0===b?void 0:b.name)||"User Profile",children:[(0,k.jsx)("img",{src:We?"/default-avatar.png":(null===b||void 0===b?void 0:b.avatar)||"https://ui-avatars.com/api/?name=".concat(encodeURIComponent((null===b||void 0===b?void 0:b.name)||"User"),"&background=4f46e5&color=fff&size=80&bold=true&format=png"),alt:(null===b||void 0===b?void 0:b.name)||"User",onError:e=>{We||(console.log("Avatar load failed, trying fallback:",e.target.src),Zn(),e.target.src.includes("ui-avatars.com")?e.target.src="/default-avatar.png":e.target.src="https://ui-avatars.com/api/?name=".concat(encodeURIComponent((null===b||void 0===b?void 0:b.name)||"User"),"&background=4f46e5&color=fff&size=80&bold=true&format=png"))},onLoad:()=>Ve(!1)}),(0,k.jsx)("div",{className:"status-indicator online"}),"admin"===(null===b||void 0===b?void 0:b.role)&&(0,k.jsx)("div",{className:"admin-badge",title:"Administrator",children:"\ud83d\udc51"})]}),!j&&(0,k.jsxs)("div",{className:"user-info",children:[(0,k.jsx)("h3",{className:"user-name",children:(null===b||void 0===b?void 0:b.name)||"User"}),(0,k.jsx)("p",{className:"user-status",children:"Online"})]})]}),!j&&(0,k.jsxs)("div",{className:"sidebar-actions",children:[(0,k.jsxs)("button",{className:"action-btn primary",onClick:zn,children:[(0,k.jsx)("span",{className:"icon",children:"\u2795"}),(0,k.jsx)("span",{className:"text",children:"New Chat"})]}),(0,k.jsxs)("button",{className:"action-btn secondary",onClick:Pn,children:[(0,k.jsx)("span",{className:"icon",children:"\ud83d\udd0d"}),(0,k.jsx)("span",{className:"text",children:"Find Users"})]})]}),!j&&(0,k.jsx)("div",{className:"sidebar-search simplified",children:(0,k.jsxs)("div",{className:"search-container",children:[(0,k.jsx)("span",{className:"search-icon",children:"\ud83d\udd0d"}),(0,k.jsx)("input",{type:"text",placeholder:"Search conversations...",className:"search-input",value:q,onChange:In})]})}),!j&&(0,k.jsxs)("div",{className:"sidebar-filters simplified",children:[(0,k.jsxs)("button",{className:"filter-tab ".concat("all"===re?"active":""),onClick:()=>Ln("all"),children:["All (",wa.all,")"]}),(0,k.jsxs)("button",{className:"filter-tab ".concat("unread"===re?"active":""),onClick:()=>Ln("unread"),children:["Unread (",wa.unread,")"]})]}),!j&&(0,k.jsx)("div",{className:"sidebar-toolbar simplified",children:(0,k.jsxs)("select",{className:"sort-select",value:ue,onChange:e=>he(e.target.value),title:"Sort conversations",children:[(0,k.jsx)("option",{value:"recent",children:"Recent"}),(0,k.jsx)("option",{value:"unread",children:"Unread"}),(0,k.jsx)("option",{value:"alphabetical",children:"A-Z"})]})}),(0,k.jsx)("div",{className:"pro-sidebar-content",children:(0,k.jsx)("div",{className:"conversations-list simplified",children:va.map((e,t)=>(0,k.jsxs)("div",{className:"conversation-item simple ".concat(A===e.id?"active":""),onClick:()=>Tn(e.id),children:[(0,k.jsxs)("div",{className:"conversation-avatar",children:[(0,k.jsx)("img",{src:e.avatar||"https://ui-avatars.com/api/?name=".concat(e.name,"&background=random&size=40"),alt:e.name}),e.isOnline&&(0,k.jsx)("div",{className:"online-dot"}),e.unreadCount>0&&(0,k.jsx)("div",{className:"unread-badge",children:e.unreadCount})]}),!j&&(0,k.jsxs)("div",{className:"conversation-details",children:[(0,k.jsxs)("div",{className:"conversation-header",children:[(0,k.jsx)("h5",{className:"conversation-name",children:e.name}),(0,k.jsx)("span",{className:"conversation-time",children:e.lastMessageTime||"2m"})]}),(0,k.jsx)("p",{className:"last-message",children:e.lastMessage||"Hey there! How are you doing?"})]})]},e.id))})}),(0,k.jsx)("div",{className:"sidebar-footer simplified",children:(0,k.jsxs)("div",{className:"footer-actions",children:[(0,k.jsx)("button",{className:"footer-btn",title:"Contacts",onClick:sa,"data-mobile-action":"contacts",children:"\ud83d\udc65"}),(0,k.jsx)("button",{className:"footer-btn",title:"Settings",onClick:_n,"data-mobile-action":"settings",children:"\u2699\ufe0f"})]})})]}),!j&&(0,k.jsx)("div",{className:"pro-sidebar-overlay",onClick:En,"aria-hidden":"true",style:{pointerEvents:"auto",zIndex:1e3}}),(0,k.jsx)("div",{className:"pro-main ".concat(j?"collapsed":""),children:(0,k.jsxs)("div",{className:"pro-header enhanced-chat-header",children:[(0,k.jsxs)("div",{className:"header-left",children:[(0,k.jsx)("button",{className:"mobile-menu-btn",onClick:kn,title:"Toggle sidebar","aria-label":"Toggle sidebar",children:"\u2630"}),(0,k.jsxs)("div",{className:"conversation-avatar",onClick:()=>Pa(!0),style:{cursor:"pointer"},title:"View profile",children:[(0,k.jsx)("img",{src:(null===wn||void 0===wn?void 0:wn.avatar)||(null===h||void 0===h?void 0:h.avatar)||"https://images.unsplash.com/photo-1516726817505-f5ed825624d8?w=40&h=40&fit=crop&crop=face",alt:(null===wn||void 0===wn?void 0:wn.name)||(null===h||void 0===h?void 0:h.name)||"Chat"}),(0,k.jsx)("div",{className:"online-indicator ".concat(x?"online":"offline")})]}),(0,k.jsx)("div",{className:"conversation-info",children:(0,k.jsxs)("div",{className:"conversation-status",children:[Na?(0,k.jsxs)("span",{className:"typing-indicator",children:[(0,k.jsxs)("span",{className:"typing-dots",children:[(0,k.jsx)("span",{}),(0,k.jsx)("span",{}),(0,k.jsx)("span",{})]}),Na," is typing..."]}):(0,k.jsx)("span",{className:"connection-status ".concat(null!==wn&&void 0!==wn&&wn.isOnline||null!==h&&void 0!==h&&h.isOnline||x?"connected":"disconnected"),children:null!==wn&&void 0!==wn&&wn.isOnline||null!==h&&void 0!==h&&h.isOnline?"\u25cf Online":x?"\u25cf Away":"\u25cf Offline"}),(0,k.jsxs)("span",{className:"participant-count",children:[(null===wn||void 0===wn?void 0:wn.participants)||(null===h||void 0===h?void 0:h.participants)||(wn?2:0)," participants"]})]})})]}),(0,k.jsxs)("div",{className:"header-actions",children:[(0,k.jsx)(_e,{onClick:ba,className:"notification-btn"}),(0,k.jsx)("button",{className:"action-btn invite-user-btn",title:"\ud83d\udc65 Invite Users - Search and invite people to chat",onClick:Pn,children:"\ud83d\udc65"}),(0,k.jsxs)("button",{className:"action-btn unified-call-btn",title:"\ud83d\udcde Make Calls - International phone calls & app-to-app voice calls",onClick:Ls,children:["\ud83d\udcde",Ya&&(0,k.jsx)("span",{className:"connection-indicator",style:{color:Ya.color},children:Ya.icon})]}),(0,k.jsxs)("button",{className:"action-btn video-call-btn enhanced-video-btn",title:"Start Video Call",onClick:qs,children:[(0,k.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"video-icon",children:[(0,k.jsx)("rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,k.jsx)("path",{d:"M16 10L22 7V17L16 14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,k.jsx)("circle",{cx:"7",cy:"11",r:"1.5",fill:"currentColor",opacity:"0.5"})]}),(0,k.jsx)("span",{className:"btn-label",children:"Video"})]}),(0,k.jsx)("button",{className:"action-btn file-share-btn",title:"\ud83d\udcce File Sharing - Upload, manage, and share files",onClick:()=>Ut(!0),children:"\ud83d\udcce"}),(0,k.jsx)("button",{className:"action-btn donation-btn",title:"\ud83d\udc9d Support Our Free App - Help us keep it free for everyone!",onClick:()=>jt(!0),children:"\ud83d\udc9d"}),(0,k.jsx)("div",{className:"header-menu",children:(0,k.jsx)("button",{className:"action-btn menu-btn",title:"More options",onClick:ea,style:{position:"relative",zIndex:10},children:"\u22ee"})})]})]})}),(0,k.jsxs)("div",{className:"pro-content",children:[(0,k.jsxs)("div",{className:"pro-message-list mobile-optimized pull-to-refresh",ref:dn,children:[mn&&(0,k.jsxs)("div",{className:"message-loading-indicator",children:[(0,k.jsx)("div",{className:"loading-spinner"}),(0,k.jsx)("span",{children:"Loading messages..."})]}),gn&&!mn&&(0,k.jsxs)("div",{className:"message-error-indicator",children:[(0,k.jsxs)("span",{children:["\u26a0\ufe0f ",gn]}),(0,k.jsx)("button",{className:"retry-button",onClick:()=>window.location.reload(),children:"Retry"})]}),!mn&&!gn&&0===un.length&&(0,k.jsx)("div",{className:"no-messages-indicator",children:A?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("span",{children:"\ud83d\udcac No messages yet in this conversation"}),(0,k.jsx)("p",{children:"Be the first to send a message!"})]}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("span",{children:"\ud83d\udc48 Select a conversation to view messages"}),(0,k.jsx)("p",{children:"Choose a conversation from the sidebar to start chatting."})]})}),un.map(e=>{var t,n,a,s,i,r;return(0,k.jsxs)("div",{id:"message-".concat(e.id),className:"pro-message-blurb ".concat(vt===e.id?"search-highlighted":""),"data-message-id":e.id,children:[(0,k.jsx)("div",{className:"message-avatar",children:(0,k.jsx)("img",{src:e.user.avatar||"https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=32&h=32&fit=crop&crop=face",alt:e.user.name,onClick:()=>ms(e.user.id,e.user.name)})}),(0,k.jsxs)("div",{className:"message-content",onClick:()=>ha(e.id),children:[(0,k.jsxs)("div",{className:"message-header",children:[(0,k.jsx)("span",{className:"user-name",children:e.user.name}),e.isEncrypted&&(0,k.jsx)("span",{className:"encryption-indicator ".concat(e.encryptionStatus),title:"Message is encrypted (".concat(e.encryptionStatus,")"),children:"decrypted"===e.encryptionStatus?"\ud83d\udd13":"failed"===e.encryptionStatus?"\u26a0\ufe0f":"sent"===e.encryptionStatus?"\ud83d\udd12":"\ud83d\udd10"})]}),(0,k.jsx)("div",{className:"message-text","data-length":Vs(e.text),"data-content-type":Ws(e).type,"data-has-code":Ws(e).hasCode,"data-has-links":Ws(e).hasLinks,"data-has-mentions":Ws(e).hasMentions,"data-sentiment":Ws(e).sentiment,children:(0,k.jsx)("span",{className:"message-smart-text",children:e.text})}),e.file&&(0,k.jsx)("div",{className:"message-attachment",children:e.file.type.startsWith("image/")?(0,k.jsxs)("div",{className:"image-attachment ".concat(e.file.isGif?"gif-attachment":""),children:[e.file.isGif&&(0,k.jsx)("div",{className:"gif-badge",children:(0,k.jsx)("span",{className:"gif-label",children:"GIF"})}),(0,k.jsx)("img",{src:e.file.url,alt:e.file.name,className:"attached-image ".concat(e.file.isGif?"gif-image":""),onClick:()=>{ys(e.file.url,e.file.name)}}),(0,k.jsxs)("div",{className:"image-caption ".concat(e.file.isGif?"gif-caption":""),children:[e.file.isGif&&"\ud83c\udfad ",e.file.name," (",(e.file.size/1024).toFixed(1)," KB)",e.file.isGif&&(0,k.jsx)("span",{className:"gif-info",children:" \u2022 Animated GIF"})]})]}):e.file.type.startsWith("video/")?(0,k.jsxs)("div",{className:"video-attachment",children:[(0,k.jsxs)("div",{className:"video-container",children:[(0,k.jsxs)("video",{src:e.file.url,poster:e.file.thumbnail,controls:!0,preload:"metadata",muted:!1,playsInline:!0,"webkit-playsinline":"true",onClick:()=>{bs(e.file.url,e.file.name,e.file.thumbnail,e.file.type)},onError:t=>{console.error("Video playback error:",t),console.log("Video details:",{src:e.file.url,type:e.file.type,poster:e.file.thumbnail?"Has thumbnail":"No thumbnail",error:t.target.error})},onLoadedMetadata:e=>{console.log("Video loaded for playback:",{duration:e.target.duration,videoWidth:e.target.videoWidth,videoHeight:e.target.videoHeight,readyState:e.target.readyState})},onLoadStart:()=>console.log("Video load started"),onCanPlay:()=>console.log("Video can play"),onCanPlayThrough:()=>console.log("Video can play through"),style:{maxWidth:"400px",maxHeight:"300px",borderRadius:"8px",width:"100%",height:"auto",cursor:"pointer"},children:[(0,k.jsx)("source",{src:e.file.url,type:e.file.type}),"Your browser does not support the video tag."]}),e.file.duration&&(0,k.jsx)("div",{className:"video-duration-badge",children:e.file.duration})]}),(0,k.jsxs)("div",{className:"video-caption",children:["\ud83c\udfa5 ",e.file.name,e.file.size&&" (".concat((e.file.size/1048576).toFixed(1)," MB)"),e.file.width&&e.file.height&&" \u2022 ".concat(e.file.width,"\xd7").concat(e.file.height)]})]}):(0,k.jsxs)("div",{className:"file-attachment",children:[(0,k.jsx)("div",{className:"file-icon",children:"\ud83d\udcc4"}),(0,k.jsxs)("div",{className:"file-info",children:[(0,k.jsx)("div",{className:"file-name",children:e.file.name}),(0,k.jsxs)("div",{className:"file-size",children:[(e.file.size/1024).toFixed(1)," KB"]})]}),(0,k.jsx)("button",{className:"download-btn",onClick:()=>{const t=document.createElement("a");t.href=e.file.url,t.download=e.file.name,t.click()},children:"Download"})]})}),"voice"===e.type&&(0,k.jsx)("div",{className:"voice-message enhanced",children:e.audioUrl?(0,k.jsx)(me,{audioUrl:e.audioUrl,duration:e.duration,compact:!0,className:"chat-voice-player"}):(0,k.jsxs)("div",{className:"voice-message-fallback",children:[(0,k.jsx)("div",{className:"voice-icon",children:"\ud83c\udfa4"}),(0,k.jsx)("div",{className:"voice-duration",children:ma(e.duration||0)}),(0,k.jsx)("div",{className:"voice-placeholder",children:"Legacy voice message"})]})}),"voice_call"===e.type&&(0,k.jsxs)("div",{className:"voice-call-message",children:[(0,k.jsx)("div",{className:"voice-call-icon",children:"\ud83d\udcde"}),(0,k.jsxs)("div",{className:"voice-call-info",children:[(0,k.jsx)("div",{className:"voice-call-text",children:e.text}),(0,k.jsxs)("div",{className:"voice-call-status",children:["Status: ",e.callStatus]})]}),(0,k.jsx)("div",{className:"voice-call-controls",children:"connecting"===e.callStatus&&(0,k.jsx)("button",{className:"voice-call-btn-small end-call",onClick:()=>Fs(),title:"End call",children:"End"})})]}),"voice_call_enhanced"===e.type&&(0,k.jsxs)("div",{className:"voice-call-enhanced-message",children:[(0,k.jsxs)("div",{className:"voice-call-enhanced-header",children:[(0,k.jsx)("div",{className:"voice-call-method-icon",children:(null===(t=e.callMethod)||void 0===t?void 0:t.icon)||"\ud83d\udcde"}),(0,k.jsxs)("div",{className:"voice-call-enhanced-info",children:[(0,k.jsx)("div",{className:"voice-call-enhanced-text",children:e.text}),(0,k.jsx)("div",{className:"voice-call-method-description",children:null===(n=e.callMethod)||void 0===n?void 0:n.description}),(0,k.jsxs)("div",{className:"voice-call-quality-info",children:[(0,k.jsxs)("span",{className:"connection-quality",style:{color:Pe.getConnectionStatus().color},children:[null===(a=e.callMethod)||void 0===a?void 0:a.estimated_quality," ",e.connectionQuality]}),(null===(s=e.callMethod)||void 0===s?void 0:s.latency)&&(0,k.jsxs)("span",{className:"latency-info",children:["\u2022 ",Math.round(e.callMethod.latency),"ms"]})]})]})]}),(0,k.jsxs)("div",{className:"voice-call-enhanced-controls",children:[(0,k.jsxs)("div",{className:"call-status-indicator",children:[(0,k.jsx)("div",{className:"status-dot ".concat(e.callStatus)}),(0,k.jsx)("span",{className:"status-text",children:e.callStatus})]}),("connecting"===e.callStatus||"connected"===e.callStatus)&&(0,k.jsx)("button",{className:"voice-call-btn-small end-call-enhanced",onClick:()=>Fs(),title:"End call",children:"End Call"})]}),(null===(i=e.callMethod)||void 0===i?void 0:i.note)&&(0,k.jsxs)("div",{className:"call-method-note",children:["\u2139\ufe0f ",e.callMethod.note]})]})]}),(0,k.jsxs)("div",{className:"message-timestamp-with-reactions",children:[(0,k.jsxs)("div",{className:"message-timestamp",children:[new Date(e.timestamp).toLocaleTimeString(),String(null===(r=e.user)||void 0===r?void 0:r.id)===String(null===b||void 0===b?void 0:b.id)&&(0,k.jsx)("span",{className:"message-delivery-status ".concat(e.pending?"pending":"sent"),title:e.pending?"Sending\u2026":"Sent",children:e.pending?"\u25cb":"\u2713"})]}),e.reactions&&e.reactions.length>0&&(0,k.jsx)("div",{className:"message-reactions-inline",children:e.reactions.map((t,n)=>(0,k.jsxs)("button",{className:"reaction-bubble-inline",onClick:n=>{n.stopPropagation(),da(e.id,t.emoji)},title:"".concat(t.emoji," ").concat(t.count),children:[(0,k.jsx)("span",{className:"reaction-emoji",children:t.emoji}),(0,k.jsx)("span",{className:"reaction-count",children:t.count})]},n))})]}),(0,k.jsx)("div",{className:"message-threading-actions",children:(()=>{const t=hs(e.id);return t?(0,k.jsx)(ae,{thread:t,onClick:()=>cs(t.id),compact:!1,showParticipants:!0}):(0,k.jsx)("button",{className:"reply-in-thread-btn icon-only",onClick:t=>{t.stopPropagation(),ls(e)},title:"Reply in thread",children:"\ud83d\udcac"})})()})]},e.id)}),(0,k.jsx)("div",{ref:ln})]}),(0,k.jsxs)("div",{className:"pro-chat-input-container enhanced mobile-input-bar keyboard-avoiding",children:[(0,k.jsxs)("div",{className:"input-wrapper enhanced touch-target",children:[Ke&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"recording-overlay",onClick:()=>Ge(!1),title:"Click to close"}),(0,k.jsx)("div",{className:"enhanced-recording-container",children:(0,k.jsx)(pe,{onRecordingComplete:ga,onRecordingCancel:fa,onRecordingStart:pa,onClose:()=>Ge(!1),maxDuration:3e5,minDuration:1e3,compact:!0,autoStart:!1,className:"chat-voice-recorder"})})]}),!Ke&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("input",{ref:an,type:"file",accept:"image/*,image/gif,video/*,audio/*,.pdf,.doc,.docx,.txt",style:{display:"none"},multiple:!0,onChange:Un}),(0,k.jsx)("input",{ref:sn,id:"mobile-camera-photo",type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:Un}),(0,k.jsx)("input",{ref:rn,id:"mobile-camera-video",type:"file",accept:"video/*",capture:"environment",style:{display:"none"},onChange:Un}),(0,k.jsx)("input",{ref:on,id:"mobile-gallery",type:"file",accept:"image/*,video/*,image/gif",style:{display:"none"},multiple:!0,onChange:Un}),(0,k.jsxs)("div",{className:"input-actions-row",children:[(0,k.jsx)("button",{className:"input-btn attachment-btn mobile-action-button touch-target touch-ripple haptic-light",onClick:qn()?Kn:()=>{var e;return null===(e=an.current)||void 0===e?void 0:e.click()},type:"button",title:qn()?"Upload menu":"Attach files",children:"\ud83d\udcce"}),(0,k.jsx)("button",{className:"input-btn gif-btn mobile-action-button touch-target touch-ripple haptic-light",onClick:Bn,type:"button",title:"Choose GIF",children:"\ud83c\udfad"}),(0,k.jsx)("button",{className:"input-btn gif-upload-btn",onClick:Hn,type:"button",title:"Upload your own GIF",children:"\ud83d\udce4"}),!Ke&&(0,k.jsx)("button",{className:"input-btn voice-btn mobile-action-button touch-target touch-ripple haptic-light",onClick:()=>Ge(!0),type:"button",title:"Record voice message",children:"\ud83c\udfa4"}),De.isSupported("camera")&&(0,k.jsx)("button",{className:"input-btn camera-btn mobile-action-button touch-target touch-ripple haptic-light",onClick:()=>Gn("photo"),type:"button",title:"Take photo/video",children:"\ud83d\udcf7"}),De.isSupported("contacts")&&(0,k.jsx)("button",{className:"input-btn contact-btn mobile-action-button touch-target touch-ripple haptic-light",onClick:Qn,type:"button",title:"Share contacts",children:"\ud83d\udc65"}),(0,k.jsx)("button",{className:"input-btn emoji-btn mobile-action-button touch-target touch-ripple haptic-light",onClick:()=>He(!Be),type:"button",title:"Add emoji",children:"\ud83d\ude0a"}),(0,k.jsx)("button",{className:"input-btn ai-btn mobile-action-button touch-target touch-ripple haptic-light",onClick:rs,disabled:!ka.trim(),type:"button",title:"AI Enhance & Translate",children:"\u2728"}),Vt&&(0,k.jsx)("button",{className:"input-btn encryption-btn mobile-action-button touch-target touch-ripple haptic-light ".concat(Yt?"active":""),onClick:()=>Qt(!Yt),type:"button",title:Yt?"Encryption enabled":"Encryption disabled",children:Yt?"\ud83d\udd12":"\ud83d\udd13"})]}),(0,k.jsxs)("div",{className:"message-input-row",children:[(0,k.jsx)("textarea",{value:ka,onChange:e=>{ja(e.target.value);const t=Date.now();if(t-Ta.current>2e3){Ta.current=t;const e=((null===wn||void 0===wn?void 0:wn.participants)||[]).find(e=>String(e)!==String(null===b||void 0===b?void 0:b.id))||null;Re.sendTyping({conversationId:A,recipientId:e})}},onKeyPress:ss,onFocus:()=>{He(!1),xn(!1)},onClick:e=>{e.stopPropagation(),He(!1),xn(!1),e.target.focus()},placeholder:"Type your message...",className:"message-input enhanced mobile-message-input touch-target clickable-input",rows:"1",autoComplete:"off",autoCorrect:"on",autoCapitalize:"sentences",spellCheck:"true",inputMode:"text","aria-label":"Type your message","data-testid":"message-input"}),(0,k.jsx)("button",{onClick:as,disabled:!ka.trim(),className:"send-button enhanced mobile-action-button touch-target touch-ripple haptic-light",type:"button","aria-label":"Send message",title:"Send message","data-testid":"send-button",children:(0,k.jsx)("span",{className:"send-icon","aria-hidden":"true",children:"\u27a4"})})]})]})]}),Be&&(0,k.jsx)("div",{className:"emoji-picker-overlay",onClick:()=>He(!1),children:(0,k.jsxs)("div",{className:"emoji-picker",onClick:e=>e.stopPropagation(),children:[(0,k.jsxs)("div",{className:"emoji-picker-header",children:[(0,k.jsx)("span",{children:"Choose an emoji"}),(0,k.jsx)("button",{className:"emoji-close",onClick:()=>He(!1),children:"\u2715"})]}),(0,k.jsx)("div",{className:"emoji-grid",children:["\ud83d\ude0a","\ud83d\ude02","\ud83e\udd70","\ud83d\ude0d","\ud83e\udd14","\ud83d\ude2e","\ud83d\ude05","\ud83d\udc4d","\ud83d\udc4e","\u2764\ufe0f","\ud83d\udd25","\ud83c\udf89","\ud83d\udc4f","\ud83d\ude4c","\u2728","\ud83d\udcaf","\ud83d\ude80","\ud83d\udca1","\ud83c\udfaf","\u2705","\u274c","\u26a1","\ud83c\udf1f","\ud83e\udd1d","\ud83d\udcaa","\ud83c\udf08","\u2600\ufe0f","\ud83c\udf19","\u2b50","\ud83d\udc9d","\ud83c\udf88"].map(e=>(0,k.jsx)("button",{className:"emoji-item",onClick:()=>ua(e),children:e},e))})]})}),bn&&vn&&(0,k.jsx)("div",{className:"emoji-picker-overlay",onClick:()=>{xn(!1),yn(null)},children:(0,k.jsxs)("div",{className:"emoji-picker",onClick:e=>e.stopPropagation(),children:[(0,k.jsxs)("div",{className:"emoji-picker-header",children:[(0,k.jsx)("span",{children:"Add Reaction"}),(0,k.jsx)("button",{className:"emoji-close",onClick:()=>{xn(!1),yn(null)},children:"\u2715"})]}),(0,k.jsx)("div",{className:"emoji-grid",children:["\ud83d\ude0a","\ud83d\ude02","\ud83e\udd70","\ud83d\ude0d","\ud83e\udd14","\ud83d\ude2e","\ud83d\ude05","\ud83d\udc4d","\ud83d\udc4e","\u2764\ufe0f","\ud83d\udd25","\ud83c\udf89","\ud83d\udc4f","\ud83d\ude4c","\u2728","\ud83d\udcaf","\ud83d\ude80","\ud83d\udca1","\ud83c\udfaf","\u2705","\u274c","\u26a1","\ud83c\udf1f","\ud83e\udd1d","\ud83d\udcaa","\ud83c\udf08","\u2600\ufe0f","\ud83c\udf19","\u2b50","\ud83d\udc9d","\ud83c\udf88"].map(e=>(0,k.jsx)("button",{className:"emoji-item",onClick:()=>ua(e),children:e},e))})]})})]})]}),Nt&&Et.length>0||It?(0,k.jsxs)("div",{className:"pro-smart-panel-container",children:[Nt&&Et.length>0&&(0,k.jsx)(X,{replies:Et,onSelectReply:is,onClose:()=>Ct(!1),lastMessage:un[un.length-1]}),It&&(0,k.jsx)(Z,{message:Dt,onEnhance:os,onClose:()=>Pt(!1)})]}):null,Ia&&(wn||h)&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{onClick:()=>Pa(!1),style:{position:"fixed",inset:0,backgroundColor:"rgba(0,0,0,0.4)",zIndex:2147483640,backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)"}}),(0,k.jsxs)("div",{style:{position:"fixed",top:"70px",left:"50%",transform:"translateX(-50%)",width:"min(340px, 92vw)",backgroundColor:"var(--pro-surface, #fff)",borderRadius:"20px",boxShadow:"0 24px 60px rgba(0,0,0,0.2)",zIndex:2147483641,overflow:"hidden",fontFamily:"inherit"},children:[(0,k.jsx)("button",{onClick:()=>Pa(!1),style:{position:"absolute",top:"10px",right:"10px",zIndex:1,width:"32px",height:"32px",borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.35)",color:"#fff",fontSize:"18px",lineHeight:1,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(4px)"},"aria-label":"Close",children:"\xd7"}),(0,k.jsx)("div",{style:{height:"80px",background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%)"}}),(0,k.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"-40px",padding:"0 20px 20px"},children:[(0,k.jsxs)("div",{style:{position:"relative"},children:[(0,k.jsx)("img",{src:(null===wn||void 0===wn?void 0:wn.avatar)||(null===h||void 0===h?void 0:h.avatar),alt:(null===wn||void 0===wn?void 0:wn.name)||(null===h||void 0===h?void 0:h.name),style:{width:"80px",height:"80px",borderRadius:"50%",border:"4px solid #fff",boxShadow:"0 4px 16px rgba(0,0,0,0.15)",objectFit:"cover"},onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}),(0,k.jsx)("div",{style:{display:"none",width:"80px",height:"80px",borderRadius:"50%",border:"4px solid #fff",background:"linear-gradient(135deg, #6366f1, #8b5cf6)",alignItems:"center",justifyContent:"center",fontSize:"28px",color:"#fff",fontWeight:"700"},children:((null===wn||void 0===wn?void 0:wn.name)||(null===h||void 0===h?void 0:h.name)||"?")[0].toUpperCase()}),(0,k.jsx)("span",{style:{position:"absolute",bottom:"4px",right:"4px",width:"16px",height:"16px",borderRadius:"50%",backgroundColor:x?"#22c55e":"#94a3b8",border:"2px solid #fff"}})]}),(0,k.jsx)("h3",{style:{margin:"10px 0 2px",fontSize:"18px",fontWeight:"700",color:"var(--pro-text, #1e293b)"},children:(null===wn||void 0===wn?void 0:wn.name)||(null===h||void 0===h?void 0:h.name)}),(0,k.jsx)("p",{style:{margin:"0 0 16px",fontSize:"13px",color:x?"#22c55e":"#94a3b8",fontWeight:"500"},children:x?"\u25cf Online":"\u25cf Offline"}),(0,k.jsx)("div",{style:{display:"flex",gap:"10px",width:"100%",marginBottom:"16px"},children:[{icon:"\ud83d\udcac",label:"Message",action:()=>Pa(!1)},{icon:"\ud83d\udcde",label:"Call",action:()=>{Pa(!1),Ls()}},{icon:"\ud83c\udfa5",label:"Video",action:()=>{Pa(!1),qs()}}].map(e=>{let{icon:t,label:n,action:a}=e;return(0,k.jsxs)("button",{onClick:a,style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",padding:"10px 4px",background:"rgba(99,102,241,0.08)",border:"none",borderRadius:"12px",cursor:"pointer",color:"#6366f1",fontSize:"12px",fontWeight:"600",transition:"background 0.2s"},onMouseEnter:e=>e.currentTarget.style.background="rgba(99,102,241,0.16)",onMouseLeave:e=>e.currentTarget.style.background="rgba(99,102,241,0.08)",children:[(0,k.jsx)("span",{style:{fontSize:"20px"},children:t}),n]},n)})}),(0,k.jsx)("div",{style:{width:"100%",borderTop:"1px solid rgba(0,0,0,0.07)",paddingTop:"14px",display:"flex",flexDirection:"column",gap:"2px"},children:[{icon:"\ud83d\udd0d",label:"Search in conversation",action:()=>{Pa(!1),oa()}},{icon:"\ud83d\udd14",label:"Mute notifications",action:()=>{Pa(!1),na()}},{icon:"\ud83d\udc64",label:"View full profile",action:()=>{Pa(!1),ms((null===wn||void 0===wn?void 0:wn.id)||(null===h||void 0===h?void 0:h.id),(null===wn||void 0===wn?void 0:wn.name)||(null===h||void 0===h?void 0:h.name))}},{icon:"\ud83d\uddd1\ufe0f",label:"Clear chat",action:()=>{Pa(!1),aa()},danger:!0}].map(e=>{let{icon:t,label:n,action:a,danger:s}=e;return(0,k.jsxs)("button",{onClick:a,style:{display:"flex",alignItems:"center",gap:"12px",width:"100%",padding:"10px 4px",border:"none",background:"none",textAlign:"left",fontSize:"14px",color:s?"#ef4444":"var(--pro-text, #374151)",cursor:"pointer",borderRadius:"8px",transition:"background 0.15s"},onMouseEnter:e=>e.currentTarget.style.background=s?"rgba(239,68,68,0.07)":"rgba(0,0,0,0.04)",onMouseLeave:e=>e.currentTarget.style.background="none",children:[(0,k.jsx)("span",{style:{fontSize:"16px",width:"22px",textAlign:"center"},children:t}),n]},n)})})]})]})]}),it&&d.createPortal((0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{onClick:()=>rt(!1),style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.4)",zIndex:2147483646,WebkitTapHighlightColor:"transparent"}}),(0,k.jsxs)("div",{className:"more-options-dropdown",children:[(0,k.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"10px 0 4px"},children:(0,k.jsx)("div",{style:{width:36,height:4,borderRadius:2,background:"rgba(0,0,0,0.15)"}})}),(0,k.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 16px 12px",borderBottom:"1px solid rgba(226,232,240,0.6)",fontWeight:"600",fontSize:"15px",color:"#374151"},children:[(0,k.jsx)("span",{children:"More Options"}),(0,k.jsx)("button",{onClick:()=>rt(!1),style:{background:"none",border:"none",fontSize:"20px",color:"#6b7280",cursor:"pointer",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",padding:0},children:"\xd7"})]}),[{icon:"\ud83d\udd0d",label:"Search in Chat",action:oa},{icon:"\ud83d\udc65",label:"Contacts",action:sa},{icon:"\ud83d\udce5",label:"Export Chat",action:ta},{icon:"\ud83d\udda8\ufe0f",label:"Print Chat",action:ca},{icon:"true"===localStorage.getItem("notificationsMuted")?"\ud83d\udd14":"\ud83d\udd15",label:("true"===localStorage.getItem("notificationsMuted")?"Unmute":"Mute")+" Notifications",action:na},{icon:"\ud83d\uddd1\ufe0f",label:"Clear Chat",action:aa},{icon:"\u2753",label:"Help & Support",action:()=>Ua(!0)},{icon:"\ud83d\udce2",label:"Send Feedback",action:()=>Oa(!0)}].map(e=>{let{icon:t,label:n,action:a}=e;return(0,k.jsxs)("button",{className:"dropdown-item",onClick:()=>{a(),rt(!1)},children:[(0,k.jsx)("span",{className:"dropdown-icon",children:t}),n]},n)}),(0,k.jsx)("hr",{className:"dropdown-divider"}),[{icon:"\ud83d\udd14",label:"Notifications",action:()=>Wa(!0)},{icon:"\ud83d\udcf0",label:"News Feed",action:()=>Ba(!0)},{icon:"\u2699\ufe0f",label:"Settings",action:_n},{icon:p?"\u2600\ufe0f":"\ud83c\udf19",label:p?"Light Mode":"Dark Mode",action:g}].map(e=>{let{icon:t,label:n,action:a}=e;return(0,k.jsxs)("button",{className:"dropdown-item",onClick:()=>{a(),rt(!1)},children:[(0,k.jsx)("span",{className:"dropdown-icon",children:t}),n]},n)}),(0,k.jsx)("hr",{className:"dropdown-divider"}),(0,k.jsxs)("button",{className:"dropdown-item logout-item",onClick:()=>{m(),rt(!1)},children:[(0,k.jsx)("span",{className:"dropdown-icon",children:"\ud83d\udeaa"}),"Logout"]})]})]}),document.body),Da.open&&(0,k.jsxs)(k.Fragment,{children:[console.log("\ud83d\udd0d Rendering UserProfileModal:",{profileModal:Da,user:b}),(0,k.jsx)(T,{isOpen:Da.open,user:b,onClose:ps,onUpdateProfile:e=>{console.log("Profile updated:",e)}})]}),Ma.open&&(0,k.jsxs)(k.Fragment,{children:[console.log("\ud83d\udd27 Rendering SettingsModal:",{settingsModal:Ma}),(0,k.jsx)(I,{isOpen:Ma.open,onClose:gs,initialSection:Ma.section})]}),Ha&&(0,k.jsx)(de,{isOpen:Ha,onClose:()=>Wa(!1),user:b}),qa&&(0,k.jsx)("div",{className:"modal-overlay",onClick:()=>Ba(!1),children:(0,k.jsxs)("div",{className:"modal-content news-feed-modal",onClick:e=>e.stopPropagation(),style:{maxWidth:"900px",width:"90%",maxHeight:"90vh",overflow:"auto",background:"#fff",borderRadius:"12px",position:"relative"},children:[(0,k.jsxs)("div",{className:"modal-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px",borderBottom:"1px solid #e2e8f0"},children:[(0,k.jsx)("h2",{style:{margin:0,fontSize:"24px",fontWeight:"600"},children:"\ud83d\udcf0 News Feed"}),(0,k.jsx)("button",{onClick:()=>Ba(!1),style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"#64748b",padding:"0",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center"},children:"\xd7"})]}),(0,k.jsx)("div",{className:"modal-body",style:{padding:"0"},children:(0,k.jsx)(Qe,{user:b})})]})}),Ze.open&&(0,k.jsx)("div",{className:"pro-lightbox-overlay",onClick:js,children:(0,k.jsxs)("div",{className:"pro-lightbox-content",onClick:e=>e.stopPropagation(),children:[(0,k.jsxs)("div",{className:"pro-lightbox-header",children:[(0,k.jsxs)("div",{className:"pro-lightbox-info",children:[(0,k.jsx)("div",{className:"pro-lightbox-title",children:Ze.imageName}),(0,k.jsxs)("div",{className:"pro-lightbox-meta",children:[(0,k.jsxs)("span",{className:"pro-lightbox-zoom-info",children:[Math.round(100*Ze.zoom),"%"]}),Ze.images.length>1&&(0,k.jsxs)("span",{className:"pro-lightbox-counter",children:[Ze.currentIndex+1," / ",Ze.images.length]})]})]}),(0,k.jsxs)("div",{className:"pro-lightbox-controls",children:[(0,k.jsx)("button",{className:"pro-lightbox-btn",onClick:Cs,title:"Zoom out (-)",children:"\ud83d\udd0d-"}),(0,k.jsx)("button",{className:"pro-lightbox-btn",onClick:Es,title:"Reset zoom (0)",children:"\u22a1"}),(0,k.jsx)("button",{className:"pro-lightbox-btn",onClick:Ns,title:"Zoom in (+)",children:"\ud83d\udd0d+"}),(0,k.jsx)("button",{className:"pro-lightbox-btn pro-lightbox-download",onClick:()=>{const e=document.createElement("a");e.href=Ze.imageUrl,e.download=Ze.imageName,e.click()},title:"Download image",children:"\ud83d\udcbe"})]}),(0,k.jsx)("button",{className:"pro-lightbox-close",onClick:js,children:"\xd7"})]}),(0,k.jsxs)("div",{className:"pro-lightbox-image-container",onMouseDown:Ts,onMouseMove:Is,onMouseUp:Ps,onMouseLeave:Ps,style:{cursor:Ze.zoom>1?Ze.isDragging?"grabbing":"grab":"zoom-in"},children:[Ze.images.length>1&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("button",{className:"pro-lightbox-nav pro-lightbox-nav-prev",onClick:()=>ws("prev"),disabled:0===Ze.currentIndex,title:"Previous image (\u2190)",children:"\u2190"}),(0,k.jsx)("button",{className:"pro-lightbox-nav pro-lightbox-nav-next",onClick:()=>ws("next"),disabled:Ze.currentIndex===Ze.images.length-1,title:"Next image (\u2192)",children:"\u2192"})]}),(0,k.jsx)("img",{src:Ze.imageUrl,alt:Ze.imageName,className:"pro-lightbox-image ".concat(Ze.isLoading?"loading":"loaded"),style:{transform:"scale(".concat(Ze.zoom,") translate(").concat(Ze.pan.x,"px, ").concat(Ze.pan.y,"px)"),transition:Ze.isDragging?"none":"transform 0.3s ease",opacity:Ze.isLoading?.3:1},onLoad:Ss,onError:ks,onDoubleClick:()=>{1===Ze.zoom?Ns():Es()},draggable:!1}),Ze.isLoading&&(0,k.jsxs)("div",{className:"pro-lightbox-loading",children:[(0,k.jsx)("div",{className:"pro-lightbox-spinner"}),(0,k.jsx)("span",{children:"Loading..."})]})]}),(0,k.jsx)("div",{className:"pro-lightbox-help",children:(0,k.jsx)("span",{children:"ESC to close \u2022 Arrow keys to navigate \u2022 Mouse wheel to zoom \u2022 Drag to pan \u2022 Double-click to zoom"})})]})}),tt.open&&(0,k.jsx)("div",{className:"pro-lightbox-overlay",onClick:xs,children:(0,k.jsxs)("div",{className:"pro-lightbox-content",onClick:e=>e.stopPropagation(),children:[(0,k.jsxs)("div",{className:"pro-lightbox-header",children:[(0,k.jsx)("div",{className:"pro-lightbox-info",children:(0,k.jsx)("div",{className:"pro-lightbox-title",children:(0,k.jsx)("h3",{children:tt.videoName})})}),(0,k.jsx)("div",{className:"pro-lightbox-controls",children:(0,k.jsx)("button",{className:"pro-lightbox-btn pro-lightbox-download",onClick:()=>{const e=document.createElement("a");e.href=tt.videoUrl,e.download=tt.videoName,e.click()},title:"Download video",children:"\ud83d\udcbe"})}),(0,k.jsx)("button",{className:"pro-lightbox-close",onClick:xs,children:"\xd7"})]}),(0,k.jsx)("div",{className:"pro-lightbox-video-container",children:(0,k.jsxs)("video",{src:tt.videoUrl,poster:tt.poster,controls:!0,autoPlay:!0,playsInline:!0,className:"pro-lightbox-video",style:{maxWidth:"100%",maxHeight:"80vh",width:"auto",height:"auto"},children:[(0,k.jsx)("source",{src:tt.videoUrl,type:tt.type}),"Your browser does not support the video tag."]})}),(0,k.jsx)("div",{className:"pro-lightbox-help",children:(0,k.jsx)("span",{children:"ESC to close \u2022 Click outside to close \u2022 Download available"})})]})}),(0,k.jsx)(P,{isOpen:at,onGifSelect:Wn,onClose:Vn}),(0,k.jsx)(F,{isOpen:Fa,onClose:()=>La(!1),onCreateChat:On,currentUser:b,darkMode:p}),(0,k.jsx)(z,{isOpen:za,onClose:()=>Oa(!1),onSubmit:fs}),(0,k.jsx)(O,{isOpen:_a,onClose:()=>Ua(!1)}),Za&&(0,k.jsx)("div",{className:"call-method-selector-overlay",children:(0,k.jsxs)("div",{className:"call-method-selector-modal",children:[(0,k.jsxs)("div",{className:"call-method-header",children:[(0,k.jsx)("h3",{children:"Choose Call Method"}),(0,k.jsx)("button",{className:"close-btn",onClick:()=>es(!1),children:"\xd7"})]}),(0,k.jsx)("div",{className:"call-method-list",children:$a.map((e,t)=>(0,k.jsxs)("div",{className:"call-method-option ".concat(e.quality),onClick:()=>{Rs(wn||h,e.type)},children:[(0,k.jsx)("div",{className:"method-icon",children:e.icon}),(0,k.jsxs)("div",{className:"method-info",children:[(0,k.jsx)("div",{className:"method-title",children:e.description}),(0,k.jsx)("div",{className:"method-quality",children:e.estimated_quality}),e.targetPhone&&(0,k.jsxs)("div",{className:"method-phone",children:["\ud83d\udcf1 ",e.targetPhone]}),e.note&&(0,k.jsx)("div",{className:"method-note",children:e.note}),e.estimatedLatency&&(0,k.jsxs)("div",{className:"method-latency",children:["\u26a1 ",Math.round(e.estimatedLatency),"ms"]})]}),(0,k.jsx)("div",{className:"method-quality-badge",children:e.quality})]},t))}),(0,k.jsx)("div",{className:"connection-info",children:(0,k.jsxs)("div",{className:"current-connection",children:["\ud83d\udcf6 Current: ",Pe.getConnectionStatus().quality,"(",Pe.getConnectionStatus().type,")"]})})]})}),ot&&(0,k.jsx)(_,{mode:ut,onCapture:Yn,onClose:Jn}),ct&&(0,k.jsx)(U,{onContactSelect:Xn,onClose:$n}),mt&&(0,k.jsx)(K,{isOpen:mt,onClose:()=>{pt(!1),document.body.classList.remove("contact-manager-open")},onStartChat:ia,onStartCall:ra,currentUser:b,darkMode:p}),bt&&(0,k.jsx)("div",{className:"modal-overlay",onClick:()=>xt(!1),children:(0,k.jsxs)("div",{className:"modal-content call-options-modal",onClick:e=>e.stopPropagation(),children:[(0,k.jsxs)("div",{className:"modal-header",children:[(0,k.jsx)("h3",{children:"Choose Call Type"}),(0,k.jsx)("button",{className:"close-btn",onClick:()=>xt(!1),children:"\xd7"})]}),(0,k.jsxs)("div",{className:"call-options-content",children:[(0,k.jsxs)("button",{className:"call-option-btn international-option",onClick:zs,children:[(0,k.jsx)("span",{className:"call-option-icon",children:"\ud83c\udf0d"}),(0,k.jsxs)("div",{className:"call-option-info",children:[(0,k.jsx)("h4",{children:"International Phone Call"}),(0,k.jsx)("p",{children:"Call any phone number worldwide - completely FREE!"})]})]}),(0,k.jsxs)("button",{className:"call-option-btn app-call-option",onClick:_s,children:[(0,k.jsx)("span",{className:"call-option-icon",children:"\ud83d\udcac"}),(0,k.jsxs)("div",{className:"call-option-info",children:[(0,k.jsx)("h4",{children:"App-to-App Voice Call"}),(0,k.jsx)("p",{children:"High-quality voice call with other Quibish users"})]})]})]})]})}),wt&&(0,k.jsx)(ee,{isOpen:wt,onClose:()=>St(!1),onCall:Os,darkMode:p}),kt&&(0,k.jsx)(se,{isOpen:kt,onClose:()=>jt(!1),darkMode:p,userStats:{callsMade:0,messagesSent:(null===h||void 0===h||null===(r=h.messages)||void 0===r?void 0:r.length)||0,daysUsed:1}}),(0,k.jsx)(ie,{userStats:{callsMade:0,messagesSent:(null===h||void 0===h||null===(o=h.messages)||void 0===o?void 0:o.length)||0,daysUsed:1},darkMode:p,onOpenDonation:()=>jt(!0),position:"bottom-right",autoShow:!0}),V&&(0,k.jsx)(J,{isOpen:V,onClose:()=>G(!1),onUserSelect:Dn,searchQuery:"users"===H?q:"",onSearchQueryChange:B}),gt&&(0,k.jsx)(Q,{isOpen:gt,onClose:()=>ft(!1),onResultSelect:la,currentConversationId:A}),Ft&&Mt&&(0,k.jsx)("div",{className:"thread-view-overlay",onClick:ds,children:(0,k.jsx)("div",{className:"thread-view-panel",onClick:e=>e.stopPropagation(),children:(0,k.jsx)(ne,{thread:Mt,onReply:us,onClose:ds,currentUser:b,compact:!1})})}),_t&&(0,k.jsx)(ve,{userId:b.id,conversationId:A,onClose:()=>Ut(!1),onFileSelect:e=>{Wt(e.id),Bt(!0)}}),qt&&Ht&&(0,k.jsx)(ye,{fileId:Ht,onClose:()=>{Bt(!1),Wt(null)}}),Va.active&&(0,k.jsx)(ke,{callId:Va.callId,participants:Va.withUser?[Va.withUser]:[],onClose:()=>{Ka({active:!1,withUser:null,minimized:!1,audioOnly:!1,callId:null})}}),Je&&(0,k.jsx)(Oe,{isOpen:Je,onClose:xa,onNotificationClick:ya}),(0,k.jsx)(Ue,{onPermissionGranted:()=>{console.log("\u2705 User granted notification permission")},onPermissionDenied:()=>{console.log("\u274c User denied notification permission")}})]})},Xe=()=>{window.innerWidth<=430&&"ontouchstart"in window&&((()=>{const e=()=>{const e=.01*window.innerHeight;if(document.documentElement.style.setProperty("--vh","".concat(e,"px")),window.navigator.userAgent.includes("iPhone")&&window.screen.height>=844&&3===window.devicePixelRatio){document.documentElement.classList.add("iphone-pro");const e=document.querySelector(".auth-form");e&&e.classList.add("iphone-pro-optimized")}};e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(e,100)})})(),(()=>{let e=window.innerHeight;const t=()=>{const t=window.innerHeight;if(e-t>150){document.body.classList.add("keyboard-open");const e=document.activeElement;e&&"INPUT"===e.tagName&&setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},300)}else document.body.classList.remove("keyboard-open")};window.addEventListener("resize",t),document.addEventListener("focusin",e=>{"INPUT"===e.target.tagName&&setTimeout(t,300)}),document.addEventListener("focusout",()=>{setTimeout(()=>{document.body.classList.remove("keyboard-open")},300)})})(),document.addEventListener("touchstart",e=>{e.target.matches('button, .text-button, input[type="submit"]')&&e.target.classList.add("touch-active")}),document.addEventListener("touchend",e=>{e.target.matches('button, .text-button, input[type="submit"]')&&setTimeout(()=>{e.target.classList.remove("touch-active")},150)}),document.querySelectorAll("input").forEach(e=>{e.addEventListener("focus",()=>{e.style.fontSize="16px"})}),new MutationObserver(e=>{e.forEach(e=>{if("childList"===e.type){const t=document.querySelector(".auth-container");t&&e.target.contains(t)&&setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"start"})},100)}})}).observe(document.body,{childList:!0,subtree:!0}),console.log("iPhone Pro authentication enhancements initialized"))},Ze={addIPhoneProClass:()=>!!(window.navigator.userAgent.includes("iPhone")&&window.screen.height>=844&&3===window.devicePixelRatio)&&(document.documentElement.classList.add("iphone-pro"),!0),isKeyboardOpen:()=>document.body.classList.contains("keyboard-open"),scrollToAuthForm:()=>{const e=document.querySelector(".auth-form");e&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}},et=e=>{let{onLogin:t,switchToRegister:n}=e;const{login:s}=C(),[i,r]=(0,a.useState)(""),[o,l]=(0,a.useState)(""),[c,d]=(0,a.useState)(!1),[u,h]=(0,a.useState)(null),[m,p]=(0,a.useState)(!1),[g,f]=(0,a.useState)(!1),[v,y]=(0,a.useState)(!1),[b,x]=(0,a.useState)("checking"),[w,S]=(0,a.useState)(!1),[j,N]=(0,a.useState)(null),[E,T]=(0,a.useState)(""),I=(0,a.useRef)(null);(0,a.useEffect)(()=>{I.current&&I.current.focus(),Xe(),Ze.addIPhoneProClass();(async()=>{await We()?(console.log("API server is online"),x("online")):(console.log("API server appears to be offline"),h("\ud83c\udf10 Unable to connect to server. Please check your connection and try again."),x("offline"))})()},[]);return(0,k.jsx)("div",{className:"login-container",children:(0,k.jsxs)("div",{className:"auth-form",children:[(0,k.jsxs)("div",{className:"elegant-header",children:[(0,k.jsxs)("div",{className:"brand-section",children:[(0,k.jsx)("div",{className:"brand-icon",children:(0,k.jsx)("span",{className:"brand-emoji",children:"\ud83d\udcac"})}),(0,k.jsxs)("div",{className:"brand-content",children:[(0,k.jsx)("h2",{className:"brand-title",children:"Welcome Back"}),(0,k.jsx)("p",{className:"brand-subtitle",children:"Sign in to continue your conversation"})]})]}),(0,k.jsx)("div",{className:"decorative-line"})]}),"checking"!==b&&(0,k.jsxs)("div",{className:"server-status ".concat(b),children:[(0,k.jsx)("div",{className:"status-indicator"}),(0,k.jsx)("div",{className:"status-text",children:"online"===b?"Server Online":"Server Offline"})]}),(0,k.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),y(!0),i.trim()?o?!(o.length<6)||(h("Password must be at least 6 characters"),0):(h("Password is required"),0):(h("Username or email is required"),0)){p(!0),h(null);try{console.log("Login Component - Attempting login with:",{username:i});const e=await He.login(i,o);if(console.log("Login Component - Login response:",e),!e)throw console.error("Login Component - Empty response received"),new Error("No response from server");if(e.requiresTwoFactor)return console.log("Login Component - 2FA required for user:",e.userId),N(e.userId),T(i),S(!0),void p(!1);if(!e.user)throw console.error("Login Component - Missing user data in response"),new Error("User data missing from response");if(!e.token)throw console.error("Login Component - Missing token in response"),new Error("Authentication token missing from response");console.log("Login Component - Login successful, saving session"),s(e.user,e.token,c),t(e.user,e.token),console.log("Login Component - Session saved and parent notified")}catch(n){if(console.error("Login Component - Login error:",n),n.response){const e=n.response.data;console.error("Login Component - Server error response:",e),e.error?h(e.error):e.message?h(e.message):401===n.response.status?h("Invalid username or password. Please try again."):404===n.response.status?h("Server endpoint not found. Is the server running?"):h("Server error (".concat(n.response.status,"). Please try again later."))}else n.request?(console.error("Login Component - Network error, no response received"),h("Unable to connect to server. Please check your internet connection and try again."),We().then(e=>{e||h("Server appears to be offline. Please try again later.")})):(console.error("Login Component - Other error:",n.message),h(n.message||"Login failed. Please try again."))}finally{p(!1)}}},children:[(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{htmlFor:"username",children:"Username or Email"}),(0,k.jsxs)("div",{className:"input-wrapper",children:[(0,k.jsx)("input",{id:"username",type:"text",value:i,onChange:e=>r(e.target.value),onBlur:()=>y(!0),ref:I,required:!0,autoComplete:"username email",placeholder:"Enter your username or email",className:v&&!i.trim()?"error-input":""}),i&&(0,k.jsx)("button",{type:"button",className:"clear-input",onClick:()=>r(""),"aria-label":"Clear username",children:"\u2715"})]}),v&&!i.trim()&&(0,k.jsx)("div",{className:"field-error",children:"Username or email is required"})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{htmlFor:"password",children:"Password"}),(0,k.jsxs)("div",{className:"input-wrapper",children:[(0,k.jsx)("input",{id:"password",type:g?"text":"password",value:o,onChange:e=>l(e.target.value),onBlur:()=>y(!0),required:!0,autoComplete:"current-password",placeholder:"Enter your password",className:v&&!o?"error-input":""}),(0,k.jsx)("button",{type:"button",className:"toggle-password",onClick:()=>f(!g),"aria-label":g?"Hide password":"Show password",children:g?"\ud83d\udc41\ufe0f":"\ud83d\udc41\ufe0f\u200d\ud83d\udde8\ufe0f"})]}),v&&!o&&(0,k.jsx)("div",{className:"field-error",children:"Password is required"}),v&&o&&o.length<6&&(0,k.jsx)("div",{className:"field-error",children:"Password must be at least 6 characters"})]}),(0,k.jsxs)("div",{className:"form-options",children:[(0,k.jsxs)("label",{className:"checkbox-container",children:[(0,k.jsx)("input",{type:"checkbox",checked:c,onChange:e=>d(e.target.checked)}),(0,k.jsx)("span",{className:"checkmark"}),"Remember me"]}),(0,k.jsx)("button",{type:"button",className:"forgot-password",onClick:()=>console.log("Forgot password clicked"),children:"Forgot password?"})]}),(0,k.jsx)("button",{type:"submit",className:"auth-button",disabled:m,children:m?(0,k.jsxs)("span",{className:"button-with-loader",children:[(0,k.jsx)("span",{className:"loader"}),(0,k.jsx)("span",{children:"Signing in..."})]}):(0,k.jsx)("span",{children:"Sign In"})}),u&&(0,k.jsxs)("div",{className:"auth-error",children:[(0,k.jsx)("div",{className:"error-icon",children:"\u2757"}),(0,k.jsx)("div",{className:"error-message",children:u})]})]}),(0,k.jsxs)("div",{className:"auth-switch",children:["Don't have an account?"," ",(0,k.jsx)("button",{className:"text-button",onClick:n,children:"Sign Up"})]})]})})};const tt=new class{constructor(){this.emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,this.disposableEmailDomains=["10minutemail.com","tempmail.org","guerrillamail.com","mailinator.com","throwaway.email"]}isValidFormat(e){return!(!e||"string"!==typeof e)&&this.emailRegex.test(e.trim().toLowerCase())}isDisposableEmail(e){if(!this.isValidFormat(e))return!1;const t=e.split("@")[1].toLowerCase();return this.disposableEmailDomains.includes(t)}validateEmail(e){const t={isValid:!1,errors:[],warnings:[]};if(!e||""===e.trim())return t.errors.push("Email is required"),t;const n=e.trim().toLowerCase();return this.isValidFormat(n)?n.length>254?(t.errors.push("Email is too long"),t):n.includes("..")?(t.errors.push("Email cannot contain consecutive dots"),t):n.startsWith(".")||n.endsWith(".")?(t.errors.push("Email cannot start or end with a dot"),t):(this.isDisposableEmail(n)&&t.warnings.push("Disposable email addresses are not recommended"),t.isValid=!0,t):(t.errors.push("Invalid email format"),t)}suggestCorrection(e){if(!e)return null;const t=e.split("@");if(2!==t.length)return null;const[n,a]=t,s={"gmail.co":"gmail.com","gmail.cm":"gmail.com","gmial.com":"gmail.com","gmai.com":"gmail.com","yahoo.co":"yahoo.com","yahoo.cm":"yahoo.com","hotmai.com":"hotmail.com","hotmial.com":"hotmail.com","outlook.co":"outlook.com","outlok.com":"outlook.com"}[a.toLowerCase()];return s?"".concat(n,"@").concat(s):null}validateRealTime(e){if(!e)return{isValid:!1,message:""};if(e.length<3)return{isValid:!1,message:"Email is too short"};if(!e.includes("@"))return{isValid:!1,message:"Email must contain @"};const t=this.validateEmail(e);return t.isValid?t.warnings.length>0?{isValid:!0,message:t.warnings[0],isWarning:!0}:{isValid:!0,message:"Valid email"}:{isValid:!1,message:t.errors[0]||"Invalid email"}}async validateEmailAsync(e){const t=this.validateEmail(e);if(!t.isValid)return t;await new Promise(e=>setTimeout(e,500));return c(c({},t),{},{deliverable:Math.random()>.1,riskScore:Math.floor(100*Math.random()),suggestedCorrection:this.suggestCorrection(e)})}},nt=e=>{let{onRegisterSuccess:t,switchToLogin:n}=e;const[s,i]=(0,a.useState)(""),[r,o]=(0,a.useState)(""),[l,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),[h,m]=(0,a.useState)(null),[p,g]=(0,a.useState)(!1),[f,v]=(0,a.useState)(!1),[y,b]=(0,a.useState)(!1),[x,w]=(0,a.useState)(!1),[S,j]=(0,a.useState)({}),[N,C]=(0,a.useState)("checking"),[E,T]=(0,a.useState)(!1),[I,P]=(0,a.useState)(null),[D,A]=(0,a.useState)(!1),[M,R]=(0,a.useState)({score:0,feedback:[]}),F=(0,a.useRef)(null);(0,a.useEffect)(()=>{F.current&&F.current.focus(),Xe(),Ze.addIPhoneProClass(),We().then(e=>{e?(console.log("API server is online"),C("online")):(console.log("API server appears to be offline"),m("Server connection failed. Please try again later."),C("offline"))})},[]),(0,a.useEffect)(()=>{if(r){const e=L(r);R(e)}else R({score:0,feedback:[]})},[r]);const L=e=>{let t=0;const n=[];return e.length>=8?t+=1:n.push("Use at least 8 characters"),/[a-z]/.test(e)?t+=1:n.push("Include lowercase letters"),/[A-Z]/.test(e)?t+=1:n.push("Include uppercase letters"),/\d/.test(e)?t+=1:n.push("Include numbers"),/[^\w\s]/.test(e)?t+=1:n.push("Include special characters"),{score:t,feedback:n}};return(0,k.jsx)("div",{className:"login-container",children:(0,k.jsxs)("div",{className:"auth-form tall-form",children:[(0,k.jsxs)("div",{className:"elegant-header",children:[(0,k.jsxs)("div",{className:"brand-section",children:[(0,k.jsx)("div",{className:"brand-icon",children:(0,k.jsx)("span",{className:"brand-emoji",children:"\u2728"})}),(0,k.jsxs)("div",{className:"brand-content",children:[(0,k.jsx)("h2",{className:"brand-title",children:"Create Account"}),(0,k.jsx)("p",{className:"brand-subtitle",children:"Join the conversation and get started"})]})]}),(0,k.jsx)("div",{className:"decorative-line"})]}),"checking"!==N&&(0,k.jsxs)("div",{className:"server-status ".concat(N),children:[(0,k.jsx)("div",{className:"status-indicator"}),(0,k.jsx)("div",{className:"status-text",children:"online"===N?"Server Online":"Server Offline - Demo Mode"})]}),(0,k.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{w(!0);const e={};return s.trim()?s.length<3?e.username="Username must be at least 3 characters":s.length>20?e.username="Username must be less than 20 characters":/^[a-zA-Z0-9_]+$/.test(s)?/^\d/.test(s)&&(e.username="Username cannot start with a number"):e.username="Username can only contain letters, numbers and underscore":e.username="Username is required",d.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d)?d.length>254&&(e.email="Email address is too long"):e.email="Please enter a valid email address":e.email="Email is required",r?r.length<8?e.password="Password must be at least 8 characters":M.score<3&&(e.password="Password is too weak. Please strengthen it."):e.password="Password is required",l?r!==l&&(e.confirmPassword="Passwords do not match"):e.confirmPassword="Please confirm your password",j(e),0===Object.keys(e).length})())if(g(!0),m(null),E)setTimeout(()=>{console.log("Using demo mode registration");const e={id:Date.now(),username:s,email:d},n="offline-token-"+Date.now().toString().slice(-6);He.saveUserSession(e,n,!0),t(e,n),g(!1)},1e3);else try{console.log("Register Component - Starting email verification for:",{username:s,email:d});const e=await tt.sendVerificationEmail(d,s,r);e.success&&(P({verificationId:e.verificationId,email:d,expiresAt:e.expiresAt}),A(!0))}catch(n){console.error("Register Component - Email verification error:",n),m(n.message||"Failed to send verification email. Please try again.")}finally{g(!1)}},children:[(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{htmlFor:"username",children:"Username"}),(0,k.jsxs)("div",{className:"input-wrapper",children:[(0,k.jsx)("input",{id:"username",type:"text",value:s,onChange:e=>i(e.target.value),onBlur:()=>w(!0),ref:F,required:!0,placeholder:"Choose a username",className:x&&S.username?"error-input":""}),s&&(0,k.jsx)("button",{type:"button",className:"clear-input",onClick:()=>i(""),"aria-label":"Clear username",children:"\u2715"})]}),x&&S.username&&(0,k.jsx)("div",{className:"field-error",children:S.username})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{htmlFor:"email",children:"Email"}),(0,k.jsxs)("div",{className:"input-wrapper",children:[(0,k.jsx)("input",{id:"email",type:"email",value:d,onChange:e=>u(e.target.value),onBlur:()=>w(!0),required:!0,placeholder:"Your email address",className:x&&S.email?"error-input":""}),d&&(0,k.jsx)("button",{type:"button",className:"clear-input",onClick:()=>u(""),"aria-label":"Clear email",children:"\u2715"})]}),x&&S.email&&(0,k.jsx)("div",{className:"field-error",children:S.email})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{htmlFor:"password",children:"Password"}),(0,k.jsxs)("div",{className:"input-wrapper",children:[(0,k.jsx)("input",{id:"password",type:f?"text":"password",value:r,onChange:e=>o(e.target.value),onBlur:()=>w(!0),required:!0,placeholder:"Choose a password",className:x&&S.password?"error-input":""}),(0,k.jsx)("button",{type:"button",className:"toggle-password",onClick:()=>v(!f),"aria-label":f?"Hide password":"Show password",children:f?"\ud83d\udc41\ufe0f":"\ud83d\udc41\ufe0f\u200d\ud83d\udde8\ufe0f"})]}),x&&S.password&&(0,k.jsx)("div",{className:"field-error",children:S.password})]}),(0,k.jsxs)("div",{className:"form-group",children:[(0,k.jsx)("label",{htmlFor:"confirmPassword",children:"Confirm Password"}),(0,k.jsxs)("div",{className:"input-wrapper",children:[(0,k.jsx)("input",{id:"confirmPassword",type:y?"text":"password",value:l,onChange:e=>c(e.target.value),onBlur:()=>w(!0),required:!0,placeholder:"Confirm your password",className:x&&S.confirmPassword?"error-input":""}),(0,k.jsx)("button",{type:"button",className:"toggle-password",onClick:()=>b(!y),"aria-label":y?"Hide password":"Show password",children:y?"\ud83d\udc41\ufe0f":"\ud83d\udc41\ufe0f\u200d\ud83d\udde8\ufe0f"})]}),x&&S.confirmPassword&&(0,k.jsx)("div",{className:"field-error",children:S.confirmPassword})]}),(0,k.jsx)("button",{type:"submit",className:"auth-button",disabled:p,children:p?(0,k.jsxs)("span",{className:"button-with-loader",children:[(0,k.jsx)("span",{className:"loader"}),(0,k.jsx)("span",{children:"Creating account..."})]}):(0,k.jsx)("span",{children:"Sign Up"})}),h&&(0,k.jsxs)("div",{className:"auth-error",children:[(0,k.jsx)("div",{className:"error-icon",children:"\u2757"}),(0,k.jsx)("div",{className:"error-message",children:h})]})]}),(0,k.jsxs)("div",{className:"auth-switch",children:["Already have an account?"," ",(0,k.jsx)("button",{className:"text-button",onClick:n,children:"Log In"})]}),(0,k.jsx)("div",{className:"demo-mode-switch",children:(0,k.jsxs)("label",{className:"checkbox-container",children:[(0,k.jsx)("input",{type:"checkbox",checked:E,onChange:e=>T(e.target.checked)}),(0,k.jsx)("span",{className:"checkmark"}),"Use Demo Mode ",E&&"(Account will be stored locally)"]})})]})})},at=e=>{let{size:t="medium",message:n="Loading..."}=e;return(0,k.jsxs)("div",{className:"loading-spinner-container ".concat(t),children:[(0,k.jsxs)("div",{className:"loading-spinner",children:[(0,k.jsx)("div",{className:"spinner-ring"}),(0,k.jsx)("div",{className:"spinner-ring"}),(0,k.jsx)("div",{className:"spinner-ring"})]}),n&&(0,k.jsx)("p",{className:"loading-message",children:n})]})},st=e=>{let{isVisible:t=!0,darkMode:n=!1,appVersion:s="1.0.0",onComplete:i}=e;const[r,o]=(0,a.useState)(0),[l,c]=(0,a.useState)("Initializing..."),[d,u]=(0,a.useState)([]);return(0,a.useEffect)(()=>{const e=Array.from({length:20},(e,t)=>({id:t,left:100*Math.random(),top:100*Math.random(),size:4*Math.random()+2,duration:3*Math.random()+2,delay:2*Math.random()}));u(e)},[]),(0,a.useEffect)(()=>{if(!t)return;const e=[{progress:20,text:"Loading components..."},{progress:40,text:"Connecting to services..."},{progress:60,text:"Preparing interface..."},{progress:80,text:"Finalizing setup..."},{progress:100,text:"Ready!"}];let n=0;const a=setInterval(()=>{n<e.length?(o(e[n].progress),c(e[n].text),n++):(clearInterval(a),setTimeout(()=>{i&&i()},500))},300);return()=>clearInterval(a)},[t,i]),t?(0,k.jsxs)("div",{className:"dynamic-splash-screen ".concat(n?"dark-mode":""),children:[(0,k.jsx)("div",{className:"splash-particles",children:d.map(e=>(0,k.jsx)("div",{className:"particle",style:{left:"".concat(e.left,"%"),top:"".concat(e.top,"%"),width:"".concat(e.size,"px"),height:"".concat(e.size,"px"),animationDuration:"".concat(e.duration,"s"),animationDelay:"".concat(e.delay,"s")}},e.id))}),(0,k.jsxs)("div",{className:"splash-ripples",children:[(0,k.jsx)("div",{className:"ripple ripple-1"}),(0,k.jsx)("div",{className:"ripple ripple-2"}),(0,k.jsx)("div",{className:"ripple ripple-3"})]}),(0,k.jsxs)("div",{className:"floating-shapes",children:[(0,k.jsx)("div",{className:"shape shape-circle"}),(0,k.jsx)("div",{className:"shape shape-triangle"}),(0,k.jsx)("div",{className:"shape shape-square"})]}),(0,k.jsxs)("div",{className:"splash-content",children:[(0,k.jsxs)("div",{className:"splash-logo",children:[(0,k.jsxs)("div",{className:"logo-wrapper",children:[(0,k.jsx)("div",{className:"logo-glow"}),(0,k.jsxs)("h1",{className:"logo-text",children:[(0,k.jsx)("span",{className:"letter",style:{animationDelay:"0s"},children:"Q"}),(0,k.jsx)("span",{className:"letter",style:{animationDelay:"0.1s"},children:"u"}),(0,k.jsx)("span",{className:"letter",style:{animationDelay:"0.2s"},children:"i"}),(0,k.jsx)("span",{className:"letter",style:{animationDelay:"0.3s"},children:"b"}),(0,k.jsx)("span",{className:"letter",style:{animationDelay:"0.4s"},children:"i"}),(0,k.jsx)("span",{className:"letter",style:{animationDelay:"0.5s"},children:"s"}),(0,k.jsx)("span",{className:"letter",style:{animationDelay:"0.6s"},children:"h"})]})]}),(0,k.jsxs)("p",{className:"version",children:["v",s]}),(0,k.jsx)("div",{className:"tagline",children:"Connect. Chat. Create."})]}),(0,k.jsxs)("div",{className:"splash-progress",children:[(0,k.jsx)("div",{className:"progress-bar",children:(0,k.jsx)("div",{className:"progress-fill",style:{width:"".concat(r,"%")},children:(0,k.jsx)("div",{className:"progress-shimmer"})})}),(0,k.jsxs)("p",{className:"loading-text",children:[(0,k.jsx)("span",{className:"loading-icon",children:"\u26a1"}),l]}),(0,k.jsxs)("div",{className:"loading-dots",children:[(0,k.jsx)("span",{className:"dot"}),(0,k.jsx)("span",{className:"dot"}),(0,k.jsx)("span",{className:"dot"})]})]})]})]}):null};class it extends a.Component{constructor(e){super(e),this.handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})},this.handleReload=()=>{window.location.reload()},this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?(0,k.jsx)("div",{className:"error-boundary",children:(0,k.jsxs)("div",{className:"error-content",children:[(0,k.jsx)("div",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,k.jsx)("h2",{children:"Something went wrong"}),(0,k.jsx)("p",{children:"We're sorry, but something unexpected happened."}),!1,(0,k.jsxs)("div",{className:"error-actions",children:[(0,k.jsx)("button",{onClick:this.handleReset,className:"retry-btn",children:"Try Again"}),(0,k.jsx)("button",{onClick:this.handleReload,className:"reload-btn",children:"Reload Page"})]})]})}):this.props.children}}const rt=it,ot=()=>{const[e,t]=(0,a.useState)(navigator.onLine),[n,s]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",n),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{s(!0)}),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}},[]);const i=()=>{window.location.reload()};return e?n?(0,k.jsxs)("div",{className:"pwa-status update-available",children:[(0,k.jsx)("span",{className:"status-icon",children:"\ud83d\udd04"}),(0,k.jsx)("span",{className:"status-text",children:"Update Available"}),(0,k.jsx)("button",{onClick:i,className:"refresh-btn",children:"Refresh"})]}):null:(0,k.jsxs)("div",{className:"pwa-status offline",children:[(0,k.jsx)("span",{className:"status-icon",children:"\ud83d\udce1"}),(0,k.jsx)("span",{className:"status-text",children:"Offline Mode"})]})},lt=()=>{const[e,t]=(0,a.useState)(null),[n,s]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=e=>{e.preventDefault(),t(e),s(!0)};return window.addEventListener("beforeinstallprompt",e),()=>{window.removeEventListener("beforeinstallprompt",e)}},[]);return n&&e?(0,k.jsx)("div",{className:"install-prompt",children:(0,k.jsxs)("div",{className:"install-prompt-content",children:[(0,k.jsx)("div",{className:"install-icon",children:"\ud83d\udcf1"}),(0,k.jsxs)("div",{className:"install-text",children:[(0,k.jsx)("h3",{children:"Install Quibish"}),(0,k.jsx)("p",{children:"Add to your home screen for a better experience"})]}),(0,k.jsxs)("div",{className:"install-actions",children:[(0,k.jsx)("button",{onClick:async()=>{if(!e)return;e.prompt();"accepted"===(await e.userChoice).outcome&&console.log("PWA install accepted"),t(null),s(!1)},className:"install-btn",children:"Install"}),(0,k.jsx)("button",{onClick:()=>{s(!1),t(null)},className:"dismiss-btn",children:"\u2715"})]})]})}):null};const ct=new class{constructor(){this.currentTheme="default",this.backgroundType="static",this.seasonalThemes=this.getSeasonalThemes(),this.customThemes=new Map,this.backgroundAnimations=new Map,this.init()}init(){this.detectAndApplySeason(),this.setupTimeBasedThemes(),this.initBackgroundEffects()}getSeasonalThemes(){return{spring:{name:"Spring Bloom",colors:{primary:"#10b981",secondary:"#34d399",accent:"#f59e0b",background:"linear-gradient(135deg, #ecfdf5 0%, #d1fae5 50%, #a7f3d0 100%)",particles:["\ud83c\udf38","\ud83c\udf31","\ud83e\udd8b","\ud83c\udf3f"]},effects:["floating-petals","gentle-breeze"]},summer:{name:"Summer Vibes",colors:{primary:"#3b82f6",secondary:"#60a5fa",accent:"#f59e0b",background:"linear-gradient(135deg, #dbeafe 0%, #93c5fd 50%, #60a5fa 100%)",particles:["\u2600\ufe0f","\ud83c\udf0a","\ud83c\udfd6\ufe0f","\ud83c\udf1e"]},effects:["sun-rays","wave-motion"]},autumn:{name:"Autumn Leaves",colors:{primary:"#f59e0b",secondary:"#fb923c",accent:"#dc2626",background:"linear-gradient(135deg, #fef3c7 0%, #fed7aa 50%, #fdba74 100%)",particles:["\ud83c\udf42","\ud83c\udf41","\ud83c\udf30","\ud83c\udf44"]},effects:["falling-leaves","wind-rustle"]},winter:{name:"Winter Wonder",colors:{primary:"#6366f1",secondary:"#818cf8",accent:"#06b6d4",background:"linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 50%, #cbd5e1 100%)",particles:["\u2744\ufe0f","\u2b50","\ud83c\udf28\ufe0f","\u2728"]},effects:["snowfall","twinkling-stars"]}}}detectAndApplySeason(){const e=(new Date).getMonth();let t;t=e>=2&&e<=4?"spring":e>=5&&e<=7?"summer":e>=8&&e<=10?"autumn":"winter";const n=localStorage.getItem("quibish-theme-preference");n&&"auto"!==n?this.applyTheme(n):this.applySeasonalTheme(t)}applySeasonalTheme(e){const t=this.seasonalThemes[e];t&&(this.currentTheme=e,this.updateCSSVariables(t.colors),this.setBackground(t.colors.background),this.updateParticles(t.colors.particles),this.applyEffects(t.effects),console.log("\ud83c\udfa8 Applied ".concat(t.name," theme")))}applyTheme(e){if(this.seasonalThemes[e])this.applySeasonalTheme(e);else if(this.customThemes.has(e)){const t=this.customThemes.get(e);this.updateCSSVariables(t.colors),this.setBackground(t.background)}localStorage.setItem("quibish-theme-preference",e)}updateCSSVariables(e){const t=document.documentElement;Object.entries(e).forEach(e=>{let[n,a]=e;"background"!==n&&"particles"!==n&&t.style.setProperty("--theme-".concat(n),a)})}setBackground(e){const t=document.querySelector(".app");t&&(t.style.background=e,t.style.transition="background 1s ease-in-out")}initBackgroundEffects(){this.createParticleSystem(),this.createAnimatedShapes()}createParticleSystem(){const e=document.createElement("div");e.className="dynamic-particles",e.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n      z-index: -1;\n      overflow: hidden;\n    ",document.body.appendChild(e),this.particleContainer=e}updateParticles(e){if(this.particleContainer){this.particleContainer.innerHTML="";for(let t=0;t<20;t++){const t=this.createParticle(e);this.particleContainer.appendChild(t)}}}createParticle(e){const t=document.createElement("div"),n=e[Math.floor(Math.random()*e.length)],a=20*Math.random()+10,s=100*Math.random(),i=10*Math.random()+15,r=5*Math.random();return t.textContent=n,t.style.cssText="\n      position: absolute;\n      font-size: ".concat(a,"px;\n      left: ").concat(s,"%;\n      top: -50px;\n      animation: particleFall ").concat(i,"s linear infinite;\n      animation-delay: ").concat(r,"s;\n      opacity: 0.7;\n    "),t}createAnimatedShapes(){const e=document.createElement("div");e.className="animated-shapes",e.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n      z-index: -2;\n      overflow: hidden;\n    ";for(let t=0;t<5;t++){const t=this.createAnimatedShape();e.appendChild(t)}document.body.appendChild(e)}createAnimatedShape(){const e=document.createElement("div"),t=100*Math.random()+50,n=100*Math.random(),a=100*Math.random(),s=360*Math.random(),i=20*Math.random()+10,r=Math.random();let o="0";return r<.33?o="50%":r<.66&&(o="25%"),e.style.cssText="\n      position: absolute;\n      width: ".concat(t,"px;\n      height: ").concat(t,"px;\n      left: ").concat(n,"%;\n      top: ").concat(a,"%;\n      background: linear-gradient(45deg, \n        rgba(99, 102, 241, 0.1), \n        rgba(139, 92, 246, 0.1));\n      border-radius: ").concat(o,";\n      transform: rotate(").concat(s,"deg);\n      animation: floatShape ").concat(i,"s ease-in-out infinite;\n      opacity: 0.3;\n    "),e}applyEffects(e){e.forEach(e=>{switch(e){case"floating-petals":this.createFloatingPetals();break;case"snowfall":this.createSnowfall();break;case"sun-rays":this.createSunRays();break;case"falling-leaves":this.createFallingLeaves()}})}createFloatingPetals(){const e=document.createElement("style");e.textContent="\n      @keyframes petalFloat {\n        0% { transform: translateY(100vh) rotateZ(0deg); }\n        100% { transform: translateY(-100px) rotateZ(360deg); }\n      }\n      .petal-particle {\n        animation: petalFloat 8s linear infinite !important;\n      }\n    ",document.head.appendChild(e)}createSnowfall(){const e=document.createElement("style");e.textContent="\n      @keyframes snowfall {\n        0% { transform: translateY(-100px) translateX(0px); }\n        100% { transform: translateY(100vh) translateX(100px); }\n      }\n      .snow-particle {\n        animation: snowfall 6s linear infinite !important;\n      }\n    ",document.head.appendChild(e)}createSunRays(){const e=document.createElement("div");e.className="sun-rays",e.style.cssText="\n      position: fixed;\n      top: -50%;\n      left: -50%;\n      width: 200%;\n      height: 200%;\n      background: radial-gradient(\n        circle at 70% 20%, \n        rgba(251, 191, 36, 0.1) 0%, \n        transparent 50%\n      );\n      animation: sunRotate 30s linear infinite;\n      pointer-events: none;\n      z-index: -1;\n    ",document.body.appendChild(e);const t=document.createElement("style");t.textContent="\n      @keyframes sunRotate {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n    ",document.head.appendChild(t)}createFallingLeaves(){const e=document.createElement("style");e.textContent="\n      @keyframes leafFall {\n        0% { \n          transform: translateY(-100px) rotateZ(0deg) translateX(0px);\n          opacity: 1;\n        }\n        50% { \n          transform: translateY(50vh) rotateZ(180deg) translateX(50px);\n          opacity: 0.8;\n        }\n        100% { \n          transform: translateY(100vh) rotateZ(360deg) translateX(-50px);\n          opacity: 0;\n        }\n      }\n      .leaf-particle {\n        animation: leafFall 10s ease-in-out infinite !important;\n      }\n    ",document.head.appendChild(e)}setupTimeBasedThemes(){setInterval(()=>{const e=(new Date).getHours();"true"===localStorage.getItem("quibish-auto-dark")&&(e>=20||e<=6?this.enableDarkMode():this.disableDarkMode())},6e4)}enableDarkMode(){document.body.classList.add("dark-theme");document.documentElement.style.setProperty("--theme-background","linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%)")}disableDarkMode(){document.body.classList.remove("dark-theme"),this.detectAndApplySeason()}createCustomTheme(e,t,n){this.customThemes.set(e,{colors:t,background:n}),localStorage.setItem("quibish-custom-theme-".concat(e),JSON.stringify({colors:t,background:n}))}getAvailableThemes(){return{seasonal:Object.keys(this.seasonalThemes).map(e=>({id:e,name:this.seasonalThemes[e].name,preview:this.seasonalThemes[e].colors.background})),custom:Array.from(this.customThemes.keys()).map(e=>({id:e,name:e,preview:this.customThemes.get(e).background}))}}addAnimationStyles(){const e=document.createElement("style");e.textContent="\n      @keyframes particleFall {\n        0% {\n          transform: translateY(-100px) rotate(0deg);\n          opacity: 0;\n        }\n        10% {\n          opacity: 1;\n        }\n        90% {\n          opacity: 1;\n        }\n        100% {\n          transform: translateY(100vh) rotate(360deg);\n          opacity: 0;\n        }\n      }\n\n      @keyframes floatShape {\n        0%, 100% {\n          transform: translateY(0px) rotate(0deg);\n        }\n        33% {\n          transform: translateY(-20px) rotate(120deg);\n        }\n        66% {\n          transform: translateY(10px) rotate(240deg);\n        }\n      }\n\n      .dynamic-particles {\n        transition: opacity 0.5s ease;\n      }\n\n      .animated-shapes {\n        transition: opacity 0.5s ease;\n      }\n\n      @media (prefers-reduced-motion: reduce) {\n        .dynamic-particles,\n        .animated-shapes,\n        .sun-rays {\n          display: none !important;\n        }\n      }\n    ",document.head.appendChild(e)}toggleEffects(e){const t=document.querySelector(".dynamic-particles"),n=document.querySelector(".animated-shapes");t&&(t.style.opacity=e?"1":"0"),n&&(n.style.opacity=e?"1":"0")}cleanup(){const e=document.querySelector(".dynamic-particles"),t=document.querySelector(".animated-shapes"),n=document.querySelector(".sun-rays");e&&e.remove(),t&&t.remove(),n&&n.remove(),this.backgroundAnimations.forEach(e=>{e.cancel&&e.cancel()}),this.backgroundAnimations.clear()}},dt=ct,ut=()=>{var e,t;const[n,s]=(0,a.useState)("auto"),[i,r]=(0,a.useState)(!1),[o,l]=(0,a.useState)(!0),[c,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{const e=localStorage.getItem("quibish-theme-preference")||"auto",t=localStorage.getItem("quibish-effects-enabled"),n=localStorage.getItem("quibish-auto-mode");s(e),l("false"!==t),d("false"!==n),"false"===t&&dt.toggleEffects(!1),dt.addAnimationStyles()},[]);const u=[{id:"auto",name:"Auto (Seasonal)",icon:"\ud83c\udf1f",description:"Automatically changes with seasons"},{id:"spring",name:"Spring Bloom",icon:"\ud83c\udf38",description:"Fresh greens and blooming flowers"},{id:"summer",name:"Summer Vibes",icon:"\u2600\ufe0f",description:"Bright blues and sunny vibes"},{id:"autumn",name:"Autumn Leaves",icon:"\ud83c\udf42",description:"Warm oranges and falling leaves"},{id:"winter",name:"Winter Wonder",icon:"\u2744\ufe0f",description:"Cool blues and snowy effects"},{id:"dark",name:"Dark Mode",icon:"\ud83c\udf19",description:"Easy on the eyes"},{id:"cosmic",name:"Cosmic",icon:"\ud83c\udf0c",description:"Deep space vibes"},{id:"ocean",name:"Ocean Depths",icon:"\ud83c\udf0a",description:"Calming ocean blues"}],h=e=>{s(e),"auto"===e?(d(!0),localStorage.setItem("quibish-auto-mode","true"),dt.detectAndApplySeason()):(d(!1),localStorage.setItem("quibish-auto-mode","false"),dt.applyTheme(e)),localStorage.setItem("quibish-theme-preference",e)};return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("button",{className:"theme-toggle ".concat(i?"active":""),onClick:()=>r(!i),title:"Theme Settings",children:(0,k.jsx)("span",{className:"theme-icon",children:"\ud83c\udfa8"})}),i&&(0,k.jsxs)("div",{className:"theme-panel",children:[(0,k.jsxs)("div",{className:"theme-panel-header",children:[(0,k.jsx)("h3",{children:"\ud83c\udfa8 Themes & Effects"}),(0,k.jsx)("button",{className:"close-btn",onClick:()=>r(!1),children:"\u2715"})]}),(0,k.jsxs)("div",{className:"theme-panel-content",children:[(0,k.jsxs)("div",{className:"theme-section",children:[(0,k.jsx)("h4",{children:"Choose Theme"}),(0,k.jsx)("div",{className:"theme-grid",children:u.map(e=>(0,k.jsxs)("div",{className:"theme-card ".concat(n===e.id?"active":""),onClick:()=>h(e.id),children:[(0,k.jsx)("div",{className:"theme-preview",children:(0,k.jsx)("span",{className:"theme-emoji",children:e.icon})}),(0,k.jsxs)("div",{className:"theme-info",children:[(0,k.jsx)("div",{className:"theme-name",children:e.name}),(0,k.jsx)("div",{className:"theme-description",children:e.description})]})]},e.id))})]}),(0,k.jsxs)("div",{className:"theme-section",children:[(0,k.jsx)("h4",{children:"Visual Effects"}),(0,k.jsxs)("div",{className:"effects-controls",children:[(0,k.jsxs)("label",{className:"toggle-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:o,onChange:()=>{const e=!o;l(e),dt.toggleEffects(e),localStorage.setItem("quibish-effects-enabled",e.toString())}}),(0,k.jsx)("span",{className:"toggle-slider"}),(0,k.jsx)("span",{className:"toggle-text",children:o?"\u2728 Effects On":"\ud83d\udeab Effects Off"})]}),(0,k.jsxs)("label",{className:"toggle-label",children:[(0,k.jsx)("input",{type:"checkbox",checked:c,onChange:e=>{d(e.target.checked),localStorage.setItem("quibish-auto-mode",e.target.checked.toString()),e.target.checked&&h("auto")}}),(0,k.jsx)("span",{className:"toggle-slider"}),(0,k.jsx)("span",{className:"toggle-text",children:c?"\ud83c\udf1f Auto Season":"\ud83d\udd12 Manual Mode"})]})]})]}),(0,k.jsxs)("div",{className:"theme-section",children:[(0,k.jsx)("h4",{children:"Personalization"}),(0,k.jsxs)("button",{className:"custom-theme-btn",onClick:()=>{const e=prompt("Enter custom theme name:");if(!e)return;const t=prompt("Enter primary color (hex):")||"#3b82f6",n=prompt("Enter secondary color (hex):")||"#60a5fa",a=prompt("Enter accent color (hex):")||"#f59e0b",s={primary:t,secondary:n,accent:a},i="linear-gradient(135deg, ".concat(t,"20 0%, ").concat(n,"20 50%, ").concat(a,"20 100%)");dt.createCustomTheme(e,s,i),h(e)},children:[(0,k.jsx)("span",{children:"\ud83c\udfa8"}),"Create Custom Theme"]})]}),(0,k.jsx)("div",{className:"theme-section",children:(0,k.jsxs)("div",{className:"current-theme-info",children:[(0,k.jsx)("h4",{children:"Current Theme"}),(0,k.jsxs)("div",{className:"current-theme-display",children:[(0,k.jsx)("span",{className:"current-theme-icon",children:(null===(e=u.find(e=>e.id===n))||void 0===e?void 0:e.icon)||"\ud83c\udfa8"}),(0,k.jsx)("span",{className:"current-theme-name",children:(null===(t=u.find(e=>e.id===n))||void 0===t?void 0:t.name)||"Custom Theme"})]})]})})]})]}),i&&(0,k.jsx)("div",{className:"theme-panel-overlay",onClick:()=>r(!1)})]})},ht=()=>{const[e,t]=(0,a.useState)(navigator.onLine),[n,s]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{const e=()=>{t(!0),s(!0),setTimeout(()=>s(!1),3e3)},n=()=>{t(!1),s(!0)};return window.addEventListener("online",e),window.addEventListener("offline",n),navigator.onLine||s(!0),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}},[]),n?(0,k.jsx)("div",{className:"connection-status ".concat(e?"online":"offline"),children:(0,k.jsxs)("div",{className:"status-content",children:[(0,k.jsx)("span",{className:"status-icon",children:e?"\ud83d\udfe2":"\ud83d\udd34"}),(0,k.jsx)("span",{className:"status-text",children:e?"Back online":"No internet connection"})]})}):null};const mt=new class{constructor(){this.isSupported="serviceWorker"in navigator,this.shortcuts=new Map,this.initialize()}initialize(){this.isSupported?(this.registerServiceWorker(),this.initializeShortcuts(),this.handleAppInstall()):console.warn("PWA: Service Workers not supported in this browser")}async registerServiceWorker(){try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.register("".concat("/quibish","/sw.js"),{scope:"".concat("/quibish","/")});console.log("PWA: Service Worker registered successfully:",e.scope),e.addEventListener("updatefound",()=>{console.log("PWA: Service Worker update found")})}}catch(e){console.error("PWA: Service Worker registration failed:",e)}}initializeShortcuts(){this.shortcuts.set("voice-call",{name:"Voice Call",shortName:"Call",description:"Start a voice call",url:"/?action=voice-call",icons:[{src:"/icons/voice-call-96x96.png",sizes:"96x96"}]}),this.shortcuts.set("video-call",{name:"Video Call",shortName:"Video",description:"Start a video call",url:"/?action=video-call",icons:[{src:"/icons/video-call-96x96.png",sizes:"96x96"}]}),this.shortcuts.set("new-message",{name:"New Message",shortName:"Message",description:"Compose a new message",url:"/?action=new-message",icons:[{src:"/icons/message-96x96.png",sizes:"96x96"}]})}handleAppInstall(){let e;window.addEventListener("beforeinstallprompt",t=>{console.log("PWA: Install prompt available"),t.preventDefault(),e=t,this.showInstallButton(e)}),window.addEventListener("appinstalled",t=>{console.log("PWA: App installed successfully"),e=null})}showInstallButton(e){if(!document.getElementById("pwa-install-button")){const t=document.createElement("button");t.id="pwa-install-button",t.textContent="Install App",t.className="pwa-install-btn",t.addEventListener("click",async()=>{if(e){e.prompt();const n=await e.userChoice;console.log("PWA: Install prompt result:",n),e=null,t.style.display="none"}});const n=()=>{const e=document.querySelector("header")||document.body;e&&e.appendChild(t)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()}}triggerShortcut(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.shortcuts.get(e);if(!n)return console.warn("PWA: Unknown shortcut: ".concat(e)),!1;console.log("PWA: Triggering shortcut: ".concat(n.name),t);const a=new CustomEvent("pwa-shortcut-".concat(e),{detail:{shortcut:n,options:t}});return window.dispatchEvent(a),!0}async share(e){if(!navigator.share)return console.warn("PWA: Web Share API not supported"),this.fallbackShare(e);try{return await navigator.share(e),console.log("PWA: Content shared successfully"),!0}catch(t){return"AbortError"===t.name?console.log("PWA: Share cancelled by user"):console.error("PWA: Share failed:",t),!1}}fallbackShare(e){if(navigator.clipboard&&e.text)return navigator.clipboard.writeText(e.text),console.log("PWA: Content copied to clipboard"),!0;const t=e.url||window.location.href,n=e.text||e.title||"Check this out!",a=document.createElement("input");return a.value="".concat(n," ").concat(t),document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),console.log("PWA: Content copied to clipboard (fallback)"),!0}async requestNotificationPermission(){if(!("Notification"in window))return console.warn("PWA: Notifications not supported"),!1;if("granted"===Notification.permission)return!0;if("denied"===Notification.permission)return console.warn("PWA: Notification permission denied"),!1;return"granted"===await Notification.requestPermission()}async showNotification(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!await this.requestNotificationPermission())return console.warn("PWA: Cannot show notification - permission denied"),!1;const n=c(c({},{icon:"/icons/icon-192x192.png",badge:"/icons/badge-72x72.png",tag:"quibish-notification",requireInteraction:!1,silent:!1}),t);try{const a=new Notification(e,n);return a.onclick=()=>{window.focus(),a.close(),t.onClick&&t.onClick()},a}catch(a){return console.error("PWA: Failed to show notification:",a),!1}}isStandalone(){return window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://")}getCapabilities(){return{serviceWorker:"serviceWorker"in navigator,notifications:"Notification"in window,share:"share"in navigator,clipboard:"clipboard"in navigator,geolocation:"geolocation"in navigator,camera:"mediaDevices"in navigator&&"getUserMedia"in navigator.mediaDevices,standalone:this.isStandalone(),online:navigator.onLine}}setupNetworkHandling(){window.addEventListener("online",()=>{console.log("PWA: Back online"),document.body.classList.remove("offline"),document.body.classList.add("online")}),window.addEventListener("offline",()=>{console.log("PWA: Gone offline"),document.body.classList.remove("online"),document.body.classList.add("offline")}),navigator.onLine?document.body.classList.add("online"):document.body.classList.add("offline")}};const pt=new class{constructor(){this.shortcuts=[],this.isInitialized=!1}init(){if(!this.isInitialized)try{"serviceWorker"in navigator&&"shortcuts"in navigator&&this.registerShortcuts(),this.isInitialized=!0}catch(e){console.warn("PWA Shortcuts not supported:",e)}}registerShortcuts(){this.shortcuts=[{name:"New Chat",short_name:"Chat",description:"Start a new conversation",url:"/?action=new-chat",icons:[{src:"/logo192.png",sizes:"192x192"}]},{name:"Profile",short_name:"Profile",description:"View your profile",url:"/?action=profile",icons:[{src:"/logo192.png",sizes:"192x192"}]}]}getShortcuts(){return this.shortcuts}updateShortcuts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];try{const t=e.slice(0,3).map((e,t)=>({name:"Chat with ".concat(e.name),short_name:e.name,description:"Start conversation with ".concat(e.name),url:"/?action=chat&contact=".concat(e.id),icons:[{src:e.avatar||"/logo192.png",sizes:"192x192"}]}));this.shortcuts=[...this.shortcuts.slice(0,2),...t],console.log("\ud83d\udd17 PWA shortcuts updated with frequent contacts")}catch(t){console.warn("Failed to update PWA shortcuts:",t)}}};const gt=new class{constructor(){this.migrationVersion="1.0.0",this.migrationKey="quibish_migration_status"}needsMigration(){try{const e=localStorage.getItem(this.migrationKey);return!e||e!==this.migrationVersion}catch(e){return console.warn("\u26a0\ufe0f Could not check migration status:",e),!0}}async performMigration(){console.log("\ud83d\udd04 Starting data migration to persistent storage...");try{const e={userMigrated:!1,messagesMigrated:!1,tokenMigrated:!1,settingsMigrated:!1,conversationsMigrated:!1};return e.userMigrated=this.migrateUserData(),e.messagesMigrated=this.migrateMessages(),e.tokenMigrated=this.migrateAuthTokens(),e.settingsMigrated=this.migrateSettings(),e.conversationsMigrated=this.migrateConversations(),localStorage.setItem(this.migrationKey,this.migrationVersion),console.log("\u2705 Data migration completed:",e),this.cleanupOldData(),e}catch(e){throw console.error("\u274c Data migration failed:",e),e}}migrateUserData(){try{const t=[localStorage.getItem("user"),sessionStorage.getItem("user"),localStorage.getItem("currentUser"),sessionStorage.getItem("currentUser")];for(const n of t)if(n)try{const e=JSON.parse(n);if(e&&e.id){const t=S.getUserData();if(!t||t.id!==e.id)return S.setUserData(e),console.log("\ud83d\udc64 Migrated user data:",e.username||e.name),!0}}catch(e){console.warn("\u26a0\ufe0f Could not parse user data from source:",e)}return!1}catch(t){return console.error("\u274c User data migration failed:",t),!1}}migrateMessages(){try{const t=[localStorage.getItem("quibish_messages"),localStorage.getItem("messages"),sessionStorage.getItem("quibish_messages"),sessionStorage.getItem("messages")];for(const n of t)if(n)try{const e=JSON.parse(n);if(Array.isArray(e)&&e.length>0){if(0===S.getMessages().length)return S.setMessages(e),console.log("\ud83d\udcac Migrated messages:",e.length),!0}}catch(e){console.warn("\u26a0\ufe0f Could not parse messages from source:",e)}return!1}catch(t){return console.error("\u274c Messages migration failed:",t),!1}}migrateAuthTokens(){try{const e=[localStorage.getItem("authToken"),localStorage.getItem("token"),sessionStorage.getItem("authToken"),sessionStorage.getItem("token")];for(const t of e)if(t){if(!S.getAuthToken())return S.setAuthToken(t),console.log("\ud83d\udd11 Migrated auth token"),!0}return!1}catch(e){return console.error("\u274c Auth token migration failed:",e),!1}}migrateSettings(){try{const t=[localStorage.getItem("settings"),localStorage.getItem("userSettings"),localStorage.getItem("preferences"),sessionStorage.getItem("settings")];for(const n of t)if(n)try{const e=JSON.parse(n);if(e&&"object"===typeof e){const t=S.getSettings();if(0===Object.keys(t).length)return S.setSettings(e),console.log("\u2699\ufe0f Migrated settings:",Object.keys(e)),!0}}catch(e){console.warn("\u26a0\ufe0f Could not parse settings from source:",e)}return!1}catch(t){return console.error("\u274c Settings migration failed:",t),!1}}migrateConversations(){try{const t=[localStorage.getItem("conversations"),localStorage.getItem("chats"),sessionStorage.getItem("conversations")];for(const n of t)if(n)try{const e=JSON.parse(n);if(Array.isArray(e)&&e.length>0){if(0===S.getConversations().length)return S.setConversations(e),console.log("\ud83d\udcac Migrated conversations:",e.length),!0}}catch(e){console.warn("\u26a0\ufe0f Could not parse conversations from source:",e)}return!1}catch(t){return console.error("\u274c Conversations migration failed:",t),!1}}cleanupOldData(){try{let e=0;["user","currentUser","authToken","token","quibish_messages","messages","settings","userSettings","preferences","conversations","chats"].forEach(t=>{localStorage.getItem(t)&&(localStorage.removeItem(t),e++),sessionStorage.getItem(t)&&(sessionStorage.removeItem(t),e++)}),e>0&&console.log("\ud83e\uddf9 Cleaned up ".concat(e," old storage entries"))}catch(e){console.warn("\u26a0\ufe0f Error during cleanup:",e)}}createBackup(){try{const e=S.exportAllData(),t="quibish_backup_".concat(Date.now());return localStorage.setItem(t,JSON.stringify(e)),console.log("\ud83d\udcbe Created data backup:",t),this.cleanupOldBackups(),t}catch(e){return console.error("\u274c Failed to create backup:",e),null}}cleanupOldBackups(){try{const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);n&&n.startsWith("quibish_backup_")&&e.push(n)}e.sort((e,t)=>{const n=parseInt(e.split("_")[2]);return parseInt(t.split("_")[2])-n}),e.length>3&&e.slice(3).forEach(e=>{localStorage.removeItem(e),console.log("\ud83d\uddd1\ufe0f Removed old backup: ".concat(e))})}catch(e){console.warn("\u26a0\ufe0f Error during backup cleanup:",e)}}restoreFromBackup(e){try{const t=localStorage.getItem(e);if(!t)throw new Error("Backup not found");const n=JSON.parse(t);if(S.importAllData(n))return console.log("\u2705 Data restored from backup:",e),!0;throw new Error("Import failed")}catch(t){return console.error("\u274c Failed to restore from backup:",t),!1}}getAvailableBackups(){try{const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(n&&n.startsWith("quibish_backup_")){const t=parseInt(n.split("_")[2]);e.push({key:n,timestamp:t,date:new Date(t).toLocaleString()})}}return e.sort((e,t)=>t.timestamp-e.timestamp)}catch(e){return console.error("\u274c Failed to get backups:",e),[]}}async initializePersistence(){try{console.log("\ud83d\ude80 Initializing data persistence..."),this.createBackup(),this.needsMigration()&&await this.performMigration();const e=S.healthCheck();return e.healthy||console.warn("\u26a0\ufe0f Storage health check failed:",e),console.log("\u2705 Data persistence initialized successfully"),!0}catch(e){return console.error("\u274c Failed to initialize persistence:",e),!1}}},ft=()=>{const{isAuthenticated:e,user:t,loading:n,logout:s}=C(),[i,r]=(0,a.useState)("login"),[o,l]=(0,a.useState)(()=>!sessionStorage.getItem("quibish-splash-seen")),[c,d]=(0,a.useState)(()=>{const e=localStorage.getItem("quibish-dark-mode");return!!e&&JSON.parse(e)}),[u,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(null),[g]=(0,a.useState)([{id:1,name:"Sarah Johnson",avatar:"https://ui-avatars.com/api/?name=Sarah+Johnson&background=8b5cf6&color=fff&size=40",lastMessage:"Hey! Are we still on for lunch today?",lastMessageTime:"2m",unreadCount:2,isOnline:!0,isPinned:!0,isMuted:!1,messageStatus:"delivered",timestamp:new Date(Date.now()-12e4)},{id:2,name:"Team Alpha",avatar:"https://ui-avatars.com/api/?name=Team+Alpha&background=10b981&color=fff&size=40",lastMessage:"Mike: The deployment went smoothly \ud83d\ude80",lastMessageTime:"15m",unreadCount:5,isOnline:!1,isPinned:!1,isMuted:!1,messageStatus:"read",timestamp:new Date(Date.now()-9e5)},{id:3,name:"Alex Chen",avatar:"https://ui-avatars.com/api/?name=Alex+Chen&background=f59e0b&color=fff&size=40",lastMessage:"Thanks for the code review!",lastMessageTime:"1h",unreadCount:0,isOnline:!0,isPinned:!1,isMuted:!0,messageStatus:"sent",timestamp:new Date(Date.now()-36e5)},{id:4,name:"Design Team",avatar:"https://ui-avatars.com/api/?name=Design+Team&background=ef4444&color=fff&size=40",lastMessage:"Lisa: New mockups are ready for review",lastMessageTime:"3h",unreadCount:1,isOnline:!1,isPinned:!0,isMuted:!1,messageStatus:"delivered",timestamp:new Date(Date.now()-108e5)},{id:5,name:"Mom",avatar:"https://ui-avatars.com/api/?name=Mom&background=ec4899&color=fff&size=40",lastMessage:"Don't forget to call grandma today! \u2764\ufe0f",lastMessageTime:"5h",unreadCount:0,isOnline:!1,isPinned:!1,isMuted:!1,messageStatus:"read",timestamp:new Date(Date.now()-18e6)}]),[f]=(0,a.useState)(g[0]);(0,a.useEffect)(()=>{e&&t&&!n?(console.log("App - User authenticated, setting view to home"),r("home")):e||n||(console.log("App - User not authenticated, ensuring login view"),"home"===i&&r("login"))},[e,t,n,i]),(0,a.useEffect)(()=>{if(t&&t.theme){const e="dark"===t.theme;d(e),localStorage.setItem("quibish-dark-mode",JSON.stringify(e))}},[t]),(0,a.useEffect)(()=>((async()=>{try{console.log("\ud83d\ude80 Starting Quibish App...");await gt.initializePersistence()||console.warn("\u26a0\ufe0f Data persistence initialization failed, continuing with limited functionality");const e=S.healthCheck();console.log("\ud83d\udcbe Storage health:",e),console.log("\u2705 App initialization completed"),h(!0),console.log("\u2705 App initialized successfully")}catch(e){console.error("\u274c App initialization failed:",e),p(e.message),h(!0)}})(),()=>{console.log("\ud83e\uddf9 App unmounting - ensuring data persistence...");try{gt.createBackup(),console.log("\ud83d\udcbe Final backup created before unmount")}catch(e){console.warn("\u26a0\ufe0f Could not create final backup:",e)}}),[]),(0,a.useEffect)(()=>{if(window.addEventListener("pwa-new-chat",t=>{console.log("\ud83d\udcf1 PWA: New chat shortcut triggered"),e&&r("home")}),window.addEventListener("pwa-voice-call",t=>{console.log("\ud83d\udcf1 PWA: Voice call shortcut triggered",t.detail),e&&(r("home"),mt.triggerShortcut("voice-call",{initiated:"shortcut"}))}),window.addEventListener("pwa-video-call",t=>{console.log("\ud83d\udcf1 PWA: Video call shortcut triggered",t.detail),e&&(r("home"),mt.triggerShortcut("video-call",{initiated:"shortcut"}))}),window.addEventListener("pwa-files-shared",t=>{if(console.log("\ud83d\udcc1 PWA: Files shared",t.detail),e){r("home");const{files:e}=t.detail;console.log("Processing shared files:",e)}}),window.addEventListener("pwa-share-received",t=>{if(console.log("\ud83d\udce4 PWA: Content shared",t.detail),e){r("home");const{title:e,text:n,url:a}=t.detail;console.log("Processing shared content:",{title:e,text:n,url:a})}}),window.addEventListener("pwa-installed",e=>{console.log("\ud83d\udcf1 PWA: App installed",e.detail)}),e&&g.length>0){const e=g.filter(e=>e.lastMessageTime).sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp)).slice(0,4).map(e=>({id:e.id,name:e.name,avatar:e.avatar}));pt.updateShortcuts(e)}},[e,g]),(0,a.useEffect)(()=>{localStorage.setItem("quibish-dark-mode",JSON.stringify(c)),document.documentElement.setAttribute("data-theme",c?"dark":"light"),c?document.body.classList.add("dark-theme"):document.body.classList.remove("dark-theme")},[c]);const v=()=>{l(!1),sessionStorage.setItem("quibish-splash-seen","true")};return n?(0,k.jsx)(at,{size:"large",message:"Loading..."}):u?o?(0,k.jsx)(st,{isVisible:!0,darkMode:c,appVersion:"1.0.0",onComplete:v}):(0,k.jsxs)(rt,{children:[(0,k.jsx)("div",{className:"app smartphone-optimized ".concat(c?"dark-mode":""),children:(0,k.jsx)("div",{className:"app-content",children:e&&t&&!n?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(ht,{compact:!0}),(0,k.jsx)($e,{user:t,conversations:g,currentConversation:f,onLogout:()=>{s(),r("login")},darkMode:c,onToggleDarkMode:()=>d(e=>!e)})]}):n?(0,k.jsx)(at,{size:"large",message:"Signing you in..."}):(0,k.jsxs)("div",{className:"auth-container",children:["login"===i&&(0,k.jsx)(et,{onLogin:()=>{console.log("App - handleLogin called, waiting for auth state update")},switchToRegister:()=>{console.log("App - switchToRegister called"),r("register")}}),"register"===i&&(0,k.jsx)(nt,{onRegisterSuccess:()=>{console.log("App - handleRegister called, redirecting to login"),r("login")},switchToLogin:()=>r("login")})]})})}),(0,k.jsx)(ot,{}),(0,k.jsx)(lt,{}),(0,k.jsx)(ut,{})]}):(0,k.jsx)(at,{size:"large",message:m?"Initialization failed: ".concat(m):"Initializing application..."})};"true"==={NODE_ENV:"production",PUBLIC_URL:"/quibish",WDS_SOCKET_HOST:"localhost",WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:"5001",FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"http://localhost:5001/api",REACT_APP_ENV:"dev",REACT_APP_WEBSOCKET_URL:"ws://localhost:5001"}.REACT_APP_ENABLE_DIAGNOSTICS&&n.e(37).then(n.bind(n,37)),window.addEventListener("error",e=>{if(e.filename&&(e.filename.includes("contentScript.js")||e.filename.includes("chrome-extension://")||e.filename.includes("moz-extension://")))return console.warn("\ud83d\udd0c Browser extension error (ignored):",e.message),e.preventDefault(),!0});s.createRoot(document.getElementById("root")).render((0,k.jsx)(a.StrictMode,{children:(0,k.jsx)(N,{children:(0,k.jsx)(ft,{})})}))})();