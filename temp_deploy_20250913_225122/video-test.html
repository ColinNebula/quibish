<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Upload Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .video-test {
            border: 2px dashed #ccc;
            padding: 20px;
            text-align: center;
            border-radius: 5px;
            margin: 10px 0;
        }
        .video-result {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        video {
            max-width: 100%;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <h1>üé• Video Upload Functionality Test</h1>
    
    <div class="test-container">
        <h2>Test 1: Basic Video File Support</h2>
        <div class="video-test">
            <input type="file" id="videoTest" accept="video/*" multiple>
            <p>Select video files to test upload processing</p>
        </div>
        <div id="results"></div>
    </div>

    <div class="test-container">
        <h2>Test 2: Sample Video URLs</h2>
        <p>Test with online sample videos:</p>
        <button onclick="testSampleVideo('https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4')">
            Test MP4 Sample
        </button>
        <button onclick="testSampleVideo('https://sample-videos.com/zip/10/webm/SampleVideo_1280x720_1mb.webm')">
            Test WebM Sample
        </button>
        <div id="sampleResults"></div>
    </div>

    <div class="test-container">
        <h2>Test 3: Browser Compatibility</h2>
        <div id="compatibilityResults"></div>
        <button onclick="checkBrowserSupport()">Check Video Format Support</button>
    </div>

    <div class="test-container">
        <h2>Debug Log</h2>
        <div id="debugLog" class="log"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        let logElement = document.getElementById('debugLog');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'warning' ? 'warning' : type === 'success' ? 'success' : '';
            logElement.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            logElement.innerHTML = '';
        }

        // Test file upload processing
        document.getElementById('videoTest').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            log(`Selected ${files.length} files`, 'info');
            
            files.forEach(file => {
                log(`Processing: ${file.name} (${file.type}, ${(file.size / 1024 / 1024).toFixed(1)}MB)`, 'info');
                processVideoFile(file);
            });
        });

        function processVideoFile(file) {
            const videoUrl = URL.createObjectURL(file);
            log(`Created object URL: ${videoUrl}`, 'success');
            
            const video = document.createElement('video');
            video.muted = true;
            video.playsInline = true;
            
            video.onloadedmetadata = function() {
                log(`Metadata loaded - Duration: ${video.duration}s, Size: ${video.videoWidth}x${video.videoHeight}`, 'success');
                
                // Try to generate thumbnail
                video.currentTime = Math.min(video.duration * 0.1, 3);
            };
            
            video.onseeked = function() {
                log('Video seeked, generating thumbnail...', 'info');
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 320;
                    canvas.height = 180;
                    
                    ctx.drawImage(video, 0, 0, 320, 180);
                    const thumbnail = canvas.toDataURL('image/jpeg', 0.8);
                    
                    log('Thumbnail generated successfully', 'success');
                    displayVideoResult(file, videoUrl, thumbnail, video);
                } catch (error) {
                    log(`Thumbnail generation failed: ${error.message}`, 'error');
                    displayVideoResult(file, videoUrl, null, video);
                }
            };
            
            video.onerror = function(error) {
                log(`Video loading error: ${error}`, 'error');
            };
            
            video.src = videoUrl;
        }

        function displayVideoResult(file, videoUrl, thumbnail, videoElement) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'video-result';
            
            const duration = Math.round(videoElement.duration);
            const durationFormatted = `${Math.floor(duration / 60)}:${(duration % 60).toString().padStart(2, '0')}`;
            
            resultDiv.innerHTML = `
                <h3>üìπ ${file.name}</h3>
                <p><strong>Type:</strong> ${file.type}</p>
                <p><strong>Size:</strong> ${(file.size / 1024 / 1024).toFixed(1)} MB</p>
                <p><strong>Duration:</strong> ${durationFormatted}</p>
                <p><strong>Resolution:</strong> ${videoElement.videoWidth}x${videoElement.videoHeight}</p>
                ${thumbnail ? '<p><strong>Thumbnail:</strong> ‚úÖ Generated</p>' : '<p><strong>Thumbnail:</strong> ‚ùå Failed</p>'}
                <video controls preload="metadata" ${thumbnail ? `poster="${thumbnail}"` : ''}>
                    <source src="${videoUrl}" type="${file.type}">
                    Your browser does not support the video tag.
                </video>
            `;
            
            resultsDiv.appendChild(resultDiv);
        }

        function testSampleVideo(url) {
            log(`Testing sample video: ${url}`, 'info');
            const sampleResultsDiv = document.getElementById('sampleResults');
            
            const video = document.createElement('video');
            video.controls = true;
            video.preload = 'metadata';
            video.style.maxWidth = '100%';
            video.style.marginTop = '10px';
            
            video.onloadedmetadata = function() {
                log(`Sample video loaded - Duration: ${video.duration}s`, 'success');
            };
            
            video.onerror = function() {
                log('Sample video failed to load', 'error');
            };
            
            video.src = url;
            sampleResultsDiv.appendChild(video);
        }

        function checkBrowserSupport() {
            const video = document.createElement('video');
            const formats = [
                { name: 'MP4 (H.264)', type: 'video/mp4; codecs="avc1.42E01E"' },
                { name: 'WebM (VP8)', type: 'video/webm; codecs="vp8"' },
                { name: 'WebM (VP9)', type: 'video/webm; codecs="vp9"' },
                { name: 'OGG (Theora)', type: 'video/ogg; codecs="theora"' },
                { name: 'MP4 (Basic)', type: 'video/mp4' },
                { name: 'WebM (Basic)', type: 'video/webm' },
                { name: 'OGG (Basic)', type: 'video/ogg' }
            ];
            
            const resultsDiv = document.getElementById('compatibilityResults');
            resultsDiv.innerHTML = '<h3>Browser Video Format Support:</h3>';
            
            formats.forEach(format => {
                const support = video.canPlayType(format.type);
                const supportText = support === 'probably' ? '‚úÖ Full Support' : 
                                  support === 'maybe' ? '‚ö†Ô∏è Maybe' : 
                                  '‚ùå Not Supported';
                
                resultsDiv.innerHTML += `<p><strong>${format.name}:</strong> ${supportText} (${support || 'empty'})</p>`;
                log(`${format.name}: ${supportText}`, support ? 'success' : 'warning');
            });
            
            // Additional browser info
            resultsDiv.innerHTML += `
                <h4>Browser Information:</h4>
                <p><strong>User Agent:</strong> ${navigator.userAgent}</p>
                <p><strong>Platform:</strong> ${navigator.platform}</p>
            `;
        }

        // Auto-run compatibility check on load
        window.onload = function() {
            log('Video upload test page loaded', 'success');
            checkBrowserSupport();
        };
    </script>
</body>
</html>