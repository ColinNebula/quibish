"use strict";(self.webpackChunkquibish=self.webpackChunkquibish||[]).push([[839],{839:(t,e,s)=>{s.r(e),s.d(e,{default:()=>i});var a=s(555),n=s(43);"undefined"!==typeof document&&function(){const t=document.createElement("style");t.textContent="\n/* Gesture Feedback Styles */\n.touch-focused {\n  outline: 2px solid #3b82f6;\n  outline-offset: 2px;\n}\n\n.touch-active {\n  transform: scale(0.95);\n  transition: transform 0.1s ease;\n}\n\n.gesture-target {\n  touch-action: manipulation;\n  user-select: none;\n  -webkit-user-select: none;\n}\n\n.zoomable {\n  touch-action: pan-x pan-y;\n  cursor: grab;\n}\n\n.zoomable.zoomed {\n  cursor: grabbing;\n}\n\n.swipeable {\n  touch-action: pan-y;\n}\n\n.no-touch-action {\n  touch-action: none;\n}\n\n/* Context menu styles */\n.gesture-context-menu {\n  position: fixed;\n  background: white;\n  border-radius: 8px;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n  padding: 8px 0;\n  z-index: 10000;\n  min-width: 150px;\n}\n\n.gesture-context-menu-item {\n  padding: 12px 16px;\n  cursor: pointer;\n  border: none;\n  background: none;\n  width: 100%;\n  text-align: left;\n  font-size: 14px;\n}\n\n.gesture-context-menu-item:hover {\n  background: #f3f4f6;\n}\n\n/* Accessibility improvements */\n@media (prefers-reduced-motion: reduce) {\n  .touch-active {\n    transform: none;\n    transition: none;\n  }\n}\n\n/* High contrast mode */\n@media (prefers-contrast: high) {\n  .touch-focused {\n    outline-color: HighlightText;\n    outline-width: 3px;\n  }\n}\n",document.head.appendChild(t)}();new class{constructor(){this.isTouch="ontouchstart"in window||navigator.maxTouchPoints>0,this.activeGestures=new Map,this.gestureHistory=[],this.longPressDelay=500,this.tapThreshold=10,this.swipeThreshold=50,this.pinchThreshold=.1,this.rotationThreshold=5,this.gestureStates={idle:"idle",touching:"touching",gesturing:"gesturing",pinching:"pinching",rotating:"rotating",swiping:"swiping"},this.currentState=this.gestureStates.idle,this.gestureData=this.createGestureData(),this.init()}init(){this.isTouch?(this.setupGestureListeners(),this.setupAccessibilityFeatures(),this.setupContextMenus(),console.log("\u270b Advanced Touch Gesture Service initialized")):console.log("\ud83d\udc46 Touch not supported, gesture service disabled")}createGestureData(){return{touches:[],startTime:0,lastTime:0,startCenter:{x:0,y:0},currentCenter:{x:0,y:0},startDistance:0,currentDistance:0,startAngle:0,currentAngle:0,scale:1,rotation:0,velocity:{x:0,y:0},direction:null,target:null,longPressTimer:null,tapCount:0,lastTapTime:0}}setupGestureListeners(){document.addEventListener("touchstart",t=>{this.handleTouchStart(t)},{passive:!1}),document.addEventListener("touchmove",t=>{this.handleTouchMove(t)},{passive:!1}),document.addEventListener("touchend",t=>{this.handleTouchEnd(t)},{passive:!1}),document.addEventListener("touchcancel",t=>{this.handleTouchCancel(t)},{passive:!1})}handleTouchStart(t){const e=performance.now();this.gestureData.touches=Array.from(t.touches),this.gestureData.startTime=e,this.gestureData.lastTime=e,this.gestureData.target=t.target,1===t.touches.length?this.handleSingleTouchStart(t.touches[0],e):2===t.touches.length&&this.handleMultiTouchStart(t.touches,e),this.currentState=this.gestureStates.touching}handleSingleTouchStart(t,e){const{clientX:s,clientY:a}=t;this.gestureData.startCenter={x:s,y:a},this.gestureData.currentCenter={x:s,y:a};e-this.gestureData.lastTapTime<300?this.gestureData.tapCount++:this.gestureData.tapCount=1,this.gestureData.longPressTimer=setTimeout(()=>{this.handleLongPress(t)},this.longPressDelay),this.triggerHapticFeedback("light")}handleMultiTouchStart(t,e){this.gestureData.longPressTimer&&(clearTimeout(this.gestureData.longPressTimer),this.gestureData.longPressTimer=null);const s=this.calculateCenter(t);this.gestureData.startCenter=s,this.gestureData.currentCenter=s,2===t.length&&(this.gestureData.startDistance=this.calculateDistance(t[0],t[1]),this.gestureData.currentDistance=this.gestureData.startDistance,this.gestureData.startAngle=this.calculateAngle(t[0],t[1]),this.gestureData.currentAngle=this.gestureData.startAngle),this.currentState=this.gestureStates.gesturing,this.triggerHapticFeedback("medium")}handleTouchMove(t){const e=performance.now(),s=e-this.gestureData.lastTime;this.gestureData.longPressTimer&&(clearTimeout(this.gestureData.longPressTimer),this.gestureData.longPressTimer=null),this.gestureData.touches=Array.from(t.touches),this.gestureData.lastTime=e,1===t.touches.length?this.handleSingleTouchMove(t.touches[0],s):2===t.touches.length&&this.handleMultiTouchMove(t.touches,s);const a=this.gestureData.target;a&&("IMG"===a.tagName||"VIDEO"===a.tagName||a.closest(".zoomable")||a.closest(".media-viewer"))&&t.preventDefault()}handleSingleTouchMove(t,e){const{clientX:s,clientY:a}=t,n=this.gestureData.currentCenter;this.gestureData.currentCenter={x:s,y:a},e>0&&(this.gestureData.velocity={x:(s-n.x)/e,y:(a-n.y)/e});const r=s-this.gestureData.startCenter.x,i=a-this.gestureData.startCenter.y,o=Math.sqrt(r*r+i*i);o>this.swipeThreshold&&this.currentState!==this.gestureStates.swiping&&(this.currentState=this.gestureStates.swiping,this.gestureData.direction=this.calculateDirection(r,i),this.triggerGestureEvent("swipestart",{direction:this.gestureData.direction,distance:o,velocity:this.gestureData.velocity,target:this.gestureData.target})),this.currentState===this.gestureStates.swiping&&this.triggerGestureEvent("swipemove",{direction:this.gestureData.direction,distance:o,deltaX:r,deltaY:i,velocity:this.gestureData.velocity,target:this.gestureData.target})}handleMultiTouchMove(t,e){if(2!==t.length)return;const s=this.calculateCenter(t),a=this.calculateDistance(t[0],t[1]),n=this.calculateAngle(t[0],t[1]);this.gestureData.currentCenter=s,this.gestureData.currentDistance=a,this.gestureData.currentAngle=n;const r=a/this.gestureData.startDistance;this.gestureData.scale=r;const i=n-this.gestureData.startAngle;this.gestureData.rotation=i,Math.abs(r-1)>this.pinchThreshold&&(this.currentState!==this.gestureStates.pinching&&(this.currentState=this.gestureStates.pinching,this.triggerGestureEvent("pinchstart",{scale:r,center:s,target:this.gestureData.target})),this.triggerGestureEvent("pinchmove",{scale:r,delta:r-1,center:s,target:this.gestureData.target})),Math.abs(i)>this.rotationThreshold&&(this.currentState!==this.gestureStates.rotating&&(this.currentState=this.gestureStates.rotating,this.triggerGestureEvent("rotatestart",{rotation:i,center:s,target:this.gestureData.target})),this.triggerGestureEvent("rotatemove",{rotation:i,delta:i,center:s,target:this.gestureData.target}))}handleTouchEnd(t){const e=performance.now()-this.gestureData.startTime;switch(this.gestureData.longPressTimer&&(clearTimeout(this.gestureData.longPressTimer),this.gestureData.longPressTimer=null),this.currentState){case this.gestureStates.touching:this.handleTap(e);break;case this.gestureStates.swiping:this.handleSwipeEnd(e);break;case this.gestureStates.pinching:this.handlePinchEnd();break;case this.gestureStates.rotating:this.handleRotateEnd()}0===t.touches.length&&this.resetGestureState()}handleTap(t){if(this.calculateDistance(this.gestureData.startCenter,this.gestureData.currentCenter)<=this.tapThreshold&&t<500){this.gestureData.lastTapTime=performance.now();const e={tapCount:this.gestureData.tapCount,position:this.gestureData.currentCenter,target:this.gestureData.target,duration:t};1===this.gestureData.tapCount?setTimeout(()=>{1===this.gestureData.tapCount&&this.triggerGestureEvent("tap",e)},250):2===this.gestureData.tapCount?this.triggerGestureEvent("doubletap",e):this.gestureData.tapCount>=3&&this.triggerGestureEvent("multitap",e),this.triggerHapticFeedback("light")}}handleSwipeEnd(t){const e=this.gestureData.currentCenter.x-this.gestureData.startCenter.x,s=this.gestureData.currentCenter.y-this.gestureData.startCenter.y,a=Math.sqrt(e*e+s*s);this.triggerGestureEvent("swipeend",{direction:this.gestureData.direction,distance:a,duration:t,velocity:this.gestureData.velocity,deltaX:e,deltaY:s,target:this.gestureData.target}),this.triggerHapticFeedback("medium")}handlePinchEnd(){this.triggerGestureEvent("pinchend",{scale:this.gestureData.scale,finalScale:this.gestureData.scale,center:this.gestureData.currentCenter,target:this.gestureData.target})}handleRotateEnd(){this.triggerGestureEvent("rotateend",{rotation:this.gestureData.rotation,finalRotation:this.gestureData.rotation,center:this.gestureData.currentCenter,target:this.gestureData.target})}handleLongPress(t){this.triggerGestureEvent("longpress",{position:{x:t.clientX,y:t.clientY},target:this.gestureData.target,duration:this.longPressDelay}),this.triggerHapticFeedback("heavy"),this.showContextMenu(t)}handleTouchCancel(t){this.resetGestureState()}resetGestureState(){this.gestureData.longPressTimer&&clearTimeout(this.gestureData.longPressTimer),this.currentState=this.gestureStates.idle,this.gestureData=this.createGestureData()}setupAccessibilityFeatures(){document.addEventListener("focusin",t=>{this.isTouch&&t.target.classList.add("touch-focused")}),document.addEventListener("focusout",t=>{t.target.classList.remove("touch-focused")}),document.addEventListener("gesturestart",t=>{if(window.speechSynthesis){const e=this.createGestureAnnouncement(t.detail);e&&this.announceGesture(e)}})}setupContextMenus(){this.contextMenus=new Map,this.registerContextMenu("img",[{label:"View Full Size",action:"viewFullSize"},{label:"Download",action:"download"},{label:"Share",action:"share"}]),this.registerContextMenu("[data-text-selectable]",[{label:"Copy",action:"copy"},{label:"Select All",action:"selectAll"},{label:"Share",action:"share"}])}registerContextMenu(t,e){this.contextMenus.set(t,e)}showContextMenu(t){const e=this.gestureData.target;let s=null;for(const[a,n]of this.contextMenus)if(e.matches&&e.matches(a)){s=n;break}s&&this.triggerGestureEvent("contextmenu",{position:{x:t.clientX,y:t.clientY},target:e,items:s})}calculateDistance(t,e){const s=e.x-t.x,a=e.y-t.y;return Math.sqrt(s*s+a*a)}calculateCenter(t){let e=0,s=0;for(const a of t)e+=a.clientX,s+=a.clientY;return{x:e/t.length,y:s/t.length}}calculateAngle(t,e){return 180*Math.atan2(e.clientY-t.clientY,e.clientX-t.clientX)/Math.PI}calculateDirection(t,e){return Math.abs(t)>Math.abs(e)?t>0?"right":"left":e>0?"down":"up"}triggerHapticFeedback(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light";if(!navigator.vibrate)return;const e={light:[10],medium:[50],heavy:[100]};navigator.vibrate(e[t]||e.light)}triggerGestureEvent(t,e){const s=new CustomEvent("gesture".concat(t),{detail:(0,a.A)((0,a.A)({},e),{},{timestamp:performance.now()})});e.target&&e.target.dispatchEvent(s),document.dispatchEvent(s),this.gestureHistory.push({type:t,detail:e,timestamp:performance.now()}),this.gestureHistory.length>100&&this.gestureHistory.shift()}createGestureAnnouncement(t){const{type:e}=t;return{tap:"Button activated",doubletap:"Double tap detected",longpress:"Context menu available",swipe:"Swiped ".concat(t.direction),pinch:"Zoom gesture detected",rotate:"Rotation gesture detected"}[e]}announceGesture(t){if(window.speechSynthesis){const e=new SpeechSynthesisUtterance(t);e.volume=.3,e.rate=1.2,window.speechSynthesis.speak(e)}}getGestureAnalytics(){const t=this.gestureHistory.slice(-50),e={};return t.forEach(t=>{e[t.type]=(e[t.type]||0)+1}),{totalGestures:this.gestureHistory.length,recentGestures:t.length,gestureTypes:e,currentState:this.currentState}}setEnabled(t){this.enabled=t,t||this.resetGestureState()}destroy(){this.resetGestureState(),this.gestureHistory=[],this.activeGestures.clear(),this.contextMenus.clear()}};var r=s(579);const i=t=>{var e,s;let{media:i=[],currentIndex:o=0,isOpen:c=!1,onClose:u=()=>{},onNavigate:l=()=>{},showControls:h=!0,autoPlay:g=!1,enableGestures:d=!0}=t;const[m,p]=(0,n.useState)({scale:1,rotation:0,translateX:0,translateY:0,isDragging:!1,isZoomed:!1}),[v,D]=(0,n.useState)(o),[b,x]=(0,n.useState)(!1),[f,w]=(0,n.useState)(null),y=(0,n.useRef)(null),C=(0,n.useRef)(null),S=(0,n.useRef)({}),T=(0,n.useRef)(null),E=i[v],M=null===E||void 0===E||null===(e=E.type)||void 0===e?void 0:e.startsWith("video/"),k=null===E||void 0===E||null===(s=E.type)||void 0===s?void 0:s.startsWith("image/");(0,n.useEffect)(()=>{if(!d||!C.current)return;const t=C.current,e=t=>{k&&(S.current={scale:m.scale,rotation:m.rotation,translateX:m.translateX,translateY:m.translateY},p(t=>(0,a.A)((0,a.A)({},t),{},{isDragging:!0})))},s=t=>{if(!k||!S.current)return;const{scale:e,center:s}=t.detail,n=Math.max(.5,Math.min(5,S.current.scale*e));p(t=>(0,a.A)((0,a.A)({},t),{},{scale:n,isZoomed:n>1}))},n=t=>{if(!k)return;p(t=>(0,a.A)((0,a.A)({},t),{},{isDragging:!1}));const{scale:e}=m;let s=e;e<.8?s=1:e>4&&(s=4),s!==e&&A(s)},r=t=>{if(!k)return;const{rotation:e}=t.detail;p(t=>(0,a.A)((0,a.A)({},t),{},{rotation:S.current.rotation+e}))},o=t=>{if(!k)return;const{scale:e,isZoomed:s}=m;A(s?1:2.5)},c=t=>{const{direction:e,distance:s,velocity:a}=t.detail;!m.isZoomed&&s>100&&("left"===e&&v<i.length-1?G(1):"right"===e&&v>0&&G(-1)),"down"===e&&s>150&&u()},l=t=>{L()};return t.addEventListener("gesturepinchstart",e),t.addEventListener("gesturepinchmove",s),t.addEventListener("gesturepinchend",n),t.addEventListener("gesturerotatemove",r),t.addEventListener("gesturedoubletap",o),t.addEventListener("gestureswipeend",c),t.addEventListener("gesturelongpress",l),()=>{t.removeEventListener("gesturepinchstart",e),t.removeEventListener("gesturepinchmove",s),t.removeEventListener("gesturepinchend",n),t.removeEventListener("gesturerotatemove",r),t.removeEventListener("gesturedoubletap",o),t.removeEventListener("gestureswipeend",c),t.removeEventListener("gesturelongpress",l)}},[d,m,v,i.length,k]),(0,n.useEffect)(()=>{p({scale:1,rotation:0,translateX:0,translateY:0,isDragging:!1,isZoomed:!1}),w(null)},[v]),(0,n.useEffect)(()=>{D(o)},[o]);const A=(0,n.useCallback)(function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;const s=m.scale,n=performance.now(),r=i=>{const o=i-n,c=Math.min(o/e,1),u=1-Math.pow(1-c,3),l=s+(t-s)*u;p(t=>(0,a.A)((0,a.A)({},t),{},{scale:l,isZoomed:l>1})),c<1&&(T.current=requestAnimationFrame(r))};T.current&&cancelAnimationFrame(T.current),T.current=requestAnimationFrame(r)},[m.scale]),G=(0,n.useCallback)(t=>{const e=v+t;e>=0&&e<i.length&&(D(e),l(e))},[v,i.length,l]);(0,n.useEffect)(()=>{if(!c)return;const t=t=>{switch(t.key){case"Escape":u();break;case"ArrowLeft":G(-1);break;case"ArrowRight":G(1);break;case"+":case"=":A(Math.min(1.2*m.scale,5));break;case"-":A(Math.max(.8*m.scale,.5));break;case"0":A(1)}};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[c,u,G,m.scale,A]);const L=(0,n.useCallback)(()=>{console.log("Media info:",E)},[E]),j=(0,n.useCallback)(()=>{w("Failed to load media"),x(!1)},[]),N=(0,n.useCallback)(()=>{x(!1),w(null)},[]),P=(0,n.useCallback)(()=>{const{scale:t,rotation:e,translateX:s,translateY:a}=m;return{transform:"scale(".concat(t,") rotate(").concat(e,"deg) translate(").concat(s,"px, ").concat(a,"px)"),transformOrigin:"center center",transition:m.isDragging?"none":"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)"}},[m]);return c&&E?(0,r.jsxs)("div",{className:"enhanced-media-viewer",ref:C,"data-media-viewer":"true","aria-label":"Media viewer",role:"dialog","aria-modal":"true",children:[(0,r.jsx)("div",{className:"media-viewer-backdrop",onClick:u,"aria-hidden":"true"}),(0,r.jsxs)("div",{className:"media-viewer-content",children:[b&&(0,r.jsxs)("div",{className:"media-viewer-loading",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{children:"Loading media..."})]}),f&&(0,r.jsxs)("div",{className:"media-viewer-error",children:[(0,r.jsx)("div",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,r.jsx)("p",{children:f}),(0,r.jsx)("button",{onClick:()=>w(null),children:"Retry"})]}),!f&&(0,r.jsxs)("div",{className:"media-display-container",children:[k&&(0,r.jsx)("img",{ref:y,src:E.url,alt:E.alt||"Media",className:"media-image ".concat(m.isZoomed?"zoomed":""),style:P(),onLoad:N,onError:j,draggable:!1}),M&&(0,r.jsx)("video",{ref:y,src:E.url,className:"media-video",controls:!0,autoPlay:g,onLoadedData:N,onError:j})]}),h&&(0,r.jsxs)("div",{className:"media-viewer-controls",children:[(0,r.jsx)("button",{className:"control-button close-button",onClick:u,"aria-label":"Close viewer",children:"\u2715"}),i.length>1&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{className:"control-button nav-button prev-button",onClick:()=>G(-1),disabled:0===v,"aria-label":"Previous media",children:"\u2190"}),(0,r.jsx)("button",{className:"control-button nav-button next-button",onClick:()=>G(1),disabled:v===i.length-1,"aria-label":"Next media",children:"\u2192"})]}),k&&(0,r.jsxs)("div",{className:"zoom-controls",children:[(0,r.jsx)("button",{className:"control-button zoom-button",onClick:()=>A(Math.max(.8*m.scale,.5)),"aria-label":"Zoom out",children:"\u2212"}),(0,r.jsxs)("span",{className:"zoom-level",children:[Math.round(100*m.scale),"%"]}),(0,r.jsx)("button",{className:"control-button zoom-button",onClick:()=>A(Math.min(1.2*m.scale,5)),"aria-label":"Zoom in",children:"+"}),(0,r.jsx)("button",{className:"control-button reset-button",onClick:()=>A(1),"aria-label":"Reset zoom",children:"Reset"})]})]}),(0,r.jsxs)("div",{className:"media-viewer-info",children:[(0,r.jsxs)("span",{className:"media-counter",children:[v+1," of ",i.length]}),E.name&&(0,r.jsx)("span",{className:"media-name",children:E.name})]}),d&&k&&(0,r.jsx)("div",{className:"gesture-hints",children:(0,r.jsx)("p",{children:"\ud83d\udca1 Double tap to zoom \u2022 Pinch to zoom \u2022 Swipe to navigate"})})]})]}):null}}}]);
//# sourceMappingURL=839.710241b2.chunk.js.map